/*1342204423,176820664*/

if (window.CavalryLogger) { CavalryLogger.start_js(["QjDo1"]); }

function EmuController(a,b){this.impression=b;this.containerId=a;DataStore.set($(a),'emuController',this);return this;}copy_properties(EmuController,{fromContainer:function(a){var b=ge(a);if(!b)return null;return DataStore.get(b,'emuController');},getEventClass:function(a){return "emuEvent"+String(a).trim();}});copy_properties(EmuController.prototype,{EVENT_HANDLER_PATH:'/ajax/emu/end.php',CLICK:1,FAN:"fad_fan",event:function(a,b,c,d){var e={eid:this.impression,f:0,ui:this.containerId,en:a,a:1};if(b)e.ed=JSON.stringify(b);if(!d)var d=bagofholding;var f=new AsyncRequest().setURI(this.EVENT_HANDLER_PATH).setData(e).setErrorHandler(d);if(c)f.setHandler(c);f.send();},redirect:function(){var a={eid:this.impression,f:0,ui:this.containerId,en:this.CLICK,a:0,sig:Math.floor(Math.random()*65535)+65536},b=new URI(this.EVENT_HANDLER_PATH);b.setQueryData(a);goURI(b);}});
var ShortClickHandlers={EVENT_NAME_CAME_BACK:'cameback',onclicked:function(a){if(this.onsite)return;if(a.button!==0||a.getModifiers().any)return;this.click_ts=(+new Date());if(this.listeners!==undefined)for(var b in this.listeners)this.listeners[b].remove();this.listeners={focus:Event.listen(window,'focus',ShortClickHandlers.oncameback.bind(this))};},oncameback:function(a){var b=(+new Date())-this.click_ts;this.listeners[a.type].remove();var c={click_ts:this.click_ts,length:b,trigger:a.type};this.sendData(ShortClickHandlers.EVENT_NAME_CAME_BACK,c);}};
function EmuTracker(a,b){this.base=EmuController.fromContainer(a);!this.base;this.onsite=b;var c=DOM.scry($(a),"a."+EmuController.getEventClass(EmuTracker.EVENT_CLICK));c.forEach(function(d){Event.listen(d,'click',ShortClickHandlers.onclicked.bind(this));}.bind(this));return this;}copy_properties(EmuTracker,{EVENT_CLICK:1});copy_properties(EmuTracker.prototype,{sendData:function(a,b){this.base.event(a,b);}});
function BassWhitespaceListener(a,b){this.link=b;Event.listen(a,'click',this.onclicked.bind(this));}copy_properties(BassWhitespaceListener.prototype,{onclicked:function(a){if(Parent.byTag(a.getTarget(),'A'))return;switch(this.link.getAttribute('rel')){case 'async':Bootloader.loadComponents('async',function(){AsyncRequest.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));break;case 'theater':var b=Parent.byClass(a.getTarget(),'fbPhotoSnowlift');Bootloader.loadComponents('PhotoViewer',function(){PhotoViewer.bootstrap(this.link.getAttribute('ajaxify'),this.link);}.bind(this));if(b)return false;break;default:goURI(this.link.getAttribute('href'));}}});
__d("ErrorDialog",["Dialog"],function(a,b,c,d,e,f){var g=b('Dialog'),h={showAsyncError:function(i){try{return h.show(i.getErrorSummary(),i.getErrorDescription());}catch(j){alert(i);}},show:function(i,j,k,l){return (new g()).setTitle(i).setBody(j).setButtons([g.OK]).setStackable(true).setModal(true).setHandler(k||bagofholding).setButtonsMessage(l||'').show();}};e.exports=h;});
__d("legacy:error-dialog",["ErrorDialog"],function(a,b,c,d){var e=b('ErrorDialog');a.ErrorDialog=e;},3);
__d("DynamicIconSelector",["Button","CSS","DOM","Selector"],function(a,b,c,d,e,f){var g=b('Button'),h=b('CSS'),i=b('DOM'),j=b('Selector'),k={swapIcon:function(l){var m=j.getSelectedOptions(l)[0],n=m&&i.scry(m,'.itemIcon')[0],o=j.getSelectorButton(l);if(n){g.setIcon(o,n.cloneNode(true));}else{var p=i.scry(o,'.img')[0];p&&i.remove(p);}h.conditionClass(o,'uiSelectorChevronOnly',!n);}};j.subscribe('change',function(l,m){var n=m.selector;if(h.hasClass(n,'dynamicIconSelector'))k.swapIcon(n);});e.exports=k;});
__d("AudienceSelector",["Arbiter","CSS","DOM","DynamicIconSelector","PrivacyConst","Selector"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('DynamicIconSelector'),k=b('PrivacyConst'),l=b('Selector');l.subscribe('select',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;var o=l.getOptionValue(n.option);g.inform('AudienceSelector/changed',n);if(o==k.BaseValue.CUSTOM&&!h.hasClass(n.option,'noDialog')){l.toggle(n.selector);return false;}if(h.hasClass(n.selector,'dataTooltip')){var p=i.find(n.option,'.itemAnchor').getAttribute('data-tooltip');l.setButtonTooltip(n.selector,p||null);}if(!h.hasClass(n.option,'specialOption'))return;var q=i.find(n.option,'a').getAttribute('data-type');if(h.hasClass(n.option,'moreOption')){h.addClass(n.selector,q);h.addClass(n.selector,'showSecondaryOptions');return false;}else if(h.hasClass(n.option,'returnOption')){h.removeClass(n.selector,'showSecondaryOptions');h.removeClass(n.selector,'friendList');return false;}});g.subscribe('CustomPrivacyOption/update',function(m,n){if(!h.hasClass(n.selector,'audienceSelector'))return;l.setSelected(n.selector,l.getOptionValue(n.option));j.swapIcon(n.selector);l.setButtonTooltip(n.selector,n.tooltip);g.inform('AudienceSelector/update',n.selector);});});
__d("PrivacyModel",["PrivacyConst","copyProperties"],function(a,b,c,d,e,f){var g=b('PrivacyConst'),h=b('copyProperties');function i(){this.value=g.BaseValue.ALL_FRIENDS;this.friends=g.FriendsValue.NO_FRIENDS;this.networks=[];this.objects=[];this.lists=[];this.lists_x=[];this.list_anon=0;this.ids_anon=[];this.list_x_anon=0;this.ids_x_anon=[];this.tdata={};return this;}h(i.prototype,{init:function(j,k,l,m,n,o,p,q,r,s,t){this.value=j;this.friends=k;this.networks=l.slice();this.objects=m.slice();this.lists=n.slice();this.lists_x=o.slice();this.list_anon=p;this.ids_anon=q.slice();this.list_x_anon=r;this.ids_x_anon=s.slice();t=t||{};h(this.tdata,t);},clone:function(){var j=new i();j.init(this.value,this.friends,this.networks,this.objects,this.lists,this.lists_x,this.list_anon,this.ids_anon,this.list_x_anon,this.ids_x_anon,this.tdata);return j;},getData:function(){var j=['value','friends','networks','objects','lists','lists_x','list_anon','ids_anon','list_x_anon','ids_x_anon'],k={};for(var l=0;l<j.length;++l){var m=j[l];k[m]=this[m];}return k;}});e.exports=i;});
__d("legacy:AudienceSelector",["AudienceSelector"],function(a,b,c,d){b('AudienceSelector');},3);
__d("legacy:privacy-common",["PrivacyConst","PrivacyModel"],function(a,b,c,d){var e=b('PrivacyConst');a.PrivacyModel=b('PrivacyModel');a.PrivacyBaseValue=e.BaseValue;a.PrivacyFriendsValue=e.FriendsValue;},3);
__d("legacy:Selector",["Selector"],function(a,b,c,d){a.Selector=b('Selector');},3);
__d("GenderConst",[],function(a,b,c,d,e,f){var g={UNKNOWN:0,FEMALE_SINGULAR:1,MALE_SINGULAR:2,FEMALE_SINGULAR_GUESS:3,MALE_SINGULAR_GUESS:4,MIXED_SINGULAR:5,MIXED_PLURAL:5,NEUTER_SINGULAR:6,UNKNOWN_SINGULAR:7,FEMALE_PLURAL:8,MALE_PLURAL:9,NEUTER_PLURAL:10,UNKNOWN_PLURAL:11};e.exports=g;});
__d("Dock",["event-extensions","function-extensions","Arbiter","ArbiterMixin","ChatQuietLinks","CSS","DataStore","DOM","Parent","Style","Toggler","Vector","copyProperties","ge"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatQuietLinks'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Parent'),n=b('Style'),o=b('Toggler'),p=b('Vector'),q=b('copyProperties'),r=b('ge');function s(){}q(s,h,{MIN_HEIGHT:140,INITIAL_FLYOUT_HEIGHT_OFFSET:10,init:function(t){this.init=bagofholding;this.rootEl=t;this.calculateViewportDimensions();this.calculateFlyoutHeightOffset();i.silence(this.rootEl);Event.listen(t,'click',this._onClick.bind(this));Event.listen(window,'resize',this._onWindowResize.bind(this));o.subscribe(['show','hide'],function(u,v){var w=v.getActive();if(!l.contains(t,w))return;if(j.hasClass(w,'fbNub')){this.notifyNub(w,u);if(u==='show')this._resizeNubFlyout(w);}else{var x=m.byClass(w,'fbNubFlyout');if(x)j.conditionClass(x,'menuOpened',u==='show');}}.bind(this));this.inform('init',{},g.BEHAVIOR_PERSISTENT);},calculateViewportDimensions:function(){return (this.viewportDimensions=p.getViewportDimensions());},calculateFlyoutHeightOffset:function(){this.flyoutHeightOffset=this.INITIAL_FLYOUT_HEIGHT_OFFSET+p.getElementDimensions(this.rootEl).y;var t=r('blueBar');if(t){var u=n.isFixed(t)?'viewport':'document';this.flyoutHeightOffset+=p.getElementPosition(t,u).y+p.getElementDimensions(t).y;}},toggle:function(t){var u=this._findFlyout(t);if(!u)return;this.subscribe('init',function(){o.toggle(t);});},show:function(t){this.subscribe('init',function(){o.show(t);});},showNub:function(t){j.show(t);},hide:function(t){this.subscribe('init',function(){var u=o.getInstance(t);l.contains(t,u.getActive())&&u.hide();});},hideNub:function(t){j.hide(t);this.hide(t);},setUseMaxHeight:function(t,u){j.conditionClass(t,'maxHeight',u!==false);this._resizeNubFlyout(t);},_resizeNubFlyout:function(t){var u=this._findFlyout(t);if(!u||!(j.hasClass(t,'openToggler')||j.hasClass(t,'opened')))return;var v=l.find(u,'div.fbNubFlyoutOuter'),w=l.find(v,'div.fbNubFlyoutInner'),x=l.find(w,'div.fbNubFlyoutBody'),y=x.scrollTop,z=x.offsetHeight;n.set(x,'height','auto');var aa=p.getElementPosition(u,'viewport'),ba=p.getElementDimensions(u),ca=p.getElementDimensions(x),da=Math.max(this.MIN_HEIGHT,this.viewportDimensions.y-this.flyoutHeightOffset)-(this.viewportDimensions.y-aa.y-ba.y);da=Math.max(da,0);n.set(u,'max-height',da+'px');n.set(v,'max-height',da+'px');ba=p.getElementDimensions(u);var ea=p.getElementDimensions(w),fa=ea.y-ca.y;if(ba.y>fa)n.set(x,'height',(ba.y-fa)+'px');j.removeClass(u,'swapDirection');var ga=p.getElementPosition(u).x;j.conditionClass(u,'swapDirection',function(){if(ga<0)return true;return (ga+ba.x>this.viewportDimensions.x);}.bind(this)());if(y+z>=ca.y){x.scrollTop=ca.y;}else x.scrollTop=y;this.notifyNub(t,'resize');},resizeAllFlyouts:function(){var t=l.scry(this.rootEl,'div.fbNub.openToggler');t=t.concat(l.scry(this.rootEl,'div.fbNub.opened'));var u=t.length;while(u--)this._resizeNubFlyout(t[u]);},_onClick:function(event){var t=event.getTarget(),u=m.byClass(t,'fbNub');if(u){if(m.byClass(t,'fbNubFlyoutTitlebar')){var v=m.byTag(t,'a');if(!v){this.hide(u);return false;}}this.notifyNub(u,'click');}},_onWindowResize:function(event){this.calculateViewportDimensions();this.resizeAllFlyouts();},_findFlyout:function(t){return j.hasClass(t,'fbNubFlyout')?t:l.scry(t,'div.fbNubFlyout')[0]||null;},registerNubController:function(t,u){k.set(t,'dock:nub:controller',u);u.subscribe('nub/button/content-changed',this.inform.shield(this,'resize',t));u.subscribe('nub/flyout/content-changed',this._resizeNubFlyout.shield(this,t));},unregisterNubController:function(t){k.remove(t,'dock:nub:controller');},notifyNub:function(t,u,v){var w=k.get(t,'dock:nub:controller');w&&w.inform(u,v);}});e.exports=a.Dock||s;});
__d("NubController",["ArbiterMixin","Class","Dock","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('Class'),i=b('Dock'),j=b('copyProperties');function k(){}j(k.prototype,g,{init:function(l){this.el=l;i.registerNubController(l,this);return this;},buttonContentChanged:function(){this.inform('nub/button/content-changed');},flyoutContentChanged:function(){this.inform('nub/flyout/content-changed');},hide:function(){i.hide(this.el);},show:function(){i.show(this.el);}});e.exports=k;});
__d("DropdownContextualHelpLink",["copyProperties","DOM","ge"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('DOM'),i=b('ge'),j={set:function(k){var l=i('navHelpCenter');if(l!==null)h.replace(l,k);}};e.exports=j;});
__d("isRTL",[],function(a,b,c,d,e,f){function g(h){for(var i=0;i<h.length;i++){var j=h.charCodeAt(i);if(j>=48)return j>=1470&&j<=1920;}return false;}e.exports=g;});
__d("IntlDateFormats",[],function(a,b,c,d,e,f){var g={},h={setFormats:function(i,j){g=j;},getFormat:function(i){if(!(i in g))return i;return g[i];}};e.exports=h;});
__d("date-extensions",["IntlDateFormats","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('IntlDateFormats'),h=b('copyProperties'),i=b('tx'),j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],k=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],l=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],m=["January","February","March","April","May","June","July","August","September","October","November","December"];function n(o,p){p=p||2;o=''+o;while(o.length<p)o='0'+o;return o;}Date.format=function(o,p,q){var r=p?new Date(p*1000):new Date();return r.format(o,q);};h(Date.prototype,{format:function(o,p){if(!o)return '';var q=[],r=null,s=null,t=(p?'getUTC':'get'),u=this[t+'Date'](),v=this[t+'Day'](),w=this[t+'Month'](),x=this[t+'FullYear'](),y=this[t+'Hours'](),z=this[t+'Minutes'](),aa=this[t+'Seconds'](),ba=this[t+'Milliseconds']();for(var ca=0;ca<o.length;ca++){s=o.charAt(ca);if(s=='\\'){ca++;q.push(o.charAt(ca));continue;}switch(s){case 'd':r=n(u);break;case 'D':r=j[v];break;case 'j':r=u;break;case 'l':r=k[v];break;case 'F':r=m[w];break;case 'm':r=n(w+1);break;case 'M':r=l[w];break;case 'n':r=w+1;break;case 'Y':r=x;break;case 'y':r=(''+x).slice(2);break;case 'a':r=y<12?'am':'pm';break;case 'A':r=y<12?'AM':'PM';break;case 'g':r=(y==0||y==12)?12:y%12;break;case 'G':r=y;break;case 'h':r=(y==0||y==12)?12:n(y%12);break;case 'H':r=n(y);break;case 'i':r=n(z);break;case 's':r=n(aa);break;case 'S':r=n(ba,3);break;default:r=s;}q.push(r);}return q.join('');}});a.IntlDateFormats=g;},3);
__d("ChatActivity",["Arbiter","AvailableList","AvailableListConstants","copyProperties","event-extensions","JSLogger","MercuryThreads","PresenceState","UserActivity","MercuryConfig"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('copyProperties');b('event-extensions');var k=b('JSLogger'),l=b('MercuryThreads'),m=b('PresenceState'),n=b('UserActivity'),o=c('MercuryConfig'),p=o.activity_limit||60000,q=o.idle_limit||1800000,r=o.idle_poll_interval||300000,s=k.create('chat_activity'),t=Date.now(),u=t,v=true;function w(){var aa=Date.now();return !!(v&&(aa-t<p));}var x=j(new g(),{isActive:w});function y(){var aa=t;t=Date.now();if(t-aa>q){s.debug('idle_to_active',aa);m.doSync();}x.inform('activity');}h.subscribe(i.ON_AVAILABILITY_CHANGED,function(){if(!h.isUserIdle())u=Date.now();});Event.listen(window,'focus',function(){v=true;y();});Event.listen(window,'blur',function(){v=false;});n.subscribe(function(){y();});function z(aa){var ba=aa&&aa.at&&m.verifyNumber(aa.at);if(typeof ba!=='number')ba=null;return ba||0;}setInterval(function(){var aa=Date.now(),ba=z(m.get()),ca=Math.max(t,ba,u);if(aa-ca>q){s.debug('idle',{cookie:ba,local:t,presence:u});x.inform('idle',aa-ca);}},r);m.registerStateStorer(function(aa){var ba=z(aa);if(ba<t)aa.at=t;return aa;});g.subscribe(k.DUMP_EVENT,function(aa,ba){ba.chat_activity={activity_limit:p,idle_limit:q,idle_poll_interval:r,last_active_time:t,last_global_active_time:u};});e.exports=x;});
__d("MercuryNotificationRenderer",["MercuryAssert","MercuryMessages","MercuryParticipants","MercuryThreads","tx"],function(a,b,c,d,e,f){var g=b('MercuryAssert'),h=b('MercuryMessages'),i=b('MercuryParticipants'),j=b('MercuryThreads'),k=b('tx');function l(m,n){g.isThreadID(m);j.getThreadMeta(m,function(o){h.getThreadMessagesRange(m,0,1,function(p){var q=p.length&&p[p.length-1];if(q&&q.author!=i.user){i.get(q.author,function(r){if(o.name){n(k._("{senderName} messaged {groupName}",{senderName:r.short_name,groupName:o.name}));}else n(k._("{name} messaged you",{name:r.short_name}));});}else n("New message!");});});}e.exports={renderDocumentTitle:l};});
__d("ChatTitleBarBlinker",["ChatActivity","DocumentTitle","JSLogger","MercuryThreadInformer","MercuryNotificationRenderer","PresenceState","MercuryTimestampTracker","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('DocumentTitle'),i=b('JSLogger'),j=b('MercuryThreadInformer'),k=b('MercuryNotificationRenderer'),l=b('PresenceState'),m=b('MercuryTimestampTracker'),n=b('MercuryUnseenState'),o=i.create('chat_title'),p=null,q=0,r=false;function s(){if(p){p.stop();p=null;return true;}return false;}function t(y){var z=y||m.getLastUserMessageTimestamp();if(q<=z){q=z;if(s()||r)l.doSync();}}var u={blink:function(y,z){if(!p&&q<z)k.renderDocumentTitle(y,function(aa){if(!p)p=h.blink(aa);});},stopBlinking:function(){t();},blinkingElsewhere:function(){r=true;}};function v(y){var z=l.verifyNumber(y.sb2);if(!z||z<=q)return null;return z;}function w(y){var z=y&&v(y);if(z){q=z;o.debug('load',q);s();r=false;}}function x(y){var z=v(y);if(!z){o.debug('store',q);y.sb2=q;r=false;}return y;}l.registerStateStorer(x);l.registerStateLoader(w);j.subscribe('thread-read-changed',function(y,z){var aa=m.getLastUserMessageTimestamp(),ba=0;for(var ca in z)if(z[ca].mark_as_read&&z[ca].timestamp>=aa&&z[ca].timestamp>ba)ba=z[ca].timestamp;ba&&t(ba);});g.subscribe('activity',function(){t();});(function(){var y=l.getInitial();if(y)q=v(y)||0;})();e.exports=u;});
__d("ControlledReferer",["event-extensions","URI"],function(a,b,c,d,e,f){b('event-extensions');var g=b('URI'),h={useFacebookReferer:function(i,j,k){var l=false;function m(){if(l)return;l=true;i.contentWindow.document.body.style.margin=0;j();}var n;if(document.domain!=='facebook.com'){n='/intern/common/referer_frame.php';}else if(g().isSecure()){n='https://s-static.ak.facebook.com/common/referer_frame.php';}else n='http://static.ak.facebook.com/common/referer_frame.php';if(k)n+='?fb_source='+k;Event.listen(i,'load',m);i.src=n;},useFacebookRefererHtml:function(i,j,k){h.useFacebookReferer(i,function(){i.contentWindow.document.body.innerHTML=j;},k);}};e.exports=h;});
__d("swfobject",["AsyncRequest","Bootloader","ControlledReferer","copyProperties","CSS","DOM","function-extensions","ge","StringEscape"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Bootloader'),i=b('ControlledReferer'),j=b('copyProperties'),k=b('CSS'),l=b('DOM');b('function-extensions');var m=b('ge'),n=b('StringEscape');if(typeof o=="undefined")var o={};if(typeof o.util=="undefined")o.util={};if(typeof o.SWFObjectUtil=="undefined")o.SWFObjectUtil={};o.SWFObject=function(u,v,w,x,y,z,aa,ba,ca,da){if(!document.getElementById)return;this.DETECT_KEY=da?da:'detectflash';this.skipDetect=o.util.getRequestParameter(this.DETECT_KEY);this.params={};this.variables={};this.attributes=[];this.fallback_html='';this.fallback_js_fcn=function(){};if(u)this.setAttribute('swf',u);if(v)this.setAttribute('id',v);if(w)this.setAttribute('width',w);if(x)this.setAttribute('height',x);this.installedVer=o.SWFObjectUtil.getPlayerVersion();if(y){if(!(y instanceof Array))y=[y];var ea;y.forEach(function(ha){ea=new o.PlayerVersion(ha.toString().split('.'));if(ea.major==this.installedVer.major){this.setAttribute('version',ea);return;}else if(!this.getAttribute('version')||ea.major<this.getAttribute('version').major)this.setAttribute('version',ea);}.bind(this));}if(!window.opera&&document.all&&this.installedVer.major>7)if(!o.unloadSet){o.SWFObjectUtil.prepUnload=function(){var ha=function(){},ia=function(){};window.attachEvent("onunload",o.SWFObjectUtil.cleanupSWFs);};window.attachEvent("onbeforeunload",o.SWFObjectUtil.prepUnload);o.unloadSet=true;}if(z)this.addParam('bgcolor',z);var fa=aa?aa:'high';this.addParam('quality',fa);this.setAttribute('useExpressInstall',false);this.setAttribute('doExpressInstall',false);var ga=(ba)?ba:window.location;this.setAttribute('xiRedirectUrl',ga);this.setAttribute('redirectUrl','');if(ca)this.setAttribute('redirectUrl',ca);this.setAttribute('useIframe',false);};o.SWFObject.ieWorkaroundApplied=false;o.SWFObject.ensureIEWorkaroundAttached=function(){if(!o.SWFObject.ieWorkaroundApplied&&document.attachEvent){o.SWFObject.ieWorkaroundApplied=true;document.attachEvent('onpropertychange',o.SWFObject.onDocumentPropertyChange);}};o.SWFObject.onDocumentPropertyChange=function(event){if(event.propertyName=="title"){var u=document.title;if(u!=null&&u.indexOf('#!')!=-1){u=u.substring(0,u.indexOf('#!'));document.title=u;}}};j(o.SWFObject.prototype,{useExpressInstall:function(u){this.xiSWFPath=!u?"/swf/expressinstall.swf":u;this.setAttribute('useExpressInstall',true);},setAttribute:function(u,v){this.attributes[u]=v;},getAttribute:function(u){return this.attributes[u]||"";},addParam:function(u,v){this.params[u]=v;},getParams:function(){return this.params;},addVariable:function(u,v){this.variables[u]=v;},getVariable:function(u){return this.variables[u]||"";},getVariables:function(){return this.variables;},getVariablePairs:function(){var u=[],v,w=this.getVariables();for(v in w)u[u.length]=v+"="+w[v];return u.join('&');},getSWFHTML:function(){var u,v,w;if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute('swf',this.xiSWFPath);}v={type:'application/x-shockwave-flash',src:this.getAttribute('swf'),width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;',id:this.getAttribute('id'),name:this.getAttribute('id')};var x=this.getParams();for(var y in x)v[y]=x[y];w=this.getVariablePairs();if(w)v.flashvars=w;u=t('embed',v,null);}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute('swf',this.xiSWFPath);}v={id:this.getAttribute('id'),classid:'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000',width:this.getAttribute('width'),height:this.getAttribute('height'),style:this.getAttribute('style')||'display: block;'};var z=t('param',{name:'movie',value:this.getAttribute('swf')},null),x=this.getParams();for(var y in x)z+=t('param',{name:y,value:x[y]},null);w=this.getVariablePairs();if(w)z+=t('param',{name:'flashvars',value:w},null);u=t('object',v,z);}return u;},write:function(u){if(this.getAttribute('useExpressInstall')){var v=new o.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(v)&&!this.installedVer.versionIsValid(this.getAttribute('version'))){this.setAttribute('doExpressInstall',true);this.addVariable("MMredirectURL",escape(this.getAttribute('xiRedirectUrl')));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title);}}var w=(typeof u=='string')?document.getElementById(u):u;if(!w)return false;k.addClass(w,'swfObject');w.setAttribute('data-swfid',this.getAttribute('id'));if(this.skipDetect||this.getAttribute('doExpressInstall')||this.installedVer.versionIsValid(this.getAttribute('version'))){if(!this.getAttribute('useIframe')){o.SWFObject.ensureIEWorkaroundAttached();w.innerHTML=this.getSWFHTML();}else this._createIframe(w);return true;}else{if(this.getAttribute('redirectUrl')!="")document.location.replace(this.getAttribute('redirectUrl'));var x=this.getAttribute('version').major+'.'+this.getAttribute('version').minor+'.'+this.getAttribute('version').release+'.'+this.getAttribute('version').build,y=this.installedVer.major+'.'+this.installedVer.minor+'.'+this.installedVer.release+'.'+this.installedVer.build;this.fallback_js_fcn(y,x);w.innerHTML=this.fallback_html;}return false;},_createIframe:function(u){var v=l.create('iframe',{width:this.getAttribute('width'),height:this.getAttribute('height'),frameBorder:0});l.empty(u);u.appendChild(v);i.useFacebookRefererHtml.bind(null,v,this.getSWFHTML(),this.getAttribute('iframeSource')).defer();}});o.SWFObjectUtil.getPlayerVersion=function(){var u=new o.PlayerVersion([0,0,0,0]),v;if(navigator.plugins&&navigator.mimeTypes.length){for(var w=0;w<navigator.plugins.length;w++)try{var y=navigator.plugins[w];if(y.name=='Shockwave Flash'){v=new o.PlayerVersion(y.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+(r|d)|\s+b[0-9]+)/,".").split("."));if(typeof u=='undefined'||v.major>u.major||(v.major==u.major&&(v.minor>u.minor||(v.minor==u.minor&&(v.release>u.release||(v.release==u.release&&v.build>u.build))))))u=v;}}catch(x){}}else if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var z=1,aa=3;while(z)try{aa++;z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+aa);u=new o.PlayerVersion([aa,0,0]);}catch(ba){z=null;}}else{try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7");}catch(ca){try{var z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");u=new o.PlayerVersion([6,0,21]);z.AllowScriptAccess="always";}catch(da){if(u.major==6)return u;}try{z=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");}catch(ea){}}if(z!=null)u=new o.PlayerVersion(z.GetVariable("$version").split(" ")[1].split(","));}return u;};o.PlayerVersion=function(u){this.major=u[0]!=null?parseInt(u[0],10):0;this.minor=u[1]!=null?parseInt(u[1],10):0;this.release=u[2]!=null?parseInt(u[2],10):0;this.build=u[3]!=null?parseInt(u[3],10):0;};o.PlayerVersion.prototype.versionIsValid=function(u){if(this.major<u.major)return false;if(this.major>u.major)return true;if(this.minor<u.minor)return false;if(this.minor>u.minor)return true;if(this.release<u.release)return false;if(this.release>u.release)return true;if(this.build<u.build)return false;return true;};o.util={getRequestParameter:function(u){var v=document.location.search||document.location.hash;if(u==null)return v;if(v){var w=v.substring(1).split("&");for(var x=0;x<w.length;x++)if(w[x].substring(0,w[x].indexOf("="))==u)return w[x].substring((w[x].indexOf("=")+1));}return "";}};o.SWFObjectUtil.cleanupSWFs=function(){var u=document.getElementsByTagName("OBJECT");for(var v=u.length-1;v>=0;v--){u[v].style.display='none';for(var w in u[v])if(typeof u[v][w]=='function')u[v][w]=function(){};}};if(!document.getElementById&&document.all)document.getElementById=function(u){return document.all[u];};var p=o.util.getRequestParameter,q=o.SWFObject,r=o.SWFObject;o.spawn_flash_update_dialog=function(){new g().setURI('/ajax/flash_update_dialog.php').setMethod('GET').setReadOnly(true).send();};function s(u,v){var w=m(u),x=o.SWFObjectUtil.getPlayerVersion(),y;v.forEach(function(ba){ba=new o.PlayerVersion(ba.toString().split('.'));if(ba.major==x.major){y=ba;return;}else if(typeof y=='undefined'||ba.major<y.major)y=ba;}.bind(this));if(w&&x.major>0){var z=x.major+'.'+x.minor+'.'+x.release+'.'+x.build,aa=y.major+'.'+y.minor+'.'+y.release+'.'+y.build;l.setContent(w,l.tx._("Flash {required-version} is required to view this content. Your current version is {current-version}. Please download the latest Flash Player.",{'required-version':aa,'current-version':z}));}}o.showFlashErrorDialog=function(u,v){h.loadModules(['ErrorDialog'],function(w){w.show(u,v);});};function t(u,v,w){var x=/^[A-Za-z0-9\-]+$/;if(!u.match(x))throw new Error('Invalid tag '+u);var y='<'+u;for(var z in v){if(!z.match(x))throw new Error('Invalid attr '+z);y+=' '+z+'="'+n.htmlSpecialChars(v[z])+'"';}if(w===null){return y+'/>';}else return y+'>'+w+'</'+u+'>';}e.exports=a.deconcept||o;});
__d("swfobject2",[],function(a,b,c,d,e,f){var g=function(){var h="undefined",i="object",j="Shockwave Flash",k="ShockwaveFlash.ShockwaveFlash",l="application/x-shockwave-flash",m="SWFObjectExprInst",n="onreadystatechange",o=window,p=document,q=navigator,r=false,s=[ka],t=[],u=[],v=[],w,x,y,z,aa=false,ba=false,ca,da,ea=true,fa=function(){var eb=typeof p.getElementById!=h&&typeof p.getElementsByTagName!=h&&typeof p.createElement!=h,fb=q.userAgent.toLowerCase(),gb=q.platform.toLowerCase(),hb=gb?/win/.test(gb):/win/.test(fb),ib=gb?/mac/.test(gb):/mac/.test(fb),jb=/webkit/.test(fb)?parseFloat(fb.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):false,kb=!+"\v1",lb=[0,0,0],mb=null;if(typeof q.plugins!=h&&typeof q.plugins[j]==i){mb=q.plugins[j].description;if(mb&&!(typeof q.mimeTypes!=h&&q.mimeTypes[l]&&!q.mimeTypes[l].enabledPlugin)){r=true;kb=false;mb=mb.replace(/^.*\s+(\S+\s+\S+$)/,"$1");lb[0]=parseInt(mb.replace(/^(.*)\..*$/,"$1"),10);lb[1]=parseInt(mb.replace(/^.*\.(.*)\s.*$/,"$1"),10);lb[2]=/[a-zA-Z]/.test(mb)?parseInt(mb.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0;}}else if(typeof o.ActiveXObject!=h)try{var ob=new ActiveXObject(k);if(ob){mb=ob.GetVariable("$version");if(mb){kb=true;mb=mb.split(" ")[1].split(",");lb=[parseInt(mb[0],10),parseInt(mb[1],10),parseInt(mb[2],10)];}}}catch(nb){}return {w3:eb,pv:lb,wk:jb,ie:kb,win:hb,mac:ib};}(),ga=function(){if(!fa.w3)return;if((typeof p.readyState!=h&&p.readyState=="complete")||(typeof p.readyState==h&&(p.getElementsByTagName("body")[0]||p.body)))ha();if(!aa){if(typeof p.addEventListener!=h)p.addEventListener("DOMContentLoaded",ha,false);if(fa.ie&&fa.win){p.attachEvent(n,function(){if(p.readyState=="complete"){p.detachEvent(n,arguments.callee);ha();}});if(o==top)(function(){if(aa)return;try{p.documentElement.doScroll("left");}catch(eb){setTimeout(arguments.callee,0);return;}ha();})();}if(fa.wk)(function(){if(aa)return;if(!/loaded|complete/.test(p.readyState)){setTimeout(arguments.callee,0);return;}ha();})();ja(ha);}}();function ha(){if(aa)return;try{var fb=p.getElementsByTagName("body")[0].appendChild(xa("span"));fb.parentNode.removeChild(fb);}catch(eb){return;}aa=true;var gb=s.length;for(var hb=0;hb<gb;hb++)s[hb]();}function ia(eb){if(aa){eb();}else s[s.length]=eb;}function ja(eb){if(typeof o.addEventListener!=h){o.addEventListener("load",eb,false);}else if(typeof p.addEventListener!=h){p.addEventListener("load",eb,false);}else if(typeof o.attachEvent!=h){ya(o,"onload",eb);}else if(typeof o.onload=="function"){var fb=o.onload;o.onload=function(){fb();eb();};}else o.onload=eb;}function ka(){if(r){la();}else ma();}function la(){var eb=p.getElementsByTagName("body")[0],fb=xa(i);fb.setAttribute("type",l);var gb=eb.appendChild(fb);if(gb){var hb=0;(function(){if(typeof gb.GetVariable!=h){var ib=gb.GetVariable("$version");if(ib){ib=ib.split(" ")[1].split(",");fa.pv=[parseInt(ib[0],10),parseInt(ib[1],10),parseInt(ib[2],10)];}}else if(hb<10){hb++;setTimeout(arguments.callee,10);return;}eb.removeChild(fb);gb=null;ma();})();}else ma();}function ma(){var eb=t.length;if(eb>0)for(var fb=0;fb<eb;fb++){var gb=t[fb].id,hb=t[fb].callbackFn,ib={success:false,id:gb};if(fa.pv[0]>0){var jb=wa(gb);if(jb)if(za(t[fb].swfVersion)&&!(fa.wk&&fa.wk<312)){bb(gb,true);if(hb){ib.success=true;ib.ref=na(gb);hb(ib);}}else if(t[fb].expressInstall&&oa()){var kb={};kb.data=t[fb].expressInstall;kb.width=jb.getAttribute("width")||"0";kb.height=jb.getAttribute("height")||"0";if(jb.getAttribute("class"))kb.styleclass=jb.getAttribute("class");if(jb.getAttribute("align"))kb.align=jb.getAttribute("align");var lb={},mb=jb.getElementsByTagName("param"),nb=mb.length;for(var ob=0;ob<nb;ob++)if(mb[ob].getAttribute("name").toLowerCase()!="movie")lb[mb[ob].getAttribute("name")]=mb[ob].getAttribute("value");pa(kb,lb,gb,hb);}else{qa(jb);if(hb)hb(ib);}}else{bb(gb,true);if(hb){var pb=na(gb);if(pb&&typeof pb.SetVariable!=h){ib.success=true;ib.ref=pb;}hb(ib);}}}}function na(eb){var fb=null,gb=wa(eb);if(gb&&gb.nodeName=="OBJECT")if(typeof gb.SetVariable!=h){fb=gb;}else{var hb=gb.getElementsByTagName(i)[0];if(hb)fb=hb;}return fb;}function oa(){return !ba&&za("6.0.65")&&(fa.win||fa.mac)&&!(fa.wk&&fa.wk<312);}function pa(eb,fb,gb,hb){ba=true;y=hb||null;z={success:false,id:gb};var ib=wa(gb);if(ib){if(ib.nodeName=="OBJECT"){w=ra(ib);x=null;}else{w=ib;x=gb;}eb.id=m;if(typeof eb.width==h||(!/%$/.test(eb.width)&&parseInt(eb.width,10)<310))eb.width="310";if(typeof eb.height==h||(!/%$/.test(eb.height)&&parseInt(eb.height,10)<137))eb.height="137";p.title=p.title.slice(0,47)+" - Flash Player Installation";var jb=fa.ie&&fa.win?"ActiveX":"PlugIn",kb="MMredirectURL="+o.location.toString().replace(/&/g,"%26")+"&MMplayerType="+jb+"&MMdoctitle="+p.title;if(typeof fb.flashvars!=h){fb.flashvars+="&"+kb;}else fb.flashvars=kb;if(fa.ie&&fa.win&&ib.readyState!=4){var lb=xa("div");gb+="SWFObjectNew";lb.setAttribute("id",gb);ib.parentNode.insertBefore(lb,ib);ib.style.display="none";(function(){if(ib.readyState==4){ib.parentNode.removeChild(ib);}else setTimeout(arguments.callee,10);})();}sa(eb,fb,gb);}}function qa(eb){if(fa.ie&&fa.win&&eb.readyState!=4){var fb=xa("div");eb.parentNode.insertBefore(fb,eb);fb.parentNode.replaceChild(ra(eb),fb);eb.style.display="none";(function(){if(eb.readyState==4){eb.parentNode.removeChild(eb);}else setTimeout(arguments.callee,10);})();}else eb.parentNode.replaceChild(ra(eb),eb);}function ra(eb){var fb=xa("div");if(fa.win&&fa.ie){fb.innerHTML=eb.innerHTML;}else{var gb=eb.getElementsByTagName(i)[0];if(gb){var hb=gb.childNodes;if(hb){var ib=hb.length;for(var jb=0;jb<ib;jb++)if(!(hb[jb].nodeType==1&&hb[jb].nodeName=="PARAM")&&!(hb[jb].nodeType==8))fb.appendChild(hb[jb].cloneNode(true));}}}return fb;}function sa(eb,fb,gb){var hb,ib=wa(gb);if(fa.wk&&fa.wk<312)return hb;if(ib){if(typeof eb.id==h)eb.id=gb;if(fa.ie&&fa.win){var jb="";for(var kb in eb)if(eb[kb]!=Object.prototype[kb])if(kb.toLowerCase()=="data"){fb.movie=eb[kb];}else if(kb.toLowerCase()=="styleclass"){jb+=' class="'+eb[kb]+'"';}else if(kb.toLowerCase()!="classid")jb+=' '+kb+'="'+eb[kb]+'"';var lb="";for(var mb in fb)if(fb[mb]!=Object.prototype[mb])lb+='<param name="'+mb+'" value="'+fb[mb]+'" />';ib.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+jb+'>'+lb+'</object>';u[u.length]=eb.id;hb=wa(eb.id);}else{var nb=xa(i);nb.setAttribute("type",l);for(var ob in eb)if(eb[ob]!=Object.prototype[ob])if(ob.toLowerCase()=="styleclass"){nb.setAttribute("class",eb[ob]);}else if(ob.toLowerCase()!="classid")nb.setAttribute(ob,eb[ob]);for(var pb in fb)if(fb[pb]!=Object.prototype[pb]&&pb.toLowerCase()!="movie")ta(nb,pb,fb[pb]);ib.parentNode.replaceChild(nb,ib);hb=nb;}}return hb;}function ta(eb,fb,gb){var hb=xa("param");hb.setAttribute("name",fb);hb.setAttribute("value",gb);eb.appendChild(hb);}function ua(eb){var fb=wa(eb);if(fb&&fb.nodeName=="OBJECT")if(fa.ie&&fa.win){fb.style.display="none";(function(){if(fb.readyState==4){va(eb);}else setTimeout(arguments.callee,10);})();}else fb.parentNode.removeChild(fb);}function va(eb){var fb=wa(eb);if(fb){for(var gb in fb)if(typeof fb[gb]=="function")fb[gb]=null;fb.parentNode.removeChild(fb);}}function wa(eb){var fb=null;try{fb=p.getElementById(eb);}catch(gb){}return fb;}function xa(eb){return p.createElement(eb);}function ya(eb,fb,gb){eb.attachEvent(fb,gb);v[v.length]=[eb,fb,gb];}function za(eb){var fb=fa.pv,gb=eb.split(".");gb[0]=parseInt(gb[0],10);gb[1]=parseInt(gb[1],10)||0;gb[2]=parseInt(gb[2],10)||0;return (fb[0]>gb[0]||(fb[0]==gb[0]&&fb[1]>gb[1])||(fb[0]==gb[0]&&fb[1]==gb[1]&&fb[2]>=gb[2]))?true:false;}function ab(eb,fb,gb,hb){if(fa.ie&&fa.mac)return;var ib=p.getElementsByTagName("head")[0];if(!ib)return;var jb=(gb&&typeof gb=="string")?gb:"screen";if(hb){ca=null;da=null;}if(!ca||da!=jb){var kb=xa("style");kb.setAttribute("type","text/css");kb.setAttribute("media",jb);ca=ib.appendChild(kb);if(fa.ie&&fa.win&&typeof p.styleSheets!=h&&p.styleSheets.length>0)ca=p.styleSheets[p.styleSheets.length-1];da=jb;}if(fa.ie&&fa.win){if(ca&&typeof ca.addRule==i)ca.addRule(eb,fb);}else if(ca&&typeof p.createTextNode!=h)ca.appendChild(p.createTextNode(eb+" {"+fb+"}"));}function bb(eb,fb){if(!ea)return;var gb=fb?"visible":"hidden";if(aa&&wa(eb)){wa(eb).style.visibility=gb;}else ab("#"+eb,"visibility:"+gb);}function cb(eb){var fb=/[\\\"<>\.;]/,gb=fb.exec(eb)!=null;return gb&&typeof encodeURIComponent!=h?encodeURIComponent(eb):eb;}var db=function(){if(fa.ie&&fa.win)window.attachEvent("onunload",function(){var eb=v.length;for(var fb=0;fb<eb;fb++)v[fb][0].detachEvent(v[fb][1],v[fb][2]);var gb=u.length;for(var hb=0;hb<gb;hb++)ua(u[hb]);for(var ib in fa)fa[ib]=null;fa=null;for(var jb in g)g[jb]=null;g=null;});}();return {registerObject:function(eb,fb,gb,hb){if(fa.w3&&eb&&fb){var ib={};ib.id=eb;ib.swfVersion=fb;ib.expressInstall=gb;ib.callbackFn=hb;t[t.length]=ib;bb(eb,false);}else if(hb)hb({success:false,id:eb});},getObjectById:function(eb){if(fa.w3)return na(eb);},embedSWF:function(eb,fb,gb,hb,ib,jb,kb,lb,mb,nb){var ob={success:false,id:fb};if(fa.w3&&!(fa.wk&&fa.wk<312)&&eb&&fb&&gb&&hb&&ib){bb(fb,false);ia(function(){gb+="";hb+="";var pb={};if(mb&&typeof mb===i)for(var qb in mb)pb[qb]=mb[qb];pb.data=eb;pb.width=gb;pb.height=hb;var rb={};if(lb&&typeof lb===i)for(var sb in lb)rb[sb]=lb[sb];if(kb&&typeof kb===i)for(var tb in kb)if(typeof rb.flashvars!=h){rb.flashvars+="&"+tb+"="+kb[tb];}else rb.flashvars=tb+"="+kb[tb];if(za(ib)){var ub=sa(pb,rb,fb);if(pb.id==fb)bb(fb,true);ob.success=true;ob.ref=ub;}else if(jb&&oa()){pb.data=jb;pa(pb,rb,fb,nb);return;}else bb(fb,true);if(nb)nb(ob);});}else if(nb)nb(ob);},switchOffAutoHideShow:function(){ea=false;},ua:fa,getFlashPlayerVersion:function(){return {major:fa.pv[0],minor:fa.pv[1],release:fa.pv[2]};},hasFlashPlayerVersion:za,createSWF:function(eb,fb,gb){if(fa.w3){return sa(eb,fb,gb);}else return undefined;},showExpressInstall:function(eb,fb,gb,hb){if(fa.w3&&oa())pa(eb,fb,gb,hb);},removeSWF:function(eb){if(fa.w3)ua(eb);},createCSS:function(eb,fb,gb,hb){if(fa.w3)ab(eb,fb,gb,hb);},addDomLoadEvent:ia,addLoadEvent:ja,getQueryParamValue:function(eb){var fb=p.location.search||p.location.hash;if(fb){if(/\?/.test(fb))fb=fb.split("?")[1];if(eb==null)return cb(fb);var gb=fb.split("&");for(var hb=0;hb<gb.length;hb++)if(gb[hb].substring(0,gb[hb].indexOf("="))==eb)return cb(gb[hb].substring((gb[hb].indexOf("=")+1)));}return "";},expressInstallCallback:function(){if(ba){var eb=wa(m);if(eb&&w){eb.parentNode.replaceChild(w,eb);if(x){bb(x,true);if(fa.ie&&fa.win)w.style.display="block";}if(y)y(z);}ba=false;}}};}();e.exports=g;});
__d("SoundPlayer",["Arbiter","ChatConfig","Env","swfobject","swfobject2","URI","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatConfig'),i=b('Env'),j=b('swfobject').SWFObject,k=b('swfobject2'),l=b('URI'),m=b('createArrayFrom'),n={},o=null,p=false,q='so_sound_player',r='/swf/SoundPlayerHater.swf',s='10.0.22.87',t=null,u=h.get('sound.useswfobject_2',false),v=h.get('sound.force_flash',false);function w(ea){var fa=l(ea);if(!fa.getDomain())return l(i.static_base).setPath(fa.getPath()).toString();return ea;}function x(ea){if(/\.mp3$/.test(ea))return 'audio/mpeg';if(/\.og[ga]$/.test(ea))return 'audio/ogg';return '';}function y(){if(!t&&!v){var ea=document.createElement('audio');if(!ea||!ea.canPlayType)return null;ea.setAttribute('preload','auto');document.body.appendChild(ea);t=ea;}return t;}function z(){var ea=document[q]||window[q];if(ea)if(!ea.playSound&&ea.length)ea=ea[0];return (ea&&ea.playSound&&ea.loopSound)?ea:null;}function aa(){return p;}function ba(ea,fa,ga){o={path:ea,sync:fa,loop:ga};}function ca(){p=true;if(o){var ea=z();if(o.loop){ea.loopSound(o.path,o.sync);}else ea.playSound(o.path,o.sync);}}var da={init:function(ea){ea=m(ea);var fa;for(var ga=0;ga<ea.length;++ga){fa=ea[ga];if(n[fa])return;}var ha=y();for(ga=0;ha&&ga<ea.length;++ga){fa=ea[ga];if(ha.canPlayType(fa)){n[fa]=true;return;}}n['audio/mpeg']=true;if(z())return;try{g.registerCallback(ca,['sound/player_ready','sound/ready']);var ja=document.createElement('div');ja.id='sound_player_holder';document.body.appendChild(ja);if(u){k.embedSWF(r,ja.id,'1px','1px',s,null,{swf_id:q},{allowscriptaccess:'always',wmode:'transparent'},null,function(la){window[q]=la.ref;g.inform('sound/player_ready');});}else{var ka=new j(r,q,'1px','1px',[s],'#ffffff');ka.addParam('allowscriptaccess','always');ka.addParam('wmode','transparent');ka.addVariable('swf_id',q);ka.fallback_html=' ';ka.write(ja.id);window[q]=ka;g.inform('sound/player_ready');}}catch(ia){}},play:function(ea,fa){ea=m(ea);var ga=y(),ha,ia;for(var ja=0;ga&&ja<ea.length;++ja){ha=ea[ja];ia=x(ha);if(!ga.canPlayType(ia))continue;da.init([ia]);ga.src=w(ha);if(fa){ga.setAttribute('loop','');}else ga.removeAttribute('loop');ga.play();return;}for(ja=0;ja<ea.length;++ja){ha=w(ea[ja]);ia=x(ha);if(ia!='audio/mpeg')continue;da.init([ia]);var ka=z();if(!aa()){ba(ha,true,fa);return;}else if(ka){if(fa){ka.loopSound(ha,true);}else ka.playSound(ha,true);return;}}},stop:function(ea){ea=m(ea);for(var fa=0;fa<ea.length;++fa){var ga=w(ea[fa]),ha=y(),ia=z();if(ha&&ha.src==ga){ha.pause();ha.src=undefined;}else ia&&ia.stopSound(ga);}}};e.exports=da;});
__d("SoundSynchronizer",["event-extensions","hasArrayNature","SoundPlayer","createArrayFrom"],function(a,b,c,d,e,f){b('event-extensions');var g=b('hasArrayNature'),h=b('SoundPlayer'),i=b('createArrayFrom'),j='fb_sounds_playing3';function k(){if(window.localStorage)try{var p=window.localStorage[j];if(p){p=JSON.parse(p);if(g(p))return p;}}catch(o){}return [];}function l(o){if(window.localStorage){var p=k();p.push(o);while(p.length>5)p.shift();try{window.localStorage[j]=JSON.stringify(p);}catch(q){}}}function m(o){return k().some(function(p){return p===o;});}var n={play:function(o,p,q){o=i(o);p=p||(o[0]+Math.floor(Date.now()/1000));if(m(p))return;h.play(o,q);l(p);},isSupported:function(){return !!window.localStorage;}};e.exports=n;});
__d("SoundRPC",["event-extensions","SoundSynchronizer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('SoundSynchronizer');function h(j,k,l){g.play(j,k,l);}var i={playLocal:h,playRemote:function(j,k,l,m){var n={paths:k,sync:l,loop:m};j.postMessage(JSON.stringify(n),'*');},supportsRPC:function(){return !!window.postMessage;},_listen:function(){Event.listen(window,'message',function(j){if(!/\.facebook.com$/.test(j.origin))return;var k=JSON.parse(j.data);h(k.paths,k.sync,k.loop);});}};e.exports=i;});
__d("Sound",["SoundPlayer","SoundRPC","SoundSynchronizer","UserAgent"],function(a,b,c,d,e,f){var g=b('SoundPlayer'),h=b('SoundRPC'),i=b('SoundSynchronizer'),j=b('UserAgent'),k=null,l={init:function(o){if(!k)g.init(o);},play:function(o,p,q){if(k){h.playRemote(k.contentWindow,o,p,false);}else h.playLocal(o,p,q);},stop:function(o){if(!k)g.stop(o);}},m=location.host.replace(/^[^.]+/,'www');function n(){if(j.ie()<9)return false;return i.isSupported()&&h.supportsRPC();}if(location.host!==m&&n()){k=document.createElement('iframe');k.setAttribute('src','//'+m+'/sound_iframe.php');k.style.display='none';document.body.appendChild(k);}e.exports=l;});
__d("MercuryBrowserAlerts",["ArbiterMixin","ChatActivity","ChatConfig","ChatOptions","ChatTitleBarBlinker","copyProperties","MercuryParticipants","Sound","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatActivity'),i=b('ChatConfig'),j=b('ChatOptions'),k=b('ChatTitleBarBlinker'),l=b('copyProperties'),m=b('MercuryParticipants'),n=b('Sound'),o=c('MercuryConstants');n.init(['audio/ogg','audio/mpeg']);function p(r){if(j.getSetting('sound'))n.play([i.get('sound.notif_ogg_url'),i.get('sound.notif_mp3_url')],r,false);}var q={messageReceived:function(r){var s=o.MessagingTag;if(r.author==m.user||!r.is_unread||(r.folder!=s.INBOX&&r.folder!=s.ARCHIVED))return;var t=h.isActive(),u=r.thread_id,v=r.timestamp;if(t){var w=false;q.inform('before-alert',{threadID:u,cancelAlert:function(){w=true;}});!w&&p(v);}else{k.blink(u,v);p(v);}k.blinkingElsewhere();}};e.exports=l(q,g);});
__d("VideoCallRecordMessageDialog",["Dialog","URI"],function(a,b,c,d,e,f){var g=b('Dialog'),h=b('URI'),i={get:function(j,k){return new g().setTitle(tx._("{firstname} is Unavailable",{firstname:k})).setBody("Would you like to leave a video message?").setButtons([{name:'record-message',label:"Record Message"},g.CANCEL]).setHandler(function(){var l=h('/ajax/messaging/composer.php').setQueryData({ids:[j],autoloadvideo:true}).toString();g.bootstrap(l);});}};e.exports=i;});
__d("VideoCallCore",["event-extensions","Arbiter","AsyncRequest","AvailableList","AvailableListConstants","Bootloader","ChannelConstants","Cookie","Dialog","UserAgent","ge","ShortProfiles","VideoCallRecordMessageDialog"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('Bootloader'),l=b('ChannelConstants'),m=b('Cookie'),n=b('Dialog'),o=b('UserAgent'),p=b('ge'),q=[],r={isSupported:function(){if(o.windows()){return (o.ie()>=7&&!o.ie64())||o.firefox()>=3.6||o.chrome()>=5||o.opera()>=12;}else if(o.osx()>10.4)return (o.firefox()>=3.6||o.chrome()>=5||o.safari()>=500||o.opera()>=12);return false;},isInstalled:function(){var v=false;if(this.isSupported())if(s()){var w=null;try{w=new ActiveXObject('SkypeLimited.SkypeWebPlugin');v=!!w;}catch(x){}w=null;}else v=t();return v;},mightReloadPostInstall:function(){return o.windows();},onVideoMessage:function(v){q.push(v);k.loadModules(['VideoCallController'],bagofholding);},setMessageHandler:function(v){this.onVideoMessage=v;if(v)while(q.length)v(q.shift());},availableForCall:function(v){var w=i.get(v);return w==j.ACTIVE||w==j.IDLE;},onProfileButtonClick:function(v){r.startCallOrLeaveMessage(v,'profile_button_click');},attachListenerToProfileButton:function(v){var w=p('videoCallProfileButton');if(w)Event.listen(w,'click',function(event){r.startCallOrLeaveMessage(v,'profile_button_click_timeline');});},startCallOrLeaveMessage:function(v,w){if(this.availableForCall(v)){r.showOutgoingCallDialog(v,w);}else b('ShortProfiles').get(v,function(x){b('VideoCallRecordMessageDialog').get(v,x.firstName).show();});},showOutgoingCallDialog:function(v,w){var x=w||'unknown';r.logClick(v,x);var y=r.isInstalled()?'outgoing_dialog.php':'intro.php',z='/ajax/chat/video/'+y+'?idTarget='+v;new n().setAllowCrossPageTransition(true).setAsync(new h(z)).show();},logClick:function(v,w){new h().setURI('/ajax/chat/video/log_click.php').setData({targetUserID:v,clickSource:w}).setAllowCrossPageTransition(true).setErrorHandler(bagofholding).send();}};function s(){return o.ie()&&o.windows()&&!o.opera();}function t(){if(!navigator)return null;navigator.plugins.refresh(false);var v=navigator.mimeTypes['application/skypesdk-plugin'];return v&&v.enabledPlugin;}function u(){if(!r.mightReloadPostInstall())return;var v=m.get('vcpwn');if(v){m.clear('vcpwn');var w=m.get('vctid');if(w){m.clear('vctid');if(m.get('vctid'))return;if(w&&r.isInstalled()){var x='/ajax/chat/video/outgoing_dialog.php?idTarget='+w;new n().setAllowCrossPageTransition(true).setAsync(new h(x)).show();}}}}g.subscribe(l.getArbiterType('video'),function(v,w){r.onVideoMessage(w.obj);});g.subscribe(l.getArbiterType('chat_event'),function(v,w){if(w.obj.event_name=="missed-call")k.loadModules(['VideoCallController'],function(x){x.onMissedCallEvent(w.obj);});});u();e.exports=r;});
__d("ChatApp",["CSS","$","copyProperties"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('$'),i=b('copyProperties'),j=false,k=false,l=false;function m(n,o){m.init(h('fbDockChat'),n,o);}i(m,{init:function(n,o,p){this.root=n;d(['TabsViewport','ChatTabController','ChatTabViewCoordinator','MercuryServerRequests','MercuryChannelHandler','MercuryStateCheck'],function(q,r,s,t,u,v){t.handleUpdate(p);this.tabsViewport=new q(o);this.tabController=new r(this.tabsViewport);this.tabViewCoordinator=new s(o,this.tabsViewport);j=k=true;}.bind(this));},hide:function(){if(!j||l)return;g.hide(this.root);l=true;},unhide:function(){if(j){if(l){g.show(this.root);this.tabsViewport.checkWidth();d(['Dock'],function(n){n.resizeAllFlyouts();});l=false;}}else if(!k){d(['UIPagelet'],function(n){n.loadFromEndpoint('DockChatPagelet','pagelet_chat');});k=true;}}});e.exports=m;});
__d("ChatTabModel",["function-extensions","Arbiter","ArbiterMixin","ChatBehavior","ChatConfig","copyProperties","JSLogger","MercuryAssert","MercuryServerRequests","MercuryThreads","MercuryTimestampTracker","PresenceState","PresenceUtil","areObjectsEqual","PresenceInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ChatBehavior'),j=b('ChatConfig'),k=b('copyProperties'),l=b('JSLogger'),m=b('MercuryAssert'),n=b('MercuryServerRequests'),o=b('MercuryThreads'),p=b('MercuryTimestampTracker'),q=c('PresenceInitialData'),r=b('PresenceState'),s=b('PresenceUtil'),t=b('areObjectsEqual'),u=[],v=null,w=null,x=null,y=null;function z(){return parseInt(q.serverTime,10);}var aa=j.get('tab_max_load_age')||3600000,ba=z()-aa,ca=0,da=20,ea=l.create('chat_tab_model'),fa=false;function ga(xa){var ya=r.verifyNumber(xa.uct2);if(!ya||typeof ya!=='number'){ea.warn('bad_cookie_version',xa.uct2);return null;}if(ya<=ca||ya<ba)return null;return ya;}function ha(xa){var ya=ga(xa);if(!ya){var za={};za.old_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.old_promoted=xa&&xa.lm2;za.old_time=xa&&xa.uct2;za.old_reason=xa&&xa.tr;za.old_window=xa&&xa.tw;var ab;if(w&&xa.t2)for(var bb=0;bb<xa.t2.length;bb++){var cb=xa.t2[bb];if(cb.i===w)ab=cb.r;}var db=[];u.forEach(function(eb){if(!eb.fragile){var fb={i:eb.id,si:eb.server_id};if(eb.raised||(eb.id===w&&ab))fb.r=1;db.push(fb);}});xa.t2=db;xa.uct2=ca;xa.lm2=v;xa.tr=y;xa.tw=s.getSessionID();za.new_tabs=JSON.stringify(xa.t2);za.new_promoted=xa.lm2;za.new_time=xa.uct2;za.new_reason=xa.tr;za.new_window=xa.tw;ea.debug('store',za);}return xa;}function ia(xa){if(xa){var ya=ga(xa);if(ya){var za={};za.old_tabs=JSON.stringify(u);za.old_promoted=v;za.old_time=ca;za.old_reason=y;za.window_id=s.getSessionID();za.cookie_tabs=xa&&xa.t2&&JSON.stringify(xa.t2);za.cookie_promoted=xa&&xa.lm2;za.cookie_time=xa&&xa.uct2;za.cookie_reason=xa&&xa.tr;za.cookie_window=xa&&xa.tw;ca=ya;y='load';var ab=ja(xa.t2,xa.lm2||null);za.load_result=ab;za.new_tabs=JSON.stringify(u);za.new_promoted=v;za.new_time=ca;za.new_reason=y;var event='load';if(!fa)event+='_init';ea.log(event,za);return ab;}}return false;}function ja(xa,ya){if(ka(xa,ya)){var za=u.filter(function(cb){return cb.fragile;}),ab={};v=null;u=xa.map(function(cb){var db={id:cb.i,server_id:cb.si};if(db.id==ya)v=db.id;if(w==cb.i){var eb=pa(w);if(eb!=-1){db.raised=u[eb].raised;return db;}else return null;}if(cb.r)db.raised=true;ab[db.id]=db;return db;});u=u.filter(function(cb){return cb!=null;});if(x)for(var bb in x)if(!ab[bb]||!ab[bb].raised)delete x[bb];za=za.filter(function(cb){return !ab[cb.id];});u=u.concat(za);oa();return true;}return false;}function ka(xa,ya){if(ya!=v)return true;var za=u.filter(function(cb){return !cb.fragile;});if(xa.length!=za.length)return true;for(var ab=0,bb=xa.length;ab<bb;ab++){if(xa[ab].id===w)continue;if(!t(xa[ab],za[ab]))return true;}return false;}function la(xa,ya,za){var ab=ia(r.get());if(ya===undefined||ya>ca){if(xa()){ab=true;y=za||null;na(ya);}}else ea.error('rejected',{change_time:ya,state_time:ca});ab&&ma();}function ma(){if(fa)va.inform('chat/tabs-changed',va.get());}function na(xa){if(xa===undefined)xa=Math.max(p.getLastUserMessageTimestamp()||1,ca+1);ca=xa;r.doSync();}function oa(){var xa=u.length-da;if(xa>0)u=u.filter(function(ya){return ya.raised||xa--<=0;});}function pa(xa){for(var ya=0;ya<u.length;ya++)if(u[ya].id==xa)return ya;return -1;}function qa(xa){var ya=o.getThreadMetaNow(xa);if(!ya)return false;if(ya.is_canonical_user||ya.is_canonical_group){return sa(xa);}else{var za=ra(xa);if(za)n.getServerThreadID(xa,function(ab){if(ta(xa,ab)){na();ma();}});return za;}}function ra(xa){if(pa(xa)===-1){u.push({id:xa,fragile:true});ea.log('open_fragile_tab',{tabs:JSON.stringify(u),opened:xa,window_id:s.getSessionID()});return true;}return false;}function sa(xa){var ya=pa(xa);if(ya!=-1)if(u[ya].fragile){u.splice(ya,1);}else return false;for(var za=0;za<=u.length;za++)if(za==u.length||u[za].fragile){u.splice(za,0,{id:xa});oa();ea.log('open_tab',{tabs:JSON.stringify(u),opened:xa,window_id:s.getSessionID()});return true;}}function ta(xa,ya){var za=pa(xa);if(za!=-1&&u[za].fragile){var ab=u[za];ab.fragile=false;ab.server_id=ya;var bb=[];u.forEach(function(cb){if(cb.id!=xa){if(ab&&cb.fragile){bb.push(ab);ab=null;}bb.push(cb);}});if(ab)bb.push(ab);u=bb;ea.log('make_permanent',{tabs:JSON.stringify(u),tab_id:xa,window_id:s.getSessionID()});return true;}return false;}function ua(xa){var ya=pa(xa);if(xa==v)v=null;if(ya!=-1){u.splice(ya,1);ea.log('close_tab',{tabs:JSON.stringify(u),closed:xa,window_id:s.getSessionID()});return true;}return false;}r.registerStateStorer(ha);r.registerStateLoader(function(xa){if(ia(xa))ma();});function va(){}k(va,h,{indexOf:function(xa){return pa(xa);},getTab:function(xa){m.isThreadID(xa);var ya=this.indexOf(xa);if(ya>-1){var za=u[ya];return k({},za);}return null;},closeAllTabs:function(){if(u.length){ea.log('close_all_tabs',{closed_tabs:JSON.stringify(u),window_id:s.getSessionID()});u=[];v=null;if(x)x={};na();ma();}},closeFragileTabs:function(){var xa=[];for(var ya=0;ya<u.length;ya++)if(u[ya].fragile){xa.push(u[ya]);u.splice(ya);ma();break;}ea.log('close_fragile_tabs',{tabs:JSON.stringify(u),fragile_closed:xa,window_id:s.getSessionID()});},closeTab:function(xa,ya){m.isThreadID(xa);var za=false;if(x){delete x[xa];za=true;}la(function(){if(ua(xa))za=true;return za;},undefined,ya);},closeTabAndDemote:function(xa,ya,za){m.isThreadID(xa);var ab=false;if(x){delete x[xa];ab=true;}la(function(){if(ua(xa)){if(v){var bb=pa(v);if(bb>ya){var cb=u.splice(bb,1)[0];u.splice(ya,0,cb);v=null;}}ab=true;}return ab;},undefined,za);},raiseTab:function(xa,ya){m.isThreadID(xa);var za=false;if(x&&ya){x[xa]=true;za=true;}if(!ya&&xa===w){za&&ma();return;}la(function(){if(qa(xa))za=true;var ab=pa(xa);if(ab!=-1&&!u[ab].raised){u[ab].raised=true;za=true;ea.log('raise_tab',{tabs:JSON.stringify(u),raised:xa,window_id:s.getSessionID()});}return za;});},get:function(){var xa=u.map(function(ya){var za=k({},ya);delete za.fragile;if(x)za.raised=x[za.id];return za;});return {tabs:xa,promoted:v};},openFragileTab:function(xa){m.isThreadID(xa);if(ra(xa))ma();},openTab:function(xa){m.isThreadID(xa);la(qa.curry(xa));},lowerTab:function(xa){m.isThreadID(xa);var ya=false;if(x){delete x[xa];ya=true;}la(function(){var za=pa(xa);if(za!=-1&&u[za].raised){delete u[za].raised;ea.log('lower_tab',{tabs:JSON.stringify(u),lowered:xa,window_id:s.getSessionID()});ya=true;}return ya;});},raiseAndPromoteTab:function(xa,ya,za,ab){m.isThreadID(xa);var bb=false;if(x&&ya){x[xa]=true;bb=true;}if(!ya&&xa===w){bb&&ma();return;}la(function(){if(qa(xa))bb=true;var cb=pa(xa);if(cb!=-1&&(!u[cb].raised||v!=xa)){u[cb].raised=true;v=xa;bb=true;ea.log('raise_and_promote_tab',{tabs:JSON.stringify(u),promoted:xa,window_id:s.getSessionID()});}return bb;},za,ab);},squelchTab:function(xa){m.isThreadID(xa);w=xa;this.lowerTab(xa);ea.log('squelch_tab',{squelched:xa,tabs:JSON.stringify(u),window_id:s.getSessionID()});},clearSquelchedTab:function(){if(w)ea.log('unsquelch_tab',{squelched:w,tabs:JSON.stringify(u),window_id:s.getSessionID()});w=null;}});g.subscribe(l.DUMP_EVENT,function(xa,ya){ya.chat_tabs={promoted:v,tabs:u.map(function(za){return k({},za);}),time:ca,max_load_age:aa};});function wa(){var xa=i.ignoresRemoteTabRaise();if(xa&&!x){ea.log('start_ignore_remote_raise');x={};ma();}else if(!xa&&x){ea.log('stop_ignore_remote_raise');x=null;ma();}}i.subscribe(i.ON_CHANGED,wa);wa();ia(r.getInitial(),true);if(ca===0)ca=z()-600000;fa=true;e.exports=va;});
__d("VideoCallPromo",["ArbiterMixin","AsyncRequest","AvailableList","AvailableListConstants","ChatConfig","ChatVisibility","ContextualDialogX","copyProperties","CSS","MercuryThreads","MercuryParticipants","VideoCallCore","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('ChatConfig'),l=b('ChatVisibility'),m=b('ContextualDialogX'),n=b('copyProperties'),o=b('CSS'),p=b('MercuryThreads'),q=b('MercuryParticipants'),r=c('ChatTabTemplates'),s=b('VideoCallCore');function t(){this._dialog=null;}function u(w){if(!(s.isSupported()&&k.get('video.show_promo')))return false;var x=p.getCanonicalUserInThread(w);if(!x)return false;return l.isOnline()&&s.availableForCall(x);}function v(w){new h().setURI('/ajax/chat/video/log_promo.php').setData({viewedUserID:w}).setAllowCrossPageTransition(true).setErrorHandler(bagofholding).send();}n(t.prototype,g);n(t.prototype,{render:function(w,x){var y=u(x);if(!y)return;var z=p.getCanonicalUserInThread(x);q.get('fbid:'+z,function(aa){if(!aa.call_promo)return;var ba=r[':fb:mercury:call:promo'].build();this._dialog=new m();this._dialog.init(ba.getRoot()).setWidth(250).setAlignH('center').setContext(w).show();o.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');o.addClass(w,'video_call_promo');v(p.getCanonicalUserInThread(x));this.inform('chat/dialog-rendered',{dialog:this,thread_id:x});}.bind(this));},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=t;});
__d("VideoCallTourDialog",["ArbiterMixin","ContextualDialogX","copyProperties","CSS","MercuryThreads","VideoCallCore","VideoCallingTour","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ContextualDialogX'),i=b('copyProperties'),j=b('CSS'),k=b('MercuryThreads'),l=c('ChatTabTemplates'),m=b('VideoCallCore'),n=b('VideoCallingTour');function o(){this._dialog=null;}i(o.prototype,g);i(o.prototype,{render:function(p,q){var r=k.getCanonicalUserInThread(q);if(!r||!m.availableForCall(r))return;var s=l[':fb:mercury:call:tour'].build();this._dialog=new h();this._dialog.init(s.getRoot()).setWidth(250).setAlignH('center').setContext(p).show();j.addClass(this._dialog.getRoot(),'uiContextualDialogWithFooterArrowBottom');j.addClass(p,'video_call_tour');this.inform('chat/dialog-rendered',{dialog:this,thread_id:q});n.inform('videocallingtour/end');},updatePosition:function(){if(this._dialog&&this._dialog.isShown())this._dialog.updatePosition();},hide:function(){if(this._dialog&&this._dialog.isShown()){this._dialog.hide();this._dialog=null;}}});e.exports=o;});
__d("ChatContextualDialogController",["event-extensions","ArbiterMixin","ChatTabModel","VideoCallingTour","VideoCallPromo","VideoCallTourDialog","copyProperties","setTimeoutAcrossTransitions"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ChatTabModel'),i=b('VideoCallingTour'),j=b('VideoCallPromo'),k=b('VideoCallTourDialog'),l=b('copyProperties'),m=b('setTimeoutAcrossTransitions'),n=60000,o=false,p=false,q=function(x,y){this._videoCallPromo=new j();this._videoCallTour=new k();this._threadID=x;this._tabMainElement=y;this._openDialog=null;this._subscriptionTokens=[];this._scrollListener=null;this._timeout=null;};function r(x,event,y){if(x._openDialog)x._openDialog.updatePosition();}function s(x){if(x._openDialog)x._openDialog.updatePosition();}function t(x){if(x._openDialog){x._openDialog.hide();x._openDialog=null;}if(x._timeout){clearTimeout(x._timeout);x._timeout=null;}while(x._subscriptionTokens.length)x._subscriptionTokens.pop().unsubscribe();if(x._scrollListener){x._scrollListener.remove();x._scrollListener=null;}}function u(x,event,y){if(y.thread_id===x._threadID){x._openDialog=y.dialog;o=true;w(x);x._timeout=m(x.destroy.bind(x,x._threadID),n);x._scrollListener=Event.listen(window,'scroll',s.curry(x));}}function v(x,y){if(!x._openDialog){x._subscriptionTokens.push(y.subscribe('chat/dialog-rendered',u.curry(x)));y.render(x._tabMainElement,x._threadID);}}function w(x){x._subscriptionTokens.push(h.subscribe('chat/tabs-changed',r.curry(x)),q.subscribe('dialog/close-all',t.curry(x)));}l(q,g);l(q.prototype,{destroy:function(){t(this);},tabFocused:function(){if(p){v(this,this._videoCallTour);return;}if(!o)v(this,this._videoCallPromo);},tabNotActive:function(){t(this);},hideVideoCallouts:function(){t(this);}});i.subscribe('videocallingtour/start',function(){p=true;q.inform('dialog/close-all');});i.subscribe('videocallingtour/end',function(){p=false;});e.exports=q;});
__d("ChatPrivacyActionController",["Arbiter","ChatVisibility","JSLogger","PresencePrivacy","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatVisibility'),i=b('JSLogger'),j=b('PresencePrivacy'),k=b('copyProperties'),l=function(m,n){this._userID=m;this._logger=i.create('blackbird');this._getState=function(){if(h.isOnline())return j.allows(this._userID)?l.NORMAL:l.BLOCKED;return l.OFFLINE;};this._togglePrivacy=function(){var o=this._getState();switch(this._getState()){case l.OFFLINE:if(h.isOnline()){this._logger.error('tabs_already_online');break;}this._logger.log('tabs_go_online',{tab_id:this._userID});h.goOnline(function(){if(!j.allows(this._userID)){if(this._getState()!==l.BLOCKED)this._logger.error('privacy_action_controller_blocked_inconsistency');this._togglePrivacy();}}.bind(this));break;case l.BLOCKED:j.allow(this._userID);this._logger.log('tabs_unblock',{tab_id:this._userID});break;case l.NORMAL:j.disallow(this._userID);this._logger.log('tabs_block',{tab_id:this._userID});break;}};(function(){var o=function(){n&&n(this._getState());}.bind(this);o();j.subscribe('privacy-changed',o);}.bind(this)).defer();};l.OFFLINE='offline';l.BLOCKED='blocked';l.NORMAL='normal';k(l.prototype,{togglePrivacy:function(){this._logger.log('gear_menu_toggle_privacy',{tab_id:this._userID});this._togglePrivacy();}});e.exports=l;});
__d("MessagesEmoticonView",["event-extensions","function-extensions","DOM","InputSelection","Parent","TextAreaControl","Toggler","copyProperties","endsWith","startsWith"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('DOM'),h=b('InputSelection'),i=b('Parent'),j=b('TextAreaControl'),k=b('Toggler'),l=b('copyProperties'),m=b('endsWith'),n=b('startsWith'),o={smile:':)',frown:':(',tongue:':P',grin:'=D',gasp:':o',wink:';)',glasses:'8)',sunglasses:'B|',grumpy:'>:(',unsure:':/',cry:":'(",devil:'3:)',angel:'O:)',kiss:':*',heart:'<3',kiki:'^_^',squint:'-_-',confused:'o.O',upset:'>:o',pacman:':v',robot:':|]',colonthree:':3',penguin:'<(")',putnam:':putnam:',shark:'(^^^)','42':':42:',like:'(y)'};function p(r,s,t){var u=i.byClass(r,'emoteIcon');if(!u)return;var v='name_',w=null;u.className.split(' ').forEach(function(da){if(n(da,v))w=da.substring(v.length);});if(!o[w])return;var x=j.getInstance(s),y=x.getValue(),z=o[w],aa=y.substring(0,t.start),ba=y.substring(t.end);if(t.start>0&&!m(aa,' '))z=' '+z;if(!n(ba,' '))z+=' ';var ca=aa+z+ba;t.start+=z.length;t.end=t.start;x.setValue(ca);h.set(s,t.start,t.end);}function q(r,s){var t={start:0,end:0};function u(){t=h.get(s);}var v=g.find(r,'.uiToggleFlyout');this._subscription=k.subscribe('show',function(w,x){if(x.active&&g.contains(r,x.active))h.set(s,t.start,t.end);});this._eventListeners=[Event.listen(v,'click',function(event){k.hide(r);p(event.getTarget(),s,t);}),Event.listen(s,'keyup',u),Event.listen(s,'click',u)];}l(q.prototype,{destroy:function(){this._subscription.unsubscribe();while(this._eventListeners.length)this._eventListeners.pop().remove();}});e.exports=q;});
__d("MercuryAttachmentRenderer",["CSS","DOM","Style","MercuryAttachment","MercuryAttachmentTemplates","MercuryConstants"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('MercuryAttachment'),k=c('MercuryAttachmentTemplates'),l=c('MercuryConstants'),m={renderError:function(n){var o=k[':fb:mercury:attachment:error'].build();h.appendContent(o.getNode('error'),n.error_msg);return o.getRoot();},renderExternalLink:function(n){var o=k[':fb:mercury:attachment:external-link'].build().setNodeContent('name',n.name).setNodeContent('shortLink',n.base_url),p=o.getNode('preview');p.setAttribute('href',n.url);n.rel&&p.setAttribute('rel',n.rel);if(n.preview_url){var q=o.getNode('preview-image');q.setAttribute('src',n.preview_url);g.addClass(p,n.preview_class);g.show(q);}else{g.addClass(o.getRoot(),'noMedia');g.hide(p);}o.getNode('name').setAttribute('href',n.url);return o.getRoot();},renderFileLink:function(n){var o=k[':fb:mercury:attachment:file-link'].build().setNodeContent('filename',n.name),p=o.getNode('link');p.setAttribute('href',n.url);n.rel&&p.setAttribute('rel',n.rel);g.addClass(o.getRoot(),j.getAttachIconClass(n.icon_type));return o.getRoot();},renderMusic:function(n){var o=k[':fb:mercury:attachment:music'].build().setNodeContent('filename',n.name),p=o.getNode('link');p.setAttribute('href',n.url);p.setAttribute('target','_blank');n.rel&&p.setAttribute('rel',n.rel);var q=o.getNode('preview');q.setAttribute('href',n.url);n.rel&&q.setAttribute('rel',n.rel);var r=o.getNode('preview-image');r.setAttribute('src',n.preview_url);g.show(r);g.addClass(o.getNode('icon_link'),'MercuryMusicIcon');return o.getRoot();},renderPreview:function(n,o,p){var q=k[':fb:mercury:attachment:preview'].build(),r=q.getRoot();r.setAttribute('href',n.url);n.rel&&r.setAttribute('rel',n.rel);var s=n.preview_url;if(p)s+=p;var t=q.getNode('preview-image');if(!o){g.show(t);}else t.onload=function(){var u=t.width,v=t.height,w,x;if(u>v){i.set(t,'maxHeight',o+'px');x=Math.min(v,o);w=Math.ceil(u*x/v);}else{i.set(t,'maxWidth',o+'px');w=Math.min(u,o);x=Math.ceil(v*w/u);}i.set(t,'marginTop','-'+(x>>>1)+'px');i.set(t,'marginLeft','-'+(w>>>1)+'px');g.show(t);};t.setAttribute('src',s);g.addClass(r,n.preview_class);return r;},renderMultiplePreviews:function(n){var o=n.length,p='singleImagePreview',q=0;if(o==2||o==4){p='doubleImagePreview';q=196;}else if(o>1){p='multipleImagePreview';q=129;}var r=h.create('div',{className:'imagePreviews'}),s='&numPreviews='+o;g.addClass(r,p);for(var t=0;t<o;++t){var u=this.renderPreview(n[t],q,s);h.appendContent(r,u);}return r;},renderShareLink:function(n){var o=k[':fb:mercury:attachment:share-link'].build().setNodeContent('name',n.name),p=o.getNode('link');p.setAttribute('href',n.url);n.rel&&p.setAttribute('rel',n.rel);return o.getRoot();},renderVideoThumb:function(n){var o=k[':fb:mercury:attachment:video-thumb'].build(),p=o.getNode('thumb');p.setAttribute('href',n.url);p.setAttribute('rel',n.rel);var q=h.find(o.getRoot(),'img');q.src=n.preview_url;return o.getRoot();}};e.exports=m;});
__d("TypingDetector",["event-extensions","function-extensions","ArbiterMixin","Class","Input","Run","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('Input'),j=b('Run'),k=b('copyProperties'),l=b('createObjectFrom');function m(n){this._input=n;this._ignoreKeys={};}m.INACTIVE=0;m.TYPING=1;m.QUITTING=2;k(m.prototype,g,{_timeout:7000,_currentState:m.INACTIVE,init:function(){this.init=bagofholding;this.reset();Event.listen(this._input,'keyup',this._update.bind(this));j.onUnload(this._onunload.bind(this));},reset:function(){clearTimeout(this._checkTimer);this._checkTimer=null;this._lastKeystrokeAt=null;this._currentState=m.INACTIVE;},setIgnoreKeys:function(n){this._ignoreKeys=l(n);},_onunload:function(){if(this._currentState==m.TYPING)this._transition(m.QUITTING);},_update:function(event){var n=Event.getKeyCode(event),o=this._currentState;if(!this._ignoreKeys[n])if(i.getValue(this._input).trim().length===0){if(o==m.TYPING)this._transition(m.INACTIVE);}else if(o==m.TYPING){this._recordKeystroke();}else if(o==m.INACTIVE){this._transition(m.TYPING);this._recordKeystroke();}},_transition:function(n){this.reset();this._currentState=n;this.inform('change',n);},_recordKeystroke:function(){this._lastKeystrokeTime=Date.now();if(!this._checkTimer)this._checkTimer=this._checkTyping.bind(this).defer(this._timeout);},_checkTyping:function(){var n=this._lastKeystrokeTime+this._timeout,o=Date.now();if(o>n){this._transition(m.INACTIVE);}else{clearTimeout(this._checkTimer);this._checkTimer=this._checkTyping.bind(this).defer(n-o+10);}}});e.exports=m;});
__d("MercuryTypingReceiver",["Arbiter","ChannelConstants","MercuryParticipants","MercuryServerRequests","MercuryThreads","TypingDetector","setTimeoutAcrossTransitions","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('MercuryParticipants'),j=b('MercuryServerRequests'),k=b('MercuryThreads'),l=b('TypingDetector'),m=b('setTimeoutAcrossTransitions'),n=c('MercuryConstants'),o,p={},q=30000,r=new g();function s(x){var y=p[x]||{},z=Object.keys(y);z.sort(function(aa,ba){return y[aa]-y[ba];});return z;}function t(){o=null;var x=Date.now(),y={},z=false;for(var aa in p){var ba=false;for(var ca in p[aa]||{})if(p[aa][ca]<x-q){delete p[aa][ca];ba=true;}else z=true;if(ba)y[aa]=s(aa);}for(var da in y){r.inform('state-changed',y);break;}if(z)o=m(t,3000);}function u(x,y){if(x in p)if(y in p[x]){delete p[x][y];v(x);}}function v(x){var y={};y[x]=s(x);r.inform('state-changed',y);}function w(x){if(x.thread)return j.getClientThreadIDNow(x.thread);if(x.type==='typ')return k.getThreadIdForUser(x.from);return null;}g.subscribe([h.getArbiterType('typ'),h.getArbiterType('ttyp')],function(x,y){var z=y.obj,aa=w(z);if(aa){var ba=i.getIDForUser(z.from);if(z.st==l.TYPING){p[aa]=p[aa]||{};var ca=p[aa][ba];p[aa][ba]=Date.now();if(!o)o=m(t,3000);!ca&&v(aa);}else if(z.st==l.INACTIVE)u(aa,ba);}});j.subscribe('update-typing-state',function(x,y){var z=y.payload_source;if(z!=n.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE)return;var aa=y.actions;if(!aa||!aa.length)return;var ba=n.MercuryActionType.USER_GENERATED_MESSAGE;aa.forEach(function(ca){if(ca.action_type==ba&&ca.author!=i.user)u(ca.thread_id,ca.author);});});e.exports=r;});
__d("ChatTabIndicatorController",["ArbiterMixin","ChatConfig","DOM","LiveTimer","MercuryParticipants","MercuryRoger","MercuryThreads","MercuryTypingReceiver","copyProperties","setTimeoutAcrossTransitions","tx","date-extensions","MercuryConfig","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('ChatConfig'),i=b('DOM'),j=b('LiveTimer'),k=b('MercuryParticipants'),l=b('MercuryRoger'),m=b('MercuryThreads'),n=b('MercuryTypingReceiver'),o=b('copyProperties'),p=b('setTimeoutAcrossTransitions'),q=b('tx');b('date-extensions');var r=c('MercuryConfig'),s=c('MercuryConstants'),t=r['roger.seen_delay'],u=[];function v(w){this._threadID=w;this._canonicalUser=m.getCanonicalUserInThread(w);u.push(this);}o(v.prototype,g,{destroy:function(){u.remove(this);},setLastMessage:function(w){this._lastMsg=w;if(this._stateChangeTimeout){clearTimeout(this._stateChangeTimeout);this._stateChangeTimeout=null;}if(w){var x=t,y=s.MercuryActionStatus.SUCCESS;if(w.action_id||w.status==y){var z=j.getApproximateServerTime();x=w.timestamp+t-z;}if(x>0)this._stateChangeTimeout=p(function(){this._stateChangeTimeout=null;this._handleStateChange();}.bind(this),x);}this._handleStateChange();},_informStateChanged:function(w){if(w.activity=='none'&&this._currentActivity=='none')return;this._currentActivity=w.activity;this.inform('state-changed',w);},_notifySentFrom:function(){var w=s.MercurySourceType,x,y,z=this._lastMsg.location_text;if(z){x=q._("Sent from {location}",{location:z});y='sentFromMobile';}else switch(this._lastMsg.source){case w.CHAT_ORCA:case w.TITAN_ORCA:x=i.create('a',{href:'/mobile/messenger','class':'fcg',target:'_blank'},"Sent from Messenger");y='sentFromMobile';break;case w.MOBILE:case w.CHAT_IPHONE:case w.TITAN_API_MOBILE:case w.TITAN_WAP:x=i.create('a',{href:'/mobile','class':'fcg',target:'_blank'},"Sent from Mobile");y='sentFromMobile';break;case w.EMAIL:case w.TITAN_EMAIL_REPLY:x="Sent from Email";y='sentFromEmail';break;default:this._informStateChanged({activity:'none'});return;}this._informStateChanged({activity:y,text:x});},_notifySeenTimestamp:function(w){var x=l.getSeenTimestamp(this._threadID,w[0])*.001,y=Date.now()*.001,z=r['24h_times']?'H:i':'g:i A';if(x<y-518400){z='M j';}else if(x<y-86400)z='D '+z;var aa=Date.format(z,x);this._informStateChanged({activity:'seen-timestamp',text:q._("Seen {timestamp}",{timestamp:aa})});},_notifySeenBy:function(w){var x=this._lastMsg,y=true;k.getMulti(w,function(z){y=false;if(this._lastMsg!=x)return;var aa=m.getThreadMetaNow(this._threadID),ba=aa?aa.participants.length:0,ca=w.length+(x.author!=k.user),da,ea=false;if(ba>3&&ca>=ba-1){da="Seen by Everyone";}else if(w.length==1){da=q._("Seen by {user}",{user:z[w[0]].short_name});}else if(w.length==2){da=q._("Seen by {user1}, {user2}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name});}else if(w.length==3){da=q._("Seen by {user1}, {user2}, {user3}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,user3:z[w[2]].short_name});}else if(w.length>3){var fa=Object.keys(z).length-2,ga=q._("{num} more",{num:fa}),ha=i.create('span',{className:'more'},ga);da=i.tx._("Seen by {user1}, {user2}, {=num more link}",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,'=num more link':ha});ea=true;}this._informStateChanged({activity:'seen-by',text:da,seenBy:w,tooltip:ea});}.bind(this));y&&this._informStateChanged({activity:'none'});},_notifyTyping:function(w){var x=this._lastMsg,y=true;k.getMulti(w,function(z){y=false;if(this._lastMsg!=x)return;if(this._canonicalUser||h.get('chat_multi_typ')){var aa=m.getThreadMetaNow(this._threadID),ba=aa?aa.participants.length:0,ca,da=false;if(ba>3&&w.length>=ba-1){ca="Everyone is typing...";}else if(w.length==1){ca=q._("{name} is typing...",{name:z[w[0]].short_name});}else if(w.length==2){ca=q._("{user1} and {user2} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name});}else if(w.length==3){ca=q._("{user1}, {user2}, and {user3} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,user3:z[w[2]].short_name});}else if(w.length>3){var ea=Object.keys(z).length-2,fa=q._("{num} more",{num:ea}),ga=i.create('a',{href:'#'},fa);ca=i.tx._("{user1}, {user2}, and {=num more link} are typing...",{user1:z[w[0]].short_name,user2:z[w[1]].short_name,'=num more link':ga});da=true;}this._informStateChanged({activity:'typing',text:ca,typing:w,tooltip:da});}}.bind(this));y&&this._informStateChanged({activity:'none'});},_handleStateChange:function(){var w=s.MercuryActionType.LOG_MESSAGE;if(!this._lastMsg||this._lastMsg.action_type==w){this._informStateChanged({activity:'none'});return;}if(this._typing&&this._typing.length){this._notifyTyping(this._typing);return;}if(this._canonicalUser&&this._lastMsg.author!=k.user){this._notifySentFrom();return;}if(!this._stateChangeTimeout){var x=l.getSeenBy(this._lastMsg);if(x.length)if(this._canonicalUser){this._notifySeenTimestamp(x);return;}else{this._notifySeenBy(x);return;}}this._informStateChanged({activity:'none'});}});n.subscribe('state-changed',function(w,x){u.forEach(function(y){var z=x[y._threadID];if(z!==undefined){y._typing=z;y._handleStateChange();}});});l.subscribe('state-changed',function(w,x){u.forEach(function(y){if(x[y._threadID]&&!y._stateChangeTimeout)y._handleStateChange();});});e.exports=v;});
__d("ChatTabIndicatorLine",["ChatTabIndicatorController","CSS","DOM","DOMQuery","MercuryParticipants","Tooltip","copyProperties","csx"],function(a,b,c,d,e,f){var g=b('ChatTabIndicatorController'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('MercuryParticipants'),l=b('Tooltip'),m=b('copyProperties'),n=b('csx');function o(p,q,r){this._typingIndicator=q;this._messagesView=r;this._controller=new g(p);this._subscription=this._controller.subscribe('state-changed',this._handleStateChanged.bind(this));}m(o.prototype,{destroy:function(){this._setClass(null);this._subscription.unsubscribe();this._controller.destroy();},setLastMessage:function(p){this._controller.setLastMessage(p);},_handleStateChanged:function(p,q){var r=this._messagesView.isScrolledToBottom();this._rerender(q);r&&this._messagesView.scrollToBottom();},_rerender:function(p){if(p.activity=='none'){this._setClass(null);return;}var q=i.find(this._typingIndicator,".-cx-PRIVATE-mercuryTypingIndicator__text");if(p.text){i.setContent(q,p.text);}else i.empty(q);if(p.activity.substring(0,4)=='seen'){this._setClass('seen');if(p.activity=='seen-by'&&p.tooltip)k.getMulti(p.seenBy,function(r){var s=i.create('div'),t=0;for(var u in r)if(t++>=2){var v=i.create('div');i.setContent(v,r[u].name);i.appendContent(s,v);}var w=j.find(this._typingIndicator,'span.more');l.set(w,s,'above','center');}.bind(this));}else this._setClass(p.activity);},_setClass:function(p){if(this._lastClass===p)return;this._lastClass&&h.removeClass(this._typingIndicator,this._lastClass);p&&h.addClass(this._typingIndicator,p);this._lastClass=p;}});e.exports=o;});
__d("htmlHyperlink",["Env","StringEscape","UntrustedLink","URI","URLScraper"],function(a,b,c,d,e,f){var g=b('Env'),h=b('StringEscape'),i=b('UntrustedLink'),j=b('URI'),k=b('URLScraper');function l(m,n,o,p){if(typeof m==='undefined'||!m.toString)return '';if(typeof n!=='function')n=h.htmlize;if(typeof o!=='function')o=h.htmlize;var m=m.toString(),q=[],r;while((r=k.match(m))){var s=m.indexOf(r);if(s>=0)q.push(n(m.substring(0,s)));var t=o(r),u=r.replace(/"/g,'%22');if(!(/^[a-z][a-z0-9\-+.]+:\/\//i.test(r)))u='http://'+u;q.push('<a target="_blank" rel="nofollow" href="'+u+'"');if(p&&!j(r).isFacebookURI()){a.UntrustedLink=i;q.push(' onmousedown="UntrustedLink.bootstrap(this, \''+g.lhsh+'\', event)"');}q.push('>'+t+'</a>');m=m.substring(s+r.length);}m&&q.push(n(m));return q.join('');}e.exports=l;});
__d("MercuryMessageRenderer",["MercuryAttachmentRenderer","CSS","DOM","DOMQuery","Emote","HTML","htmlHyperlink","MercuryParticipants","Tooltip","tx","MercuryConstants"],function(a,b,c,d,e,f){var g=b('MercuryAttachmentRenderer'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('Emote'),l=b('HTML'),m=b('htmlHyperlink'),n=b('MercuryParticipants'),o=b('Tooltip'),p=c('MercuryConstants'),q=b('tx'),r={renderTooltipFlyout:function(ga,ha){ha.forEach(function(ia){var ja=i.create('div');i.setContent(ja,ia.name);i.appendContent(ga,ja);});},renderLogMessage:function(ga,ha,ia,ja){s(ga,ja);t(ha,ja);u(ia,ja);},formatMessageBody:function(ga){ga=(ga||'').replace(/\n+$/,'');ga=m(ga,k.htmlEmote,null,true);return l(ga);}};function s(ga,ha){var ia='';switch(ha.log_message_type){case p.MercuryLogMessageType.SUBSCRIBE:ia='mercurySubscribeIcon';break;case p.MercuryLogMessageType.UNSUBSCRIBE:ia='mercuryUnsubscribeIcon';break;case p.MercuryLogMessageType.THREAD_NAME:ia='mercuryThreadNameIcon';break;case p.MercuryLogMessageType.THREAD_IMAGE:ia='mercuryThreadImageIcon';break;case p.MercuryLogMessageType.VIDEO_CALL:var ja=ha.log_message_data.answered;if(ja||fa(ha)){ia='mercuryVideoCallIcon';}else ia='mercuryMissedVideoCallIcon';break;case p.MercuryLogMessageType.SERVER_ERROR:ia='mercuryErrorIcon';break;}h.addClass(ga,ia);}function t(ga,ha){switch(ha.log_message_type){case p.MercuryLogMessageType.SUBSCRIBE:ca(ga,ha);break;case p.MercuryLogMessageType.UNSUBSCRIBE:da(ga,ha);break;case p.MercuryLogMessageType.VIDEO_CALL:if(fa(ha)){v(ga,ha);}else w(ga,ha);break;case p.MercuryLogMessageType.THREAD_NAME:x(ga,ha);break;case p.MercuryLogMessageType.THREAD_IMAGE:y(ga,ha);break;case p.MercuryLogMessageType.SERVER_ERROR:ea(ga,ha);break;}}function u(ga,ha){var ia=ha.log_message_type;if(ia==p.MercuryLogMessageType.THREAD_IMAGE)z(ga,ha);}var v=function(ga,ha){n.get(ha.author,function(ia){var ja=ia.short_name,ka;switch(ha.log_message_data.event_name){case 'installing':ka=i.tx._("{firstname} is setting up video calling...",{firstname:ja});break;case 'installed':ka=i.tx._("{firstname} finished setting up video calling.",{firstname:ja});break;case 'install_canceled':ka=i.tx._("You canceled the video calling installation. ",{firstname:ja});break;}if(ka)i.setContent(ga,ka);});},w=function(ga,ha){var ia=ha.log_message_data.caller,ja=ha.log_message_data.callee,ka=[ia,ja];n.getMulti(ka,function(la){if(ia==n.user){var ma=la[ja].short_name,na;if(ha.log_message_data.answered){na=i.tx._("You called {firstname}.",{firstname:ma});}else na=i.tx._("{firstname} missed a call from you. ",{firstname:ma});}else{var oa=la[ia].short_name;if(ha.log_message_data.answered){na=i.tx._("{firstname} called you.",{firstname:oa});}else na=i.tx._("You missed a call from {firstname}. ",{firstname:oa});}i.setContent(ga,na);});},x=function(ga,ha){var ia=ha.log_message_data.name,ja=i.create('b',{},ia);if(ha.author==n.user){if(ia){i.setContent(ga,i.tx._("You named the conversation: {name}.",{name:ja}));}else i.setContent(ga,i.tx._("You removed the conversation name."));}else n.get(ha.author,function(ka){var la,ma=aa(ka);if(ia){la=i.tx._("{actor} named the conversation: {name}.",{actor:ma,name:ja});}else la=i.tx._("{actor} removed the conversation name.",{actor:ma});i.setContent(ga,la);});},y=function(ga,ha){if(ha.author==n.user){if(ha.log_message_data.image){i.setContent(ga,i.tx._("You changed the conversation picture."));}else i.setContent(ga,i.tx._("You removed the conversation picture."));}else n.get(ha.author,function(ia){var ja=aa(ia),ka;if(ha.log_message_data.image){ka=i.tx._("{actor} changed the conversation picture.",{actor:ja});}else ka=i.tx._("{actor} removed the conversation picture.",{actor:ja});i.setContent(ga,ka);});};function z(ga,ha){var ia=ha.log_message_data.image;if(ia)i.setContent(ga,g.renderPreview(ia));}var aa=function(ga){if(ga.href)return i.create('a',{href:ga.href},ga.name);return ga.name;},ba=function(ga){if(ga.href)return i.create('a',{href:ga.href},ga.short_name);return ga.short_name;},ca=function(ga,ha){var ia=ha.log_message_data.added_participants,ja=null,ka;if(ia.length==1){ja=[ha.author,ia[0]];n.getMulti(ja,function(la){if(ha.author==n.user){ka=i.tx._("You added {subscriber1}.",{subscriber1:aa(la[ia[0]])});}else ka=i.tx._("{actor} added {subscriber1}.",{actor:aa(la[ha.author]),subscriber1:aa(la[ia[0]])});i.setContent(ga,ka);});}else if(ia.length==2){ja=[ha.author].concat(ia);n.getMulti(ja,function(la){if(ha.author==n.user){ka=i.tx._("You added {subscriber1} and {subscriber2}.",{subscriber1:aa(la[ia[0]]),subscriber2:aa(la[ia[1]])});}else ka=i.tx._("{actor} added {subscriber1} and {subscriber2}.",{actor:aa(la[ha.author]),subscriber1:aa(la[ia[0]]),subscriber2:aa(la[ia[1]])});i.setContent(ga,ka);});}else if(ia.length==3){ja=[ha.author].concat(ia);n.getMulti(ja,function(la){if(ha.author==n.user){ka=i.tx._("You added {subscriber1}, {subscriber2} and {subscriber3}.",{subscriber1:aa(la[ia[0]]),subscriber2:aa(la[ia[1]]),subscriber3:aa(la[ia[2]])});}else ka=i.tx._("{actor} added {subscriber1}, {subscriber2} and {subscriber3}.",{actor:aa(la[ha.author]),subscriber1:aa(la[ia[0]]),subscriber2:aa(la[ia[1]]),subscriber3:aa(la[ia[2]])});i.setContent(ga,ka);});}else{ja=[ha.author].concat(ia);n.getMulti(ja,function(la){var ma=i.tx._("{num} more",{num:ia.length-2}),na=i.create('span',{className:'more'},ma),oa=i.create('div');r.renderTooltipFlyout(oa,ia.slice(2).map(function(qa){return la[qa];}));if(ha.author==n.user){ka=i.tx._("You added {subscriber1}, {subscriber2} and {more_people}.",{subscriber1:aa(la[ia[0]]),subscriber2:aa(la[ia[1]]),more_people:na});}else ka=i.tx._("{actor} added {subscriber1}, {subscriber2} and {more_people}.",{actor:aa(la[ha.author]),subscriber1:aa(la[ia[0]]),subscriber2:aa(la[ia[1]]),more_people:na});i.setContent(ga,ka);var pa=j.find(ga,'span.more');o.set(pa,oa,'above','center');});}},da=function(ga,ha){n.get(ha.author,function(ia){i.setContent(ga,i.tx._("{actor} left the conversation.",{actor:aa(ia)}));});},ea=function(ga,ha){var ia="We were unable to fetch previous messages in this conversation.";i.setContent(ga,ia);},fa=function(ga){return ga.log_message_data.event_name==='installing'||ga.log_message_data.event_name==='install_canceled';};e.exports=r;});
__d("ChatTabMessagesView",["event-extensions","Arbiter","ArbiterMixin","MercuryAttachmentRenderer","ChannelConstants","ChatConfig","ChatTabIndicatorLine","ChatVisibility","CSS","DOM","Emote","Env","MercuryMessages","MercuryThreadMetadataRenderer","MercuryThreads","MercuryMessageRenderer","MercuryParticipants","MercuryThreadInformer","Tooltip","VideoCallCore","copyProperties","isRTL","tx","date-extensions","ChatTabTemplates","MercuryConstants"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('MercuryAttachmentRenderer'),j=b('ChannelConstants'),k=b('ChatConfig'),l=b('ChatTabIndicatorLine'),m=b('ChatVisibility'),n=b('CSS'),o=b('DOM'),p=b('Emote'),q=b('Env'),r=b('MercuryMessages'),s=b('MercuryThreadMetadataRenderer'),t=b('MercuryThreads'),u=b('MercuryMessageRenderer'),v=b('MercuryParticipants'),w=b('MercuryThreadInformer'),x=b('Tooltip'),y=b('VideoCallCore'),z=c('ChatTabTemplates'),aa=c('MercuryConstants'),ba=b('copyProperties'),ca=b('isRTL'),da=b('tx');b('date-extensions');function ea(pa){return Date.format(k.get('24h_times')?'H:i':'g:ia',pa/1000);}function fa(pa){var qa=z[':fb:chat:conversation:message-group'].build();qa.setNodeContent('timestamp',ea(pa.timestamp));v.get(pa.author,function(ra){var sa=qa.getNode('profileLink');sa.href=ra.href;var ta=ra.fbid==q.user?"You":ra.name;x.set(sa,ta,'left');qa.setNodeProperty('profilePhoto','src',ra.image_src);});return qa;}function ga(pa){var qa=z[':fb:chat:conversation:message:event'].build();qa.setNodeContent('timestamp',ea(pa.timestamp));u.renderLogMessage(qa.getNode('icon'),qa.getNode('message'),qa.getNode('attachment'),pa);var ra=ha(pa);if(ra)o.appendContent(qa.getNode('message'),ra);return qa.getRoot();}function ha(pa){var qa,ra;if(pa.log_message_type==aa.MercuryLogMessageType.VIDEO_CALL)if(pa.log_message_data.event_name=='install_canceled'){qa=o.tx._("Retry setup and call back.");ra='callback_cancelinstall_link';return ia(qa,pa.thread_id,pa.log_message_data.to,ra);}else if(!pa.log_message_data.event_name&&pa.log_message_data.callee==v.user&&!pa.log_message_data.answered){qa=o.tx._("Call Back");ra='callback_link';return ia(qa,pa.thread_id,pa.log_message_data.caller.split(':')[1],ra);}return null;}function ia(pa,qa,ra,sa){if(y.isSupported()){var ta=!m.isOnline()||!y.availableForCall(ra),ua=o.create('a',{href:'#',className:'callBackLink'},pa);if(ta)n.hide(ua);ua.setAttribute('data-gt',JSON.stringify({videochat:'clicked_callback_link'}));Event.listen(ua,'click',function(){na.inform('video-call-clicked',{userID:ra,threadID:qa,clickSource:sa});});return ua;}return null;}function ja(pa){var qa=z[':fb:mercury:chat:message:forward'].build(),ra=qa.getNode('forwardText');if(ra){n.hide(qa.getRoot());s.renderTitanLink(pa.thread_id,qa.getNode('forwardLink'),n.show.bind(n,qa.getRoot()));if(pa.forward_count>1){o.appendContent(ra,da._("{count} forwarded messages",{count:pa.forward_count}));}else o.appendContent(ra,"1 forwarded message");}return qa.getRoot();}var ka=["January","February","March","April","May","June","July","August","September","October","November","December"];function la(pa){var qa=new Date();qa.setHours(0);qa.setMinutes(0);qa.setSeconds(0);qa.setMilliseconds(0);var ra=24*60*60*1000,sa=qa.getTime()-pa.getTime();if(sa<=0){return "Today";}else if(sa<ra)return "Yesterday";return da._("{month} {date}",{month:ka[pa.getMonth()],date:pa.getDate()});}var ma=[];function na(pa,qa,ra,sa){this.threadID=pa;this.scrollContainer=qa;this.conversationElem=ra;this.messageElements={};this.messageGroup=null;this.prevMessage=null;var ta=aa.MercuryThreadlistConstants.MESSAGE_TIMESTAMP_THRESHOLD;this._olderTimestamp=(new Date()).getTime()-ta;ma.push(this);this._subscription=g.subscribe('overflow-applied-to-body',this.scrollToBottom.bind(this));if(sa)this.indicatorLine=new l(this.threadID,sa,this);r.getThreadMessagesRange(this.threadID,0,aa.MercuryThreadlistConstants.RECENT_MESSAGES_LIMIT,Function.prototype);this.rerender();}ba(na,h);ba(na.prototype,{destroy:function(){o.empty(this.conversationElem);this._subscription.unsubscribe();ma.remove(this);this.indicatorLine&&this.indicatorLine.destroy();this.destroyed=true;},_appendMessage:function(pa){if(pa==this.prevMessage)return;var qa=aa.MercuryThreadlistConstants,ra=qa.GROUPING_THRESHOLD,sa=pa.action_type==aa.MercuryActionType.LOG_MESSAGE&&pa.log_message_type==aa.MercuryLogMessageType.SERVER_ERROR;if(pa.is_cleared)return;var ta=null;if(this.prevMessage)ta=new Date(this.prevMessage.timestamp);var ua=new Date(pa.timestamp);if(!sa&&(!ta||ta.getDate()!=ua.getDate()||ta.getMonth()!=ua.getMonth()||ta.getFullYear()!=ua.getFullYear())){var va=z[':fb:chat:conversation:date-break'].build();o.setContent(va.getRoot(),la(ua));o.appendContent(this.conversationElem,va.getRoot());this.messageGroup=null;}if(pa.action_type==aa.MercuryActionType.LOG_MESSAGE){o.appendContent(this.conversationElem,ga(pa));this.messageGroup=null;this.prevMessage=pa;return;}if(!this.messageGroup||this.prevMessage.author!=pa.author||this.prevMessage.timestamp<pa.timestamp-ra){this.messageGroup=fa(pa);o.appendContent(this.conversationElem,this.messageGroup.getRoot());}var wa=this._renderSingleMessage(pa);this.messageElements[pa.message_id]=wa;o.appendContent(this.messageGroup.getNode('messages'),wa);this.prevMessage=pa;},rerender:function(){o.empty(this.conversationElem);this.messageElements={};this.messageGroup=null;this.prevMessage=null;var pa=r.getThreadMessagesSinceTimestamp(this.threadID,this._olderTimestamp);this._appendMessages(pa);},update:function(pa){for(var qa in pa){var ra=this.messageElements[qa];if(ra){var sa=this._renderSingleMessage(r.getMessagesFromIDs([qa])[0]);this.messageElements[qa]=sa;o.replace(ra,sa);}}},_appendMessages:function(pa){pa.forEach(this._appendMessage.bind(this));this.indicatorLine&&this.indicatorLine.setLastMessage(this.prevMessage);this.scrollToBottom();},isScrolledToBottom:function(){var pa=this.scrollContainer;return pa.scrollTop+pa.clientHeight>=pa.scrollHeight;},scrollToBottom:function(){this.scrollContainer.scrollTop=this.scrollContainer.scrollHeight;},_renderSingleMessage:function(pa){var qa=z[':fb:chat:conversation:message'].render();if(pa.subject){var ra=z[':fb:chat:conversation:message:subject'].render();o.setContent(ra,pa.subject);o.appendContent(qa,ra);}if(pa.body.substr(0,4)=='?OTR'){o.setContent(qa,"[encrypted message]");n.addClass(qa,'cyphertext');}else{n.addClass(qa,ca(pa.body)?'direction_rtl':'direction_ltr');o.appendContent(qa,u.formatMessageBody(pa.body));}if(pa.has_attachment)this._appendMessageAttachments(qa,pa.attachments);if(pa.forward_count)o.appendContent(qa,ja(pa));var sa=s.renderStatusIndicator(pa.status,r.resendMessage.bind(r,pa));if(sa){n.addClass(qa,'errorStatus');var ta=z[':fb:chat:conversation:message:status'].build();o.appendContent(ta.getNode('message'),qa);o.appendContent(ta.getNode('status'),sa);return ta.getRoot();}return qa;},_appendMessageAttachments:function(pa,qa){var ra=aa.MercuryAttachmentType;for(var sa=0,ta=qa.length;sa<ta;++sa){var ua=qa[sa],va=ua.attach_type,wa=ua.share_data_type;if(va==ra.ERROR)o.appendContent(pa,i.renderError(ua));if(va==ra.FILE)o.appendContent(pa,i.renderFileLink(ua));var xa=null,ya;if(va==ra.SHARE&&wa==aa.MercurySupportedShareType.FB_VIDEO){xa=i.renderVideoThumb(ua);ya=o.find(xa,'img');Event.listen(ya,'load',this._thumbLoaded.shield(this,ya));}else if(va==ra.SHARE&&(wa==aa.MercurySupportedShareType.FB_MUSIC_ALBUM||wa==aa.MercurySupportedShareType.FB_SONG)){xa=i.renderMusic(ua);ya=o.find(xa,'img');Event.listen(ya,'load',this._thumbLoaded.shield(this,ya));}else if(va==ra.SHARE&&(wa==aa.MercurySupportedShareType.EXTERNAL||wa==aa.MercurySupportedShareType.FB_TEMPLATE)){xa=i.renderExternalLink(ua);ya=o.find(xa,'img');Event.listen(ya,'load',this._thumbLoaded.shield(this,ya));}else if(ua.preview_url){xa=i.renderPreview(ua,true);ya=o.find(xa,'img');Event.listen(ya,'load',this._thumbLoaded.shield(this,ya));}else if(va==ra.SHARE)xa=i.renderShareLink(ua);if(xa)o.appendContent(pa,xa);}},_thumbLoaded:function(pa){var qa=this.scrollContainer.scrollTop+this.scrollContainer.clientHeight;if(qa+pa.offsetHeight>=this.scrollContainer.scrollHeight)this.scrollToBottom();}});w.subscribe('messages-reordered',function(pa,qa){ma.forEach(function(ra){qa[ra.threadID]&&ra.rerender();});});w.subscribe('messages-updated',function(pa,qa){ma.forEach(function(ra){qa[ra.threadID]&&ra.update(qa[ra.threadID]);});});w.subscribe('messages-received',function(pa,qa){ma.forEach(function(ra){var sa=qa[ra.threadID];sa&&ra._appendMessages(sa);});});g.subscribe(j.getArbiterType('chat_event'),function(pa,qa){if(oa(qa.obj)){var ra=(q.user==qa.obj.from)?qa.obj.to:qa.obj.from,sa=t.getThreadIdForUser(ra),ta=ma.filter(function(wa){return wa.threadID===sa;});if(ta.length>0){var ua=ta[0],va=r.constructLogMessageObject(aa.MercurySourceType.CHAT_WEB,sa,aa.MercuryLogMessageType.VIDEO_CALL,qa.obj);va.author='fbid:'+qa.obj.from;ua._appendMessages([va]);}}});function oa(pa){return (pa.event_name==='installing'||pa.event_name==='install_canceled');}e.exports=na;});
__d("ChatTabSheetPolicy",[],function(a,b,c,d,e,f){var g={canReplaceOpenSheet:function(h,i){if(h.getType()==i.getType())return false;if(h.isPermanent()&&!i.isPermanent())return false;return true;}};e.exports=g;});
__d("ChatTabSheetView",["event-extensions","Animation","ChatTabSheetPolicy","CSS","DOM","Style","Vector","copyProperties","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Animation'),h=b('ChatTabSheetPolicy'),i=b('CSS'),j=b('DOM'),k=b('Style'),l=b('Vector'),m=b('copyProperties'),n=c('ChatTabTemplates'),o=5000,p=function(q,r,s){this._threadID=q;this._rootElement=r;this._tabMainElement=s;this._openSheet=null;};m(p.prototype,{destroy:function(){j.empty(this._rootElement);},_openCommon:function(q,r){if(this._openSheet&&!h.canReplaceOpenSheet(this._openSheet,q))return;this.clear(function(){this._openSheet=q;var s=n[':fb:mercury:chat:tab-sheet:loading'].build().getRoot();j.setContent(this._rootElement,s);i.show(s);i.show(this._rootElement);q.render();if(r){i.addClass(this._tabMainElement,'sheetSlide');var t=l.getElementDimensions(this._rootElement).y;k.set(this._rootElement,'bottom',t+'px');this._animation=new g(this._rootElement).to('bottom',0).duration(150).ease(g.ease.both).ondone(function(){i.removeClass(this._tabMainElement,'sheetSlide');}.bind(this)).go();}if(!q.isPermanent()){var u=o;if(q.getCloseTimeout)u=q.getCloseTimeout();this._sheetCloseHandler=this.close.bind(this,q).defer(u,false);}}.bind(this));},set:function(q){return this._openCommon(q,false);},open:function(q){return this._openCommon(q,true);},close:function(q,r){if(this._openSheet!=q)return;if(!this._openSheet){r&&r();return;}if(this._animation)this._animation.stop();if(this._sheetCloseHandler){clearTimeout(this._sheetCloseHandler);this._sheetCloseHandler=null;}i.addClass(this._tabMainElement,'sheetSlide');var s=l.getElementDimensions(this._rootElement).y;this._animation=new g(this._rootElement).to('bottom',s+'px').duration(100).ease(g.ease.begin).ondone(function(){j.empty(this._rootElement);i.hide(this._rootElement);i.removeClass(this._tabMainElement,'sheetSlide');this._openSheet=null;r&&r();}.bind(this)).go();},clear:function(q){this.close(this._openSheet,q);}});e.exports=p;});
__d("Tokenizer",["array-extensions","event-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","Input","Keys","Parent","Token","UserAgent","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('Input'),n=b('Keys'),o=b('Parent'),p=b('Token'),q=b('UserAgent'),r=b('copyProperties'),s=b('createObjectFrom');function t(u,v){this.element=u;this.typeahead=v;this.input=v.getCore().getElement();k.set(this.element,'Tokenizer',this);}t.getInstance=function(u){var v=o.byClass(u,'uiTokenizer');return v?k.get(v,'Tokenizer'):null;};r(t.prototype,h,{inline:false,maxTokens:null,excludeDuplicates:true,placeholder:'',init:function(u,v,w,x){this.init=bagofholding;this.tokenarea=u;this.paramName=v;this.placeholder=this.input.getAttribute('data-placeholder')||'';r(this,x||{});this.initEvents();this.initTypeahead();this.reset(w);this.initBehaviors();g.inform('Tokenizer/init',this,g.BEHAVIOR_PERSISTENT);},reset:function(u){this.tokens=[];this.unique={};if(u){this.populate(u);}else l.empty(this.tokenarea);this.updateTokenarea();},populate:function(u){var v=[];this.tokens=this.getTokenElements().map(function(w,x){var y=u[x];v.push(this._tokenKey(y));return this.createToken(y,w);},this);this.unique=s(v,this.tokens);},getElement:function(){return this.element;},getTypeahead:function(){return this.typeahead;},getInput:function(){return this.input;},initBehaviors:function(){this.behaviors=this.behaviors||[];if(this.behaviors instanceof Array){this.behaviors.forEach(function(w){w.behavior(this,w.config);}.bind(this));}else for(var u in (this.behaviors||{})){var v=window.TokenizerBehaviors&&window.TokenizerBehaviors[u];v.call(null,this,this.behaviors[u]);}},initTypeahead:function(){var u=this.typeahead.getCore();u.resetOnSelect=true;u.setValueOnSelect=false;u.preventFocusChangeOnTab=true;if(this.inline){var v=this.typeahead.getView();j.addClass(v.getElement(),'uiInlineTokenizerView');}this.typeahead.subscribe('select',function(w,x){var y=x.selected;if('uid' in y){this.updateInput();this.addToken(this.createToken(y));}}.bind(this));this.typeahead.subscribe('blur',this.handleBlur.bind(this));},handleBlur:function(event){this.inform('blur',{event:event});this.updatePlaceholder();},initEvents:function(){var u=this.handleEvents.bind(this),v=q.firefox()<4?'keypress':'keydown';Event.listen(this.tokenarea,{click:u,keydown:u});Event.listen(this.input,'paste',this.paste.bind(this));Event.listen(this.input,v,this.keydown.bind(this));},handleEvents:function(event){var u=event.getTarget(),v=u&&this.getTokenElementFromTarget(u);if(!v)return;if(event.type!='keydown'||Event.getKeyCode(event)==n.RETURN)this.processEvents(event,u,v);},processEvents:function(event,u,v){if(o.byClass(u,'remove')){var w=v.nextSibling;w=w&&l.scry(v.nextSibling,'.remove')[0];var x=this.getTokenFromElement(v);x=this.addTokenData(x,u);this.removeToken(x);this.focusOnTokenRemoval(event,w);event.kill();}},focusOnTokenRemoval:function(event,u){m.focus(event.type=='keydown'&&u||this.input);},addTokenData:function(u,v){return u;},keydown:function(event){this.inform('keydown',{event:event});var u=Event.getKeyCode(event),v=this.input;if(this.inline&&u==n.BACKSPACE&&m.isEmpty(v)){var w=this.getLastToken();if(w&&w.isRemovable())this.removeToken(w);}this.updateInput();},paste:function(event){this.inform('paste',{event:event});this.updateInput(true);},focusInput:function(){m.focus(this.input);},updateInput:function(u){if(!this.inline)return;var v=this.input;setTimeout(function(){v.size=v.value.length||1;if(u)v.value=v.value;},20);m.setPlaceholder(this.input,'');},updatePlaceholder:function(){if(!this.inline||this.stickyPlaceholder||this.input.value)return;var u=!this.tokens.length;this.input.size=u?this.placeholder.length*2||1:1;m.setPlaceholder(this.input,u?this.placeholder:'');},getToken:function(u){return this.unique[u]||null;},getTokens:function(){return this.tokens||[];},getTokenElements:function(){return l.scry(this.tokenarea,'span.uiToken');},getTokenElementFromTarget:function(u){return o.byClass(u,'uiToken');},getTokenFromElement:function(u){return k.get(u,'Token');},getTokenValues:function(){return this.tokens.map(function(u){return u.getValue();});},getFirstToken:function(){return this.tokens[0]||null;},getLastToken:function(){return this.tokens[this.tokens.length-1]||null;},hasMaxTokens:function(){return this.maxTokens&&this.maxTokens<=this.tokens.length;},createToken:function(u,v){var w=this.getToken(this._tokenKey(u));w=w||new p(u,this.paramName);v&&w.setElement(v);return w;},addToken:function(u){if(this.hasMaxTokens())return;var v=this._tokenKey(u.getInfo());if(v in this.unique)return;this.unique[v]=u;this.tokens.push(u);this.insertToken(u);this.updateTokenarea();this.inform('addToken',u);g.inform('Form/change',{node:this.element});},insertToken:function(u){l.appendContent(this.tokenarea,u.getElement());},removeToken:function(u){if(!u)return;var v=this.tokens.indexOf(u);if(v<0)return;this.tokens.splice(this.tokens.indexOf(u),1);delete this.unique[this._tokenKey(u.getInfo())];l.remove(u.getElement());this.updateTokenarea();this.inform('removeToken',u);g.inform('Form/change',{node:this.element});},removeAllTokens:function(){this.reset();this.inform('removeAllTokens');},updateTokenarea:function(){var u=this.typeahead.getCore(),v=this.getTokenValues();if(this.excludeDuplicates){this._exclusions||(this._exclusions=u.getExclusions());u.setExclusions(v.concat(this._exclusions));}u.setEnabled(!this.hasMaxTokens());this.updateTokenareaVisibility();this.updatePlaceholder();},updateTokenareaVisibility:function(){j.conditionShow(this.tokenarea,this.tokens.length!==0);},_tokenKey:function(u){return u.uid+(u.freeform?':':'');}});e.exports=t;});
__d("MercuryTypeahead",["event-extensions","ArbiterMixin","DOM","Env","Input","Tokenizer","Typeahead","TypeaheadCore","copyProperties","MercuryTypeaheadTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('DOM'),i=b('Env'),j=b('Input'),k=b('Tokenizer'),l=b('Typeahead'),m=b('TypeaheadCore'),n=b('copyProperties'),o=c('MercuryTypeaheadTemplates'),p=function(q,r){this._domElement=null;this._typeahead=null;this._tokenizer=null;this._placeholder='';this._exclusions=[];this._viewNodeID=null;this._viewOptions={renderer:'compact',autoSelect:true};this._tokenizerBehaviors=[];this._dataSource=q;this._view=r;};n(p.prototype,g);n(p.prototype,{setPlaceholder:function(q){this._placeholder=q;return this;},setExcludedParticipants:function(q){this._exclusions=[];q.forEach(function(r){var s=r.indexOf(':');if(r.substr(0,s)=='fbid')this._exclusions.push(r.substr(s+1));}.bind(this));return this;},setViewNodeID:function(q){this._viewNodeID=q;},setViewOption:function(q,r){this._viewOptions[q]=r;},addTokenizerBehavior:function(q){this._tokenizerBehaviors.push(q);},build:function(q){if(this._domElement)return;var r=o[':fb:mercury:tokenizer'].build(),s=o[':fb:mercury:typeahead'].build();this._domElement=r.getRoot();h.appendContent(this._domElement,s.getRoot());var t=s.getNode('textfield');j.setPlaceholder(t,this._placeholder);t.setAttribute('data-placeholder',this._placeholder);var u={node_id:this._viewNodeID,ctor:this._view,options:this._viewOptions},v={ctor:m,options:{setValueOnSelect:true}};this._typeahead=new l(this._dataSource,u,v,s.getRoot());this._typeahead.init();var w={inline:true,behaviors:this._tokenizerBehaviors};this._tokenizer=new k(this._domElement,this._typeahead);this._tokenizer.init(r.getNode('tokenarea'),'participants',[],w);this._tokenizer.subscribe(['addToken','removeToken','removeAllTokens'],function(){this.inform('tokens-changed');}.bind(this));Event.listen(t,'focus',function(){this._resetDataSource();this._typeahead.init();}.bind(this));Event.listen(this._domElement,'click',this.focus.bind(this));},getElement:function(){return this._domElement;},getSelectedParticipantIDs:function(){var q=[];if(this._tokenizer)(this._tokenizer.getTokenValues()||[]).forEach(function(r){q.push('fbid:'+r);});return q;},getTokens:function(){var q=[];if(this._tokenizer)q=this._tokenizer.getTokens();return q;},getTokenizer:function(){return this._tokenizer;},reset:function(){this._tokenizer&&this._tokenizer.removeAllTokens();this._typeahead&&this._typeahead.getCore().reset();},focus:function(){this._tokenizer&&this._tokenizer.focusInput();},getTypeahead:function(){return this._typeahead;},_resetDataSource:function(){this._dataSource.setExclusions(this._exclusions);}});e.exports=p;});
__d("MultiChatController",["Arbiter","AsyncSignal","copyProperties","Form","MercuryMessages","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncSignal'),i=b('copyProperties'),j=b('Form'),k=b('MercuryMessages'),l=b('MercuryServerRequests'),m=b('MercuryThreads');function n(){}i(n,{subscribe:function(o,p){o.subscribe('confirm',function(){this.createGroupThreadFromChooserDialog(o,p);}.bind(this));},createGroupThreadFromChooserDialog:function(o,p){var q=j.serialize(o.getRoot()),r=JSON.parse(q.profileChooserItems),s=[];for(var t in r)if(r[t])s.push(t);var u=n.createThreadForFBIDs(s);l.subscribe('update-thread-ids',function(v,w){for(var x in w)if(w[x]==u)new h('/ajax/groups/chat/log',{group_id:p,message_id:x}).send();});o.hide();},createThreadForTokens:function(o){if(!o.length)return;var p;if(o.length==1){p='user:'+o[0].split(':')[1];}else p='root:'+k.generateNewClientMessageID((new Date()).getTime());m.createNewLocalThread(p,o);g.inform('chat/open-tab',{thread_id:p});return p;},createThreadForFBIDs:function(o){var p=[];for(var q=0;q<o.length;q++)p.push("fbid:"+o[q]);return n.createThreadForTokens(p);}});e.exports=n;});
__d("ChatAddFriendsTabSheet",["event-extensions","Arbiter","ChatTabSheetView","ContextualTypeaheadView","DOM","MercuryTypeahead","MercuryMessages","MultiChatController","MercuryServerRequests","MercuryThreads","copyProperties","tx","MercuryConstants","MercuryDataSource","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ChatTabSheetView'),i=b('ContextualTypeaheadView'),j=b('DOM'),k=b('MercuryTypeahead'),l=b('MercuryMessages'),m=b('MultiChatController'),n=b('MercuryServerRequests'),o=b('MercuryThreads'),p=b('copyProperties'),q=c('MercuryConstants'),r=c('MercuryDataSource'),s=c('ChatTabTemplates'),t=b('tx');function u(x,y,z){this._threadID=x;this._rootElement=y;this._sheetView=z;}p(u.prototype,{render:function(){var x=s[':fb:mercury:chat:tab-sheet:add-friends'].build();o.getThreadMeta(this._threadID,function(y){var z=new k(r,i);z.setExcludedParticipants(y.participants);z.setPlaceholder("Enter a friend's name");z.build();j.replace(x.getNode('participantsTypeahead'),z.getElement());j.setContent(this._rootElement,x.getRoot());z.focus();var aa=y.participants,ba=y.is_canonical_user?v.bind(null,this,this._sheetView,aa,z):w.bind(null,this,this._sheetView,this._threadID,z);Event.listen(x.getNode('doneButton'),'click',ba);}.bind(this));},isPermanent:function(){return true;},getType:function(){return 'add_friends_type';},open:function(){this._sheetView.open(this);}});function v(x,y,z,aa){var ba=aa.getSelectedParticipantIDs();if(ba.length)m.createThreadForTokens(z.concat(ba));y.close(x);}function w(x,y,z,aa){var ba=aa.getSelectedParticipantIDs();if(ba.length)if(o.isEmptyLocalThread(z)){o.addParticipantsToThreadLocally(z,ba);}else l.sendMessage(l.constructLogMessageObject(q.MercurySourceType.CHAT_WEB,z,q.MercuryLogMessageType.SUBSCRIBE,{added_participants:ba}));y.close(x);}e.exports=u;});
__d("ChatAvailabilityTabSheet",["Arbiter","AvailableList","AvailableListConstants","ChatConfig","CSS","DOM","GenderConst","MercuryThreads","ShortProfiles","copyProperties","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('ChatConfig'),k=b('CSS'),l=b('DOM'),m=b('GenderConst'),n=b('MercuryThreads'),o=b('ShortProfiles'),p=b('copyProperties'),q=c('ChatTabTemplates');function r(v,w,x,y){this._handledAvailability=w;this._sheetView=y;this._rootElement=x;this._canonicalUser=n.getCanonicalUserInThread(v);if(this._canonicalUser){this._currentAvailability=i.ACTIVE;this._handleAvailabilityChange();g.subscribe(i.ON_AVAILABILITY_CHANGED,this._handleAvailabilityChange.bind(this));}}r.createSheets=function(v,w,x){var y={};if(j.get('roger.ui')){y[i.OFFLINE]=new r(v,i.OFFLINE,w,x);return y;}[i.ACTIVE,i.OFFLINE,i.MOBILE].forEach(function(z){y[z]=new r(v,z,w,x);});return y;};p(r.prototype,{render:function(){!this._canonicalUser;var v=q[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();o.get(this._canonicalUser,function(w){var x=null;switch(this._currentAvailability){case i.ACTIVE:k.addClass(v.getRoot(),'active');x=s(w);break;case i.MOBILE:k.addClass(v.getRoot(),'mobile');x=t(w);break;case i.OFFLINE:x=u(w);break;}l.setContent(v.getNode('text'),x);l.setContent(this._rootElement,v.getRoot());}.bind(this));},isPermanent:function(){return false;},getType:function(){switch(this._handledAvailability){case i.ACTIVE:return 'availability_active_type';case i.MOBILE:return 'availability_mobile_type';case i.OFFLINE:return 'availability_offline_type';default:throw new Error("Invalid handled availability");}},getCloseTimeout:function(){return 5000;},_handleAvailabilityChange:function(){var v=h.get(this._canonicalUser);if(v==this._currentAvailability)return;this._currentAvailability=v;if(v==this._handledAvailability)this._sheetView.open(this);}});function s(v){return l.tx._("{name} is now available.",{name:v.firstName});}function t(v){return l.tx._("Your messages will be sent to {name}'s phone.",{name:v.firstName});}function u(v){switch(v.gender){case m.FEMALE_SINGULAR:case m.FEMALE_SINGULAR_GUESS:return l.tx._("{name} is offline, but you can still send her a message.",{name:v.firstName});case m.MALE_SINGULAR:case m.MALE_SINGULAR_GUESS:return l.tx._("{name} is offline, but you can still send him a message.",{name:v.firstName});default:return l.tx._("{name} is offline, but you can still send them a message.",{name:v.firstName});}}e.exports=r;});
__d("ChatNoRecipientsTabSheet",["DOM","MercuryParticipants","MercuryThreadInformer","MercuryThreads","copyProperties","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('MercuryParticipants'),i=b('MercuryThreadInformer'),j=b('MercuryThreads'),k=b('copyProperties'),l=c('ChatTabTemplates');function m(n,o,p){this._threadID=n;this._rootElement=o;this._sheetView=p;i.subscribe('threads-updated',this._handleThreadsUpdated.bind(this));}k(m.prototype,{render:function(){var n=l[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build();g.setContent(n.getNode('text'),g.tx._("All recipients have left this conversation. Please close the stale tab."));g.setContent(this._rootElement,n.getRoot());},isPermanent:function(){return true;},getType:function(){return 'no_recipients_type';},_handleThreadsUpdated:function(){j.getThreadMeta(this._threadID,function(n){var o=h.user,p=n.participants.filter(function(q){return q!=o;});if(p.length<1){this._sheetView.open(this);}else this._sheetView.close(this);}.bind(this));}});e.exports=m;});
__d("ChatOfflineTabSheet",["event-extensions","ChatPrivacyActionController","ChatTabSheetView","ChatVisibility","CSS","DOM","JSLogger","MercuryParticipants","MercuryThreads","copyProperties","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ChatPrivacyActionController'),h=b('ChatTabSheetView'),i=b('ChatVisibility'),j=b('CSS'),k=b('DOM'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads'),o=b('copyProperties'),o=b('copyProperties'),p=c('ChatTabTemplates');function q(r,s,t){this._rootElement=s;this._sheetView=t;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(r);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(q.prototype,{render:function(){if(!this._canonicalUser)this._logger.error('offline_sheet_open_with_non_friend');var r=p[':fb:mercury:chat:tab-sheet:message-icon-sheet'].build(),s='fbid:'+this._canonicalUser;m.get(s,function(t){var u='fbChatGoOnlineLink',v=k.create('a',{href:'#',className:u},k.tx._("go online")),w=k.tx._("You are now offline. To chat with {name} and other friends, {link}.",{name:t.short_name,link:v});k.setContent(r.getNode('text'),w);j.addClass(r.getRoot(),'chatOffline');k.setContent(this._rootElement,r.getRoot());Event.listen(this._rootElement,'click',function(event){if(j.hasClass(event.getTarget(),u)){if(i.isOnline())this._logger.error('tab_sheet_already_online');this._privacyActionController.togglePrivacy();this._logger.log('tab_sheet_go_online',{tab_id:this._canonicalUser});return false;}}.bind(this));}.bind(this));},_handlePrivacyChange:function(r){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(r){case g.OFFLINE:this._sheetView.open(this);break;case g.NORMAL:case g.BLOCKED:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'offline_type';}});e.exports=q;});
__d("ChatUserBlockedTabSheet",["event-extensions","ChatPrivacyActionController","ChatTabSheetView","CSS","DOM","GenderConst","JSLogger","MercuryParticipants","MercuryThreads","copyProperties","tx","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ChatPrivacyActionController'),h=b('ChatTabSheetView'),i=b('CSS'),j=b('DOM'),k=b('GenderConst'),l=b('JSLogger'),m=b('MercuryParticipants'),n=b('MercuryThreads'),o=b('copyProperties'),p=c('ChatTabTemplates'),q=b('tx');function r(s,t,u){this._rootElement=t;this._sheetView=u;this._logger=l.create('blackbird');this._canonicalUser=n.getCanonicalUserInThread(s);if(this._canonicalUser)this._privacyActionController=new g(this._canonicalUser,this._handlePrivacyChange.bind(this));}o(r.prototype,{render:function(){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_open_with_non_friend');var s=p[':fb:mercury:chat:tab-sheet:user-blocked'].build(),t='fbid:'+this._canonicalUser;m.get(t,function(u){var v=null;switch(u.gender){case k.FEMALE_SINGULAR:case k.FEMALE_SINGULAR_GUESS:v=q._("{name} sees you as offline on chat, but you can still send her a message. ",{name:u.short_name});break;case k.MALE_SINGULAR:case k.MALE_SINGULAR_GUESS:v=q._("{name} sees you as offline on chat, but you can still send him a message. ",{name:u.short_name});break;default:v=q._("{name} sees you as offline on chat, but you can still send them a message. ",{name:u.short_name});}j.setContent(s.getNode('text'),v);var w=q._("Go Online to {name}",{name:u.short_name});j.setContent(s.getNode('actionLink'),w);i.addClass(s.getRoot(),'blocked');j.setContent(this._rootElement,s.getRoot());Event.listen(s.getNode('actionLink'),'click',this._privacyActionController.togglePrivacy.bind(this._privacyActionController));}.bind(this));},_handlePrivacyChange:function(s){if(!this._canonicalUser)this._logger.error('user_blocked_sheet_privacy_changed_non_friend');switch(s){case g.BLOCKED:this._sheetView.open(this);break;case g.NORMAL:case g.OFFLINE:this._sheetView.close(this);break;}},isPermanent:function(){return true;},getType:function(){return 'user_blocked_type';}});e.exports=r;});
__d("ChatTabSheetController",["ChatAddFriendsTabSheet","ChatAvailabilityTabSheet","ChatNoRecipientsTabSheet","ChatOfflineTabSheet","ChatTabSheetView","ChatUserBlockedTabSheet","copyProperties","MercuryServerRequests","MercuryThreads"],function(a,b,c,d,e,f){var g=b('ChatAddFriendsTabSheet'),h=b('ChatAvailabilityTabSheet'),i=b('ChatNoRecipientsTabSheet'),j=b('ChatOfflineTabSheet'),k=b('ChatTabSheetView'),l=b('ChatUserBlockedTabSheet'),m=b('copyProperties'),n=b('MercuryServerRequests'),o=b('MercuryThreads'),p=function(q,r,s){this._sheetView=new k(q,r,s);this._addFriendsTabSheet=new g(q,r,this._sheetView);this._userBlockedTabSheet=new l(q,r,this._sheetView);this._offlineTabSheet=new j(q,r,this._sheetView);this._availabilityTabSheets=h.createSheets(q,r,this._sheetView);if(o.isMultichatThread(q))this._noRecipientsTabSheet=new i(q,r,this._sheetView);};m(p.prototype,{openAddFriendsSheet:function(){this._addFriendsTabSheet.open();},destroy:function(){this._sheetView.destroy();}});e.exports=p;});
__d("ChatTabView",["event-extensions","function-extensions","Arbiter","ArbiterMixin","AvailableList","AvailableListConstants","ChatConfig","ChatContextualDialogController","ChatQuietLinks","ChatPrivacyActionController","MessagesEmoticonView","ChatTabMessagesView","ChatTabSheetController","ChatVisibility","CSS","Dialog","Dock","DOM","JSLogger","Keys","MercuryMessages","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","MercuryThreadMetadataRenderer","MercuryThreads","MercuryTypingReceiver","NubController","Parent","PresencePrivacy","Style","TextAreaControl","Tooltip","TypingIndicator","URI","UserAgent","VideoCallCore","copyProperties","setIntervalAcrossTransitions","tx","MercuryConstants","ChatTabTemplates"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('AvailableList'),j=b('AvailableListConstants'),k=b('ChatConfig'),l=b('ChatContextualDialogController'),m=b('ChatQuietLinks'),n=b('ChatPrivacyActionController'),o=b('MessagesEmoticonView'),p=b('ChatTabMessagesView'),q=b('ChatTabSheetController'),r=b('ChatVisibility'),s=b('CSS'),t=b('Dialog'),u=b('Dock'),v=b('DOM'),w=b('JSLogger'),x=b('Keys'),y=b('MercuryMessages'),z=b('MercuryParticipants'),aa=b('MercuryServerRequests'),ba=b('MercuryThreadInformer'),ca=b('MercuryThreadMetadataRenderer'),da=b('MercuryThreads'),ea=b('MercuryTypingReceiver'),fa=b('NubController'),ga=b('Parent'),ha=b('PresencePrivacy'),ia=b('Style'),ja=b('TextAreaControl'),ka=b('Tooltip'),la=b('TypingIndicator'),ma=b('URI'),na=b('UserAgent'),oa=b('VideoCallCore'),pa=c('MercuryConstants'),qa=c('ChatTabTemplates'),ra=b('copyProperties'),sa=b('setIntervalAcrossTransitions'),ta=b('tx'),ua=w.create('tab_view'),va={};function wa(fb,gb){var hb=v.create('div');gb=gb.filter(function(ib){return ib!=z.user;});z.getMulti(gb,function(ib){for(var jb in ib){var kb=ib[jb],lb=qa[':fb:mercury:chat:multichat-tooltip-item'].build();v.setContent(lb.getNode('name'),kb.name);var mb=z.getUserID(jb),nb=mb&&i.get(mb)==j.ACTIVE;s.conditionShow(lb.getNode('icon'),nb);s.conditionClass(lb.getNode('name'),'tooltipItemWithIcon',nb);v.appendContent(hb,lb.getRoot());}ka.set(fb,hb,'above','center');});}var xa={},ya=null,za=false;function ab(fb,gb,hb){if(hb){xa[fb]=gb;if(!ya)ya=sa(bb,600);}else{s.removeClass(gb,'highlightTitle');delete xa[fb];}}function bb(){for(var fb in xa){var gb=xa[fb];if(gb.parentNode){s.conditionClass(gb,'highlightTitle',za);}else delete xa[fb];}za=!za;if(!Object.keys(xa).length){clearInterval(ya);ya=null;}}function cb(fb){var gb=aa.tokenizeThreadID(fb);switch(gb.type){case 'user':return qa[':fb:mercury:chat:user-tab'].build();case 'group':return qa[':fb:mercury:chat:group-tab'].build();}return qa[':fb:mercury:chat:multichat-tab'].build();}function db(fb,gb){if(gb)aa.ensureThreadIsFetched(gb);this._threadID=fb;this._eventListeners=[];this._tabTemplate=cb(fb);this._tabElem=this._tabTemplate.getRoot();if(!(this._getNode instanceof Function))ua.log('getnode_undefined',{is_getnode_set:!!this._getNode,is_prototype_set:!!db.prototype,is_window:window==this,is_chat_tab_view:this instanceof db,ctor_name:this.constructor&&this.constructor.name});this._sheetController=new q(this._threadID,this._getNode('sheet'),this._tabElem);this._contextualDialogController=new l(this._threadID,this._getNode('videoCallLink'));this._messagesView=null;var hb=this._getNode('conversationLink');if(hb){s.hide(hb);ca.renderTitanLink(fb,hb,s.show.bind(s,hb));}if(da.isMultichatThread(this._threadID))this._titlebarTooltipAnchor=this._getNode('titlebarText');var ib=this._getCanonicalUserID();if(this._isTitleTextLinked())z.get('fbid:'+ib,function(nb){var ob=this._getNode('titlebarText');ob.setAttribute('href',nb.href);ob.removeAttribute('rel');s.removeClass(ob,'noLink');}.bind(this));this._nubController=new fa().init(this._tabElem);ja.getInstance(this._getNode('input')).subscribe('resize',function(){this._nubController.flyoutContentChanged();}.bind(this));this._nubController.subscribe('resize',function(){this._emoticonsNode.style.left=(this._getNode('input').clientWidth+3)+'px';}.bind(this));this._listen('closeButton','click',this._closeClicked);this._listen('titlebarCloseButton','click',this._closeClicked);this._listen('dockButton','click',this._nubClicked);this._listen('dockButton','keydown',this._dockKeyDown);this._listen('nubFlyoutTitlebar','click',this._titleClicked);this._listen('chatConv','click',this._chatConvClicked);this._listen('addFriendLink','click',this._addFriendLinkClicked,true);this._listen('addToThreadLink','click',this._addFriendLinkClicked,true);this._listen('clearWindowLink','click',this._clearHistory,true);this._listen('unsubscribeLink','click',this._unsubscribeLinkClicked,true);this._listen('videoCallLink','click',this._callClicked,true);this._listen('reportSpamLink','click',this._reportSpamClicked,true);this._listen('input','focus',this._focusTab);this._listen('input','blur',this._blurTab);this._emoticonsNode=this._getNode('emoticons');this._emoticonView=new o(this._emoticonsNode,this._getNode('input'));if(na.firefox()){this._listen('input','keypress',this._inputKeyDown);}else this._listen('input','keydown',this._inputKeyDown);this._privacyLink=this._getNode('privacyLink');if(this._privacyLink){var jb=new n(ib,this._updatePrivacyLink.bind(this));this._eventListeners.push(Event.listen(this._privacyLink,'click',jb.togglePrivacy.bind(jb)));}var kb=ib||(k.get('chat_multi_typ_send')&&da.isMultichatThread(this._threadID));if(kb)aa.getServerThreadID(this._threadID,function(nb){this._typingIndicator=new la(ib,this._getNode('input'),'mercury-chat',null,nb);}.bind(this));var lb=this._getNode('muteGroupLink');if(lb){var mb=da.getCanonicalGroupInThread(this._threadID);if(mb)lb.setAttribute('ajaxify',ma(lb.getAttribute('ajaxify')).addQueryData({id:mb}));}m.removeLinkHrefs(this._tabElem);va[fb]=this;this.updateAvailableStatus();this.updateTab();}function eb(){for(var fb in va){va[fb].updateAvailableStatus();va[fb].updateMultichatTooltip();}}g.subscribe(['buddylist/availability-changed'],eb);ha.subscribe(['privacy-changed','privacy-availability-changed'],eb);ea.subscribe('state-changed',function(fb,gb){for(var hb in gb){var ib=gb[hb]&&gb[hb].length,jb=va[hb];jb&&jb.showTypingIndicator(ib);}});ba.subscribe('threads-updated',function(fb,gb){for(var hb in va)gb[hb]&&va[hb].updateTab();});ba.subscribe('threads-deleted',function(fb,gb){for(var hb in va)db.inform('thread-deleted',hb);});ra(db,h,{get:function(fb){return va[fb];}});ra(db.prototype,{getThreadID:function(){return this._threadID;},isVisible:function(){return s.shown(this._tabElem);},setVisibleState:function(fb,gb){var hb=s.shown(this._tabElem),ib=s.hasClass(this._tabElem,'opened');s.conditionShow(this._tabElem,fb);s.conditionClass(this._tabElem,'opened',gb);if(!(hb&&ib)&&fb&&gb){if(!this._messagesView)this._messagesView=new p(this._threadID,this._getNode('chatConv'),this._getNode('conversation'),this._getNode('typingIndicator'));this._nubController.flyoutContentChanged();this._messagesView.scrollToBottom();}if(hb&&ib&&!(fb&&gb))this._contextualDialogController.tabNotActive();},focus:function(){var fb=s.hasClass(this._tabElem,'opened')?'input':'dockButton';this._getNode(fb).focus();},isFocused:function(){var fb=document.activeElement;return ga.byClass(fb,'fbMercuryChatTab')===this._tabElem;},setInput:function(fb){this._getNode('input').value=fb;},insertBefore:function(fb){v.insertBefore(fb._tabElem,this._tabElem);},appendTo:function(fb){v.appendContent(fb,this._tabElem);},nextTabIs:function(fb){var gb=fb&&fb._tabElem;return this._tabElem.nextSibling==gb;},destroy:function(){v.remove(this._tabElem);this._emoticonView&&this._emoticonView.destroy();while(this._eventListeners.length)this._eventListeners.pop().remove();this._messagesView&&this._messagesView.destroy();this._sheetController.destroy();this._contextualDialogController.destroy();delete va[this._threadID];u.unregisterNubController(this._nubController);},updateAvailableStatus:function(){var fb={active:false,mobile:false,greenphone:false},gb=this._getCanonicalUserID(),hb=true,ib=false;if(gb){var jb=i.get(gb);hb=!r.isOnline();ib=!ha.allows(gb);fb.active=(jb===j.ACTIVE);if(k.get('sidebar_mobile_icon_green')){fb.greenphone=jb===j.MOBILE;}else fb.mobile=jb===j.MOBILE;this._updateCallLink(jb);}s.conditionClass(this._tabElem,'chatOffline',hb);s.conditionClass(this._tabElem,'blocked',!hb&&ib);for(var kb in fb)s.conditionClass(this._tabElem,kb,!hb&&!ib&&fb[kb]);},updateTab:function(){da.getThreadMeta(this._threadID,function(fb){if(!fb.is_subscribed){db.inform('unsubscribed',this._threadID);return;}ca.renderAndSeparatedParticipantList(this._threadID,[this._getNode('name'),this._getNode('titlebarText')],{names_renderer:ca.renderShortNames,check_length:true});this._updateUnreadCount(fb);this.updateMultichatTooltip();this._updateArchiveWarning(fb);}.bind(this));},_updateArchiveWarning:function(fb){var gb=false;z.get(z.user,function(hb){gb=hb.employee;if(gb)z.getMulti(fb.participants,this._showArchiveWarningIfAllParticipantsAreEmployees.bind(this));}.bind(this));},_showArchiveWarningIfAllParticipantsAreEmployees:function(fb){var gb=true;for(var hb in fb)gb=gb&&fb[hb].employee;var ib=this._getNode('titanArchiveWarning');if(ib){if(this._titlebarTooltipAnchor)s.conditionClass(this._titlebarTooltipAnchor,'narrowTitleBar',gb);s.conditionShow(ib,gb);}},updateMultichatTooltip:function(){if(da.isMultichatThread(this._threadID))da.getThreadMeta(this._threadID,function(fb){wa(this._titlebarTooltipAnchor,fb.participants);}.bind(this));},_getNode:function(fb){return this._tabTemplate.getNode(fb);},_getCanonicalUserID:function(){return da.getCanonicalUserInThread(this._threadID);},_listen:function(fb,event,gb,hb){var ib=this._getNode(fb);if(ib){this._eventListeners.push(Event.listen(ib,event,gb.bind(this)));}else if(!hb)throw new Error('Could not find node "'+fb+'"');},_closeClicked:function(fb){db.inform('closed-tab',this._threadID);fb.prevent();},_nubClicked:function(){return db.inform('nub-activated',this._threadID);},_dockKeyDown:function(event){if(event.keyCode===x.RETURN||event.keyCode===x.SPACE){db.inform('nub-activated',this._threadID);event.kill();}else this._handleHotkeyPressed(event);},_handleHotkeyPressed:function(event){if(event.keyCode===x.ESC){db.inform('esc-pressed',this._threadID);event.kill();}else if(event.keyCode===x.TAB){var fb=db.inform('tab-pressed',{id:this._threadID,shiftPressed:event.shiftKey});!fb&&event.kill();}},_isTitleTextLinked:function(){var fb=this._getCanonicalUserID();return fb&&k.get('chat_tab_title_link_timeline');},_titleClicked:function(event){var fb=event.getTarget(),gb=ga.byClass(fb,'titlebarText'),hb=gb&&this._isTitleTextLinked();if(!hb&&!ga.byClass(fb,'uiSelector')&&!ga.byClass(fb,'addToThread'))db.inform('lower-activated',this._threadID);},_callClicked:function(fb){var gb=this._getCanonicalUserID();if(oa.availableForCall(gb)){var hb='chat_tab_icon';if(fb.target&&s.hasClass(fb.target,'video_call_promo')){hb='chat_tab_icon_promo';}else if(fb.target&&s.hasClass(fb.target,'video_call_tour'))hb='chat_tab_icon_tour';db.inform('video-call-clicked',{threadID:this._threadID,userID:gb,clickSource:hb});}return false;},_addFriendLinkClicked:function(){this._sheetController.openAddFriendsSheet();},_clearHistory:function(){var fb=da.getThreadMetaNow(this._threadID);if(fb){var gb=this._getCanonicalUserID();aa.clearChat(this._threadID,gb,fb.timestamp);}},_unsubscribeLinkClicked:function(){var fb=[];fb.push({name:'unsubscribe',label:"Leave Conversation",handler:this._unsubscribeToThread.bind(this)});fb.push(t.CANCEL);new t().setTitle("Leave Conversation?").setBody("You will stop receiving messages from this conversation and people will see that you left.").setButtons(fb).show();},_reportSpamClicked:function(){var fb=this._getCanonicalUserID(),gb=ma('/ajax/chat/report.php').addQueryData({id:fb}).addQueryData({src:'top_report_link'});t.bootstrap(gb.toString(),null,false);},_focusTab:function(){s.addClass(this._tabElem,'focusedTab');db.inform('focused',this._threadID);this._contextualDialogController.tabFocused();},_blurTab:function(){s.removeClass(this._tabElem,'focusedTab');},_inputKeyDown:function(event){if(event.keyCode===x.RETURN&&!event.shiftKey){var fb=this._getNode('input'),gb=fb.value||'';if(!/^\s*$/.test(gb))da.getThreadMeta(this._threadID,function(hb){var ib=y.constructUserGeneratedMessageObject(gb,pa.MercurySourceType.CHAT_WEB,this._threadID);if(da.isEmptyLocalThread(this._threadID)){var jb=aa.tokenizeThreadID(this._threadID);ib.message_id=jb.value;ib.specific_to_list=hb.participants;}y.sendMessage(ib);this._getNode('input').value='';this._typingIndicator&&this._typingIndicator.resetState();}.bind(this));event.kill();}if(event.keyCode===x.DOWN&&event.shiftKey&&this._getNode('input').value===''){db.inform('lower-activated',this._threadID);event.kill();return;}this._handleHotkeyPressed(event);},_chatConvClicked:function(){!v.getSelection()&&this.focus();},showTypingIndicator:function(fb){var gb=this._getCanonicalUserID()||(k.get('chat_multi_typ')&&da.isMultichatThread(this._threadID));if(gb)s.conditionClass(this._tabElem,'typing',fb);},_updateUnreadCount:function(fb){var gb=fb.unread_count;if(typeof gb!='undefined'){var hb=this._getNode('numMessages');s.conditionShow(hb,gb);s.conditionClass(this._tabElem,'highlightTab',gb);ab(this._threadID,this._tabElem,!!gb);v.setContent(hb,gb);}},_updateCallLink:function(fb){var gb=this._getNode('videoCallLink');if(r.isOnline()){var hb=this._getCanonicalUserID(),ib='fbid:'+hb;z.get(ib,function(jb){if(oa.availableForCall(hb)){ka.set(gb,ta._("Start a video call with {firstname}",{firstname:jb.short_name}));this._updateCallBackLinks(this._tabElem,true);}else{ka.set(gb,ta._("{firstname} is currently unavailable for video calling",{firstname:jb.short_name}));this._hideVideoCallouts();this._updateCallBackLinks(this._tabElem,false);}}.bind(this));}else{ka.set(gb,"You must be online to make a call.");this._hideVideoCallouts();this._updateCallBackLinks(document.body,false);}},_updateCallBackLinks:function(fb,gb){var hb=v.scry(fb,'a.callBackLink');if(gb){hb.forEach(s.show);}else hb.forEach(s.hide);},_hideVideoCallouts:function(){this._contextualDialogController.hideVideoCallouts();},_updatePrivacyLink:function(fb){if(fb==n.OFFLINE){v.setContent(this._privacyLink,"Go online");}else{var gb=this._getCanonicalUserID(),hb='fbid:'+gb;z.get(hb,function(ib){var jb=null;if(fb==n.BLOCKED){jb=ta._("Go Online to {name}",{name:ib.short_name});}else jb=ta._("Go Offline to {name}",{name:ib.short_name});v.setContent(this._privacyLink,jb);}.bind(this));}},_unsubscribeToThread:function(){if(da.isEmptyLocalThread(this._threadID)){db.inform('unsubscribed',this._threadID);}else{var fb=y.constructLogMessageObject(pa.MercurySourceType.CHAT_WEB,this._threadID,pa.MercuryLogMessageType.UNSUBSCRIBE,{});y.sendMessage(fb);}return true;},_emoticonView:null});e.exports=db;});
__d("ChatNewMessageHandler",["ChatActivity","ChatTabModel","ChatTabView","JSLogger","MercuryAssert","MercuryBrowserAlerts","MercuryThreads","MercuryUnseenState"],function(a,b,c,d,e,f){var g=b('ChatActivity'),h=b('ChatTabModel'),i=b('ChatTabView'),j=b('JSLogger'),k=b('MercuryAssert'),l=b('MercuryBrowserAlerts'),m=b('MercuryThreads'),n=b('MercuryUnseenState'),o=j.create('chat_new_message'),p={_raiseTab:function(q,r){var s=h.getTab(q),t=false;if(s){t=s.raised;}else{h.raiseTab(q,false);t=true;}r.to_new_tab=!s;r.to_raised_tab=!!t;},_notify:function(q,r,s){var t=i.get(q);s.view_is_visible=t&&t.isVisible();s.view_is_focused=t&&t.isFocused();if(!s.view_is_visible)o.log('message_to_hidden');s.is_active=g.isActive();l.messageReceived(r);},newMessage:function(q,r){k.isThreadID(q);var s={thread_id:q,message_id:r.message_id};this._raiseTab(q,s);this._notify(q,r,s);o.log('message',s);}};l.subscribe('before-alert',function(q,event){var r=event.threadID,s=i.get(r),t=h.getTab(r);if(t&&t.raised&&s&&s.isVisible()&&s.isFocused()){m.changeThreadReadStatus(r,true);n.markThreadSeen(r);event.cancelAlert();}});e.exports=p;});
__d("ChatTabPresence",["Arbiter","AvailableList","ChatTabModel","MercuryThreads"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('ChatTabModel'),j=b('MercuryThreads'),k={};function l(m){var n=j.getCanonicalUserInThread(m);if(n)h.updateForID(n);}i.subscribe('chat/tabs-changed',function(event,m){m.tabs.forEach(function(n){if(n.raised&&!k[n.id])l(n.id);});k={};m.tabs.forEach(function(n){if(n.raised)k[n.id]=true;});});e.exports={};});
__d("ChatTabPolicy",["ChatBehavior","ChatConfig","FBDesktopPlugin","JSLogger","MercuryAssert","MercuryParticipants","MercuryThreads","MercuryUnseenState","PresencePrivacy","ShortProfiles","MercuryConstants"],function(a,b,c,d,e,f){var g=b('ChatBehavior'),h=b('ChatConfig'),i=b('FBDesktopPlugin'),j=b('JSLogger'),k=b('MercuryAssert'),l=b('MercuryParticipants'),m=b('MercuryThreads'),n=b('MercuryUnseenState'),o=b('PresencePrivacy'),p=b('ShortProfiles'),q=c('MercuryConstants'),r=j.create('tab_policy');function s(t,u){n.markThreadSeen(t,u);}e.exports={messageIsAllowed:function(t,u,v){var w=t.thread_id,x=u.message_id;k.isThreadID(w);k.isParticipantID(u.author);var y;if(t.mode==q.MercuryThreadMode.OBJECT_ORIGINATED){y={thread_id:w,message_id:x,mode:t.mode};r.log('message_object_originated',y);return;}var z=q.MercurySourceType;if(u.source==z.EMAIL||u.source==z.TITAN_EMAIL_REPLY){y={thread_id:w,message_id:x,source:u.source};r.log('message_source_not_allowed',y);return;}var aa=l.getUserID(u.author);if(!aa){r.log('message_bad_author',{thread_id:w,message_id:x,user:aa});return;}if(u.action_type!=q.MercuryActionType.USER_GENERATED_MESSAGE){y={thread_id:w,message_id:x,type:u.action_type};r.log('message_non_user_generated',y);return;}if(t.is_canonical_user&&!g.notifiesUserMessages()){r.log('message_jabber',{thread_id:w,message_id:x});s(w,true);return;}var ba=t.is_canonical_user;if(h.get('desktop_mercury'))ba=true;if(i.shouldSuppressMessages()&&ba){r.log('message_desktop',{thread_id:w,message_id:x});return;}if(!t.is_canonical_group&&t.folder!=q.MessagingTag.INBOX){r.log('message_folder',{thread_id:w,message_id:x,folder:t.folder});return;}p.get(aa,function(ca){if(!o.allows(aa)){r.log('message_privacy',{thread_id:w,message_id:x,user:aa});return;}if(!t.is_canonical_group)if(ca.type!='friend'){r.log('message_non_friend',{thread_id:w,message_id:x,user:aa});return;}v();});}};});
__d("ChatTabViewSelector",["Arbiter","copyProperties","CSS","DataStore","DOM","Menu","MercuryThreadInformer","MercuryThreads","NubController","MercuryThreadMetadataRenderer","Toggler","ChatTabTemplates"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Menu'),m=b('MercuryThreadInformer'),n=b('MercuryThreads'),o=b('NubController'),p=b('MercuryThreadMetadataRenderer'),q=b('Toggler'),r=c('ChatTabTemplates');function s(t){var u=r[':fb:chat:tab:selector'].build(),v=u.getRoot(),w=u.getNode('menu'),x=k.find(w,'.uiMenuInner'),y={},z=new o().init(v);i.hide(v);k.insertBefore(t,v);function aa(da){var ea=0;for(var fa in y){var ga=y[fa],ha=n.getThreadMetaNow(fa),ia=ga.getNode('unreadCount'),ja=(ha&&ha.unread_count)||0;ea+=ja;if(ja>9)ja='+';i.conditionClass(ia,'invisible_elem',!ja);k.setContent(ia,ja);}var ka=u.getNode('numMessages');i.conditionShow(ka,ea);k.setContent(ka,ea);}this.setTabData=function(da){y={};if(da.length<1){i.hide(v);return;}i.show(v);k.empty(x);da.forEach(function(ea){var fa=r[':fb:chat:tab:selector:item'].build();y[ea.id]=fa;var ga=fa.getNode('content');p.renderAndSeparatedParticipantList(ea.id,ga);k.prependContent(x,fa.getRoot());j.set(fa.getRoot(),'threadID',ea.id);});z.flyoutContentChanged();k.setContent(u.getNode('numTabs'),da.length);aa();};function ba(event,da){if(da.menu!=w)return;var ea=j.get(da.item,'threadID');s.inform('selected',ea);q.hide(v);}function ca(event,da){l.register(w);}l.subscribe('select',ba.bind(this));q.listen('show',v,function(){g.inform('layer_shown',{type:'ChatTabSelector'});ca();});q.listen('hide',v,function(){g.inform('layer_hidden',{type:'ChatTabSelector'});});m.subscribe('threads-updated',aa);}h(s,new g());e.exports=s;});
__d("ChatTabController",["ChatTabPresence","Arbiter","AsyncRequest","ChatActivity","ChatConfig","ChatNewMessageHandler","ChatTabMessagesView","ChatTabModel","ChatTabPolicy","ChatTabView","ChatTabViewSelector","ChatTitleBarBlinker","Dialog","JSLogger","MercuryMessages","MercuryParticipants","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryUnseenState","Style","UserAgent","VideoCallCore"],function(a,b,c,d,e,f){b('ChatTabPresence');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('ChatActivity'),j=b('ChatConfig'),k=b('ChatNewMessageHandler'),l=b('ChatTabMessagesView'),m=b('ChatTabModel'),n=b('ChatTabPolicy'),o=b('ChatTabView'),p=b('ChatTabViewSelector'),q=b('ChatTitleBarBlinker'),r=b('Dialog'),s=b('JSLogger'),t=b('MercuryMessages'),u=b('MercuryParticipants'),v=b('MercuryServerRequests'),w=b('MercuryThreadInformer'),x=b('MercuryThreads'),y=b('MercuryUnseenState'),z=b('Style'),aa=b('UserAgent'),ba=b('VideoCallCore'),ca=j.get('tab_auto_close_timeout')||7200000,da=s.create('tab_controller');function ea(ma){x.changeThreadReadStatus(ma,true);fa(ma);}function fa(ma){y.markThreadSeen(ma);}function ga(){var ma=m.get();ma.tabs.forEach(function(na){var oa=o.get(na.id);if(na.raised&&oa&&oa.isVisible())ea(na.id);});}function ha(){var ma=m.get();ma.tabs.forEach(function(na){fa(na.id);});}function ia(ma,na,oa){var pa=m.get().tabs;ma+=na?1:-1;while(ma>=0&&ma<pa.length){var qa=pa[ma],ra=o.get(qa.id);if(ra&&ra.isVisible()&&(!oa||qa.raised)){ra.focus();return true;}ma+=na?1:-1;}return false;}function ja(ma){function na(qa){var ra=ma.shouldPromoteOnRaise(qa);g.inform("chat/promote-tab",qa);if(ra){m.raiseAndPromoteTab(qa,true);}else m.raiseTab(qa,true);var sa=o.get(qa);sa&&sa.focus();}function oa(qa,ra){var sa=m.get(),ta=ma.getMaxTabsToShow(),ua=m.indexOf(qa);m.closeTabAndDemote(qa,ta-2,ra);return ua;}p.subscribe('selected',function(qa,ra){na(ra);});g.subscribe('chat/open-tab',function(qa,ra){na(ra.thread_id);});g.subscribe('page_transition',function(qa,ra){m.closeFragileTabs();});v.subscribe('model-update-completed',ha);o.subscribe('focused',function(event,qa){ea(qa);});i.subscribe('idle',function(qa,ra){if(ra>ca){var sa=m.get().tabs;sa.forEach(function(ta){var ua=ta.id;x.getThreadMeta(ua,function(va){if(!va.unread_count){da.log('autoclose_idle_seen',{thread_id:ua,idleness:ra});m.closeTab(ua,'autoclose_idle_seen');}});});}});o.subscribe('nub-activated',function(qa,ra){na(ra);});o.subscribe('lower-activated',function(qa,ra){m.lowerTab(ra);var sa=o.get(ra);sa&&sa.focus();ea(ra);});function pa(qa,ra){ba.showOutgoingCallDialog(ra.userID,ra.clickSource);m.lowerTab(ra.threadID);}o.subscribe('video-call-clicked',pa);l.subscribe('video-call-clicked',pa);o.subscribe('closed-tab',function(qa,ra){da.log('close_view',{thread_id:ra});oa(ra,'close_view');ea(ra);return false;});o.subscribe('thread-deleted',function(qa,ra){da.log('close_thread_deleted',{thread_id:ra});oa(ra,'close_thread_deleted');return false;});o.subscribe('unsubscribed',function(qa,ra){da.log('close_view_unsubscribed',{thread_id:ra});oa(ra,'close_view_unsubscribed');return false;});o.subscribe('esc-pressed',function(qa,ra){da.log('close_esc',{thread_id:ra});var sa=oa(ra,'close_esc');ia(sa-1,true,true)||ia(sa,false,true);});w.subscribe('messages-received',function(qa,ra){for(var sa in ra){var ta=ra[sa];for(var ua=0;ua<ta.length;ua++){var va=ta[ua];if(va.author!=u.user){if(!va.is_unread){da.log('message_already_read',{action_id:va.action_id,thread_id:va.thread_id});continue;}x.getThreadMeta(sa,function(wa){n.messageIsAllowed(wa,va,function(){k.newMessage(sa,va);});});}}}});w.subscribe('thread-read-changed',function(qa,ra){for(var sa in ra)if(!ra[sa].mark_as_read){da.log('autoclose_marked_unread',{thread_id:sa});m.closeTab(sa,'autoclose_marked_unread');}});o.subscribe('tab-pressed',function(qa,ra){return !ia(m.indexOf(ra.id),ra.shiftPressed);});g.subscribe(s.DUMP_EVENT,function(qa,ra){ra.chat_controller={auto_close_timeout:ca};});}if(aa.firefox()){var ka=function(){return z.get(document.body,'overflowX')+' '+z.get(document.body,'overflowY');},la=ka();document.documentElement.addEventListener('DOMAttrModified',function(event){if(event.getTarget()===document.documentElement&&(event.attrName==='class'||event.attrName==='style')){var ma=ka();if(ma!==la){la=ma;g.inform('overflow-applied-to-body');}}},false);}e.exports=ja;});
__d("ChatTabViewCoordinator",["Arbiter","ChatConfig","ChatTabModel","ChatTabView","ChatTabViewSelector","CSS","VideoCallCore"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChatConfig'),i=b('ChatTabModel'),j=b('ChatTabView'),k=b('ChatTabViewSelector'),l=b('CSS'),m=b('VideoCallCore');function n(o,p){var q=new k(o),r={},s=false;function t(){var y=i.get(),z={};y.tabs.forEach(function(ba){z[ba.id]=1;});for(var aa in r)if(!z[aa]){r[aa].destroy();delete(r[aa]);}u(y);v(y);}function u(y){var z=null;y.tabs.forEach(function(aa){var ba=aa.id,ca=false;if(!r[ba]){r[ba]=new j(ba,aa.server_id);ca=true;}if(ca||!r[ba].nextTabIs(z))if(z){r[ba].insertBefore(z);}else r[ba].appendTo(o);z=r[ba];});}function v(y){var z=p.getTabsToShow(y),aa=[],ba=false;y.tabs.forEach(function(ca){if(!z[ca.id]){r[ca.id].setVisibleState(false,ca.raised);aa.push(ca);}});y.tabs.forEach(function(ca){if(z[ca.id]){r[ca.id].setVisibleState(true,ca.raised);ba|=ca.raised;}});q.setTabData(aa);x(ba);}function w(y){for(var z=0,aa=y.tabs.length;z<aa;z++){var ba=y.tabs[z];if(ba.raised)if(ba.id===y.promoted||z<p.getMaxTabsToShow()-1)return true;}return false;}function x(y){if(!y&&s){g.inform('layer_hidden',{type:'ChatTab'});s=false;}else if(y&&!s){g.inform('layer_shown',{type:'ChatTab'});s=true;}}if(m.isSupported())l.addClass(o,'videoCallEnabled');p.subscribe('tabs-changed',t);t();}e.exports=n;});
__d("TabsViewport",["event-extensions","ArbiterMixin","ChatConfig","ChatTabModel","Class","CSS","Dock","DOM","Parent","Vector","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ChatConfig'),i=b('ChatTabModel'),j=b('Class'),k=b('CSS'),l=b('Dock'),m=b('DOM'),n=b('Parent'),o=b('Vector'),p=b('areObjectsEqual'),q=b('copyProperties');function r(s){this._root=s;Event.listen(window,'resize',this._recalculateWidth.bind(this));l.subscribe('resize',this._recalculateWidth.bind(this));i.subscribe('chat/tabs-changed',this._recalculateTabs.shield(this,true));this._recalculateWidth();this._initialized=true;}q(r.prototype,g,{_root:null,_initialized:false,_availableWidth:0,_maxShown:1,_viewState:null,_recalculateWidth:function(){var s=r._getAvailableDockWidth(this._root),t=Math.max(1,Math.floor(s/264)),u=t!=this._maxShown;if(!this._viewState||u||s<=this._viewState.usedWidth||s>this._viewState.widthToShowNext){this._availableWidth=s;this._maxShown=t;this._viewState=null;this._recalculateTabs(u);}},_onTabsChanged:function(){if(this._initialized){this.inform('tabs-changed');this.inform('max-to-show-changed',this._maxShown);this.inform('max-to-show-change-completed');}},_recalculateTabs:function(s){var t=r._getTabsToShow(i.get(),this._availableWidth);if(s||!p(this._viewState,t)){this._viewState=t;this._onTabsChanged();}},getMaxTabsToShow:function(){return this._maxShown;},checkWidth:function(){this._recalculateWidth();},getTabsToShow:function(){return JSON.parse(JSON.stringify(this._viewState.tabsToShow));},shouldPromoteOnRaise:function(s){if(!this._viewState.tabsToShow[s])return true;if(this._viewState.nextToHide!=s)return false;var t=i.getTab(s),u=t&&t.raised;return !u&&(this._availableWidth-this._viewState.usedWidth<100);}});q(r,{_getAvailableDockWidth:function(s){var t=o.getViewportDimensions().x;t-=230;t-=50;var u=n.byClass(s,'fbDock'),v=o.getElementDimensions(u),w=n.byClass(s,'fbDockChat'),x=o.getElementDimensions(w),y=v.x-x.x;t-=y;t-=20;return Math.max(t,0);},_getTabsToShow:function(s,t){var u=164,v=264;t=Math.max(t,v+1);function w(la){return la.raised?v:u;}var x=JSON.parse(JSON.stringify(s.tabs)),y=-1,z=null;if(s.promoted)x.forEach(function(la,ma){if(la.id===s.promoted){y=ma;z=la;}});var aa=0,ba=0,ca=!z;x.forEach(function(la,ma){var na=w(la);la.leftmostOffset=aa+v;aa+=na;if(la.leftmostOffset<t)ba++;ca|=ma==y;la.alreadyPlacedPromoted=ca;});function da(la,ma,na){var oa={};for(var pa=0;pa<ma;pa++){var qa=la[pa];if(!qa.alreadyPlacedPromoted&&pa==ma-1){oa[na]=true;}else oa[qa.id]=true;}return oa;}var ea=da(x,ba,s.promoted),fa=da(x,ba-1,s.promoted),ga=null;for(var ha in ea)if(!fa[ha])ga=ha;var ia=x[ba-1],ja=ia?ia.leftmostOffset:0,ka=Infinity;if(ba<x.length)ka=x[ba].leftmostOffset;return {nextToHide:ga,tabsToShow:ea,usedWidth:ja,widthToShowNext:ka};}});e.exports=r;});
__d("MercuryStateCheck",["Arbiter","copyProperties","ChannelConnection","ChannelConstants","MercuryFolders","MercuryServerRequests","URI","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChannelConnection'),j=b('ChannelConstants'),k=b('MercuryFolders'),l=b('MercuryServerRequests'),m=b('URI'),n=c('MercuryConstants'),o=h(new g(),{initialize:function(){g.subscribe(j.ON_INVALID_HISTORY,p);i.subscribe(i.CONNECTED,function(q,r){if(!r.init)p();});}});function p(){var q;if(m.getRequestURI().getPath().search(/webmessenger/)!==-1){q=k.getSupportedFolders();}else q=[n.MessagingTag.INBOX];l.fetchMissedMessages(q);}o.initialize();e.exports=o;});
__d("AjaxRequest",["ErrorUtils","Keys","URI","UserAgent","XHR","copyProperties"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h=b('Keys'),i=b('URI'),j=b('UserAgent'),k=b('XHR'),l=b('copyProperties');function m(p,q,r){this.xhr=k.create();if(!(q instanceof i))q=new i(q);if(r&&p=='GET'){q.setQueryData(r);}else this._params=r;this.method=p;this.uri=q;this.xhr.open(p,q);}m.corsEnabled=window.XMLHttpRequest&&('withCredentials' in new XMLHttpRequest());m.ERROR='ar:error';m.TIMEOUT='ar:timeout';m.PROXY_ERROR='ar:proxy error';m.TRANSPORT_ERROR='ar:transport error';m.SERVER_ERROR='ar:http error';m.PARSE_ERROR='ar:parse error';m._inflight=[];function n(){var p=m._inflight;m._inflight=[];p.forEach(function(q){q.abort();});}function o(p){p.onJSON=p.onError=p.onSuccess=null;clearTimeout(p._timer);if(p.xhr&&p.xhr.readyState<4){p.xhr.abort();p.xhr=null;}m._inflight=m._inflight.filter(function(q){return q&&q!=p&&q.xhr&&q.xhr.readyState<4;});}l(m.prototype,{timeout:60000,prelude:/^for \(;;\);/,status:null,_eol:-1,_call:function(p){if(this[p])this[p](this);},_parseStatus:function(){var p;try{this.status=this.xhr.status;p=this.xhr.statusText;}catch(q){if(this.xhr.readyState>=4){this.errorType=m.TRANSPORT_ERROR;this.errorText=q.message;}return;}if(this.status===0&&!(/^(file|ftp)/.test(this.uri))){this.errorType=m.TRANSPORT_ERROR;}else if(this.status>=100&&this.status<200){this.errorType=m.PROXY_ERROR;}else if(this.status>=200&&this.status<300){return;}else if(this.status>=300&&this.status<400){this.errorType=m.PROXY_ERROR;}else if(this.status>=400&&this.status<500){this.errorType=m.SERVER_ERROR;}else if(this.status>=500&&this.status<600){this.errorType=m.PROXY_ERROR;}else if(this.status==1223){return;}else if(this.status>=12001&&this.status<=12156){this.errorType=m.TRANSPORT_ERROR;}else{p='unrecognized status code: '+this.status;this.errorType=m.ERROR;}if(!this.errorText)this.errorText=p;},_parseResponse:function(){var p,q=this.xhr.readyState;try{p=this.xhr.responseText||'';}catch(r){if(q>=4){this.errorType=m.ERROR;this.errorText='responseText not available - '+r.message;}return;}while(this.xhr){var s=this._eol+1,t=p.indexOf('\n',s);if(t<0&&q==4)t=p.length;if(t<=this._eol)break;var u=p.substr(s,t-s).replace(/^\s*|\s*$/g,'');if(s===0&&this.prelude)if(this.prelude.test(u))u=u.replace(this.prelude,'');this._eol=t;if(u){try{this.json=JSON.parse(u);}catch(r){var v=(/(<body[\S\s]+?<\/body>)/i).test(p)&&RegExp.$1,w={message:r.message,'char':s,excerpt:((s===0&&v)||u).substr(512)};this.errorType=m.PARSE_ERROR;this.errorText='parse error - '+JSON.stringify(w);return;}g.applyWithGuard(this._call,this,['onJSON']);}}},_onReadyState:function(){var p=this.xhr&&this.xhr.readyState||0;if(this.status==null&&p>=2)this._parseStatus();if(this.status!=null&&p>=3&&!this.errorType)this._parseResponse();if(this.errorType||p==4){this._time=Date.now()-this._sentAt;this._call(!this.errorType?'onSuccess':'onError');o(this);}},send:function(p){this.xhr.onreadystatechange=function(){g.applyWithGuard(this._onReadyState,this,arguments);}.bind(this);var q=this.timeout;if(q)this._timer=setTimeout((function(){this.errorType=m.TIMEOUT;this.errorText='timeout';this._time=Date.now()-this._sentAt;this._call('onError');o(this);}).bind(this),q,false);m._inflight.push(this);if(this.method=='POST')this.xhr.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this._sentAt=Date.now();this.xhr.send(p?i.implodeQuery(p):'');},abort:function(){o(this);},toString:function(){var p='[AjaxRequest readyState='+this.xhr.readyState;if(this.errorType)p+=' errorType='+this.errorType+' ('+this.errorText+')';return p+']';},toJSON:function(){var p={json:this.json,status:this.status,errorType:this.errorType,errorText:this.errorText,time:this._time};for(var q in p)if(p[q]==null)delete p[q];return p;}});if(window.addEventListener&&j.firefox())window.addEventListener('keydown',function(event){if(event.keyCode===h.ESC)event.prevent();},false);if(window.attachEvent)window.attachEvent('onunload',n);e.exports=m;});
__d("ChannelConstants",[],function(a,b,c,d,e,f){var g='channel/',h={ON_SHUTDOWN:g+'shutdown',ON_INVALID_HISTORY:g+'invalid_history',ON_CONFIG:g+'config',ON_ENTER_STATE:g+'enter_state',ON_EXIT_STATE:g+'exit_state',OK:'ok',ERROR:'error',ERROR_MAX:'error_max',ERROR_MISSING:'error_missing',ERROR_MSG_TYPE:'error_msg_type',ERROR_SHUTDOWN:'error_shutdown',ERROR_STALE:'error_stale',SYS_OWNER:'sys_owner',SYS_NONOWNER:'sys_nonowner',SYS_ONLINE:'sys_online',SYS_OFFLINE:'sys_offline',SYS_TIMETRAVEL:'sys_timetravel',HINT_AUTH:'shutdown auth',HINT_CONN:'shutdown conn',HINT_DISABLED:'shutdown disabled',HINT_INVALID_STATE:'shutdown invalid state',HINT_MAINT:'shutdown maint',HINT_UNSUPPORTED:'shutdown unsupported',reason_Unknown:0,reason_AsyncError:1,reason_TooLong:2,reason_Refresh:3,reason_RefreshDelay:4,reason_UIRestart:5,reason_NeedSeq:6,reason_PrevFailed:7,reason_IFrameLoadGiveUp:8,reason_IFrameLoadRetry:9,reason_IFrameLoadRetryWorked:10,reason_PageTransitionRetry:11,reason_IFrameLoadMaxSubdomain:12,reason_NoChannelInfo:13,reason_NoChannelHost:14,getArbiterType:function(i){return g+'message:'+i;}};e.exports=h;});
__d("ChannelSubdomain",["Cookie","JSLogger"],function(a,b,c,d,e,f){var g=b('Cookie'),h=b('JSLogger'),i=h.create('channel'),j=7,k=null;function l(o){var p=null,q=m(),r;for(r=0;r<32&&(q&(1<<r));r++);o--;if(r<Math.min(32,j*o)){k=r;p=k%j;g.set('sub',q|(1<<k));}else{k=-1;p=null;i.error('subdomain_overflow',{slot:k,max:o});}return p;}function m(){var o=g.get('sub')||0;o=parseInt(o,10);return isNaN(o)?0:o;}function n(){if(k!==null&&k>=0){var o=m()&~(1<<k);if(o){g.set('sub',o);}else g.clear('sub');}}e.exports={allocate:l,clear:n};});
__d("DocRPC",[],function(a,b,c,d,e,f){var g={_apis:{},origin:location.origin||(location+'').replace(/([^:\/])\/.*/,'$1'),originFilter:/\.facebook\.com(:\d+)?$/,_init:function(){var h=function(event){event=event||window.event;var i=event.domain||event.origin;if(g.originFilter.test(i))g._dispatch(event.data);};if(window.postMessage)if(window.addEventListener){window.addEventListener('message',h,false);}else window.onmessage=h;this._init=function(){};},_dispatch:function(h){h=JSON.parse(h);var i=JSON.stringify(h.params);if(g._apis.hasOwnProperty(h.api)){var j=g._apis[h.api];if(j[h.method])j[h.method].apply(j,h.params);}},publish:function(h,i){g._init();g._apis[i]=h;},proxy:function(h,i,j,k){g._init();var l={_proxyId:Math.random().toString(36),_seq:0};function m(o){l[o]=function(){var p={api:i,method:o,params:Array.prototype.slice.call(arguments)},q=JSON.stringify(p.params);p=JSON.stringify(p);if(h.postMessage){h.postMessage(p,k);}else if(h.DocRPC)h.DocRPC._dispatch(p);};}for(var n=0;n<j.length;n++)m(j[n]);return l;}};e.exports=a.DocRPC=g;},3);
__d("ChannelTransport",["copyProperties","bind","AjaxRequest","URI","JSLogger","DocRPC","ChannelConstants"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('bind'),i=b('AjaxRequest'),j=b('URI'),k=b('JSLogger'),l=b('DocRPC'),m=b('ChannelConstants'),n=k.create('channel'),o=null;function p(){return (1048576*Math.random()|0).toString(36);}function q(z,aa){var ba=z.subdomain;ba=ba===null?'':(ba+'-');var ca=new j(aa).setDomain(ba+z.host+'.facebook.com').setPort(z.port).setSecure(j().isSecure());return ca;}function r(event,z){if(window!==window.parent&&/iframe/.test(window.location)){if(!o)o=l.proxy(window.parent,'outerTransport',['_addJsLoggerEntry'],top.DocRPC.origin);o._addJsLoggerEntry(event,z);}else n.log(event,z);}function s(z){var aa={partition:z.partition,cb:p()},ba=q(z,'/p').setQueryData(aa);r('start_p',{uri:ba.toString()});var ca=new i('GET',ba);if(i.corsEnabled)ca.xhr.withCredentials=true;var da=function(ea){r('finish_p',{xhr:ea.toJSON?ea.toJSON():ea});};ca.timeout=z.P_TIMEOUT;ca.onError=ca.onSuccess=da;ca.send();}function t(z,aa,ba){var ca=new Image(),da=0,ea=function(ha){ca.abort();return ha?aa():ba();};ca.onload=function(){r('ping_ok',{duration:Date.now()-da});ea(true);};ca.onerror=function(){s(z);ea(false);};var fa=setTimeout(ca.onerror,10000,false);ca.abort=function(){if(fa){clearTimeout(fa);fa=null;}ca.onload=ca.onerror=null;};var ga={partition:z.partition,cb:p()};da=Date.now();ca.src=q(z,'/ping').setQueryData(ga);return ca;}function u(z,aa,ba,ca){var da=new Date(),ea=(da-z.userActive)/1000|0;if(ea<0)n.warn('idle_regression',{idleTime:ea,now:da.getTime(),userActive:z.userActive});var fa={channel:z.user_channel,seq:z.seq,partition:z.partition,clientid:z.sessionID,cb:p(),idle:ea};if(ea<60)fa.state='active';if(z.streamingCapable){fa.mode='stream';fa.format='json';}var ga=q(z,'/pull').setQueryData(fa),ha=new i('GET',ga);if(i.corsEnabled)ha.xhr.withCredentials=true;ha.timeout=z.streamingCapable?z.STREAMING_TIMEOUT:z.LONGPOLL_TIMEOUT;ha.onJSON=aa;ha.onSuccess=ba;ha.onError=function(){var ia=(this.status==12002&&this._time>=z.MIN_12002_TIMEOUT)||(this.status==504&&this._time>=z.MIN_504_TIMEOUT),ja=ia?ba:ca;return ja&&ja.apply(this,arguments);};ha.send();z.inStreaming=z.streamingCapable;return ha;}function v(z){this.manager=z;(this.init&&this.init());}function w(z){v.apply(this,arguments);}g(w.prototype,{logName:'CORS',enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='init')setTimeout(h(this.manager,'exitState',{status:m.OK,stateId:aa.stateId}),3000,false);if(!/pull|ping/.test(z))return;var ba=this.manager;if(z=='ping'){this._request=t(aa,h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(ba,'_processTransportData',aa.stateId),h(ba,'exitState',{status:m.OK,stateId:aa.stateId}),h(ba,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});function x(z){n.log('iframe_init_constructor');v.apply(this,arguments);this._iframe=document.createElement('iframe');this._iframe.style.display='none';document.body.appendChild(this._iframe);l.publish(this,'outerTransport');}g(x.prototype,{logName:'iframe',_initIframe:function(z){n.log('iframe_init_start');window.onchanneliframeready=function(){n.log('iframe_resources');return z.resources;};window.onchanneliframeloaded=function(){n.log('iframe_loaded');};if(z){this._iframeURI=q(z,z.path);if(z.bustIframe){var aa={partition:z.partition,cb:p()};this._iframeURI.setQueryData(aa);}}else this._iframeURI='about:blank';this._iframeProxy=null;try{this._iframe.contentWindow.location.replace(this._iframeURI);n.log('iframe_uri_set');}catch(ba){n.error('iframe_uri_set_error',ba);this.exitState({status:m.ERROR,stateId:z.stateId},ba+'');}},_addJsLoggerEntry:function(event,z){n.log(event,z);},enterState:function(z,aa){if(z=='init'){this._initIframe(aa);}else if(/idle|ping|pull/.test(z)){if(this._iframeProxy){this._iframeProxy.enterState.apply(this._iframeProxy,arguments);}else if(z!='idle')this.exitState({status:m.ERROR,stateId:aa.stateId},'iframe not yet loaded');}else if(z=='shutdown')this._initIframe();},_processTransportData:function(){this.manager._processTransportData.apply(this.manager,arguments);},exitState:function(z){if(this.manager.state=='init'&&z.status==m.OK)this._iframeProxy=l.proxy(this._iframe.contentWindow,'innerTransport',['enterState'],(this._iframeURI+'').replace(/iframe.*/,''));if(/ping|pull/.test(this.manager.state)&&!this._iframeProxy)return;this.manager.exitState.apply(this.manager,arguments);}});function y(){this.init=this.init.bind(this);v.apply(this,arguments);}g(y.prototype,{logName:'iframe(inner)',init:function(){l.publish(this,'innerTransport');try{var aa=l.proxy(window.parent,'outerTransport',['_processTransportData','exitState'],top.DocRPC.origin);g(this,aa);this.exitState({status:m.OK,stateId:1e+06});}catch(z){n.error('iframe_inner_init_error',z);}},enterState:function(z,aa){if(this._request){this._request.abort();this._request=null;}if(z=='ping'){this._request=t(aa,h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}else if(z=='pull')this._request=u(aa,h(this,'_processTransportData',aa.stateId),h(this,'exitState',{status:m.OK,stateId:aa.stateId}),h(this,'exitState',{status:m.ERROR,stateId:aa.stateId}));}});e.exports={getURI:q,Transport:v,CORSTransport:w,IframeTransport:x,IframeInnerTransport:y};});
__d("FBAjaxRequest",["$","AjaxRequest","copyProperties","XHR"],function(a,b,c,d,e,f){var g=b('$'),h=b('AjaxRequest'),i=b('copyProperties'),j=b('XHR');function k(l,m,n){n=i(j.getAsyncParams(l),n);var o=new h(l,m,n),p=o._call;o._call=function(q){if(q=='onJSON'&&this.json){if(this.json.error){this.errorType=h.SERVER_ERROR;this.errorText='AsyncResponse error: '+this.json.error;}this.json=this.json.payload;}p.apply(this,arguments);};return o;}e.exports=k;});
__d("MovingStat",[],function(a,b,c,d,e,f){function g(h){h=h||60000;var i={t:new Date(),count:0,v:0},j=i,k=0,l=0;function m(){var n=new Date()-h;while(j&&j.next&&j.t<n){k-=j.v;l-=j.count;j=j.next;}}this.add=function(n){k+=n;l++;var o=new Date();if(o-i.t<1000){i.v+=n;i.count++;}else{i.next={t:o,v:n,count:1};i=i.next;m();}};this.tally=function(n){n=n||1000;m();return {sum:k,count:l,timeAverage:k*n/h};};}e.exports=g;});
__d("Dcode",[],function(a,b,c,d,e,f){var g,h={},i={_:'%',A:'%2',B:'000',C:'%7d',D:'%7b%22',E:'%2c%22',F:'%22%3a',G:'%2c%22ut%22%3a1',H:'%2c%22bls%22%3a',I:'%2c%22n%22%3a%22%',J:'%22%3a%7b%22i%22%3a0%7d',K:'%2c%22pt%22%3a0%2c%22vis%22%3a',L:'%2c%22ch%22%3a%7b%22h%22%3a%22',M:'%7b%22v%22%3a2%2c%22time%22%3a1',N:'.channel%22%2c%22sub%22%3a%5b',O:'%2c%22sb%22%3a1%2c%22t%22%3a%5b',P:'%2c%22ud%22%3a100%2c%22lc%22%3a0',Q:'%5d%2c%22f%22%3anull%2c%22uct%22%3a',R:'.channel%22%2c%22sub%22%3a%5b1%5d',S:'%22%2c%22m%22%3a0%7d%2c%7b%22i%22%3a',T:'%2c%22blc%22%3a1%2c%22snd%22%3a1%2c%22ct%22%3a',U:'%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',V:'%2c%22blc%22%3a0%2c%22snd%22%3a0%2c%22ct%22%3a',W:'%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a',X:'%2c%22ri%22%3a0%7d%2c%22state%22%3a%7b%22p%22%3a0%2c%22ut%22%3a1',Y:'%2c%22pt%22%3a0%2c%22vis%22%3a1%2c%22bls%22%3a0%2c%22blc%22%3a0%2c%22snd%22%3a1%2c%22ct%22%3a',Z:'%2c%22sb%22%3a1%2c%22t%22%3a%5b%5d%2c%22f%22%3anull%2c%22uct%22%3a0%2c%22s%22%3a0%2c%22blo%22%3a0%7d%2c%22bl%22%3a%7b%22ac%22%3a'};(function(){var k=[];for(var l in i){h[i[l]]=l;k.push(i[l]);}k.reverse();g=new RegExp(k.join("|"),'g');})();var j={encode:function(k){return encodeURIComponent(k).replace(/([_A-Z])|%../g,function(l,m){return m?'%'+m.charCodeAt(0).toString(16):l;}).toLowerCase().replace(g,function(l){return h[l];});},decode:function(k){return decodeURIComponent(k.replace(/[_A-Z]/g,function(l){return i[l];}));}};e.exports=j;});
__d("randomInt",[],function(a,b,c,d,e,f){function g(h,i){if(arguments.length===1){i=h;h=0;}var j=this.random||Math.random;return Math.floor(h+j()*(i-h));}e.exports=g;});
__d("debounceAcrossTransitions",["debounce"],function(a,b,c,d,e,f){var g=b('debounce');function h(i,j,k){return g(i,j,k,true);}e.exports=h;});
__d("setIntervalAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setInterval(h,i,false);}e.exports=g;});
__d("UserActivity",["event-extensions","Arbiter","ClickRefUtils","collectDataAttributes"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ClickRefUtils'),i=b('collectDataAttributes'),j=5000,k=500,l=Date.now(),m=l,n={subscribeOnce:function(p){var q=n.subscribe(function(){n.unsubscribe(q);p();});},subscribe:function(p){return g.subscribe('useractivity/activity',p);},unsubscribe:function(p){p.unsubscribe();},isActive:function(p){return (new Date()-l<(p||n.DEFAULT_IDLE_MS));},getLastInformTime:function(){return m;}};function o(event){l=Date.now();var p=l-m;if(p>k){m=l;g.inform('useractivity/activity',{event:event,idleness:p});}}Event.listen(document.documentElement,{DOMMouseScroll:o,mousewheel:o,keydown:o,mouseover:o,click:o});e.exports=n;});
__d("ChannelManager",["event-extensions","function-extensions","AjaxRequest","Arbiter","AsyncRequest","ChannelConstants","ChannelSubdomain","ChannelTransport","Cookie","Env","FBAjaxRequest","JSLogger","MovingStat","PresenceCookieManager","PresenceState","PresenceUtil","Run","SystemEvents","URI","UserActivity","UserAgent","copyProperties","createArrayFrom","hasArrayNature","ChannelInitialData"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('AjaxRequest'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('ChannelConstants'),k=b('ChannelSubdomain'),l=b('ChannelTransport'),m=b('Cookie'),n=b('Env'),o=b('FBAjaxRequest'),p=b('JSLogger'),q=b('MovingStat'),r=b('PresenceCookieManager'),s=b('PresenceState'),t=b('PresenceUtil'),u=b('Run'),v=b('SystemEvents'),w=b('URI'),x=b('UserActivity'),y=b('UserAgent'),z=b('copyProperties'),aa=b('createArrayFrom'),ba=b('hasArrayNature'),ca=c('ChannelInitialData'),da,ea=p.create('channel'),fa={idle:{ok:'init!'},init:{ok:'pull!',error:'reconnect',sys_online:'init',sys_timetravel:'init'},pull:{ok:'pull!',error:'ping',error_missing:'pull',error_msg_type:'pull',refresh_0:'reconnect',refresh_110:'reconnect',refresh_111:'pull',refresh_112:'pull',refresh_113:'pull',refresh_117:'reconnect'},ping:{ok:'pull!',error:'ping',error_stale:'reconnect!'},reconnect:{ok:'init!',error:'reconnect',sys_online:'reconnect',sys_timetravel:'reconnect'},shutdown:{},_all:{error_max:'shutdown!',error_shutdown:'shutdown!',sys_owner:'reconnect',sys_nonowner:'idle!',sys_online:'ping',sys_offline:'idle!',sys_timetravel:'ping'}},ga={userActive:Date.now(),sessionID:(Math.random()*2147483648|0).toString(16),streamingCapable:false,inStreaming:false,LONGPOLL_TIMEOUT:60000,STREAMING_TIMEOUT:60000,P_TIMEOUT:30000,IFRAME_LOAD_TIMEOUT:30000,MIN_RETRY_INTERVAL:5000,MAX_RETRY_INTERVAL:30000,MIN_12002_TIMEOUT:9000,MIN_504_TIMEOUT:20000,STALL_THRESHOLD:180000,JUMPSTART_THRESHOLD:90000,MIN_INIT_PROBE_DELAY:3000,INIT_PROBE_DELAY_RANDOMIZE_RANGE:12000,PROBE_DELAY:60000,PROBE_HEARTBEATS_INTERVAL_LOW:1500,PROBE_HEARTBEATS_INTERVAL_HIGH:2500,STREAMING_EXIT_STATE_ON_CONTINUE:false},ha=1,ia={},ja=0;function ka(qa){return qa.toLowerCase().replace(/[^0-9a-z]+/g,'_');}function la(){return i.lastSuccessTime?Math.round((Date.now()-i.lastSuccessTime)/1000):-1;}function ma(){var qa={};if(da.getConfig('host'))qa[da.getConfig('user_channel')]=da.getConfig('seq',0);return qa;}function na(){var qa=Date.now(),ra=Date.now(),sa={total:0},ta='idle',ua=false;v.subscribe([v.USER,v.ONLINE,v.TIME_TRAVEL],function(xa,ya){pa(true);ra=null;da.lastPullTime=Date.now();var za;switch(xa){case v.USER:za=v.isPageOwner()?j.SYS_OWNER:j.SYS_NONOWNER;break;case v.ONLINE:za=ya?j.SYS_ONLINE:j.SYS_OFFLINE;break;case v.TIME_TRAVEL:za=j.SYS_TIMETRAVEL;break;}da.exitState({status:za,stateId:ha});});var va=function(xa,ya){var za=Date.now(),ab;if(ya){qa=za;ab=ya.nextState||ya.state;}else ab=ta;v.checkTimeTravel();if(ra){var bb=Math.round((za-ra)/1000);if(bb>0){sa[ta]=(sa[ta]||0)+bb;sa.total+=bb;}}ta=ab;ra=za;if(!xa){sa.lastSuccessTime=la();sa.online=v.isOnline();ea.log('rollup',sa);}};h.subscribe(j.ON_ENTER_STATE,va);setInterval(va,60000,false);h.subscribe(p.DUMP_EVENT,function(xa,ya){ya.channelRollup=sa;});var wa=function(){if(da.isShutdown()||da.shouldIdle())return;v.checkTimeTravel();var xa=Date.now()-(da.lastPullTime||n.start);if(!ua&&xa>ga.STALL_THRESHOLD){var ya=la();ea.error('stall',{lastSuccessTime:ya,rollupState:ta});ua=true;}var za=Date.now()-qa;if(da.state=='pull'&&za>ga.JUMPSTART_THRESHOLD){qa=null;ea.warn('jumpstart',{state:da.state,dormant:za});da.enterState('init');}};setInterval(wa,10000,false);}function oa(){var qa=Date.now(),ra=1;function sa(){setTimeout(sa,ra*1000,false);var xa=da.state;if(xa=='idle'&&da.shouldIdle())return;ea.bump('conn_t',ra);if(xa=='pull')ea.bump('conn_t_pull',ra);}sa();var ta=[15,30,60,120,240],ua=false,va=false;function wa(xa){setTimeout(function(){ea.rate('pullenter_'+xa,ua);ea.rate('pullexit_'+xa,va);},xa*1000,false);}while(ta.length)wa(ta.shift());h.subscribe(j.ON_ENTER_STATE,function(xa,ya){if(ya.state=='pull')ua=true;qa=Date.now();});h.subscribe(j.ON_EXIT_STATE,function(xa,ya){if(ya.state!='pull'||!qa)return;var za='other';if(ya.status==j.OK){va=true;za='ok';}else if(ya.xhr&&ya.xhr.errorType){za=/ar:(\w+)/.test(ya.xhr.errorType)&&RegExp.$1;}else if(/^sys_/.test(ya.status))return;var ab=(Date.now()-qa)/1000;if(ab<0){return;}else if(ab>3600)ab=3600;ea.bump('conn_num');ea.bump('conn_exit',ab);ea.bump('conn_num_'+za);ea.bump('conn_exit_'+za,ab);});}function pa(qa){if(qa){ja=0;ia={};}else ja++;}da={state:'idle',nextState:null,lastPullTime:Date.now(),heartbeats:[],init:function(qa){this.init=function(){};if(typeof(x)!='undefined'){x.subscribe(function(){ga.userActive=Date.now();}.bind(this));}else ea.error('user_activity_undefined');r.register('ch',ma);var ra=this.getConfig('max_conn',2);ga.subdomain=k.allocate(ra);if(typeof window.onpageshow!='undefined'){Event.listen(window,'pagehide',k.clear);}else u.onUnload(k.clear);this._transportRate=new q(30000);var sa=(g.corsEnabled&&!ga.forceIframe)?'CORSTransport':'IframeTransport';this.transport=new l[sa](this);if(qa)this.enterState.apply(this,arguments);h.subscribe(p.DUMP_EVENT,function(event,ua){ua.transportRate=this._transportRate.tally();ua.transportType=sa;ua.transportVersion=2;}.bind(this));na();oa();if(da.getConfig('tryStreaming')&&da.getConfig('host')&&g.corsEnabled&&!ga.forceIframe){var ta=ga.MIN_INIT_PROBE_DELAY+Math.random()*ga.INIT_PROBE_DELAY_RANDOMIZE_RANGE;setTimeout(this._probeTest,ta,false);}},configure:function(){var qa=aa(arguments);ea.log('configure',qa);qa.forEach(z.bind(null,ga));h.inform(j.ON_CONFIG,this);},getConfig:function(qa,ra){return qa in ga?ga[qa]:ra;},isShutdown:function(){return this.state=='shutdown';},shouldIdle:function(){return !(v.isPageOwner()&&v.isOnline());},_sendIframeError:function(qa){var ra=new i().setURI('/ajax/presence/reconnect.php').setData({reason:qa,fb_dtsg:n.fb_dtsg}).setOption('suppressErrorHandlerWarning',true).setOption('retries',1).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(true);ra.specifiesWriteRequiredParams()&&ra.send();},_getDelay:function(){var qa=Math.min(ga.MIN_RETRY_INTERVAL*Math.pow(2,Math.max(0,ja-1)),ga.MAX_RETRY_INTERVAL);return qa*(.75+Math.random()/2)|0;},enterState:function(){if(this._inEnterState)ea.warn('enterstate_recursion');this._inEnterState=true;try{this._enterState.apply(this,arguments);this._inEnterState=false;}catch(qa){this._inEnterState=false;throw qa;}},_enterState:function(qa){var ra=0,sa=null,ta=aa(arguments);if(this.isShutdown())return;if(qa!='idle!'&&this.shouldIdle())return;ha++;ga.stateId=ha;clearTimeout(this._deferredTransition);this._deferredTransition=null;this.transport.enterState('idle');this.state='idle';this.nextState=null;if(/!$/.test(qa)){var ua=this._transportRate.tally().timeAverage,va=da.getConfig('MAX_CHANNEL_STATES_PER_SEC',1);if(ua>=va){if(!this._throttled){this._throttled=true;ea.warn('throttled');}ea.bump('throttle');ra=1000/va;}}else if(!(/#$/.test(qa)))ra=this._getDelay();qa=qa.replace(/\W*$/,'');if(!fa[qa])throw new Error('invalid state:'+qa);var wa;if(ra<=0){wa={state:qa};this._transportRate.add(1);this.state=qa;var xa=this['_enter_'+this.state];if(xa){ta.shift();xa.apply(this,ta);}if(/init|idle|pull|ping/.test(this.state)){if(ga.streamingCapable&&/pull/.test(this.state))this.heartbeats=[];this.transport.enterState(this.state,ga);if(this.state=='ping'){wa.url=l.getURI(ga).toString();wa.port=ga.port||'undefined';}}}else{this.state='idle';this.nextState=qa;wa={state:this.state,delay:ra,nextState:qa};ta[0]=qa+'#';this._deferredTransition=(function(){this._deferredTransition=null;this.enterState.apply(this,ta);}).bind(this).defer(ra,false);}if(/pull/.test(qa)){wa.client_id=ga.sessionID;wa.streaming=ga.inStreaming;}ea.log('enter_'+this.state,wa);h.inform(j.ON_ENTER_STATE,wa);},exitState:function(qa,ra){var sa=qa.stateId,ta=qa.status;if(this.isShutdown()||sa<ha)return;var ua=aa(arguments),va=this.state;ua[0]=qa.status;var wa={state:va,status:ta};if(/pull/.test(va)){wa.client_id=ga.sessionID;wa.streaming=ga.inStreaming;}if(this.nextState)wa.nextState=this.nextState;if(ra&&ra.errorType){wa.xhr=ra.toJSON?ra.toJSON():ra;delete wa.xhr.json;}if(ra&&ra.json){if(ra.json.t)wa.t=ra.json.t;if(ra.json.reason)wa.reason=ra.json.reason;if(ra.json.seq)wa.seq=ra.json.seq;}ea.log('exit_'+va,wa);h.inform(j.ON_EXIT_STATE,wa);var xa=this['_exit_'+va];if(xa)ta=xa.apply(this,ua)||ta;if(ta!=j.OK){pa();ia[va]=(ia[va]||0)+1;}var ya=fa[this.nextState||va][ta]||fa._all[ta],za=ya&&ya.replace(/!*$/,'');if(!za){ea.error('terminal_transition',wa);this._shutdownHint=j.HINT_INVALID_STATE;ya='shutdown!';}this._lastState=va;this._lastStatus=ta;this.enterState(ya);},_processTransportData:function(qa,ra){var sa=ra.json,ta=sa.t;if('s' in sa){sa.seq=sa.s;delete sa.s;}var ua=ga.seq;if('seq' in sa){ga.seq=sa.seq;s.doSync();}switch(ta){case 'continue':if(ga.inStreaming&&this.heartbeats.length<1){ga.streamingCapable=false;ea.log('switch_to_longpoll');setTimeout(this._probeTest,ga.PROBE_DELAY,false);}pa(true);if(!ga.inStreaming||ga.STREAMING_EXIT_STATE_ON_CONTINUE)this.exitState({status:j.OK,stateId:qa});break;case 'refresh':case 'refreshDelay':this.exitState({status:'refresh_'+(sa.reason||0),stateId:qa},ra);break;case 'fullReload':r.clear();ea.log('invalid_history');h.inform(j.ON_INVALID_HISTORY);this.exitState({status:j.ERROR_MISSING,stateId:qa},ra);break;case 'msg':var va,wa,xa,ya;pa(true);wa=sa.ms;xa=ga.seq-wa.length;for(va=0;va<wa.length;va++,xa++)if(xa>=ua){ya=wa[va];if(ya.type){ea.debug(ya.type);h.inform(j.getArbiterType(ya.type),{obj:ya});}}else ea.warn('seq_regression',{seq:xa,last_seq:ua,messages:wa.length});break;case 'heartbeat':if(ga.inStreaming){var za=Date.now();if(this.heartbeats.length>0){var ab=za-this.heartbeats[this.heartbeats.length-1];ea.log('heartbeat_interval',{client_id:ga.sessionID,interval:ab});}this.heartbeats.push(za);}break;default:ea.error('unknown_msg_type',{type:ta});break;}},_enter_init:function(){if(ia.init>=da.getConfig('MAX_INIT_FAILS',2))return this.exitState.bind(this,{status:j.ERROR_MAX,stateId:ha}).defer();this._initTimer=this.exitState.bind(this,{status:j.ERROR,stateId:ha},'timeout').defer(ga.IFRAME_LOAD_TIMEOUT,false);},_enter_reconnect:function(qa){var ra=ha;if(!t.hasUserCookie()){ea.warn('no_user_cookie');(function(){da._shutdownHint=j.HINT_AUTH;da.exitState({status:j.ERROR_SHUTDOWN,stateId:ra});}).defer();return;}var sa={reason:qa,fb_dtsg:n.fb_dtsg};if(n.fb_isb)sa.fb_isb=n.fb_isb;var ta=new o('GET','/ajax/presence/reconnect.php',sa);ta.onSuccess=(function(){da.configure(ta.json);r.store();this.exitState({status:j.OK,stateId:ra});}).bind(this);ta.onError=(function(){var ua=ta.json&&ta.json.error;if(ta.errorType==g.TRANSPORT_ERROR||ta.errorType==g.PROXY_ERROR)this._shutdownHint=j.HINT_CONN;if(ua&&ua==1356007){this._shutdownHint=j.HINT_MAINT;}else if(ua==1357001||ua==1357004||ua==1348009){this._shutdownHint=j.HINT_AUTH;}else this._shutdownHint=null;this.exitState({status:this._shutdownHint?j.ERROR_SHUTDOWN:j.ERROR,stateId:ra},ta);}).bind(this);ta.send();},_enter_shutdown:function(){h.inform(j.ON_SHUTDOWN,{reason:this._shutdownHint});},_exit_init:function(qa){if(this._initTimer)this._initTimer=clearTimeout(this._initTimer);if(qa==j.ERROR_MAX)this._sendIframeError(j.reason_IFrameLoadGiveUp);},_exit_pull:function(qa){if(qa==j.OK)this.lastPullTime=Date.now();},_exit_ping:function(qa){if(qa==j.OK){var ra=Date.now()-(this.lastPullTime||n.start);if(ra>ga.STALL_THRESHOLD)return j.ERROR_STALE;}},_probeTest:function(){ga.streamingCapable=false;var qa=[],ra={mode:'stream',format:'json'},sa=new w('/probe').setDomain(ga.host+'.facebook.com').setPort(ga.port).setSecure(w().isSecure()).setQueryData(ra),ta=new g('GET',sa);ta.onJSON=function(ua,va){if(ua&&ua.json&&ua.json.t==='heartbeat'){qa.push(Date.now());if(qa.length>=2){var wa=qa[1]-qa[0];if(wa>=ga.PROBE_HEARTBEATS_INTERVAL_LOW&&wa<=ga.PROBE_HEARTBEATS_INTERVAL_HIGH){ga.streamingCapable=true;ea.log('switch_to_streaming');}ea.log('probe_ok',{time:wa});}}};ta.onSuccess=function(ua){if(qa.length!=2){ga.streamingCapable=false;ea.error('probe_error',{error:'beats.length = '+qa.length});}};ta.onError=function(ua){ga.streamingCapable=false;ea.error('probe_error',ua);};ea.log('probe_request');ta.send();}};e.exports=da;if(ca.serverInitialized==null){da.configure(ca.channelConfig);if(/shutdown/.test(ca.state)){da._shutdownHint=j[ca.reason];}else ca.reconnectReason;da.init(ca.state,ca.reason);}});
__d("ChannelConnection",["Arbiter","copyProperties","ChatConfig","Run","SystemEvents","ChannelConstants","ChannelManager","JSLogger"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('ChatConfig'),j=b('Run'),k=b('SystemEvents'),l=b('ChannelConstants'),m=b('ChannelManager'),n=b('JSLogger'),o=n.create('channel_connection'),p=null,q=null,r=null,s=null,t=0,u=h(new g(),{CONNECTED:'chat-connection/connected',RECONNECTING:'chat-connection/reconnecting',SHUTDOWN:'chat-connection/shutdown',MUTE_WARNING:'chat-connection/mute',UNMUTE_WARNING:'chat-connection/unmute'});function v(){if(q){clearTimeout(q);q=null;}}function w(){v();o.log('unmute_warning');u.inform(u.UNMUTE_WARNING);}function x(ba){v();q=w.defer(ba,false);o.log('mute_warning',{time:ba});u.inform(u.MUTE_WARNING);}function y(){if(r){clearTimeout(r);r=null;}}function z(ba,ca){y();if(ba===l.ON_ENTER_STATE&&(ca.nextState||ca.state)==='pull'){if(s!==u.CONNECTED){o.log('connected');var da=!s;s=u.CONNECTED;t=0;u.inform(u.CONNECTED,{init:da});}}else if(ba===l.ON_ENTER_STATE&&((ca.nextState||ca.state)==='ping'||(!ca.nextState&&ca.state==='idle'))){r=(function(){var ea=null;if(!(ca.state==='idle'&&!ca.nextState))ea=(ca.delay||0);o.log('reconnecting',{delay:ea});if(u.disconnected())o.log('reconnecting_ui',{delay:ea});s=u.RECONNECTING;(ca.state==='idle')&&t++;if(t>1){u.inform(u.RECONNECTING,ea);}else if(!ca.nextState&&ca.state==='idle')z(ba,ca);}).defer(500,false);}else if(ba===l.ON_SHUTDOWN){o.log('shutdown',{reason:ca.reason});s=u.SHUTDOWN;t=0;u.inform(u.SHUTDOWN,ca.reason);}}function aa(ba){if(m.state==='ping'||m.isShutdown())return;o.log('reconnect',{now:ba});u.inform(u.RECONNECTING,0);if(!!ba){if(p!==null){clearTimeout(p);p=null;}m.enterState('ping!');}else if(!p)p=setTimeout(function(){m.enterState('ping!');p=null;},i.get('channel_manual_reconnect_defer_msec'),false);}if(m.isShutdown()){z(l.ON_SHUTDOWN,m._shutdownHint);}else z(l.ON_ENTER_STATE,{state:m.state,nextState:m.nextState,delay:0});g.subscribe([l.ON_ENTER_STATE,l.ON_SHUTDOWN],z);k.subscribe(k.TIME_TRAVEL,function(){aa();x(i.get('mute_warning_time_msec'));});j.onBeforeUnload(y,false);h(u,{disconnected:function(){return s===u.SHUTDOWN||(s===u.RECONNECTING&&!q&&t>1);},isShutdown:function(){return s===u.SHUTDOWN;},reconnect:aa,unmuteWarning:w});e.exports=u;});
__d("legacy:ChannelConstants",["ChannelConstants"],function(a,b,c,d){a.ChannelConstants=b('ChannelConstants');},3);
__d("FBDesktopPlugin",["CacheStorage","DOM","Env","FBDesktopDetect","HTML","URI","$"],function(a,b,c,d,e,f){var g=b('CacheStorage'),h=b('DOM'),i=b('Env'),j=b('FBDesktopDetect'),k=b('HTML'),l=b('URI'),m=b('$'),n=new g('localstorage','_socialfox_'),o={_plugin:'_not_checked',arbiterInform:function(p,q){var r=JSON.stringify({name:p,payload:q});this._transmitCommand('arbiterinform',r);},bringToFront:function(){this._transmitCommand('bringtofront');},dock:function(){this._transmitCommand('dock');},getPlugin:function(){if(this._plugin==='_not_checked'){this._plugin=null;if(j.isPluginInstalled()){var p=h.create('div');document.body.appendChild(p);h.setContent(p,k('<object id="kiwi_plugin" '+'type="'+j.mimeType+'" width="0" height="0">'+'</object>'));this._plugin=m('kiwi_plugin');}}return this._plugin;},getUserID:function(){var p=this.getPlugin();return p&&'getUserID' in p&&p.getUserID();},isAppRunning:function(){var p=this.getPlugin();return p&&'isAppRunning' in p&&p.isAppRunning();},logout:function(p){p=p||"0";var q=this.getPlugin();if(q)q.logout(p);},recheck:function(){if(this._plugin===null)this._plugin='_not_checked';},shouldSuppressBeeper:function(){return this.isAppRunning();},shouldSuppressMessages:function(){var p=this.getUserID();if(p){return p===i.user;}else return this.isAppRunning();},shouldSuppressSidebar:function(){var p=this.getPlugin(),q=p&&'isAppDocked' in p&&p.isAppDocked(),r=n&&n.get('active')==='true';return q||r;},transferAuthToken:function(p,q){if(p&&p.length>0){var r=this.getPlugin();if(r){r.setAccessToken(p,q);var s=setInterval(function(){r.setAccessToken(p,q);},500);setTimeout(function(){clearInterval(s);},10*1000);}}if(this.redirectHome)window.location.href=l().setPath().toString();},_transmitCommand:function(p,q){q=q||'';var r=this.getPlugin();if(r&&'transmitCommand' in r)r.transmitCommand(p,q);}};e.exports=o;});
__d("legacy:ui-side-nav-message",["NavigationMessage"],function(a,b,c,d){a.NavigationMessage=b('NavigationMessage');},3);
__d("SimpleDrag",["event-extensions","ArbiterMixin","Class","UserAgent","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('UserAgent'),j=b('Vector'),k=b('copyProperties');function l(m){this.minDragDistance=0;Event.listen(m,'mousedown',this._start.bind(this));}k(l.prototype,g,{setMinDragDistance:function(m){this.minDragDistance=m;},_start:function(event){var m=false,n=true,o=null;if(this.inform('mousedown',event))n=false;if(this.minDragDistance){o=j.getEventPosition(event);}else{m=true;if(this.inform('start',event))n=false;}var p=i.ie()<9?document.documentElement:window,q=Event.listen(p,{selectstart:n?Event.prevent:bagofholding,mousemove:function(event){if(!m){var r=j.getEventPosition(event);if(o.distanceTo(r)<this.minDragDistance)return;m=true;this.inform('start',event);}this.inform('update',event);}.bind(this),mouseup:function(event){for(var r in q)q[r].remove();if(m){this.inform('end',event);}else this.inform('click',event);}.bind(this)});return !n;}});e.exports=l;});
__d("legacy:dom-html",["HTML"],function(a,b,c,d){a.HTML=b('HTML');},3);
__d("legacy:dom-scroll",["DOMScroll"],function(a,b,c,d){a.DOMScroll=b('DOMScroll');},3);
__d("coalesce",[],function(a,b,c,d,e,f){function g(){for(var h=0;h<arguments.length;++h)if(arguments[h]!=null)return arguments[h];return null;}e.exports=g;});
__d("mergeObjects",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(){var i={};for(var j=0;j<arguments.length;j++)g(i,arguments[j]);return i;}e.exports=h;});
__d("legacy:object-extensions",["areObjectsEqual","coalesce","isScalar","mergeObjects","getObjectValues","createObjectFrom"],function(a,b,c,d){a.are_equal=b('areObjectsEqual');a.coalesce=b('coalesce');a.count=function(e){return Object.keys(e).length;};a.is_scalar=b('isScalar');a.keys=Object.keys;a.merge=b('mergeObjects');a.values=b('getObjectValues');Object.from=b('createObjectFrom');},3);
__d("ARIA",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge'),i,j,k=function(){i=h('ariaAssertiveAlert');if(!i){i=g.create('div',{id:'ariaAssertiveAlert',className:'accessible_elem',role:'alert','aria-live':'assertive'});g.appendContent(document.body,i);}j=h('ariaPoliteAlert');if(!j){j=i.cloneNode(false);j.setAttribute('id','ariaPoliteAlert');j.setAttribute('aria-live','polite');g.appendContent(document.body,j);}k=bagofholding;};function l(n,o){k();var p=o?i:j;g.setContent(p,n);}var m={owns:function(n,o){n.setAttribute('aria-owns',g.getID(o));},setPopup:function(n,o){var p=g.getID(o);n.setAttribute('aria-owns',p);n.setAttribute('aria-controls',p);n.setAttribute('aria-haspopup','true');if(n.tabIndex==-1)n.tabIndex=0;},announce:function(n){l(n,true);},notify:function(n){l(n);}};e.exports=m;});
__d("ContextualDialogFooterLink",["event-extensions","copyProperties","CSS","DOM"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('CSS'),i=b('DOM');function j(k){this._layer=k;}g(j.prototype,{_subscriptions:null,enable:function(){var k=this._layer.getRoot(),l=i.scry(k,'.uiContextualDialogFooterLink')[0],m='uiContextualDialogHoverFooterArrow';this._subscriptions=[Event.listen(l,'mouseenter',h.addClass.curry(k,m)),Event.listen(l,'mouseleave',h.removeClass.curry(k,m))];},disable:function(){this._subscriptions.forEach(function(k){k.remove();});this._subscriptions=null;}});e.exports=j;});
__d("ContextualThing",["DOM","ge"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('ge');function i(k){var l;while(k){if(k.getAttribute&&(l=k.getAttribute('data-ownerid')))return h(l);k=k.parentNode;}return null;}var j={register:function(k,l){k.setAttribute('data-ownerid',g.getID(l));},remove:function(k){k.removeAttribute('data-ownerid');},containsIncludingLayers:function(k,l){while(l){if(g.contains(k,l))return true;l=i(l);}return false;}};e.exports=j;});
__d("KeyEventController",["event-extensions","DOM","Run","copyProperties","isEmpty"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('Run'),i=b('event-extensions').$E,j=b('copyProperties'),k=b('isEmpty');function l(){this.handlers={};document.onkeyup=this.onkeyevent.bind(this,'onkeyup');document.onkeydown=this.onkeyevent.bind(this,'onkeydown');document.onkeypress=this.onkeyevent.bind(this,'onkeypress');}j(l,{instance:null,getInstance:function(){return l.instance||(l.instance=new l());},defaultFilter:function(event,m){event=i(event);return l.filterEventTypes(event,m)&&l.filterEventTargets(event,m)&&l.filterEventModifiers(event,m);},filterEventTypes:function(event,m){if(m==='onkeydown')return true;return false;},filterEventTargets:function(event,m){var n=event.getTarget();if(n.contentEditable==='true')return false;return !g.isNodeOfType(n,l._interactiveElements)||(n.type in l._uninterestingTypes)||(g.isNodeOfType(n,['input','textarea'])&&n.value.length===0&&event.keyCode in l._controlKeys);},filterEventModifiers:function(event,m){if(event.ctrlKey||event.altKey||event.metaKey||event.repeat)return false;return true;},registerKey:function(m,n,o,p){if(o===undefined)o=l.defaultFilter;var q=l.getInstance(),r=q.mapKey(m);if(k(q.handlers))h.onLeave(q.resetHandlers.bind(q));for(var s=0;s<r.length;s++){m=r[s];if(!q.handlers[m]||p)q.handlers[m]=[];q.handlers[m].push({callback:n,filter:o});}},keyCodeMap:{BACKSPACE:[8],TAB:[9],RETURN:[13],ESCAPE:[27],LEFT:[37,63234],UP:[38,63232],RIGHT:[39,63235],DOWN:[40,63233],DELETE:[46],COMMA:[188],PERIOD:[190],'`':[192],'[':[219],']':[221]},_interactiveElements:['input','select','textarea','object','embed'],_uninterestingTypes:{checkbox:1,radio:1,submit:1},_controlKeys:{8:1,9:1,13:1,27:1,37:1,63234:1,38:1,63232:1,39:1,63235:1,40:1,63233:1,46:1}});j(l.prototype,{mapKey:function(m){if(m>=0&&m<=9){if(typeof(m)!='number')m=m.charCodeAt(0)-48;return [48+m,96+m];}var n=l.keyCodeMap[m.toUpperCase()];if(n)return n;return [m.toUpperCase().charCodeAt(0)];},onkeyevent:function(m,n){n=i(n);var o=this.handlers[n.keyCode]||this.handlers[n.which],p,q,r;if(o)for(var s=0;s<o.length;s++){p=o[s].callback;q=o[s].filter;try{if(!q||q(n,m)){r=p(n,m);if(r===false)return Event.kill(n);}}catch(t){}}return true;},resetHandlers:function(){this.handlers={};}});e.exports=l;});
__d("Layer",["event-extensions","ArbiterMixin","BehaviorsMixin","Class","ContextualThing","CSS","DataStore","DOM","HTML","KeyEventController","Style","$","copyProperties","ge"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Class'),j=b('ContextualThing'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('HTML'),o=b('KeyEventController'),p=b('Style'),q=b('$'),r=b('copyProperties'),s=b('ge'),t=[];function u(v,w){this._config=v||{};if(w){this._configure(this._config,w);var x=this._config.addedBehaviors||[];this.enableBehaviors(this._getDefaultBehaviors().concat(x));}}r(u,g);r(u,{init:function(v,w){v.init(w);},initAndShow:function(v,w){v.init(w).show();},show:function(v){v.show();}});r(u.prototype,g,h,{_initialized:false,_root:null,_shown:false,_hiding:false,_causalElement:null,init:function(v){this._configure(this._config,v);var w=this._config.addedBehaviors||[];this.enableBehaviors(this._getDefaultBehaviors().concat(w));this._initialized=true;return this;},_configure:function(v,w){if(w){var x=m.isNode(w),y=typeof w==='string'||n.isHTML(w);if(y)w=n(w).getRootNode();}this._root=this._buildWrapper(v,w);k.addClass(this._root,'uiLayer');if(v.causalElement)this._causalElement=s(v.causalElement);l.set(this._root,'layer',this);},_getDefaultBehaviors:function(){return [];},getCausalElement:function(){return this._causalElement;},setCausalElement:function(v){this._causalElement=v;},getInsertParent:function(){return this._insertParent||document.body;},getRoot:function(){return this._root;},_getContentRoot:function(){return this._root;},_buildWrapper:function(v,w){return w;},setInsertParent:function(v){if(v){if(this._shown&&v!==this.getInsertParent()){m.appendContent(v,this.getRoot());this.updatePosition();}this._insertParent=v;}return this;},show:function(){if(this._shown)return this;var v=this.getRoot();this.inform('beforeshow');p.set(v,'visibility','hidden');p.set(v,'overflow','hidden');k.show(v);m.appendContent(this.getInsertParent(),v);if(this.updatePosition()!==false){t.push(this);this._shown=true;this.inform('show');u.inform('show',this);}else m.remove(v);p.set(v,'visibility','');p.set(v,'overflow','');this.inform('aftershow');return this;},hide:function(){if(this._hiding||!this._shown||this.inform('beforehide')===false)return this;this._hiding=true;if(this.inform('starthide')!==false)this.finishHide();return this;},finishHide:function(){if(this._shown){t.remove(this);this._hiding=false;this._shown=false;m.remove(this.getRoot());this.inform('hide');u.inform('hide',this);}},isShown:function(){return this._shown;},updatePosition:function(){return true;},destroy:function(){this.finishHide();this.destroyBehaviors();this.inform('destroy');u.inform('destroy',this);l.remove(this._root,'layer');this._root=this._causalElement=null;}});Event.listen(document.documentElement,'keydown',function(event){if(o.filterEventTargets(event,'keydown'))for(var v=t.length-1;v>=0;v--)if(t[v].inform('key',event)===false)return false;},Event.Priority.URGENT);Event.listen(document.documentElement,'click',function(event){var v=event.getTarget(),w,x;for(var y=t.length-1;y>=0;y--){w=t[y];x=w._getContentRoot();if(j.containsIncludingLayers(x,v))return;if(w.inform('blur',event)===false)return;}});e.exports=u;});
__d("LayerAutoFocus",["function-extensions","copyProperties","DOMQuery","Input"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties'),h=b('DOMQuery'),i=b('Input');function j(k){this._layer=k;}g(j.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('aftershow',this._focus.bind(this));},disable:function(){this._subscription.unsubscribe();this._subscription=null;},_focus:function(){var k=h.scry(this._layer.getRoot(),'.autofocus')[0];k&&i.focus(k);}});e.exports=j;});
__d("LayerButtons",["event-extensions","Parent","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Parent'),h=b('copyProperties');function i(j){this._layer=j;}h(i.prototype,{_listener:null,enable:function(){this._listener=Event.listen(this._layer.getRoot(),'click',this._handle.bind(this));},disable:function(){this._listener.remove();this._listener=null;},_handle:function(j){var k=j.getTarget(),l=g.byClass(k,'layerConfirm');if(l){if(this._layer.inform('confirm',l)===false)j.prevent();return;}var m=g.byClass(k,'layerCancel');if(m){if(this._layer.inform('cancel',m)!==false)this._layer.hide();j.prevent();return;}var n=g.byClass(k,'layerButton');if(n)if(this._layer.inform('button',n)===false)j.prevent();}});e.exports=i;});
__d("LayerDestroyOnHide",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties');function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('hide',Function.prototype.defer.shield(this._layer.destroy.bind(this._layer)));},disable:function(){if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}}});e.exports=h;});
__d("LayerFadeOnHide",["Animation","Layer","Style","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Layer'),i=b('Style'),j=b('UserAgent'),k=b('copyProperties');function l(m){this._layer=m;}k(l.prototype,{_subscription:null,enable:function(){if(j.ie()<9)return;this._subscription=this._layer.subscribe('starthide',this._handleStartHide.bind(this));},disable:function(){if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}},_handleStartHide:function(){var m=true,n=h.subscribe('show',function(){n.unsubscribe();m=false;});(function(){n.unsubscribe();n=null;if(m){this._animate();}else this._layer.finishHide();}).bind(this).defer();return false;},_animate:function(){new g(this._layer.getRoot()).from('opacity',1).to('opacity',0).duration(150).ondone(this._finish.bind(this)).go();},_finish:function(){i.set(this._layer.getRoot(),'opacity','');this._layer.finishHide();}});e.exports=l;});
__d("LayerFadeOnShow",["Animation","Style","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Style'),i=b('UserAgent'),j=b('copyProperties');function k(l){this._layer=l;}j(k.prototype,{_subscriptions:null,enable:function(){if(i.ie()<9)return;this._subscriptions=[this._layer.subscribe('beforeshow',function(){h.set(this._layer.getRoot(),'opacity',0);}.bind(this)),this._layer.subscribe('show',this._animate.bind(this))];},disable:function(){if(this._subscriptions){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this._subscriptions=null;}},_animate:function(){var l=this._layer.getRoot();new g(l).from('opacity',0).to('opacity',1).duration(100).ondone(h.set.curry(l,'opacity','')).go();}});e.exports=k;});
__d("LayerFormHooks",["event-extensions","Form","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Form'),h=b('copyProperties');function i(j){this._layer=j;}h(i.prototype,{_subscriptions:null,enable:function(){var j=this._layer.getRoot();this._subscriptions=[Event.listen(j,'submit',this._onSubmit.bind(this)),Event.listen(j,'success',this._onSuccess.bind(this)),Event.listen(j,'error',this._onError.bind(this))];},disable:function(){this._subscriptions.forEach(function(j){j.remove();});this._subscriptions=null;},_onSubmit:function(event){var j=event.getTarget();if(this._layer.inform('submit',event)===false){event.kill();return;}var k=(g.getAttribute(j,'data-async')==='true');if(!k)return this._onSuccess(event);},_onSuccess:function(event){this._layer.inform('success',event);},_onError:function(event){var j=event.getData();if(this._layer.inform('error',{response:j.response})===false)event.kill();}});e.exports=i;});
__d("LayerHideOnBlur",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._layer=i;}g(h.prototype,{_subscriptions:null,_onBlur:null,enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attach.bind(this)),this._layer.subscribe('hide',this._detach.bind(this))];if(this._layer.isShown())this._attach();},disable:function(){this._detach();while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this._subscriptions=null;},_detach:function(){this._onBlur&&this._onBlur.unsubscribe();this._onBlur=null;},_attach:function(){(function(){this._onBlur=this._layer.subscribe('blur',this._layer.hide.shield(this._layer));}).bind(this).defer();}});e.exports=h;});
__d("LayerHideOnEscape",["event-extensions","copyProperties","Input","Keys"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('Input'),i=b('Keys');function j(k){this._layer=k;}g(j.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('key',this._handle.bind(this));},disable:function(){this._subscription.unsubscribe();this._subscription=null;},_handle:function(k,event){if(Event.getKeyCode(event)===i.ESC){var l=this._layer.getCausalElement();if(l)if(l.tabIndex!=-1)h.focus(l);this._layer.hide();return false;}}});e.exports=j;});
__d("LayerHideOnSuccess",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._layer=i;}g(h.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('success',this._layer.hide.bind(this._layer));},disable:function(){if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}}});e.exports=h;});
__d("LayerHideOnTransition",["Arbiter","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('copyProperties');function j(k){this._layer=k;}i(j.prototype,{_subscription:null,enable:function(){this._subscription=g.subscribe('page_transition',this._layer.hide.shield(this._layer),g.SUBSCRIBE_NEW);},disable:function(){if(this._subscription){this._subscription.unsubscribe();this._subscription=null;}}});e.exports=j;});
__d("TabbableElements",["Style","createArrayFrom"],function(a,b,c,d,e,f){var g=b('Style'),h=b('createArrayFrom'),i={find:function(j){function k(n){if(n.tabIndex>0)return true;switch(n.tagName){case "A":return n.href&&n.rel!="ignore";case "INPUT":return n.type!="hidden"&&n.type!="file"&&!n.disabled;case "SELECT":return !n.disabled;case "TEXTAREA":return !n.disabled;default:return false;}}function l(n){if(n.offsetHeight===0&&n.offsetWidth===0)return true;var o=n;while(o&&o!=j&&g.get(o,'visibility')!=='hidden')o=o.parentNode;return o!==j;}var m=h(j.getElementsByTagName("*"));return m.filter(function(n){return k(n)&&!l(n);});}};e.exports=i;});
__d("LayerTabIsolation",["event-extensions","copyProperties","TabbableElements","Keys","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('TabbableElements'),i=b('Keys'),j=b('Input');function k(l){this._layer=l;}g(k.prototype,{_tabHandler:null,_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attachHandler.bind(this)),this._layer.subscribe('hide',this._detachHandler.bind(this))];},disable:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this._detachHandler();},_attachHandler:function(){var l=this._layer.getRoot();this._tabHandler=Event.listen(l,'keydown',function(m){if(Event.getKeyCode(m)==i.TAB){var n=m.getTarget();if(n){var o=h.find(l),p=o[0],q=o[o.length-1],r=m.getModifiers().shift;if(r&&n==p){m.preventDefault();j.focus(q);}else if(!r&&n==q){m.preventDefault();j.focus(p);}}}});},_detachHandler:function(){if(this._tabHandler){this._tabHandler.remove();this._tabHandler=null;}}});e.exports=k;});
__d("LayerMouseHooks",["event-extensions","function-extensions","ContextualThing","DOM","Layer","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('ContextualThing'),h=b('DOM'),i=b('Layer'),j=b('copyProperties');function k(l){this._layer=l;}j(k.prototype,{_mouseSubscriptions:[],_layerSubscriptions:[],enable:function(){var l=this._layer.getRoot();this._mouseSubscriptions=[Event.listen(l,'mouseenter',this._onMouseEnter.bind(this)),Event.listen(l,'mouseleave',this._onMouseLeave.bind(this))];this._layerSubscriptions=[i.subscribe('show',this._onLayerShow.bind(this)),i.subscribe('hide',this._onLayerHide.bind(this))];},disable:function(){this._mouseSubscriptions.forEach(function(l){l.remove();});this._mouseSubscriptions=[];this._layerSubscriptions.forEach(function(l){i.unsubscribe(l);});this._layerSubscriptions=[];},_onMouseEnter:function(l){this._fireMouseLeaveOnLayerHide=false;if(!this._spawnedLayer)this._layer.inform('mouseenter');},_onMouseLeave:function(l){if(!this._spawnedLayer)this._layer.inform('mouseleave');this._fireMouseLeaveOnLayerHide=!!this._spawnedLayer;},_onLayerShow:function(l,m){var n=m.getContext&&m.getContext();if(n)if(h.contains(this._layer.getRoot(),n))this._spawnedLayer=m;},_onLayerHide:function(l,m){if(m===this._spawnedLayer){this._spawnedLayer=null;if(this._fireMouseLeaveOnLayerHide)this._onMouseLeave.bind(this).defer();}}});e.exports=k;});
__d("Overlay",["Arbiter","Class","CSS","DataStore","DOM","Layer","LayerAutoFocus","LayerButtons","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","LayerFormHooks","LayerHideOnBlur","LayerHideOnEscape","LayerHideOnSuccess","LayerHideOnTransition","LayerTabIsolation","LayerMouseHooks","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Class'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Layer'),m=b('LayerAutoFocus'),n=b('LayerButtons'),o=b('LayerDestroyOnHide'),p=b('LayerFadeOnHide'),q=b('LayerFadeOnShow'),r=b('LayerFormHooks'),s=b('LayerHideOnBlur'),t=b('LayerHideOnEscape'),u=b('LayerHideOnSuccess'),v=b('LayerHideOnTransition'),w=b('LayerTabIsolation'),x=b('LayerMouseHooks'),y=b('$'),z=b('copyProperties');function aa(ba,ca){ba=z({buildWrapper:true},ba||{});this._shouldBuildWrapper=ba.buildWrapper;this.parent.construct(this,ba,ca);}h.extend(aa,l);z(aa.prototype,{_configure:function(ba,ca){this.parent._configure(ba,ca);var da=this.getRoot();this._overlay=k.scry(da,'div.uiOverlay')[0]||da;i.hide(da);k.appendContent(this.getInsertParent(),da);j.set(this._overlay,'overlay',this);var ea=j.get(this._overlay,'width');ea&&this.setWidth(ea);if(this.setFixed)this.setFixed(j.get(this._overlay,'fixed')=='true');if(j.get(this._overlay,'fadeonshow')!='false')this.enableBehavior(q);if(j.get(this._overlay,'fadeonhide')!='false')this.enableBehavior(p);if(j.get(this._overlay,'hideonsuccess')!='false')this.enableBehavior(u);if(j.get(this._overlay,'hideonblur')=='true')this.enableBehavior(s);if(j.get(this._overlay,'destroyonhide')!='false')this.enableBehavior(o);return this;},_getDefaultBehaviors:function(){return this.parent._getDefaultBehaviors().concat([m,n,r,x,t,v,w]);},initWithoutBuildingWrapper:function(){this._shouldBuildWrapper=false;return this.init.apply(this,arguments);},_buildWrapper:function(ba,ca){ca=this.parent._buildWrapper(ba,ca);if(!this._shouldBuildWrapper){this._contentRoot=ca;return ca;}this._contentRoot=k.create('div',{className:'uiOverlayContent'},ca);return k.create('div',{className:'uiOverlay'},this._contentRoot);},_getContentRoot:function(){return this._contentRoot;},destroy:function(){j.remove(this.getRoot(),'overlay');this.parent.destroy();}});e.exports=aa;});
__d("ContextualDialogX",["event-extensions","ARIA","Arbiter","ArbiterMixin","Bootloader","Class","ContextualDialogFooterLink","ContextualThing","CSS","DataStore","DOM","Locale","Overlay","Parent","Style","Vector","$","copyProperties","getOverlayZIndex"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ARIA'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('Bootloader'),k=b('Class'),l=b('ContextualDialogFooterLink'),m=b('ContextualThing'),n=b('CSS'),o=b('DataStore'),p=b('DOM'),q=b('Locale'),r=b('Overlay'),s=b('Parent'),t=b('Style'),u=b('Vector'),v=b('$'),w=b('copyProperties'),x=b('getOverlayZIndex');function y(z,aa){this.parent.construct(this,z,aa);}k.extend(y,r);w(y,i,{ARROW_OFFSET:15,ARROW_LENGTH:16,ARROW_INSET:22,TOP_MARGIN:8,BOTTOM_MARGIN:30,LEFT_MARGIN:15,RIGHT_MARGIN:30,POSITION_TO_CLASS:{above:'uiContextualDialogAbove',below:'uiContextualDialogBelow',left:'uiContextualDialogLeft',right:'uiContextualDialogRight'},RIGHT_ALIGNED_CLASS:'uiContextualDialogRightAligned',ARROW_CLASS:{bottom:'uiContextualDialogArrowBottom',top:'uiContextualDialogArrowTop',right:'uiContextualDialogArrowRight',left:'uiContextualDialogArrowLeft'},POSITION_TO_ARROW:{above:'bottom',below:'top',left:'right',right:'left'},getInstance:function(z){var aa=o.get(z,'ContextualDialogX');if(!aa){var ba=s.byClass(z,'uiOverlay');if(ba)aa=o.get(ba,'overlay');}return aa;}});w(y.prototype,{_scrollListener:null,_scrollParent:null,_width:null,_fixed:false,_hasCustomArrow:false,_hasFooter:false,_showSubscription:null,_hideSubscription:null,_hovercardSubscription:null,_setContextSubscription:null,_resizeListener:null,_reflowSubscription:null,_configure:function(z,aa){this.parent._configure(z,aa);var ba=this.getRoot(),ca=o.get.curry(ba);this.setAlignH(ca('alignh','left'));this.setOffsetX(ca('offsetx',0));this.setOffsetY(ca('offsety',0));this.setPosition(ca('position','above'));this._hasCustomArrow=ca('hascustomarrow',false);this._hasFooter=ca('hasfooter',false);if(this._hasFooter){var da=p.scry(ba,'.uiContextualDialogFooterLink')[0];da&&this.enableBehavior(l);}this._setContextSubscription=this.subscribe('beforeshow',function(){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;var ea=ca('context');if(ea){this.setContext(v(ea));}else{ea=ca('contextselector');if(ea)this.setContext(p.find(document,ea));}}.bind(this));this._content=p.scry(ba,'.uiContextualDialogContent')[0];this._showSubscription=this.subscribe('show',function(){var ea=this.updatePosition.shield(this);this._resizeListener=Event.listen(window,'resize',ea);this._reflowSubscription=h.subscribe('reflow',ea);this._setupScrollListener(this._scrollParent);m.register(ba,this.context);h.inform('layer_shown',{type:'ContextualDialog'});}.bind(this));this._hideSubscription=this.subscribe('hide',function(){this._teardownResizeAndReflowListeners();this._teardownScrollListener();m.remove(ba);h.inform('layer_hidden',{type:'ContextualDialog'});}.bind(this));this._hovercardSubscription=h.subscribe('Hovercard/hide',function(ea,fa){if(a.Hovercard.contains(this.getContext()))this.hide();}.bind(this));return this;},_buildWrapper:function(z,aa){var ba=this.parent._buildWrapper(z,aa);if(!this._shouldBuildWrapper)return ba;n.addClass(ba,'uiContextualDialog');return p.create('div',{className:'uiContextualDialogPositioner'},ba);},setWidth:function(z){this._width=Math.floor(z);return this;},setFixed:function(z){z=!!z;n.conditionClass(this.getRoot(),'uiContextualDialogFixed',z);this._fixed=z;return this;},setAlignH:function(z){this.alignH=z;this._updateAlignmentClass();this._shown&&this.updatePosition();this.position&&this._updateArrow();return this;},getContent:function(){return this._content;},getContext:function(){return this.context;},setContext:function(z){if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}z=v(z);if(this.context&&this.context!=z)o.remove(this.context,'ContextualDialogX');this.context=z;g.setPopup(this.getCausalElement(),this.getRoot());var aa=s.byClass(z,'fbPhotoSnowlift');this.setInsertParent(aa||document.body);if(this._scrollListener&&this._scrollParent!==aa){this._teardownScrollListener();this._setupScrollListener(aa);}this._scrollParent=aa;var ba=x(z,this._insertParent);t.set(this.getRoot(),'z-index',ba>200?ba:'');o.set(this.context,'ContextualDialogX',this);return this;},getCausalElement:function(){return this.parent.getCausalElement()||this.context;},listen:function(z,aa){return Event.listen(this.getRoot(),z,aa);},setOffsetX:function(z){this.offsetX=parseInt(z,10)||0;this._shown&&this.updatePosition();return this;},setOffsetY:function(z){this.offsetY=parseInt(z,10)||0;this._shown&&this.updatePosition();return this;},setPosition:function(z){this.position=z;for(var aa in y.POSITION_TO_CLASS)n.conditionClass(this.getRoot(),y.POSITION_TO_CLASS[aa],z==aa);this._updateAlignmentClass();this._shown&&this.updatePosition();this._updateArrow();return this;},updatePosition:function(){if(!this.context)return false;if(this._width)t.set(this._overlay,'width',this._width+'px');var z=this._fixed?'viewport':'document',aa=u.getElementPosition(this.context,z),ba=this._scrollParent;if(ba)aa=aa.sub(u.getElementPosition(ba,'document')).add(ba.scrollLeft,ba.scrollTop);var ca=u.getElementDimensions(this.context),da=this.position=='above'||this.position=='below',ea=q.isRTL();if((this.position=='right'||(da&&this.alignH=='right'))!=ea)aa=aa.add(ca.x,0);if(this.position=='below')aa=aa.add(0,ca.y);var fa=new u(0,0);if(da&&this.alignH=='center'){fa=fa.add((ca.x-this._width)/2,0);}else{var ga=da?ca.x:ca.y,ha=2*y.ARROW_INSET;if(ga<ha){var ia=ga/2-y.ARROW_INSET;if(da&&(this.alignH=='right'!=ea))ia=-ia;fa=fa.add(da?ia:0,da?0:ia);}}fa=fa.add(this.offsetX,this.offsetY);if(ea)fa=fa.mul(-1,1);aa=aa.add(fa);if(this._fixed)aa=new u(aa.x,aa.y,'document');aa.setElementPosition(this.getRoot());this._adjustVerticalPosition();this._adjustHorizontalPosition();return true;},scrollTo:function(){if(this.context)j.loadModules(['DOMScroll'],function(z){z.scrollTo(this.context,true,true);}.bind(this));},destroy:function(){this.unsubscribe(this._showSubscription);this.unsubscribe(this._hideSubscription);this._hovercardSubscription.unsubscribe();if(this._setContextSubscription){this.unsubscribe(this._setContextSubscription);this._setContextSubscription=null;}this._teardownScrollListener();this._teardownResizeAndReflowListeners();this.context&&o.remove(this.context,'ContextualDialogX');this.parent.destroy();},_adjustVerticalPosition:function(){if(this.position!='left'&&this.position!='right'){t.set(this._overlay,'top','');return;}var z=this.getRoot(),aa=u.getElementPosition(z,'viewport').y,ba=u.getElementDimensions(this._overlay).y,ca=u.getViewportDimensions().y,da=y.TOP_MARGIN,ea=Math.min(Math.max(0,aa+ba+y.BOTTOM_MARGIN-ca),Math.max(-da,aa-da),ba-2*y.ARROW_INSET);t.set(this._overlay,'top',(-1*ea)+'px');t.set(this._arrow,'top',y.ARROW_OFFSET+'px');t.set(this._arrow,'marginTop',ea+'px');},_adjustHorizontalPosition:function(){if((this.position!='above'&&this.position!='below')||this.alignH!='left'){t.set(this._overlay,'left','');t.set(this._overlay,'right','');return;}var z=this.getRoot(),aa=u.getElementPosition(z,'viewport').x,ba=u.getElementDimensions(this._overlay).x,ca=u.getViewportDimensions().x,da=q.isRTL(),ea;if(!da){ea=aa+ba+y.RIGHT_MARGIN-ca;}else ea=y.LEFT_MARGIN+ba-aa;ea=Math.min(Math.max(0,ea),ba-2*y.ARROW_INSET);t.set(this._overlay,da?'right':'left',-1*ea+'px');t.set(this._arrow,da?'right':'left',y.ARROW_OFFSET+'px');t.set(this._arrow,da?'marginRight':'marginLeft',ea+'px');},_updateArrow:function(){var z=0;if(this.position=='above'||this.position=='below')switch(this.alignH){case 'center':z=50;break;case 'right':z=100;break;}this._renderArrow(y.POSITION_TO_ARROW[this.position],z);},_renderArrow:function(z,aa){for(var ba in y.ARROW_CLASS)n.conditionClass(this._overlay,y.ARROW_CLASS[ba],z==ba);n.conditionClass(this._overlay,'uiContextualDialogWithFooterArrowBottom',z=='bottom'&&this._hasFooter);if(z=='none')return;if(!this._arrow){this._arrow=p.create('i',{className:'uiContextualDialogArrow'});p.appendContent(this._overlay,this._arrow);}t.set(this._arrow,'top','');t.set(this._arrow,'left','');t.set(this._arrow,'right','');t.set(this._arrow,'margin','');var ca=z=='top'||z=='bottom',da=ca?(q.isRTL()?'right':'left'):'top';aa=aa||0;t.set(this._arrow,da,aa+'%');var ea=y.ARROW_LENGTH+y.ARROW_OFFSET*2,fa=-(ea*aa/100-y.ARROW_OFFSET);t.set(this._arrow,'margin-'+da,fa+'px');if(this._hasCustomArrow)y.inform('arrow_rendered',{type:'ContextualDialog',root:this._root,position:z,side:da,offset_percent:aa,side_margin:fa});},_updateAlignmentClass:function(){n.conditionClass(this.getRoot(),y.RIGHT_ALIGNED_CLASS,(this.position=='above'||this.position=='below')&&this.alignH=='right');},_setupScrollListener:function(z){this._scrollListener=Event.listen(z||window,'scroll',this._adjustVerticalPosition.shield(this));},_teardownScrollListener:function(){if(this._scrollListener){this._scrollListener.remove();this._scrollListener=null;}},_teardownResizeAndReflowListeners:function(){if(this._resizeListener){this._resizeListener.remove();this._resizeListener=null;}if(this._reflowSubscription){this._reflowSubscription.unsubscribe();this._reflowSubscription=null;}}});e.exports=y;});
__d("Rect",["Vector","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Vector'),h=b('$'),i=b('copyProperties');function j(k,l,m,n,o){if(arguments.length===1){if(k instanceof j)return k;if(k instanceof g)return new j(k.y,k.x,k.y,k.x,k.domain);return j.getElementBounds(h(k));}i(this,{t:k,r:l,b:m,l:n,domain:o||'pure'});}i(j.prototype,{w:function(){return this.r-this.l;},h:function(){return this.b-this.t;},toString:function(){return '(('+this.l+', '+this.t+'), ('+this.r+', '+this.b+'))';},contains:function(k){k=new j(k).convertTo(this.domain);var l=this;return (l.l<=k.l&&l.r>=k.r&&l.t<=k.t&&l.b>=k.b);},add:function(k,l){if(arguments.length==1){if(k.domain!='pure')k=k.convertTo(this.domain);return this.add(k.x,k.y);}var m=parseFloat(k),n=parseFloat(l);return new j(this.t+n,this.r+m,this.b+n,this.l+m,this.domain);},sub:function(k,l){if(arguments.length==1){return this.add(k.mul(-1));}else return this.add(-k,-l);},boundWithin:function(k){var l=0,m=0;if(this.l<k.l){l=k.l-this.l;}else if(this.r>k.r)l=k.r-this.r;if(this.t<k.t){m=k.t-this.t;}else if(this.b>k.b)m=k.b-this.b;return this.add(l,m);},getCenter:function(){return new g(this.l+this.w()/2,this.t+this.h()/2,this.domain);},getPositionVector:function(){return new g(this.l,this.t,this.domain);},getDimensionVector:function(){return new g(this.w(),this.h(),'pure');},convertTo:function(k){if(this.domain==k)return this;if(k=='pure')return new j(this.t,this.r,this.b,this.l,'pure');if(this.domain=='pure')return new j(0,0,0,0);var l=new g(this.l,this.t,this.domain).convertTo(k);return new j(l.y,l.x+this.w(),l.y+this.h(),l.x,k);}});i(j,{deserialize:function(k){var l=k.split(':');return new j(parseFloat(l[1]),parseFloat(l[2]),parseFloat(l[3]),parseFloat(l[0]));},newFromVectors:function(k,l){return new j(k.y,k.x+l.x,k.y+l.y,k.x,k.domain);},getElementBounds:function(k){return j.newFromVectors(g.getElementPosition(k),g.getElementDimensions(k));},getViewportBounds:function(){return j.newFromVectors(g.getScrollPosition(),g.getViewportDimensions());},minimumBoundingBox:function(k){var l=new j(Math.min(),Math.max(),Math.max(),Math.min()),m;for(var n=0;n<k.length;n++){m=k[n];l.t=Math.min(l.t,m.t);l.r=Math.max(l.r,m.r);l.b=Math.max(l.b,m.b);l.l=Math.min(l.l,m.l);}return l;}});e.exports=j;});
__d("Hovercard",["ClickRef","event-extensions","function-extensions","AccessibleLayer","Arbiter","AsyncRequest","AsyncSignal","ContextualDialogX","CSS","DOM","DOMQuery","LayerDestroyOnHide","LayerFadeOnHide","LayerFadeOnShow","Parent","Rect","UserAgent","URI","Vector","ViewportBounds","tx","userAction"],function(a,b,c,d,e,f){b('ClickRef');b('event-extensions');b('function-extensions');var g=b('AccessibleLayer'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('AsyncSignal'),k=b('ContextualDialogX'),l=b('CSS'),m=b('DOM'),n=b('DOMQuery'),o=b('LayerDestroyOnHide'),p=b('LayerFadeOnHide'),q=b('LayerFadeOnShow'),r=b('Parent'),s=b('Rect'),t=b('UserAgent'),u=b('URI'),v=b('Vector'),w=b('ViewportBounds'),x=b('tx'),y=b('userAction'),z=450,aa=385,ba={},ca={},da=null,ea=null,fa=null,ga=150,ha=700,ia=1000,ja=250,ka=null,la=null,ma=null,na=null;function oa(){if(t.ie()<7)return;Event.listen(document.documentElement,'mouseover',pa);Event.listen(window,'scroll',function(){kb.hide(true);});h.subscribe('page_transition',function(){va();kb.dirtyAll();},h.SUBSCRIBE_NEW);h.subscribe('layer_shown',function(lb,mb){if(mb.type!='Hovercard'&&mb.type!='ContextualDialog')va();},h.SUBSCRIBE_NEW);k.subscribe('arrow_rendered',xa,h.SUBSCRIBE_NEW);}function pa(event){var lb=r.byTag(event.getTarget(),'a');kb.processNode(lb)&&event.stop();}function qa(lb){ea=lb;if(!ra(lb)){var mb;if(!lb||!(mb=sa(lb))){ca.moveToken&&ca.moveToken.remove();ca={};return false;}if(ca.node!=lb){ca.moveToken&&ca.moveToken.remove();ca={node:lb,endpoint:mb,pos:null};}}return true;}function ra(lb){return lb&&da&&ca.node==lb;}function sa(lb){return lb.getAttribute('data-hovercard');}function ta(lb){var mb=Event.listen(lb,'mouseout',function(){clearTimeout(ka);clearTimeout(la);mb.remove();ea=null;kb.hide();});if(!ca.moveToken)ca.moveToken=Event.listen(lb,'mousemove',function(event){ca.pos=v.getEventPosition(event);});clearTimeout(ka);clearTimeout(la);clearTimeout(na);var nb=ga,ob=da?ja:ha;if(lb.getAttribute('data-hovercard-instant'))nb=ob=50;ka=setTimeout(gb.curry(lb),nb);la=setTimeout(ua.curry(lb),ob);}function ua(lb,mb){if(ca.node!=lb)return;var nb=ba[sa(lb)];if(nb){wa(nb);}else if(mb){wa(ib());}else{var ob=da?ja:ha;ma=setTimeout(ua.curry(lb,true),ia-ob);}}function va(){kb.hide(true);clearTimeout(la);}function wa(lb){var mb=ca.node,nb=da,ob=nb!=mb;if(da){var pb=k.getInstance(da);pb&&pb.hide();}if(!m.contains(document.body,mb)){kb.hide(true);return;}da=mb;fa=lb;cb();lb.setContext(mb).show();if(ob){(function(){new j('/ajax/hovercard/shown.php').send();y('himp',da,null,'FORCE',{ft:{evt:39}});}).defer();if(nb){h.inform('Hovercard/hide',{node:nb});}else h.inform('layer_shown',{type:'Hovercard'});h.inform('Hovercard/show',{node:mb});}}function xa(lb,mb){var nb=ba[ca.endpoint];if(mb.type!=='ContextualDialog'||!nb||!mb.root||mb.position!=='top')return;var ob=n.scry(mb.root,'.CustomArrow')[0];if(!ob)return;var pb=n.scry(ob,'.ArrowShadow')[0];if(!pb)return;var qb=null;if(ob.style.webkitMaskPosition!==undefined){qb=ab;}else if(ya(ob))qb=bb;if(qb){l.addClass(mb.root,'withCustomArrow');setTimeout(function(){qb(ob,pb,mb);},0);}}function ya(lb){if(!lb)lb=document.body;var mb=['transform','WebkitTransform','msTransform','MozTransform','OTransform'],nb;while(nb=mb.shift())if(lb.style[nb]!==undefined)return nb;return null;}function za(lb,mb,nb){var ob=lb.parentNode.offsetWidth,pb=Math.round(ob*nb.offset_percent/100);if(nb.side==='left'){pb=pb+nb.side_margin;}else if(nb.side==='right')pb=ob-pb-nb.side_margin-18;return pb;}function ab(lb,mb,nb){l.addClass(nb.root,'usingMask');var ob=za(lb,mb,nb);lb.style.webkitMaskPositionX=ob+'px';mb.style.left=ob+'px';}function bb(lb,mb,nb){var ob=n.scry(lb,'.CoverPhoto')[0];if(!ob)return;var pb=ya(lb);if(!pb)return;l.addClass(nb.root,'usingRotate');var qb=za(lb,mb,nb)+9,rb=Math.ceil(qb/Math.SQRT2);ob.style[pb]='translate('+(-rb)+'px, '+rb+'px) rotate(-45deg)';lb.style[pb]='translate('+qb+'px, 0) rotate(45deg)';}function cb(){var lb=v.getViewportDimensions(),mb=v.getElementPosition(da,'viewport'),nb=mb.convertTo('document'),ob=fb(da),pb='above',qb='left',rb=eb(nb,ob,'above');if(mb.y+rb<=aa){var sb=eb(nb,ob,'below');if(mb.y+sb+da.offsetHeight+aa<lb.y){pb='below';rb=sb;}}var tb=lb.x-w.getRight(),ub=db(nb,ob,'left');if(mb.x+ub+z>=tb){var vb=db(nb,ob,'right');if(mb.x+vb+da.offsetWidth>z){qb='right';ub=vb;}}fa.setPosition(pb).setAlignH(qb).setOffsetX(ub).setOffsetY(rb);}function db(lb,mb,nb){if(nb=='left')return mb.l-lb.x;return mb.r-(lb.x+da.offsetWidth);}function eb(lb,mb,nb){if(nb=='above')return mb.t-lb.y;return mb.b-(lb.y+da.offsetHeight);}function fb(lb){var mb=ca.pos,nb=lb.getClientRects();if(!mb||nb.length===0)return s.getElementBounds(lb);var ob,pb=false;for(var qb=0;qb<nb.length;qb++){var rb=new s(Math.round(nb[qb].top),Math.round(nb[qb].right),Math.round(nb[qb].bottom),Math.round(nb[qb].left),'viewport').convertTo('document'),sb=rb.getPositionVector(),tb=sb.add(rb.getDimensionVector());if(!ob||(sb.x<=ob.l&&sb.y>ob.t)){if(pb)break;ob=new s(sb.y,tb.x,tb.y,sb.x,'document');}else{ob.t=Math.min(ob.t,sb.y);ob.b=Math.max(ob.b,tb.y);ob.r=tb.x;}if(rb.contains(mb))pb=true;}return ob;}function gb(lb){if(lb.id&&ba[lb.id]!=null)return;var mb=sa(lb);if(ba[mb]!=null)return;hb(mb);var nb=function(){kb.dirty(mb);va();};new i(mb).setData({endpoint:mb}).setMethod('GET').setReadOnly(true).setErrorHandler(nb).setTransportErrorHandler(nb).send();}function hb(lb){ba[lb]=false;}var ib=function(){var lb=new k({},m.create('div',{className:'HovercardLoading'},"Loading..."));lb.disableBehavior(g).disableBehavior(o).disableBehavior(q).disableBehavior(p);jb(lb);ib=bagof(lb);return lb;};function jb(lb){lb.subscribe('mouseenter',function(){clearTimeout(na);ea=ca.node;});lb.subscribe('mouseleave',function(){kb.hide(false);ea=null;});}var kb={hide:function(lb){if(!da)return;if(lb){if(fa){h.inform('layer_hidden',{type:'Hovercard'});h.inform('Hovercard/hide',{node:da});fa.hide();}ea=null;da=null;fa=null;}else na=setTimeout(kb.hide.curry(true),ja);},setDialog:function(lb,mb){mb.disableBehavior(g);ba[lb]=mb;jb(mb);if(ca.endpoint==lb&&ea==ca.node)wa(mb);},getDialog:function(lb){return ba[lb];},contains:function(lb){if(fa)return m.contains(fa.getRoot(),lb);return false;},dirty:function(lb){var mb=ba[lb];if(mb){mb.destroy();delete ba[lb];}},dirtyAll:function(){for(var lb in ba){var mb=ba[lb];mb&&kb.dirty(lb);}},processNode:function(lb){if(lb&&qa(lb)){ta(lb);return true;}return false;}};if(!a.Hovercard){oa();}else kb=a.Hovercard;e.exports=kb;a.Hovercard=e.exports;});
__d("legacy:data-store",["DataStore"],function(a,b,c,d){a.DataStore=a.DataStore||b('DataStore');},3);
__d("throttle",["debounce"],function(a,b,c,d,e,f){var g=b('debounce');function h(i,j,k){return g(i,j,k,false,true);}e.exports=h;});
__d("deferUntil",[],function(a,b,c,d,e,f){function g(h,i,j,k,l){var m=i();if(m){h(m);return null;}var n=Date.now(),o=setInterval(function(){m=i();if(!m){if(!j||(j<new Date()-n))return;l&&l();}clearInterval(o);h(m);},20,k);return o;}e.exports=g;});
__d("legacy:function-utils",["debounce","throttle","deferUntil"],function(a,b,c,d){a.debounce=b('debounce');a.throttle=b('throttle');a.defer_until=b('deferUntil');},3);
__d("legacy:page-transitions",["goOrReplace","computeRelativeURI","HistoryManager","PageTransitions"],function(a,b,c,d){a.go_or_replace=b('goOrReplace');a.computeRelativeURI=b('computeRelativeURI');a.HistoryManager=a.HistoryManager||b('HistoryManager');a.PageTransitions=a.PageTransitions||b('PageTransitions');},3);
__d("CallbackManagerController",["ErrorUtils","copyProperties"],function(a,b,c,d,e,f){var g=b('ErrorUtils'),h=b('copyProperties'),i=function(j){this._pendingIDs=[];this._allRequests=[undefined];this._callbackArgHandler=j;};h(i.prototype,{executeOrEnqueue:function(j,k,l){l=l||{};var m=this._attemptCallback(k,j,l);if(m)return 0;this._allRequests.push({fn:k,request:j,options:l});var n=this._allRequests.length-1;this._pendingIDs.push(n);return n;},unsubscribe:function(j){delete this._allRequests[j];},getRequest:function(j){return this._allRequests[j];},runPossibleCallbacks:function(){var j=this._pendingIDs;this._pendingIDs=[];var k=[];j.forEach(function(l){var m=this._allRequests[l];if(!m)return;if(this._callbackArgHandler(m.request,m.options)){k.push(l);}else this._pendingIDs.push(l);}.bind(this));k.forEach(function(l){var m=this._allRequests[l];delete this._allRequests[l];this._attemptCallback(m.fn,m.request,m.options);}.bind(this));},_attemptCallback:function(j,k,l){var m=this._callbackArgHandler(k,l);if(m){var n={ids:k};g.applyWithGuard(j,n,[m]);}return !!m;}});e.exports=i;});
__d("KeyedCallbackManager",["CallbackManagerController","copyProperties"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=function(){this._resources={};this._controller=new g(this._constructCallbackArg.bind(this));};h(i.prototype,{executeOrEnqueue:function(j,k){if(!(j instanceof Array)){var l=j,m=k;j=[j];k=function(n){m(n[l]);};}return this._controller.executeOrEnqueue(j,k);},unsubscribe:function(j){this._controller.unsubscribe(j);},getUnavailableResources:function(j){var k=this._controller.getRequest(j),l=[];if(k)l=k.request.filter(function(m){return !this._resources[m];}.bind(this));return l;},addResourcesAndExecute:function(j){h(this._resources,j);this._controller.runPossibleCallbacks();},setResource:function(j,k){this._resources[j]=k;this._controller.runPossibleCallbacks();},getResource:function(j){return this._resources[j];},getAllResources:function(){return this._resources;},dumpResources:function(){var j={};for(var k in this._resources){var l=this._resources[k];if(typeof l==='object')l=h({},l);j[k]=l;}return j;},_constructCallbackArg:function(j){var k={};for(var l=0;l<j.length;l++){var m=j[l],n=this._resources[m];if(typeof n=='undefined')return false;k[m]=n;}return k;}});e.exports=i;});
__d("AsyncLoader",["AsyncRequest","KeyedCallbackManager","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('KeyedCallbackManager'),i=b('copyProperties'),j={};function k(m,n){var o=new h(),p=false,q=[];function r(){if(!q.length||p)return;p=true;t.defer();}function s(w){p=false;w.forEach(o.unsubscribe.bind(o));r();}function t(){var w={},x=[];q=q.filter(function(z){var aa=o.getUnavailableResources(z);if(aa.length){aa.forEach(function(ba){w[ba]=true;});x.push(z);return true;}return false;});var y=Object.keys(w);if(y.length){new g(m).setData({ids:y}).setHandler(u.curry(x)).setErrorHandler(v.curry(x)).setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();}else p=false;}function u(w,x){var y=x.payload[n]||x.payload;o.addResourcesAndExecute(y);s(w);}function v(w){s(w);}return {get:function(w,x){var y=o.executeOrEnqueue(w,x),z=o.getUnavailableResources(y);if(z.length){q.push(y);r();}},getCachedKeys:function(){return Object.keys(o.getAllResources());},getNow:function(w){return o.getResource(w)||null;},set:function(w){o.addResourcesAndExecute(w);}};}function l(m,n){if(!j[m])j[m]=k(m,n);i(this,j[m]);}e.exports=l;});
__d("RangedCallbackManager",["CallbackManagerController","copyProperties","createObjectFrom"],function(a,b,c,d,e,f){var g=b('CallbackManagerController'),h=b('copyProperties'),i=b('createObjectFrom'),j=function(k,l,m){this._resources=[];this._reachedEndOfArray=false;this._existingIDs={};this._controller=new g(this._constructCallbackArg.bind(this));this._getValueHandler=k;this._compareValuesHandler=l;this._skipOnStrictHandler=m;};h(j.prototype,{executeOrEnqueue:function(k,l,m,n){return this._controller.executeOrEnqueue({start:k,limit:l},m,{strict:!!n});},unsubscribe:function(k){this._controller.unsubscribe(k);},getUnavailableResources:function(k){var l=this._controller.getRequest(k),m=[];if(l&&!this._reachedEndOfArray){var n=l.request,o=this._filterForStrictResults(l.options),p=n.start+n.limit;for(var q=o.length;q<p;q++)m.push(q);}return m;},addResources:function(k){k.forEach(function(l){if(!this._existingIDs[l]){this._existingIDs[l]=true;this._resources.push(l);}}.bind(this));this.resortResources();this._controller.runPossibleCallbacks();},addResourcesWithoutSorting:function(k,l){var m=this._resources.slice(0,l);m=m.concat(k);m=m.concat(this._resources.slice(l));this._resources=m;h(this._existingIDs,i(k,true));this._controller.runPossibleCallbacks();},removeResources:function(k){k.forEach(function(l){if(this._existingIDs[l]){this._existingIDs[l]=false;this._resources.remove(l);}}.bind(this));},removeAllResources:function(){this._resources=[];this._existingIDs={};},resortResources:function(){this._resources=this._resources.sort(function(k,l){return this._compareValuesHandler(this._getValueHandler(k),this._getValueHandler(l));}.bind(this));},setReachedEndOfArray:function(){if(!this._reachedEndOfArray){this._reachedEndOfArray=true;this._controller.runPossibleCallbacks();}},hasReachedEndOfArray:function(){return this._reachedEndOfArray;},hasResource:function(k){return this._existingIDs[k];},getResourceAtIndex:function(k){return this._resources[k];},getAllResources:function(){return this._resources.concat();},getCurrentArraySize:function(){return this._resources.length;},_filterForStrictResults:function(k){var l=this._resources;if(k&&k.strict&&this._skipOnStrictHandler)l=l.filter(this._skipOnStrictHandler);return l;},_constructCallbackArg:function(k,l){var m=this._filterForStrictResults(l);if(!this._reachedEndOfArray&&k.start+k.limit>m.length){return false;}else return m.slice(k.start,k.start+k.limit);},getElementsUntil:function(k){var l=[];for(var m=0;m<this._resources.length;m++){var n=this._getValueHandler(this._resources[m]);if(this._compareValuesHandler(n,k)>0)break;l.push(this._resources[m]);}return l;}});e.exports=j;});
__d("Poller",["AsyncRequest","Cookie","copyProperties","Env"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Cookie'),i=b('copyProperties'),j=b('Env');function k(l,m,n){this._clearOnQuicklingEvent=!n;this._requestCallback=m;this.setTimePeriod(l);}k.MIN_TIME_PERIOD=2000;i(k.prototype,{stop:function(){clearTimeout(this._token);this._token=null;this._cancelRequest();},scheduleRequest:function(){this.stop();if(this._timePeriod)this._token=this._makeRequest.bind(this).defer(this._timePeriod,this._clearOnQuicklingEvent);},requestNow:function(){this.stop();this._makeRequest();},_timePeriod:null,setTimePeriod:function(l){l=l||null;if(l&&(isNaN(l)||l<k.MIN_TIME_PERIOD))return;if(l&&this._timePeriod==null)this._token=this._makeRequest.bind(this).defer(l,this._clearOnQuicklingEvents);this._timePeriod=l;},_makeRequest:function(){this._cancelRequest();if(!this._isLoadUser())return;var l=new g(),m=true;l.setInitialHandler(function(){return m;});this._cancelRequest=function(){m=false;};l.setFinallyHandler(this.scheduleRequest.bind(this));l.setInitialHandler=bagofholding;l.setFinallyHandler=bagofholding;this._requestCallback(l);if(m)l.send();},_isLoadUser:function(){return j.user==h.get('c_user');},_cancelRequest:bagofholding,getTimePeriod:function(){return this._timePeriod;}});e.exports=k;});
__d("ChatBehavior",["Arbiter","AvailableList","AvailableListConstants","copyProperties","MercuryConstants","ChatSidebarCalloutData"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AvailableList'),i=b('AvailableListConstants'),j=b('copyProperties'),k=c('MercuryConstants').ChatNotificationConstants,l=c('ChatSidebarCalloutData').isShown,m=h.getWebChatNotification(),n=l,o=j(new g(),{ON_CHANGED:'changed',notifiesUserMessages:function(){return m!==k.NO_USER_MESSAGE_NOTIFICATION;},ignoresRemoteTabRaise:function(){return n;}});function p(){o.inform(o.ON_CHANGED);}h.subscribe(i.ON_CHAT_NOTIFICATION_CHANGED,function(){var q=m,r=h.getWebChatNotification();m=r;if(q!=r)p();});g.subscribe('chat/set_does_page_occlude_tabs',function(q,r){n=!!r;p();});e.exports=o;});
__d("MercuryServerDispatcher",["AsyncRequest","JSLogger","URI","areObjectsEqual","copyProperties","debounceAcrossTransitions"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('JSLogger'),i=b('URI'),j=b('areObjectsEqual'),k=b('copyProperties'),l=b('debounceAcrossTransitions'),m={},n=h.create('mercury_dispatcher'),o=false,p={IMMEDIATE:'immediate',IDEMPOTENT:'idempotent',BATCH_SUCCESSIVE:'batch-successive',BATCH_SUCCESSIVE_UNIQUE:'batch-successive-unique',BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:'batch-successive-piggyback-retry',BATCH_DEFERRED_MULTI:'batch-deferred-multi',BATCH_CONDITIONAL:'batch-conditional',registerEndpoints:function(r){for(var s in r){var t=r[s];m[s]=new q(s,t);}},trySend:function(r,s,t){m[r].trySend(s,t);}};function q(r,s){var t=s.mode||p.IMMEDIATE;switch(t){case p.IMMEDIATE:case p.IDEMPOTENT:case p.BATCH_SUCCESSIVE:case p.BATCH_SUCCESSIVE_UNIQUE:case p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR:case p.BATCH_DEFERRED_MULTI:case p.BATCH_CONDITIONAL:break;default:throw new Error('Invalid MercuryServerDispatcher mode '+t);}this._endpoint=r;this._mode=t;this._combineData=s.batch_function;this._combineDataIf=s.batch_if;this._handler=s.handler;this._errorHandler=s.error_handler;this._transportErrorHandler=s.transport_error_handler||s.error_handler;this._deferredSend=l(this._batchSend,0,this);}k(q.prototype,{_inFlight:0,_handler:null,_errorHandler:null,_transportErrorHandler:null,_combineData:null,_pendingRequestData:null,trySend:function(r,s){if(o)return;if(typeof r=='undefined')r=null;var t=s||this._mode;if(t==p.IMMEDIATE){this._send(r);}else if(t==p.IDEMPOTENT){if(!this._inFlight)this._send(r);}else if(t==p.BATCH_SUCCESSIVE||t==p.BATCH_SUCCESSIVE_UNIQUE){if(!this._inFlight){this._send(r);}else this._batchData(r);}else if(t==p.BATCH_CONDITIONAL){if(this._inFlight&&(this._combineDataIf(this._pendingRequestData,r)||this._combineDataIf(this._batchedData,r))){this._batchData(r);}else this._send(r);}else if(t==p.BATCH_DEFERRED_MULTI){this._batchData(r);this._deferredSend();}else if(t==p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR){this._batchData(r);if(!this._inFlight)this._batchSend();}},_send:function(r){this._inFlight++;this._pendingRequestData=k({},r);n.log('send',{endpoint:this._endpoint,data:r,inflight_count:this._inFlight});new g(this._endpoint).setData(r).setHandler(this._handleResponse.bind(this)).setErrorHandler(this._handleError.bind(this)).setTransportErrorHandler(this._handleTransportError.bind(this)).setAllowCrossPageTransition(true).send();},_batchData:function(r){if(this._mode==p.BATCH_SUCCESSIVE_UNIQUE&&this._pendingRequestData&&j(r,this._pendingRequestData)){return;}else if(typeof this._batchedData=='undefined'){this._batchedData=r;}else this._batchedData=this._combineData(this._batchedData,r);},_batchSend:function(){if(typeof this._batchedData!='undefined'){this._send(this._batchedData);delete this._batchedData;}},_handleResponse:function(r){this._inFlight--;n.log('response',{endpoint:this._endpoint,inflight_count:this._inFlight});var s=r.getPayload();o=s&&s.kill_chat;if(o)n.log('killswitch_enabled',{endpoint:this._endpoint,inflight_count:this._inFlight});if(s&&s.error_payload){if(this._errorHandler)this._errorHandler(r);}else this._handler&&this._handler(s);if(this._mode==p.BATCH_SUCCESSIVE||this._mode==p.BATCH_SUCCESSIVE_UNIQUE||this._mode==p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR||this._mode==p.BATCH_CONDITIONAL)this._batchSend();this._pendingRequestData=null;},_handleErrorCommon:function(r,s){n.error('error',{endpoint:this._endpoint,inflight_count:this._inFlight-1});s&&s(r);this._inFlight--;var t=this._mode;if(t==p.BATCH_SUCCESSIVE||t==p.BATCH_SUCCESSIVE_UNIQUE||t==p.BATCH_CONDITIONAL){this._batchSend();}else if(t==p.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR)if(typeof this._batchedData=='undefined'){this._batchedData=this._pendingRequestData;}else{this._batchedData=this._combineData(this._pendingRequestData,this._batchedData);this._batchSend();}this._pendingRequestData=null;},_handleError:function(r){this._handleErrorCommon(r,this._errorHandler);},_handleTransportError:function(r){this._handleErrorCommon(r,this._transportErrorHandler);}});e.exports=p;});
__d("MessagingReliabilityLogger",["function-extensions","AsyncRequest","copyProperties","isEmpty","PresenceUtil","Run","MercuryServerDispatcher","MessagingReliabilityLoggerInitialData"],function(a,b,c,d,e,f){b('function-extensions');var g=b('AsyncRequest'),h=b('copyProperties'),i=b('isEmpty'),j=b('PresenceUtil'),k=b('Run'),l=b('MercuryServerDispatcher'),m=c('MessagingReliabilityLoggerInitialData'),n='/ajax/mercury/client_reliability.php',o=2000;function p(v,w){var x={app:m.app,categories:JSON.stringify(v)};if(!i(w))x.extra=JSON.stringify(w);return x;}function q(v,w,x,y){if(v[w]===undefined)v[w]={};if(v[w][x]===undefined)v[w][x]=0;v[w][x]+=y;}function r(v,w,x,y){if(v[w]===undefined)v[w]={};if(v[w][x]===undefined)v[w][x]=[];for(var z=0;z<y.length;++z)v[w][x].push(y[z]);}function s(v,w){if(!v.categories||!w.categories)return;var x=JSON.parse(v.categories),y=v.extra?JSON.parse(v.extra):{},z=JSON.parse(w.categories),aa=w.extra?JSON.parse(w.extra):{};for(var ba in z){var ca=z[ba],da=aa[ba];for(var ea in ca){q(x,ba,ea,ca[ea]);if(da!==undefined){var fa=da[ea];if(fa!==undefined)r(y,ba,ea,fa);}}}return p(x,y);}var t={};t[n]={mode:l.BATCH_SUCCESSIVE_PIGGYBACK_ON_ERROR,batch_function:s};l.registerEndpoints(t);var u={addEntry:function(v,w,x){if(!m.enabled)return;var y={};q(y,v,w,1);var z={};if(x!==undefined)r(z,v,w,[x]);l.trySend(n,p(y,z));}};if(m.enabled){u.addEntry('page_event','load',j.getSessionID());k.onBeforeUnload(function(){var v={page_event:{unload:1}},w={page_event:{unload:[j.getSessionID()]}};new g(n).setData(p(v,w)).setOption('asynchronous',false).setTimeoutHandler(bagofholding).resetTimeout(o).send();},false);}e.exports=u;});
__d("MercuryIDs",[],function(a,b,c,d,e,f){function g(h){return typeof h==='string'&&h.indexOf(':')!==-1;}e.exports={isValid:function(h){if(!h)return false;return g(h);},tokenize:function(h){if(!this.isValid(h))throw 'bad_id_format';var i=h.indexOf(':');return {type:h.substr(0,i),value:h.substr(i+1)};}};});
__d("MercuryAssert",["MercuryIDs"],function(a,b,c,d,e,f){var g=b('MercuryIDs');e.exports={isParticipantID:function(h){if(!g.isValid(h))throw 'bad_participant_id';},allParticipantIDs:function(h){h.forEach(this.isParticipantID);},isUserParticipantID:function(h){var i=g.tokenize(h);if(i.type!='fbid')throw 'bad_user_id';},isEmailParticipantID:function(h){var i=g.tokenize(h);if(i.type!='email')throw 'bad_email_id';},allThreadID:function(h){h.forEach(this.isThreadID);},isThreadID:function(h){if(!g.isValid(h))throw 'bad_thread_id';}};});
__d("TimestampConverter",["JSLogger"],function(a,b,c,d,e,f){var g=b('JSLogger'),h=g.create('timestamp_converter');function i(k){return (typeof(k)=='string')&&k.length>6;}var j={convertActionIDToTimestamp:function(k){if(i(k)){var l=k.slice(0,-6);return parseInt(l,10);}},maxValidActionID:function(k,l){if(!i(k))return l;if(!i(l))return k;return this.isGreaterThan(k,l)?k:l;},isGreaterThan:function(k,l){if(!i(k)||!i(l))return false;return this.convertActionIDToTimestamp(k)>this.convertActionIDToTimestamp(l);}};e.exports=j;});
__d("MercuryMessageIDs",["KeyedCallbackManager"],function(a,b,c,d,e,f){var g=b('KeyedCallbackManager'),h=new g(),i={getServerIDs:function(j,k){var l=j.filter(function(n){return n.indexOf('mail.projektitan.com')!==-1;}),m=function(n){var o=j.map(function(p){return n[p]?n[p]:p;});k(o);};return h.executeOrEnqueue(l,m);},addServerID:function(j,k){h.setResource(j,k);}};e.exports=i;});
__d("MercuryThreadInformer",["Arbiter","copyProperties","MercuryAssert"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('MercuryAssert'),j={},k={},l={},m=false,n=false,o=false,p={},q={},r={},s=0;function t(){if(!s){var v=j,w=k,x=l,y=m,z=n,aa=o,ba=p,ca=q,da=r;j={};k={};l={};m=false;n=false;o=false;p={};q={};r={};var ea=Object.keys(w);if(ea.length||y)u.inform('threadlist-updated',ea);if(ea.length)u.inform('threads-updated',w);for(var fa in x){u.inform('thread-read-changed',x);break;}for(var fa in v){u.inform('threads-deleted',v);break;}if(z)u.inform('unseen-updated',null);if(aa)u.inform('unread-updated',null);for(fa in ba){u.inform('messages-received',ba);break;}for(fa in ca){u.inform('messages-reordered',ca);break;}for(fa in da){u.inform('messages-updated',da);break;}}}var u=h(new g(),{updatedThread:function(v){k[v]=true;t();},deletedThread:function(v){j[v]=true;t();},updatedThreadlist:function(){m=true;t();},updatedUnseenState:function(){n=true;t();},updatedUnreadState:function(){o=true;t();},changedThreadReadState:function(v,w,x){if(!l[v]||l[v].timestamp<x)l[v]={mark_as_read:w,timestamp:x};t();},receivedMessage:function(v){i.isThreadID(v.thread_id);var w=v.thread_id;if(!p[w])p[w]=[];p[w].push(v);this.updatedThread(w);},reorderedMessages:function(v,w){q[v]={source:w};t();},updatedMessage:function(v,w,x){if(!r[v])r[v]={};r[v][w]={source:x};t();},synchronizeInforms:function(v){s++;try{v();}catch(w){throw w;}finally{s--;t();}},listen:function(v,w){return this.subscribe('threads-updated',function(x,y){if(y[v])w(v);});}});e.exports=u;});
__d("MercuryServerRequests",["Arbiter","AsyncResponse","KeyedCallbackManager","TimestampConverter","copyProperties","Env","JSLogger","MercuryAssert","MercuryMessageIDs","MercuryServerDispatcher","MercuryThreadInformer","MercuryIDs","MessagingReliabilityLogger","createObjectFrom","hasArrayNature","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncResponse'),i=b('KeyedCallbackManager'),j=b('TimestampConverter'),k=b('copyProperties'),l=b('Env'),m=b('JSLogger'),n=b('MercuryAssert'),o=b('MercuryMessageIDs'),p=b('MercuryServerDispatcher'),q=b('MercuryThreadInformer'),r=b('MercuryIDs'),s=b('MessagingReliabilityLogger'),t=b('createObjectFrom'),u=b('hasArrayNature'),v=c('MercuryConstants'),w=v.MercuryGenericConstants,x=0,y=m.create('mercury_server'),z=new i(),aa=new i(),ba=[],ca={},da={};function ea(ab){if(ab){y.log('action_id_update',{old_action_id:x,new_action_id:ab});x=j.maxValidActionID(x,ab);}}function fa(ab){var bb=ab.thread_id,cb=z.getResource(bb);if(!cb){if(ab.is_canonical||ab.is_canonical_user){var db=ab.participants;ab.participants.forEach(function(eb){var fb=r.tokenize(eb);if(db.length==1||fb.value!=l.user)if(fb.type=='fbid'){cb='user:'+fb.value;}else cb='email:'+fb.value;});}else if(ab.is_canonical_group){cb='group:'+ab.group_id;}else if(ab.root_message_threading_id)cb='root:'+ab.root_message_threading_id;cb=cb||'thread:'+bb;ga(bb,cb);}ab.thread_id=cb;}function ga(ab,bb){z.setResource(ab,bb);aa.setResource(bb,ab);da[ab]=bb;}function ha(ab,bb){var cb=aa.executeOrEnqueue(ab,bb),db=aa.getUnavailableResources(cb),eb=xa.tokenizeThreadID(ab);if(db.length&&eb.type!='root')xa.fetchThreadData(db);}function ia(ab){return aa.getResource(ab);}function ja(ab){return !!z.getResource(ab);}function ka(ab){var bb=z.getResource(ab);if(typeof bb=='undefined')y.warn('no_client_thread_id',{server_id:ab});return bb;}function la(ab,bb){z.executeOrEnqueue(ab,bb);xa.ensureThreadIsFetched(ab);}function ma(ab,bb){if(ab.action_type!=v.MercuryActionType.SEND_MESSAGE)return;var cb=ab.client_thread_id;if(!cb)cb=ka(ab.thread_id);var db=null;if(cb)db=r.tokenize(cb).type;s.addEntry('send_'+db,bb,ab.thread_id+','+ab.message_id);}function na(ab){var bb=null;switch(ab.status){case v.MercuryActionStatus.SUCCESS:bb='success';break;case v.MercuryActionStatus.FAILED_UNKNOWN_REASON:bb='confirmed_error';break;case v.MercuryActionStatus.UNABLE_TO_CONFIRM:bb='confirm_error';break;default:return;}ma(ab,bb);}function oa(ab){(ab.message_counts||[]).forEach(function(jb){ea(jb.last_action_id);});(ab.threads||[]).forEach(function(jb){fa(jb);delete ca[jb.thread_id];delete ca[ia(jb.thread_id)];ea(jb.last_action_id);});(ab.ordered_threadlists||[]).forEach(function(jb){jb.thread_ids=jb.thread_ids.map(ka);});ab.actions=ab.actions||[];ab.actions.forEach(function(jb){na(jb);if(jb.status&&jb.status!=v.MercuryActionStatus.SUCCESS&&!jb.thread_id){jb.thread_id=jb.client_thread_id;return;}if(jb.action_type==v.MercuryActionType.SEND_MESSAGE&&jb.client_thread_id&&jb.client_thread_id!=w.PENDING_THREAD_ID)ga(jb.thread_id,jb.client_thread_id);jb.server_thread_id=jb.thread_id;jb.thread_id=ja(jb.thread_id)?ka(jb.thread_id):null;ea(jb.action_id);});if(ab.end_of_history){var bb=[];for(var cb=0;cb<ab.end_of_history.length;cb++){var db=ab.end_of_history[cb];if(db.type=='user'){bb.push('user:'+db.id);}else if(db.type=='thread'&&ja(db.id))bb.push(ka(db.id));}ab.end_of_history=bb;}if(ab.roger){var eb={};for(var fb in ab.roger){var gb=z.getResource(fb);if(gb){var hb=ab.roger[fb];eb[gb]={};for(var ib in hb)eb[gb]['fbid:'+ib]=hb[ib];}}ab.roger=eb;}}function pa(){if(ba&&ba.length){var ab=ba[0];ba=ba.slice(1);xa.handleUpdate(ab);}}function qa(ab,bb){var cb=k({},ab),db;if(bb.threads){if(!cb.threads)cb.threads={};for(db in bb.threads)cb.threads[db]=Object.keys(t((cb.threads[db]||[]).concat(bb.threads[db])));}if(bb.messages){if(!cb.messages)cb.messages={};for(db in bb.messages){if(!cb.messages[db])cb.messages[db]={};for(var eb in bb.messages[db])if(cb.messages[db][eb]){cb.messages[db][eb]=ta(cb.messages[db][eb],bb.messages[db][eb]);}else cb.messages[db][eb]=bb.messages[db][eb];}}return cb;}function ra(ab,bb){var cb=k(t(ab.folders,true),t(bb.folders,true));return {folders:Object.keys(cb)};}function sa(ab,bb){for(var cb in bb)if(ab[cb]){ab[cb]=ta(ab[cb],bb[cb]);}else{var db={};k(db,bb[cb]);ab[cb]=db;}return ab;}function ta(ab,bb){var cb=ab.offset<bb.offset?ab.offset:bb.offset,db=ab.offset+ab.limit,eb=bb.offset+bb.limit,fb=(db>eb)?db:eb,gb=fb-cb;return {offset:cb,limit:gb};}function ua(ab,bb){var cb={ids:{}};k(cb.ids,ab.ids);k(cb.ids,bb.ids);return cb;}function va(ab,bb){var cb={},db;for(db in ab)k(cb,t(ab[db],db));for(db in bb)k(cb,t(bb[db],db));var eb={};for(var fb in cb){db=cb[fb];if(!eb[db])eb[db]=[];eb[db].push(fb);}return eb;}function wa(ab,bb){var cb=t(ab.ids,true),db=t(bb.ids,true),eb=k(cb,db);return {ids:Object.keys(eb)};}var xa=k(new g(),{tokenizeThreadID:function(ab){n.isThreadID(ab);return r.tokenize(ab);},getServerThreadID:function(ab,bb){n.isThreadID(ab);ha(ab,bb);},getClientThreadID:function(ab,bb){la(ab,bb);},getClientThreadIDNow:function(ab){return ka(ab);},getServerThreadIDNow:function(ab){return ia(ab);},convertThreadIDIfAvailable:function(ab){var bb=z.getResource(ab);if(bb===undefined){return ab;}else return bb;},canLinkExternally:function(ab){n.isThreadID(ab);var bb=xa.tokenizeThreadID(ab);return (bb.type=='user')||!!ia(ab);},fetchThreadlistInfo:function(ab,bb,cb){cb=cb||v.MessagingTag.INBOX;var db={};db[cb]={offset:ab,limit:bb};p.trySend('/ajax/mercury/threadlist_info.php',db);},fetchUnseenThreadIDs:function(ab){this.fetchThreadlistInfo(v.MercuryThreadlistConstants.RECENT_THREAD_OFFSET,v.MercuryThreadlistConstants.JEWEL_THREAD_COUNT,ab);},fetchUnreadThreadIDs:function(ab){p.trySend('/ajax/mercury/unread_threads.php',{folders:[ab]});},fetchMissedMessages:function(ab){p.trySend('/ajax/mercury/thread_sync.php',{last_action_id:x,folders:ab});},fetchThreadData:function(ab){n.allThreadID(ab);var bb={threads:{}},cb=[],db=[],eb=[],fb=[];ab.forEach(function(hb){if(ca[hb])return;ca[hb]=true;var ib=ia(hb);if(ib){db.push(ib);bb.threads.thread_ids=db;}else{var jb=xa.tokenizeThreadID(hb);if(jb.type=='user'){cb.push(jb.value);bb.threads.user_ids=cb;}else if(jb.type=='group'){eb.push(jb.value);bb.threads.group_ids=eb;}else if(jb.type=='thread'){db.push(jb.value);bb.threads.thread_ids=db;}else if(jb.type!='root'&&jb.type!='email'&&jb.type!='pending')throw new Error('Unknown thread type',jb);}});this.inform("fetch-thread-data",bb);for(var gb in bb.threads){p.trySend('/ajax/mercury/thread_info.php',bb);break;}},ensureThreadIsFetched:function(ab){if(!z.getResource(ab)&&!ca[ab]){ca[ab]=true;p.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[ab]}});}},fetchThreadMessages:function(ab,bb,cb,db){n.isThreadID(ab);var eb,fb,gb=xa.tokenizeThreadID(ab),hb=ia(ab);if(hb&&gb.type!='group'){fb='thread_ids';eb=hb;}else{eb=gb.value;switch(gb.type){case 'user':fb='user_ids';break;case 'group':fb='group_ids';break;case 'thread':fb='thread_ids';break;}}var ib={messages:{}};if(fb){ib.messages[fb]={};ib.messages[fb][eb]={offset:bb,limit:cb};p.trySend('/ajax/mercury/thread_info.php',ib,db);}else ha(ab,function(jb){ib.messages.thread_ids={};ib.messages.thread_ids[jb]={offset:bb,limit:cb};p.trySend('/ajax/mercury/thread_info.php',ib,db);});},handleThreadInfoError:function(ab){var bb=ab.getRequest().getData(),cb=[];if(bb.messages){for(var db in bb.messages.thread_ids)cb.push(ya(ka(db)));for(var eb in bb.messages.user_ids)cb.push(ya('user:'+eb));for(var fb in bb.messages.group_ids)cb.push(ya('group:'+fb));}if(cb.length)xa.handleUpdate({actions:cb,from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});if(bb.threads&&(bb.threads.user_ids||bb.threads.group_ids||bb.threads.thread_ids)&&!bb.is_retry){if(bb.messages)delete bb.messages;y.log('retry_thread',bb);bb.is_retry=true;p.trySend('/ajax/mercury/thread_info.php',bb);}},markFolderAsRead:function(ab){p.trySend('/ajax/mercury/mark_folder_as_read.php',{folder:ab});var bb=[{action_type:v.MercuryGlobalActionType.MARK_ALL_READ,action_id:null,folder:ab}];this.handleUpdate({global_actions:bb,from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CHANGE_READ_STATUS});},changeThreadReadStatus:function(ab,bb,cb){n.isThreadID(ab);ha(ab,function(eb){var fb={ids:{}};fb.ids[eb]=bb;p.trySend('/ajax/mercury/change_read_status.php',fb);});var db=[{action_type:v.MercuryActionType.CHANGE_READ_STATUS,action_id:null,thread_id:ab,mark_as_read:bb,folder:cb}];this.handleUpdate({actions:db,from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CHANGE_READ_STATUS});},changeThreadArchivedStatus:function(ab,bb){n.isThreadID(ab);ha(ab,function(eb){var fb={ids:{}};fb.ids[eb]=bb;p.trySend('/ajax/mercury/change_archived_status.php',fb);});var cb={action_type:v.MercuryActionType.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ab,archived:bb},db={actions:[cb],from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CHANGE_ARCHIVED_STATUS};this.handleUpdate(db);},changeThreadFolder:function(ab,bb){n.isThreadID(ab);ha(ab,function(eb){var fb={};fb[bb]=[eb];p.trySend('/ajax/mercury/move_thread.php',fb);});var cb={action_type:v.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ab,new_folder:bb},db={actions:[cb],from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CHANGE_FOLDER};this.handleUpdate(db);},markThreadSpam:function(ab){n.isThreadID(ab);ha(ab,function(db){p.trySend('/ajax/mercury/mark_spam.php',{id:db});});var bb={action_type:v.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ab,new_folder:v.MessagingTag.SPAM},cb={actions:[bb],from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CHANGE_FOLDER};this.handleUpdate(cb);},unmarkThreadSpam:function(ab){n.isThreadID(ab);ha(ab,function(db){p.trySend('/ajax/mercury/unmark_spam.php',{id:db});});var bb={action_type:v.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:ab,new_folder:v.MessagingTag.INBOX},cb={actions:[bb],from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CHANGE_FOLDER};this.handleUpdate(cb);},deleteThread:function(ab){n.isThreadID(ab);ha(ab,function(db){var eb={ids:[db]};p.trySend('/ajax/mercury/delete_thread.php',eb);});var bb={action_type:v.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:ab},cb={actions:[bb],from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_DELETE_THREAD};this.handleUpdate(cb);},deleteMessages:function(ab,bb,cb){o.getServerIDs(bb||[],function(eb){p.trySend('/ajax/mercury/delete_messages.php',{message_ids:eb});});var db;if(cb){db={action_type:v.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:ab};}else db={action_type:v.MercuryActionType.DELETE_MESSAGES,action_id:null,thread_id:ab,message_ids:bb};this.handleUpdate({actions:[db],from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_DELETE_MESSAGES});},clearChat:function(ab,bb,cb){n.isThreadID(ab);p.trySend('/ajax/chat/settings.php',{clear_history_id:bb});var db=[{action_type:v.MercuryActionType.CLEAR_CHAT,action_id:null,thread_id:ab,clear_time:cb}];this.handleUpdate({actions:db,from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_CLEAR_CHAT});},_batchThreadRead:function(ab,bb){var cb={};k(cb,ab.ids);k(cb,bb.ids);return {ids:cb};},sendNewMessage:function(ab){o.getServerIDs(ab.forward_message_ids||[],function(cb){var db=xa.tokenizeThreadID(ab.thread_id),eb=db.type,fb=k({},ab);fb.forward_message_ids=cb;var gb=ia(ab.thread_id);if((eb=='root'&&db.value==fb.message_id)||((eb=='user'||eb=='email')&&!gb)||(ab.thread_id==w.PENDING_THREAD_ID)){fb.client_thread_id=fb.thread_id;fb.thread_id=null;this._sendNewMessageToServer(fb);}else ha(fb.thread_id,function(hb){fb.thread_id=hb;xa._sendNewMessageToServer(fb);});}.bind(this));if(ab.thread_id!=w.PENDING_THREAD_ID){var bb={actions:[k({},ab)],from_client:true,payload_source:v.MercuryPayloadSource.CLIENT_SEND_MESSAGE};xa.handleUpdate(bb);}},_sendNewMessageToServer:function(ab){p.trySend('/ajax/mercury/send_messages.php',{message_batch:[ab]});},_batchMessageSend:function(ab,bb){return {message_batch:ab.message_batch.concat(bb.message_batch)};},requestMessageConfirmation:function(ab){var bb={},cb={};for(var db in ab){var eb=ia(db);if(eb){bb[eb]=ab[db];}else{var fb=ab[db];for(var gb=0;gb<fb.length;gb++)cb[fb[gb]]=db;}}var hb=Object.keys(bb),ib=Object.keys(cb);if(hb.length||ib.length)p.trySend('/ajax/mercury/confirm_messages.php',{thread_message_map:bb,local_messages:cb});},handleMessageConfirmError:function(ab){var bb=ab.getRequest().getData().thread_message_map,cb=ab.getRequest().getData().local_messages;if(!bb&&!cb)return;var db=[];for(var eb in bb){var fb=bb[eb];fb.forEach(function(ib){db.push({action_type:v.MercuryActionType.SEND_MESSAGE,client_message_id:ib,message_id:ib,client_thread_id:null,thread_id:eb,status:v.MercuryActionStatus.UNABLE_TO_CONFIRM});});}for(var gb in cb){var hb=cb[gb];db.push({action_type:v.MercuryActionType.SEND_MESSAGE,client_message_id:gb,message_id:gb,client_thread_id:hb,thread_id:null,status:v.MercuryActionStatus.UNABLE_TO_CONFIRM});}if(db.length)this.handleUpdate({actions:db,payload_source:v.MercuryPayloadSource.CLIENT_HANDLE_ERROR});},markSeen:function(){var ab=j.convertActionIDToTimestamp(x);p.trySend('/ajax/mercury/mark_seen.php',{seen_timestamp:ab});},_batchMarkSeen:function(ab,bb){return bb;},handleRoger:function(ab){var bb=ab.tid?z.getResource(ab.tid):('user:'+ab.reader);if(bb){var cb={};cb[bb]={};cb[bb]['fbid:'+ab.reader]=ab.time;this.inform('update-roger',cb);}},handleUpdateWaitForThread:function(ab,bb){var cb=z.getResource(bb);if(cb){xa.handleUpdate(ab);return;}z.executeOrEnqueue(bb,function(){ba.push(ab);});if(!ca[bb]){ca[bb]=true;p.trySend('/ajax/mercury/thread_info.php',{threads:{thread_ids:[bb]}});}},handleUpdate:function(ab){y.debug('handle_update',{payload:ab,from_client:ab.from_client});for(var bb in ab){q.synchronizeInforms(function(){if(!ab.from_client){oa(ab);this.inform('payload-preprocessed',ab);}this.inform('update-thread-ids',da);da={};this.inform('update-participants',ab);this.inform('update-threads',ab);this.inform('update-unread',ab);this.inform('update-threadlist',ab);this.inform('update-messages',ab);this.inform('update-unseen',ab);this.inform('update-typing-state',ab);this.inform('update-roger',ab.roger);this.inform('model-update-completed',null);pa();}.bind(this));break;}},_handleSendMessageErrorCommon:function(ab,bb){var cb=ab.getPayload(),db=ab.getRequest().getData(),eb=db.message_batch;if(!eb){ma({action_type:v.MercuryActionType.SEND_MESSAGE,status:v.MercuryActionStatus.REQUEST_EMPTY_MESSAGE_LIST});return;}var fb,gb=null;if(cb&&cb.error_payload){fb=v.MercuryActionStatus.UNCONFIRMED;gb='send_error';}else{gb=bb==v.MercuryActionStatus.REQUEST_ERROR?'request_error':'transport_error';if(ab.getError())gb+='_'+ab.getError();fb=bb;}var hb=eb.map(function(jb){return {action_type:v.MercuryActionType.SEND_MESSAGE,client_message_id:jb.message_id,message_id:jb.message_id,client_thread_id:jb.client_thread_id,thread_id:jb.thread_id,status:fb};});hb.forEach(function(jb){ma(jb,gb);});var ib={actions:hb,payload_source:v.MercuryPayloadSource.CLIENT_HANDLE_ERROR};this.handleUpdate(ib);},handleSendMessageError:function(ab){if(ab.error===1404074)h.verboseErrorHandler(ab);this._handleSendMessageErrorCommon(ab,v.MercuryActionStatus.REQUEST_ERROR);},handleSendMessageTransportError:function(ab){this._handleSendMessageErrorCommon(ab,v.MercuryActionStatus.TRANSPORT_ERROR);},getLastActionID:function(){return x;}});function ya(ab){return {action_type:v.MercuryActionType.LOG_MESSAGE,thread_id:ab,message_id:ab,timestamp:(new Date()).getTime(),timestamp_absolute:'',timestamp_relative:'',is_unread:false,source:v.MercurySourceType.UNKNOWN,log_message_type:v.MercuryLogMessageType.SERVER_ERROR,log_message_data:{}};}var za=xa.handleUpdate.bind(xa);p.registerEndpoints({'/ajax/mercury/thread_sync.php':{mode:p.IDEMPOTENT,handler:za},'/ajax/mercury/thread_info.php':{mode:p.BATCH_DEFERRED_MULTI,batch_function:qa,handler:za,error_handler:xa.handleThreadInfoError.bind(xa)},'/ajax/mercury/mark_folder_as_read.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/change_read_status.php':{mode:p.BATCH_SUCCESSIVE,batch_function:xa._batchThreadRead,handler:za},'/ajax/mercury/send_messages.php':{mode:p.BATCH_SUCCESSIVE,batch_function:xa._batchMessageSend,handler:za,error_handler:xa.handleSendMessageError.bind(xa),transport_error_handler:xa.handleSendMessageTransportError.bind(xa)},'/ajax/mercury/mark_seen.php':{mode:p.BATCH_SUCCESSIVE,batch_function:xa._batchMarkSeen,handler:za},'/ajax/mercury/confirm_messages.php':{mode:p.IMMEDIATE,handler:za,error_handler:xa.handleMessageConfirmError.bind(xa)},'/ajax/mercury/threadlist_info.php':{mode:p.BATCH_SUCCESSIVE_UNIQUE,batch_function:sa,handler:za},'/ajax/mercury/mark_spam.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/unmark_spam.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/unread_threads.php':{mode:p.BATCH_SUCCESSIVE_UNIQUE,batch_function:ra,handler:za},'/ajax/chat/settings.php':{mode:p.IMMEDIATE},'/ajax/mercury/change_archived_status.php':{mode:p.BATCH_SUCCESSIVE,batch_function:ua,handler:za},'/ajax/mercury/delete_thread.php':{mode:p.BATCH_SUCCESSIVE,batch_function:wa,handler:za},'/ajax/mercury/delete_messages.php':{mode:p.IMMEDIATE,handler:za},'/ajax/mercury/move_thread.php':{mode:p.BATCH_SUCCESSIVE,batch_function:va,handler:za}});e.exports=xa;});
__d("MercuryParticipants",["Env","JSLogger","MercuryAssert","MercuryIDs","ShortProfiles","MercuryServerRequests","copyProperties","getObjectValues","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Env'),h=b('JSLogger'),i=b('MercuryAssert'),j=b('MercuryIDs'),k=b('ShortProfiles'),l=b('MercuryServerRequests'),m=b('copyProperties'),n=b('getObjectValues'),o=c('MercuryConstants'),p='fbid:'+g.user,q={},r=h.create('mercury_participants'),s=function(v){if(!q[v.id])q[v.id]=m({},v);};function t(v){i.isEmailParticipantID(v);var w=j.tokenize(v),x=w.value;return {gender:o.MercuryParticipantsConstants.UNKNOWN_GENDER,href:null,id:v,image_src:o.MercuryParticipantsConstants.EMAIL_IMAGE,name:x,short_name:x,employee:false,call_promo:false};}var u={user:p,getNow:function(v){return q[v];},get:function(v,w){i.isParticipantID(v);this.getMulti([v],function(x){w(x[v]);});},getMulti:function(v,w){i.allParticipantIDs(v);var x={},y={};v.forEach(function(aa){if(q[aa]){x[aa]=m({},q[aa]);}else{var ba=j.tokenize(aa);if(ba.type=='fbid'){var ca=ba.value;y[aa]=ca;}else if(ba.type=='email')x[aa]=t(aa);}});var z=n(y);if(z.length){k.getMulti(z,function(aa){for(var ba in y){var ca=y[ba],da=aa[ca];x[ba]={gender:da.gender,href:da.uri,id:ba,image_src:da.thumbSrc,name:da.name,short_name:da.firstName,employee:da.employee,call_promo:da.showVideoPromo};}w(x);});}else w(x);},getUserID:function(v){if(!j.isValid(v))return null;var w=j.tokenize(v);if(w.type!='fbid')return null;return w.value;},getIDForUser:function(v){return 'fbid:'+v;},addParticipants:function(v){v.forEach(s);}};l.subscribe('update-participants',function(v,w){u.addParticipants(w.participants||[]);});e.exports=u;});
__d("MercuryFolders",["array-extensions","MercuryConstants"],function(a,b,c,d,e,f){b('array-extensions');var g=c('MercuryConstants'),h=[g.MessagingTag.INBOX,g.MessagingTag.OTHER,g.MessagingTag.ACTION_ARCHIVED,g.MessagingTag.SPAM],i={getSupportedFolders:function(){return h.concat();},isSupportedFolder:function(j){return h.contains(j);},getFromMeta:function(j){var k=j.folder;if(j.is_archived)k=g.MessagingTag.ACTION_ARCHIVED;return k;}};e.exports=i;});
__d("MercuryAttachment",["startsWith","MercuryConstants"],function(a,b,c,d,e,f){var g=b('startsWith'),h=c('MercuryConstants'),i={getAttachIconClass:function(j){switch(j){case h.MercuryAttachmentContentType.PHOTO:return 'MercuryPhotoIcon';case h.MercuryAttachmentContentType.VIDEO:return 'MercuryVideoIcon';case h.MercuryAttachmentContentType.MUSIC:return 'MercuryMusicIcon';case h.MercuryAttachmentContentType.TEXT:return 'MercuryTextIcon';}return 'MercuryDefaultIcon';},getAttachIconClassByMime:function(j){if(g(j,'image')){return 'MercuryPhotoIcon';}else if(g(j,'video')){return 'MercuryVideoIcon';}else if(g(j,'audio')){return 'MercuryMusicIcon';}else if(g(j,'text/plain')){return 'MercuryTextIcon';}else return 'MercuryDefaultIcon';},getAttachTypeByMime:function(j){if(g(j,'image')){return h.MercuryAttachmentContentType.PHOTO;}else if(g(j,'video')){return h.MercuryAttachmentContentType.VIDEO;}else if(g(j,'audio')){return h.MercuryAttachmentContentType.MUSIC;}else if(g(j,'text/plain')){return h.MercuryAttachmentContentType.TEXT;}else return h.MercuryAttachmentContentType.UNKNOWN;},convertRaw:function(j){var k=[];for(var l=0;l<j.length;l++){var m=j[l];if(m.filename){var n={};n.attach_type=h.MercuryAttachmentType.FILE;n.name=m.filename;n.icon_type=i.getAttachTypeByMime(m.filetype);n.url='#';k.push(n);}}return k;}};e.exports=i;});
__d("MercuryTimestampTracker",["MercuryServerRequests","MercuryConstants"],function(a,b,c,d,e,f){var g=b('MercuryServerRequests'),h=c('MercuryConstants'),i=0;e.exports={getLastUserMessageTimestamp:function(){return i;}};g.subscribe('update-messages',function(j,k){if(!k.actions||!k.actions.length)return;var l=h.MercuryPayloadSource;if(k.payload_source==l.CLIENT_SEND_MESSAGE||k.payload_source==l.UNKNOWN)return;for(var m=0;m<k.actions.length;m++){var n=k.actions[m],o=n.action_type;if(o==h.MercuryActionType.USER_GENERATED_MESSAGE&&n.thread_id&&n.timestamp>i)i=n.timestamp;}});});
__d("MercuryThreads",["Arbiter","copyProperties","JSLogger","createObjectFrom","KeyedCallbackManager","TimestampConverter","MercuryFolders","MercuryAssert","MercuryAttachment","MercuryIDs","MercuryServerRequests","MercuryThreadInformer","MercuryTimestampTracker","MercuryParticipants","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('JSLogger'),j=b('createObjectFrom'),k=b('KeyedCallbackManager'),l=b('TimestampConverter'),m=b('MercuryFolders'),n=b('MercuryAssert'),o=b('MercuryAttachment'),p=b('MercuryIDs'),q=b('MercuryServerRequests'),r=b('MercuryThreadInformer'),s=b('MercuryTimestampTracker'),t=b('MercuryParticipants'),u=c('MercuryConstants'),v=i.create('mercury_threads'),w=new k();function x(ha,ia){var ja=j(ha.participants,true),ka=t.user;ia.forEach(function(la){if(ja[la]!==true){ha.participants.push(la);if(la===ka)ha.is_subscribed=true;}});}function y(ha,ia){ha.participants.remove(ia);if(ia===t.user)ha.is_subscribed=false;}function z(ha,ia){if(ha.participants[0]!=ia){ha.participants.remove(ia);ha.participants.unshift(ia);}}function aa(ha,ia){var ja=ia.body,ka=ia.subject,la='';if(ka){ka=ka.toLowerCase();if(ja.slice(0,ka.length).toLowerCase()==ka){la=ja;}else if(ja){la=ka+' \u00B7 '+ja;}else la=ka;}else la=ja;ha.snippet=la;ha.snippet_has_attachment=ia.has_attachment;if(ia.raw_attachments&&ia.raw_attachments.length>0){var ma=o.convertRaw(ia.raw_attachments);ha.snippet_attachments=ma;}else ha.snippet_attachments=ia.attachments;ha.is_forwarded_snippet=!!ia.forward_count;}function ba(ha,ia){if(!ha)return false;var ja=!ha.unread_count;if(ia==ja)return false;ha.unread_count=ia?0:1;w.setResource(ha.thread_id,ha);r.updatedThread(ha.thread_id);return true;}function ca(ha){var ia=w.getAllResources();for(var ja in ia){var ka=ia[ja];if(ka.folder==ha){ka.unread_count=0;w.setResource(ja,ka);r.updatedThread(ja);}}}function da(ha,ia){if(!ha||ha.chat_clear_time===ia)return false;ha.chat_clear_time=ia;w.setResource(ha.thread_id,ha);r.reorderedMessages(ha.thread_id);return true;}function ea(ha,ia,ja){var ka=ia.action_type;if(ka==u.MercuryActionType.USER_GENERATED_MESSAGE||ka==u.MercuryActionType.LOG_MESSAGE){ia.is_unread&&ha.unread_count++;ha.is_archived=false;}switch(ka){case u.MercuryActionType.USER_GENERATED_MESSAGE:z(ha,ia.author);break;case u.MercuryActionType.LOG_MESSAGE:var la=ia.log_message_type;if(la==u.MercuryLogMessageType.SUBSCRIBE){x(ha,ia.log_message_data.added_participants);}else if(la==u.MercuryLogMessageType.UNSUBSCRIBE){y(ha,ia.author);}else if(la==u.MercuryLogMessageType.THREAD_IMAGE){ha.image_src=ia.log_message_data.image?ia.log_message_data.image.preview_url:null;}else if(la==u.MercuryLogMessageType.THREAD_NAME)ha.name=ia.log_message_data.name;break;case u.MercuryActionType.CHANGE_READ_STATUS:if(ia.timestamp)r.changedThreadReadState(ha.thread_id,ia.mark_as_read,ia.timestamp);ba(ha,ia.mark_as_read);break;case u.MercuryActionType.CLEAR_CHAT:da(ha,ia.clear_time);break;case u.MercuryActionType.CHANGE_ARCHIVED_STATUS:ha.is_archived=ia.archived;break;case u.MercuryActionType.CHANGE_FOLDER:ha.folder=ia.new_folder;break;case u.MercuryActionType.DELETE_MESSAGES:if(ja){ha.snippet='...';ha.snippet_has_attachment=false;ha.snippet_attachments=null;ha.is_forwarded_snippet=false;r.updatedThread(ia.thread_id);}break;}if(ia.action_id)ha.last_action_id=l.maxValidActionID(ia.action_id,ha.last_action_id);}function fa(ha){var ia=q.tokenizeThreadID(ha.thread_id);if(ia.type=='group'){v.error('invalid_new_thread_message',ha);return undefined;}var ja={thread_id:ha.thread_id,last_action_id:ha.action_id,participants:ha.specific_to_list,name:null,snippet:ha.body,snippet_has_attachment:false,snippet_attachments:[],unread_count:0,image_src:null,timestamp_absolute:ha.timestamp_absolute,timestamp_relative:ha.timestamp_relative,timestamp:ha.timestamp,is_canonical_user:ia.type=='user',is_canonical:ia.type=='user'||ia.type=='email',is_subscribed:true,is_canonical_group:false,is_chatlogger_thread:false,group_id:null,root_message_threading_id:ha.message_id,folder:u.MessagingTag.INBOX,is_archived:false,mode:u.MercuryThreadMode.TITAN_ORIGINATED};w.setResource(ja.thread_id,ja);return ja;}g.subscribe(i.DUMP_EVENT,function(ha,ia){ia.messaging=ia.messaging||{};ia.messaging.threads=w.dumpResources();});var ga={getThreadMetaNow:function(ha){n.isThreadID(ha);return w.getResource(ha);},getThreadMeta:function(ha,ia){n.isThreadID(ha);var ja=w.executeOrEnqueue(ha,ia),ka=w.getUnavailableResources(ja);if(ka.length){var la=q.tokenizeThreadID(ha);if(la.type=='user'){this.getCanonicalThreadToUser(la.value);}else q.fetchThreadData(ka);}return ja;},unsubscribe:function(ha){w.unsubscribe(ha);},changeThreadReadStatus:function(ha,ia){n.isThreadID(ha);var ja=w.getResource(ha);if(ba(ja,ia))q.changeThreadReadStatus(ha,ia,m.getFromMeta(ja));},changeThreadArchivedStatus:function(ha,ia){n.isThreadID(ha);var ja=w.getResource(ha);if(ja.is_archived!=ia){ja.is_archived=ia;r.updatedThread(ja.thread_id);q.changeThreadArchivedStatus(ha,ia);}},markThreadSpam:function(ha){q.markThreadSpam(ha);},unmarkThreadSpam:function(ha){q.unmarkThreadSpam(ha);},changeFolder:function(ha,ia){n.isThreadID(ha);var ja=w.getResource(ha);if(ja&&ja.folder!=ia){ja.folder=ia;r.updatedThread(ja.thread_id);q.changeThreadFolder(ha,ia);}},deleteThread:function(ha){n.isThreadID(ha);q.deleteThread(ha);},updateThreads:function(ha){if(!ha||!ha.length)return;var ia={};ha.forEach(function(ja){ia[ja.thread_id]=ja;});w.addResourcesAndExecute(ia);},updateMetadataByActions:function(ha,ia){if(!ha||!ha.length)return;var ja={},ka={},la={};for(var ma=0;ma<ha.length;ma++){var na=ha[ma];if(na.is_forward)continue;var oa=na.action_type,pa=na.thread_id;n.isThreadID(pa);var qa=this.getThreadMetaNow(pa);if(oa==u.MercuryActionType.LOG_MESSAGE&&na.log_message_type==u.MercuryLogMessageType.SERVER_ERROR)continue;if(!qa&&!na.action_id&&oa==u.MercuryActionType.USER_GENERATED_MESSAGE)qa=fa(na);if(qa){if(oa==u.MercuryActionType.DELETE_THREAD){r.deletedThread(pa);continue;}var ra=!!na.action_id;if(oa==u.MercuryActionType.LOG_MESSAGE||oa==u.MercuryActionType.USER_GENERATED_MESSAGE)ra=!ia;if(na.timestamp<=qa.timestamp&&ra){v.log('ignore_old_timestamp',{action:na,from_client:ia,thread_timestamp:qa.timestamp});continue;}if(!la[pa])la[pa]=h({},qa);ea(la[pa],na,ia);if(oa==u.MercuryActionType.USER_GENERATED_MESSAGE)ja[pa]=na;if(oa==u.MercuryActionType.USER_GENERATED_MESSAGE||oa==u.MercuryActionType.LOG_MESSAGE||oa==u.MercuryActionType.SEND_MESSAGE)if(na&&na.timestamp&&(!ka[pa]||na.timestamp>ka[pa].timestamp))ka[pa]=na;}}for(var sa in la){var ta=la[sa],ua=ja[sa];if(ua)aa(ta,ua);var va=ka[sa],wa=ta.timestamp;if(va&&va.timestamp>wa)ta=h(ta,{timestamp_absolute:va.timestamp_absolute,timestamp_relative:va.timestamp_relative,timestamp:va.timestamp});w.setResource(sa,ta);}},getCanonicalThreadToGroup:function(ha,ia){var ja='group:'+ha;this.getThreadMeta(ja,ia);},getCanonicalThreadToUser:function(ha,ia){return ga.getCanonicalThreadToParticipant('fbid:'+ha,ia);},getCanonicalThreadToParticipant:function(ha,ia){var ja=ga.getThreadIDForParticipant(ha),ka=w.getResource(ja);if(typeof ka=='undefined'){ka=ga.createNewLocalThread(ja,[t.user,ha],ia);q.fetchThreadData([ja]);}return ka;},getThreadIdForUser:function(ha){return 'user:'+ha;},getThreadIdForEmail:function(ha){return 'email:'+ha;},getThreadIDForParticipant:function(ha){var ia=p.tokenize(ha);return ia.type=='fbid'?ga.getThreadIdForUser(ia.value):ga.getThreadIdForEmail(ia.value);},createNewLocalThread:function(ha,ia,ja){var ka=w.getResource(ha);if(!ka){var la=q.tokenizeThreadID(ha);ka={thread_id:ha,last_action_id:null,participants:ia,name:null,snippet:'',snippet_has_attachment:false,unread_count:ja?ja:0,image_src:null,timestamp_absolute:null,timestamp_relative:null,timestamp:null,is_canonical_user:la.type=='user',is_canonical:la.type=='user'||la.type=='email',is_subscribed:true,is_canonical_group:la.type=='group',group_id:(la.type=='group'?la.value:null),root_message_threading_id:null,folder:u.MessagingTag.INBOX,is_archived:false,mode:u.MercuryThreadMode.TITAN_ORIGINATED};ka.is_chatlogger_thread=ka.is_canonical_group;w.setResource(ha,ka);}return ka;},addParticipantsToThreadLocally:function(ha,ia){var ja=w.getResource(ha);if(ja){x(ja,ia);r.updatedThread(ja.thread_id);}},getCanonicalUserInThread:function(ha){var ia=q.tokenizeThreadID(ha);return ia.type=='user'?ia.value:null;},getCanonicalGroupInThread:function(ha){var ia=q.tokenizeThreadID(ha);return ia.type=='group'?ia.value:null;},isEmptyLocalThread:function(ha){var ia=w.getResource(ha);if(!ia)return false;var ja=q.tokenizeThreadID(ha);return ja.type=='root'&&!ia.timestamp;},isMultichatThread:function(ha){var ia=q.tokenizeThreadID(ha).type;return ia!='user'&&ia!='group';}};q.subscribe('update-threads',function(ha,ia){var ja=(ia.actions||[]).filter(function(na){return na.thread_id;});ga.updateThreads(ia.threads);ga.updateMetadataByActions(ja,ia.from_client);(ia.threads||[]).forEach(function(na){r.updatedThread(na.thread_id);});var ka=ia.global_actions||[];for(var la=0;la<ka.length;la++){var ma=ka[la];if(ma.action_type==u.MercuryGlobalActionType.MARK_ALL_READ)ca(ma.folder);}});e.exports=ga;});
__d("MercuryChannelHandler",["Arbiter","ChannelConstants","copyProperties","Env","MessagingReliabilityLogger","MercuryParticipants","PresenceUtil","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ChannelConstants'),i=b('copyProperties'),j=b('Env'),k=b('MessagingReliabilityLogger'),l=b('MercuryParticipants'),m=b('PresenceUtil'),n=b('MercuryServerRequests'),o=b('MercuryThreadInformer'),p=b('MercuryThreads'),q=c('MercuryConstants');function r(ha,ia){var ja=ia.obj.to;p.getCanonicalThreadToGroup(ja,function(ka){var la=ka.thread_id;n.getServerThreadID(la,function(ma){var na=aa(ja,ia.obj.from,ia.obj.msg.time),oa=ia.obj.from!=j.user,pa={obj:{message:{action_id:null,body:ia.obj.msg.text,is_unread:oa,mid:na,mercury_author_id:'fbid:'+ia.obj.from,mercury_source:q.MercurySourceType.CHAT_WEB,sender_fbid:ia.obj.from,tid:ma,timestamp:ia.obj.msg.time,threading_id:ia.obj.sync_id},folder:'group_chat'}};s(h.getArbiterType('messaging'),pa);});});}function s(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj||!ia.obj.message){k.addEntry('channel_receive','invalid_data');return;}var ja=ia.obj.message,ka={author:ja.mercury_author_id,body:ja.body,subject:ja.subject,has_attachment:ja.has_attachment,attachments:ja.attachments,html_body:ja.html_body,thread_id:ja.tid,message_id:ja.mid,source:ja.mercury_source,threading_id:ja.threading_id,timestamp:ja.timestamp,timestamp_absolute:new Date(ja.timestamp).toLocaleString(),action_type:q.MercuryActionType.USER_GENERATED_MESSAGE,is_unread:ja.is_unread,action_id:ja.action_id,is_forward:false,forward_count:ja.forward_count||ja.forward,forward_message_ids:ja.forward_msg_ids,location_text:ja.location_text,folder:ia.obj.folder},la=[i({},ka)];la=la.concat(ja.forward_actions||[]);var ma=q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;n.handleUpdateWaitForThread({actions:la,payload_source:ma},ja.tid);if(!ja.is_unread&&ja.mercury_author_id===l.user){var na={};na[ja.tid]=ia.obj.folder;t(h.getArbiterType('messaging'),{obj:{event:q.MessagingEventTypes.READ,tids:[ja.tid],folder_info:na}});}k.addEntry('channel_receive','success',[ka.thread_id,ka.message_id,m.getSessionID()]);}function t(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj||!ia.obj.tids)return;var ja=[],ka=ia.obj.event==q.MessagingEventTypes.READ;ia.obj.tids.forEach(function(la){ja.push({action_type:q.MercuryActionType.CHANGE_READ_STATUS,action_id:null,thread_id:la,mark_as_read:ka,timestamp:ia.obj.timestamp||0,folder:ia.obj.folder_info[la]});});n.handleUpdate({actions:ja,payload_source:q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function u(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj||!ia.obj.tids)return;var ja=[];ia.obj.tids.forEach(function(ka){ja.push({action_type:q.MercuryActionType.DELETE_THREAD,action_id:null,thread_id:ka});});n.handleUpdate({actions:ja,payload_source:q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function v(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj||!ia.obj.tids||!ia.obj.mids)return;var ja=ia.obj.tids[0],ka={action_type:q.MercuryActionType.DELETE_MESSAGES,action_id:null,thread_id:ja,message_ids:ia.obj.mids};n.handleUpdate({actions:[ka],threads:[ia.obj.updated_thread],payload_source:q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function w(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj||!ia.obj.folder)return;var ja={action_type:q.MercuryGlobalActionType.MARK_ALL_READ,action_id:ia.obj.action_id,folder:ia.obj.folder};n.handleUpdate({global_actions:[ja]});}function x(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj.tids)return;var ja=q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;ia.obj.tids.forEach(function(ka){var la={action_type:q.MercuryActionType.CHANGE_ARCHIVED_STATUS,action_id:null,thread_id:ka,archived:ia.obj.state};n.handleUpdateWaitForThread({actions:[i({},la)],payload_source:ja},ka);});}function y(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj.tids)return;var ja=q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE,ka;ia.obj.tids.forEach(function(la){if(ia.obj.event==q.MessagingEventTypes.TAG){ka=ia.obj.tag;}else ka=ia.obj.marked_as_spam?q.MessagingTag.SPAM:q.MessagingTag.INBOX;var ma={action_type:q.MercuryActionType.CHANGE_FOLDER,action_id:null,thread_id:la,new_folder:ka};n.handleUpdateWaitForThread({actions:[i({},ma)],payload_source:ja},la);});}function z(ha,ia){if(ha!=h.getArbiterType('messaging')||!ia.obj.tag)return;switch(ia.obj.tag){case q.MessagingTag.ACTION_ARCHIVED:x(ha,ia);break;case q.MessagingTag.INBOX:case q.MessagingTag.OTHER:y(ha,ia);break;}}function aa(ha,ia,ja){return ha+':'+ia+':'+ja;}function ba(ha,ia){if(ha!=h.getArbiterType('inbox')||!ia.obj||!ia.obj.seen_timestamp)return;n.handleUpdate({message_counts:[{seen_timestamp:ia.obj.seen_timestamp,folder:q.MessagingTag.INBOX}],unseen_thread_ids:[{thread_ids:[],folder:q.MessagingTag.INBOX}],payload_source:q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE});}function ca(ha,ia){if(ha!=h.getArbiterType('mercury')||!ia.obj)return;o.synchronizeInforms(function(){var ja=ia.obj,ka=[];(ja.actions||[]).forEach(function(la){var ma=q.MercuryActionType.USER_GENERATED_MESSAGE;if(la.action_type==q.MercuryActionType.LOG_MESSAGE){var na=q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;n.handleUpdateWaitForThread({actions:[i({},la)],payload_source:na},la.thread_id);}else if(la.action_type!=ma)ka.push(la);});ja.actions=ka;ja.payload_source=q.MercuryPayloadSource.CLIENT_CHANNEL_MESSAGE;n.handleUpdate(ja);});}function da(ha,ia){n.handleRoger(ia.obj);}function ea(ha,ia){switch(ia.obj.event){case q.MessagingEventTypes.DELIVER:s(ha,ia);break;case q.MessagingEventTypes.READ:case q.MessagingEventTypes.UNREAD:t(ha,ia);break;case q.MessagingEventTypes.READ_ALL:w(ha,ia);break;case q.MessagingEventTypes.DELETE:u(ha,ia);break;case q.MessagingEventTypes.DELETE_MESSAGES:v(ha,ia);break;case q.MessagingEventTypes.TAG:z(ha,ia);break;case q.MessagingEventTypes.REPORT_SPAM:y(ha,ia);break;case q.MessagingEventTypes.READ_RECEIPT:da(ha,ia);break;}}var fa=[],ga={turnOn:function(){if(!fa.length){var ha={mercury:ca,messaging:ea,group_msg:r,inbox:ba};for(var ia in ha)fa.push(g.subscribe(h.getArbiterType(ia),ha[ia]));}},turnOff:function(){if(fa.length){fa.forEach(g.unsubscribe);fa=[];}}};ga.turnOn();e.exports=ga;});
__d("MercuryMessages",["Arbiter","copyProperties","Env","JSLogger","randomInt","tx","KeyedCallbackManager","MercuryAssert","MercuryIDs","MercuryMessageIDs","MercuryParticipants","PresenceUtil","RangedCallbackManager","MercuryServerRequests","MercuryServerDispatcher","MercuryThreadInformer","MercuryThreads","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('Env'),j=b('JSLogger'),k=b('randomInt'),l=b('tx'),m=b('KeyedCallbackManager'),n=b('MercuryAssert'),o=b('MercuryIDs'),p=b('MercuryMessageIDs'),q=b('MercuryParticipants'),r=b('PresenceUtil'),s=b('RangedCallbackManager'),t=b('MercuryServerRequests'),u=b('MercuryServerDispatcher'),v=b('MercuryThreadInformer'),w=b('MercuryThreads'),x=c('MercuryConstants'),y=x.MercuryGenericConstants,z={},aa={},ba={},ca=function(qa){var ra=qa;if(aa[qa])ra=aa[qa];return z[ra];},da={},ea={},fa=new m();function ga(qa){if(qa.status===undefined)qa.status=x.MercuryActionStatus.UNSENT;qa.message_id=qa.message_id||ma.generateNewClientMessageID(qa.timestamp);var ra=q.user;qa.specific_to_list=qa.specific_to_list||[];if(qa.specific_to_list.length&&qa.specific_to_list.indexOf(ra)===-1)qa.specific_to_list.push(ra);if(!qa.thread_id){if(qa.specific_to_list.length==1){qa.thread_id='user:'+i.user;}else if(qa.specific_to_list.length==2){var sa=qa.specific_to_list[0]==ra?qa.specific_to_list[1]:qa.specific_to_list[0];if(o.tokenize(sa).type=='email'){qa.thread_id=y.PENDING_THREAD_ID;}else qa.thread_id=w.getThreadIDForParticipant(sa);}qa.thread_id=qa.thread_id||'root:'+qa.message_id;}if(!qa.specific_to_list.length){var ta=t.tokenizeThreadID(qa.thread_id);if(ta.type=='user')qa.specific_to_list=['fbid:'+ta.value,ra];}}function ha(qa,ra,sa){var ta=(new Date()).getTime(),ua={action_type:qa,thread_id:sa,author:q.user,timestamp:ta,timestamp_absolute:(new Date(ta)).toLocaleString(),timestamp_relative:"a few seconds ago",is_unread:false,is_cleared:false,is_forward:false,source:ra};return ua;}function ia(qa){switch(qa){case x.MercuryPayloadSource.UNKNOWN:case x.MercuryPayloadSource.SERVER_INITIAL_DATA:case x.MercuryPayloadSource.SERVER_FETCH_THREAD_INFO:case x.MercuryPayloadSource.SERVER_THREAD_SYNC:return true;}return false;}function ja(qa){return qa&&qa.substr(0,6)==='server';}function ka(qa){if(!da[qa])da[qa]=new s(function(ra){return ca(ra).timestamp;},function(ra,sa){return sa-ra;});return da[qa];}g.subscribe(j.DUMP_EVENT,function(qa,ra){var sa={};for(var ta in z){var ua=z[ta],va=ua.thread_id;sa[va]=sa[va]||{};sa[va][ua.message_id]=h({},ua);}ra.messaging=ra.messaging||{};ra.messaging.local_message_ids=h({},aa);ra.messaging.messages=sa;});function la(qa,ra){qa.forEach(function(sa){var ta=ka(sa);ta.setReachedEndOfArray();v.reorderedMessages(sa,ra);});}var ma={getMessagesFromIDs:function(qa){return (qa||[]).map(ca).filter(function(ra){return ra;});},hasLoadedNMessages:function(qa,ra){var sa=ka(qa);return sa.hasReachedEndOfArray()||sa.getCurrentArraySize()>=ra;},getThreadMessagesRangeImmediately:function(qa,ra,sa,ta){return this.getThreadMessagesRange(qa,ra,sa,ta,u.IMMEDIATE);},getThreadMessagesRange:function(qa,ra,sa,ta,ua){var va=ka(qa),wa=function(bb){ta(na(bb));},xa=va.executeOrEnqueue(ra,sa,wa),ya=va.getUnavailableResources(xa),za=ba[qa];if(ya.length&&!za){var ab=ea[qa]||0;t.fetchThreadMessages(qa,ab,ya.length,ua);}else ba[qa]=false;return xa;},getThreadMessagesSinceTimestamp:function(qa,ra){var sa=ka(qa),ta=sa.getElementsUntil(ra);return na(ta);},hasLoadedAllMessages:function(qa){return ka(qa).hasReachedEndOfArray();},unsubscribe:function(qa,ra){n.isThreadID(ra);var sa=ka(ra);sa.unsubscribe(qa);},handleUpdates:function(qa,ra,sa){var ta={},ua={},va=x.MercuryActionStatus;for(var wa=0;wa<qa.length;wa++){var xa=qa[wa];if(xa.is_forward||sa==x.MercuryPayloadSource.SERVER_SEARCH){if(!z[xa.message_id])z[xa.message_id]=xa;continue;}var ya=xa.action_type;if(ya==x.MercuryActionType.SEND_MESSAGE){var za=xa.client_message_id;if(za&&aa[za]&&xa.status){if(xa.status==va.UNCONFIRMED){if(!ua[xa.thread_id])ua[xa.thread_id]=[];ua[xa.thread_id].push(xa.client_message_id);}else if(!ta[xa.thread_id])ta[xa.thread_id]=[];var ab=ca(xa.client_message_id),bb=ab.status;ab.status=xa.status;if(xa.status==va.SUCCESS){this.updateLocalMessage(xa,sa);if(xa.client_thread_id==y.PENDING_THREAD_ID){ab.thread_id=xa.thread_id;ta[xa.thread_id].push(ab.message_id);fa.setResource(ab.message_id,ab.thread_id);}}if(typeof bb!='undefined'||xa.status==va.REQUEST_ERROR||xa.status==va.TRANSPORT_ERROR||xa.status==va.FAILED_UNKNOWN_REASON||xa.status==va.UNABLE_TO_CONFIRM||xa.status==va.SUCCESS)v.updatedMessage(xa.thread_id,ca(xa.client_message_id).message_id,sa);}continue;}else if(ya==x.MercuryActionType.DELETE_THREAD){ka(xa.thread_id).removeAllResources();continue;}else if(ya==x.MercuryActionType.DELETE_MESSAGES){var cb=xa.message_ids.map(function(kb){return ca(kb).message_id;}),db=ka(xa.thread_id);db.removeResources(cb);v.reorderedMessages(xa.thread_id,sa);continue;}else if(ya==x.MercuryActionType.LOG_MESSAGE){if(xa.log_message_type==x.MercuryLogMessageType.SERVER_ERROR)ba[xa.thread_id]=true;}else if(ya==x.MercuryActionType.CLEAR_CHAT){var eb=ka(xa.thread_id).getAllResources();eb.map(ca).forEach(function(kb){kb.is_cleared=true;});continue;}var fb=ca(xa.message_id);if((xa.threading_id&&aa[xa.threading_id])||(fb&&!fb.is_forward))continue;if(!ta[xa.thread_id])ta[xa.thread_id]=[];ta[xa.thread_id].push(xa.message_id);z[xa.message_id]=xa;if(xa.threading_id&&xa.threading_id!=xa.message_id)p.addServerID(xa.threading_id,xa.message_id);if(!ra)v.receivedMessage(xa);}for(var gb in ta){var db=ka(gb),hb=db.getAllResources(),ib=hb.filter(function(kb){var lb=z[kb];return lb.action_type==x.MercuryActionType.LOG_MESSAGE&&lb.log_message_type==x.MercuryLogMessageType.SERVER_ERROR;});db.removeResources(ib);oa(gb,ta[gb]);if(ra){db.addResources(ta[gb]);v.reorderedMessages(gb,sa);}else db.addResourcesWithoutSorting(ta[gb].reverse(),0);v.updatedThread(gb);}var jb=Object.keys(ua);if(jb.length)t.requestMessageConfirmation(ua);},sendMessage:function(qa,ra){ra=ra||Function.prototype;ga(qa);aa[qa.message_id]=qa.message_id;t.sendNewMessage(qa);if(qa.thread_id==y.PENDING_THREAD_ID){z[qa.message_id]=qa;return fa.executeOrEnqueue(qa.message_id,ra);}else ra(qa.thread_id);},unsubscribeSend:function(qa){fa.unsubscribe(qa);},resendMessage:function(qa){var ra=h({},qa);ra.status=x.MercuryActionStatus.RESENDING;ra.timestamp=(new Date()).getTime();ra.message_id=ma.generateNewClientMessageID(ra.timestamp);var sa=ka(qa.thread_id);sa.removeResources([qa.message_id]);this.sendMessage(ra);v.reorderedMessages(qa.thread_id,x.MercuryPayloadSource.CLIENT_SEND_MESSAGE);},deleteMessages:function(qa,ra){if(ra.length){var sa=ka(qa),ta=sa.getCurrentArraySize()==ra.length&&sa.hasReachedEndOfArray();t.deleteMessages(qa,ra,ta);}},updateLocalMessage:function(qa,ra){var sa=qa.message_id,ta=qa.client_message_id;aa[ta]=sa;z[sa]=z[ta];p.addServerID(ta,sa);z[ta]={};if(qa.timestamp)ca(ta).timestamp=qa.timestamp;if(qa.attachments&&qa.attachments.length){ca(ta).raw_attachments=null;ca(ta).attachments=qa.attachments;}},constructUserGeneratedMessageObject:function(qa,ra,sa,ta){var ua=ha(x.MercuryActionType.USER_GENERATED_MESSAGE,ra,sa);ua.body=qa;ua.has_attachment=false;ua.html_body=false;ua.attachments=[];ua.specific_to_list=ta||[];return ua;},constructLogMessageObject:function(qa,ra,sa,ta){var ua=ha(x.MercuryActionType.LOG_MESSAGE,qa,ra);ua.log_message_type=sa;ua.log_message_data=ta;return ua;},generateNewClientMessageID:function(qa){var ra=qa+':'+(k(0,4294967295)+1)+'-'+r.getSessionID();return '<'+ra+'@mail.projektitan.com>';}};t.subscribe('update-messages',function(qa,ra){var sa=(ra.actions||[]).filter(function(ua){var va=ua.action_type;return (ua.is_forward||ua.thread_id)&&(va==x.MercuryActionType.LOG_MESSAGE||va==x.MercuryActionType.USER_GENERATED_MESSAGE||va==x.MercuryActionType.SEND_MESSAGE||va==x.MercuryActionType.CLEAR_CHAT||va==x.MercuryActionType.DELETE_THREAD||va==x.MercuryActionType.DELETE_MESSAGES);}),ta=ia(ra.payload_source);if(ja(ra.payload_source))sa.forEach(function(ua){if(!ua.is_forward){var va=w.getThreadMetaNow(ua.thread_id);if(va)ua.is_cleared=ua.timestamp<va.chat_clear_time;}});ma.handleUpdates(sa,ta,ra.payload_source);if(ra.end_of_history)la(ra.end_of_history,ra.payload_source);});function na(qa){var ra=qa.map(ca);return ra.reverse();}function oa(qa,ra){var sa=ra.filter(function(ta){return pa(ca(ta));});if(!ea[qa])ea[qa]=0;ea[qa]+=sa.length;}function pa(qa){var ra=qa.action_type;if(ra==x.MercuryActionType.USER_GENERATED_MESSAGE)return true;switch(qa.log_message_type){case x.MercuryLogMessageType.SUBSCRIBE:case x.MercuryLogMessageType.UNSUBSCRIBE:case x.MercuryLogMessageType.SERVER_ERROR:case x.MercuryLogMessageType.LIVE_LISTEN:return false;default:return true;}}e.exports=ma;});
__d("MercuryRoger",["ArbiterMixin","MercuryServerRequests","LiveTimer","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('MercuryServerRequests'),i=b('LiveTimer'),j=b('copyProperties'),k={},l={getSeenBy:function(m){if(!m)return [];var n=[],o=k[m.thread_id];for(var p in o)if(o[p]>m.timestamp&&p!=m.author)n.push(p);return n;},getSeenTimestamp:function(m,n){var o=k[m];return o?o[n]:null;}};j(l,g);h.subscribe('update-roger',function(m,n){for(var o in n){if(!k[o])k[o]={};for(var p in n[o]){var q=k[o][p],r=n[o][p];if(!q||r>q)k[o][p]=r;}}if(n)l.inform('state-changed',n);});e.exports=l;});
__d("MercuryUnseenState",["Arbiter","copyProperties","TimestampConverter","KeyedCallbackManager","JSLogger","createObjectFrom","MercuryServerRequests","MercuryThreadInformer","MercuryConstants"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('TimestampConverter'),j=b('KeyedCallbackManager'),k=b('JSLogger'),l=b('createObjectFrom'),m=b('MercuryServerRequests'),n=b('MercuryThreadInformer'),o=c('MercuryConstants'),p=o.MercuryThreadlistConstants.MAX_UNSEEN_COUNT,q=0,r=0,s=false,t=new j(),u='unseen_thread_hash',v='unseen_thread_list',w=k.create('mercury_unseen_state'),x={getUnseenCount:function(){if(this.exceedsMaxCount()){w.error('unguarded_unseen_count_fetch',{});return 0;}return ba();},exceedsMaxCount:function(){return s||(ba()>p);},markAsSeen:function(){if(ba()>0||s){m.markSeen();da(i.convertActionIDToTimestamp(m.getLastActionID()),[]);}},markThreadSeen:function(ka,la){var ma={};ma[ka]=null;fa(ma,la);}};function y(ka){t.setResource(u,ka);t.setResource(v,Object.keys(ka));}function z(ka){var la=t.executeOrEnqueue(u,ka),ma=t.getUnavailableResources(la);if(ma.length)m.fetchUnseenThreadIDs();}function aa(){return t.getResource(u);}function ba(){var ka=t.getResource(v);if(ka){return ka.length;}else return q;}function ca(ka){var la=ja(ka);if(ka.unseen_thread_ids){ka.unseen_thread_ids.forEach(function(wa){if(wa.folder!=o.MessagingTag.INBOX)return;var xa=ha(wa.thread_ids),ya=r;if(la&&la.seen_timestamp)ya=la.seen_timestamp;da(ya,xa);if(la&&la.unseen_count>p)s=true;});}else if(la&&la.seen_timestamp){r=la.seen_timestamp;if(la.unseen_count>p){s=true;y({});}else{q=la.unseen_count;if(q===0)y({});}}else{if(s)return;var ma=ka.actions;if(!ma||!(ma.length))return;var na={},oa={};for(var pa=0;pa<ma.length;pa++){var qa=ma[pa];if(qa.is_forward)continue;var ra=qa.action_type,sa=qa.action_id,ta=qa.thread_id?qa.thread_id:qa.server_thread_id,ua=qa.folder===undefined||qa.folder==o.MessagingTag.INBOX;if(!ua)continue;if(ra==o.MercuryActionType.USER_GENERATED_MESSAGE||ra==o.MercuryActionType.LOG_MESSAGE){var va=i.isGreaterThan(sa,na[ta]);if(qa.is_unread&&(!na[ta]||va))na[ta]=sa;}else if(ra==o.MercuryActionType.CHANGE_READ_STATUS&&qa.mark_as_read)oa[ta]=sa;}ea(na);fa(oa);}}function da(ka,la){var ma=aa();if(ma===undefined||ka>r||s){r=ka;la=la||[];if(la.length<=p)s=false;var na={},oa=aa()||{};for(var pa in oa)if(oa[pa]!==true){var qa=oa[pa];if(ga(qa))na[pa]=qa;}var ra=h(l(la,true),na);y(ra);n.updatedUnseenState();}}function ea(ka){if(s)return;var la={},ma=false;for(var na in ka){var oa=ka[na];if(ga(oa)){la[na]=oa;ma=true;}}if(!ma)return;z(function(pa){for(var qa in la){var ra=la[qa];if(!pa[qa]&&ga(ra))pa[qa]=la[qa];}y(pa);n.updatedUnseenState();});}function fa(ka,la){var ma=false;for(var na in ka){ma=true;break;}if(ma)z(function(oa){var pa=false;for(var qa in ka){var ra=ka[qa],sa=i.isGreaterThan(ra,oa[qa]);if(oa[qa]&&(!ra||sa)){delete oa[qa];pa=true;}}if(pa){y(oa);n.updatedUnseenState();if(la&&ba()===0)m.markSeen();}});}function ga(ka){return i.convertActionIDToTimestamp(ka)>r;}function ha(ka){return ka.map(m.convertThreadIDIfAvailable);}function ia(ka){var la=aa();if(!la)return;for(var ma in ka){var na=ka[ma];if(la[ma]){la[na]=la[ma];delete la[ma];}}y(la);}function ja(ka){var la=(ka.message_counts||[]);for(var ma=0;ma<la.length;ma++)if(la[ma].folder==o.MessagingTag.INBOX)return la[ma];return null;}m.subscribe('update-unseen',function(ka,la){ca(la);});m.subscribe('update-thread-ids',function(ka,la){ia(la);});g.subscribe(k.DUMP_EVENT,function(ka,la){la.messaging=la.messaging||{};la.messaging.unseen=h({},aa());la.messaging.unseen_max_count=s;la.messaging.unseen_time=r;});e.exports=x;});
__d("Emote",["DOM","Env","StringEscape"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Env'),i=b('StringEscape'),j=e.exports={_initialized:false,_imageBase:null,_emoteMap:null,_emoteOrderMap:null,_fbidEmoticonPattern:'\\[\\[([A-Za-z0-9\\.]+)\\]\\]',_fbidEmoticonRegex:null,_imageURLs:null,_regex:null,_regexWithoutFBIDs:null,_init:function(){var k=h.static_base;j._imageBase=k+'images/emote/';j._blankImgSrc=k+'images/blank.gif';var l=['smile','frown','tongue','grin','gasp','wink','glasses','sunglasses','grumpy','unsure','cry','devil','angel','kiss','heart','kiki','squint','confused','upset','pacman','colonthree','like'];j._emoteMap={':-)':['\\:\\-\\)','smile'],':)':['\\:\\)','smile'],':]':['\\:\\]','smile'],'=)':['=\\)','smile'],':-(':['\\:\\-\\(','frown'],':(':['\\:\\(','frown'],':[':['\\:\\[','frown'],'=(':['=\\(','frown'],':-P':['\\:\\-P','tongue'],':P':['\\:P','tongue'],':-p':['\\:\\-p','tongue'],':p':['\\:p','tongue'],'=P':['=P','tongue'],':-D':['\\:\\-D','grin'],':D':['\\:D','grin'],'=D':['=D','grin'],':-O':['\\:\\-O','gasp'],':O':['\\:O','gasp'],':-o':['\\:\\-o','gasp'],':o':['\\:o','gasp'],';-)':['\\;\\-\\)','wink'],';)':['\\;\\)','wink'],'8-)':['8\\-\\)','glasses'],'8)':['8\\)','glasses'],'B-)':['B\\-\\)','glasses'],'B)':['B\\)','glasses'],'8-|':['8\\-\\|','sunglasses'],'8|':['8\\|','sunglasses'],'B-|':['B\\-\\|','sunglasses'],'B|':['B\\|','sunglasses'],'>:(':['>\\:\\(','grumpy'],'>:-(':['>\\:\\-\\(','grumpy'],':/':['\\:/','unsure'],':-/':['\\:\\-/','unsure'],':\\':['\\:\\\\','unsure'],':-\\':['\\:\\-\\\\','unsure'],":'(":["\\:'\\(",'cry'],'3:)':['3\\:\\)','devil'],'3:-)':['3\\:\\-\\)','devil'],'O:)':['O\\:\\)','angel'],'O:-)':['O\\:\\-\\)','angel'],':-*':['\\:\\-\\*','kiss'],':*':['\\:\\*','kiss'],'<3':['<3','heart'],'&lt;3':['&lt\\;3','heart'],'\u2665':['\u2665','heart'],'^_^':['\\^_\\^','kiki'],'-_-':['\\-_\\-','squint'],'o.O':['o\\.O','confused'],'O.o':['O\\.o','confused'],'>:O':['>\\:O','upset'],'>:-O':['>\\:\\-O','upset'],'>:o':['>\\:o','upset'],'>:-o':['>\\:\\-o','upset'],'>_<':['>_<','upset'],'>.<':['>\\.<','upset'],':v':['\\:v','pacman'],':|]':['\\:\\|\\]','robot'],':3':['\\:3','colonthree'],'<(")':['<\\(\\"\\)','penguin'],':putnam:':['\\:putnam\\:','putnam'],'(^^^)':['\\(\\^\\^\\^\\)','shark'],':42:':['\\:42\\:','42'],':like:':['\\:like\\:','like'],'(y)':['\\(y\\)','like'],'(Y)':['\\(Y\\)','like']};var m=[],n=[];if(h.fbid_emoticons){j._fbidEmoticonRegex=new RegExp(j._fbidEmoticonPattern);m.push(j._fbidEmoticonPattern);}for(var o in j._emoteMap){var p=j._emoteMap[o][0];m.push(p);n.push(p);}var q='(?:^|\\s|\'|"|\\.)('+m.join('|')+')(?:\\s|\'|"|\\.|,|!|\\?|<br>|$)',r='(?:^|\\s|\'|"|\\.)('+n.join('|')+')(?:\\s|\'|"|\\.|,|!|\\?|<br>|$)';j._regex=new RegExp(q);j._regexWithoutFBIDs=new RegExp(r);j._emoteOrderMap={};for(var s=0;s<l.length;s++)j._emoteOrderMap[l[s]]=s;j._initialized=true;},htmlEmote:function(k,l){return j._htmlEmote(k,l,true);},htmlEmoteWithoutFBID:function(k,l){return j._htmlEmote(k,l,false);},_getRegex:function(k){return k?j._regex:j._regexWithoutFBIDs;},_htmlEmote:function(k,l,m){if(typeof l!='function')l=i.htmlize;if(!j._initialized)j._init();var n=k,o=[];while(true){var p=j._getRegex(m),q=p.exec(n);if(!q||!q.length)break;var r=q[1],s=n.indexOf(r),t=n.substring(0,s);if(t)o.push(l(t));o.push('<span class="emote_text">');o.push(r);o.push('</span>');var u={title:r},v=j._fbidEmoticonRegex&&(j._fbidEmoticonRegex.exec(r)||[])[1];if(v){u.className='emote_custom';u.src=window.location.protocol+'//graph.facebook.com/'+encodeURIComponent(v)+'/picture';}else{var w=j._emoteMap[r][1],x=j._emoteOrderMap[w];if(x===undefined){u.className='emote_custom';u.src=j._imageBase+w+'.gif';}else{var y=x*-16;u.className='emote_img';u.src=j._blankImgSrc;u.style={backgroundPosition:y+'px 0'};}}var z=g.create('img',u);o.push(g.create('span',{},z).innerHTML);n=n.substring(s+r.length);}if(n)o.push(l(n));return o.join('');}};});
__d("MercurySeenByAll",["CSS","DataStore","DOM","MercuryMessages","MercuryParticipants","MercuryRoger","MercuryThreads"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('MercuryMessages'),k=b('MercuryParticipants'),l=b('MercuryRoger'),m=b('MercuryThreads'),n={},o={updateOnSeenChange:function(r,s){n[r.tagName]=true;h.set(r,'thread-id',s.thread_id);g.addClass(r,'seenByListener');p(r,s);}};function p(r,s){var t=s.participants.filter(function(w){return w!==k.user;}),u=q(s),v=s.participants.length>0&&s.participants[0]===k.user;g.conditionClass(r,'repliedLast',v);g.conditionClass(r,'seenByAll',v&&l.getSeenBy(u).length===t.length);}function q(r){return {author:k.user,thread_id:r.thread_id,timestamp:r.timestamp};}l.subscribe('state-changed',function(r,s){for(var t in n){var u=i.scry(document.body,t+'.seenByListener');for(var v=0;v<u.length;v++){var w=u[v],x=h.get(w,'thread-id');if(s[x])m.getThreadMeta(x,function(y){p(w,y);});}}});e.exports=o;});
__d("ContextualLayer",["array-extensions","event-extensions","Arbiter","ARIA","Class","ContextualThing","CSS","DataStore","DOM","Layer","LayerHideOnTransition","Locale","Parent","Style","Vector","copyProperties","getOverlayZIndex"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ARIA'),i=b('Class'),j=b('ContextualThing'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('Layer'),o=b('LayerHideOnTransition'),p=b('Locale'),q=b('Parent'),r=b('Style'),s=b('Vector'),t=b('copyProperties'),u=b('getOverlayZIndex');function v(z){return z.getPosition()==='left'||(z.isVertical()&&z.getAlignment()==='right');}function w(z,aa){this.parent.construct(this,z,aa);}var x=[];g.subscribe('reflow',function(){x.forEach(function(z){if(z.updatePosition()===false)z.hide();});});i.extend(w,n);t(w.prototype,{_contentWrapper:null,_content:null,_contextNode:null,_contextSelector:null,_parentLayer:null,_parentSubscription:null,_orientation:null,_orientationClass:null,_configure:function(z,aa){this.parent._configure(z,aa);if(z.context){this.setContext(z.context);}else if(z.contextID){this._setContextID(z.contextID);}else if(z.contextSelector)this._setContextSelector(z.contextSelector);z.position&&this.setPosition(z.position);z.alignment&&this.setAlignment(z.alignment);z.offsetX&&this.setOffsetX(z.offsetX);z.offsetY&&this.setOffsetY(z.offsetY);this._content=aa;},_getDefaultBehaviors:function(){return this.parent._getDefaultBehaviors().concat([o]);},_buildWrapper:function(z,aa){this._contentWrapper=m.create('div',{className:'uiContextualLayer'},aa);return m.create('div',{className:'uiContextualLayerPositioner'},this._contentWrapper);},getInsertParent:function(){var z=this._insertParent;if(!z){var aa=this.getContext();if(aa)z=q.byClass(aa,'uiContextualLayerParent');}return z||this.parent.getInsertParent();},setContent:function(z){this._content=z;m.setContent(this._contentWrapper,this._content);this._shown&&this.updatePosition();return this;},setContext:function(z){this._contextNode=z;this._contextSelector=this._contextScrollParent=null;if(this._shown){j.register(this.getRoot(),this._contextNode);this.updatePosition();}this._setParentSubscription();h.setPopup(this.getCausalElement(),this.getRoot());return this;},_setContextID:function(z){this._contextSelector='#'+z;this._contextNode=null;},_setContextSelector:function(z){this._contextSelector=z;this._contextNode=null;},getCausalElement:function(){return this.parent.getCausalElement()||this.getContext();},_setParentSubscription:function(){var z=this.getContext(),aa=null;while(z!==null){aa=l.get(z,'layer');if(aa)break;z=z.parentNode;}if(aa===this._parentLayer)return;if(this._parentLayer&&this._parentSubscription){this._parentLayer.unsubscribe(this._parentSubscription);this._parentSubscription=null;}if(aa)this._parentSubscription=aa.subscribe('hide',this.hide.bind(this));this._parentLayer=aa;},setPosition:function(z){this._getOrientation().setDefaultPosition(z);this._shown&&this.updatePosition();return this;},setAlignment:function(z){this._getOrientation().setDefaultAlignment(z);this._shown&&this.updatePosition();return this;},setOffsetX:function(z){this._getOrientation().setDefaultOffsetX(z);this._shown&&this.updatePosition();return this;},setOffsetY:function(z){this._getOrientation().setDefaultOffsetY(z);this._shown&&this.updatePosition();return this;},_getOrientation:function(){if(!this._orientation)this._orientation=new y();return this._orientation;},_getContentRoot:function(){return this._contentWrapper;},getContent:function(){return this._content;},getContext:function(){if(!this._contextNode)this._contextNode=m.find(document,this._contextSelector);return this._contextNode;},getContextScrollParent:function(){if(!this._contextScrollParent)this._contextScrollParent=r.getScrollParent(this.getContext());return this._contextScrollParent;},setInsertParent:function(z){this._insertScrollParent=null;return this.parent.setInsertParent(z);},getInsertScrollParent:function(){if(!this._insertScrollParent)this._insertScrollParent=r.getScrollParent(this.getInsertParent());return this._insertScrollParent;},show:function(){this.parent.show();if(this._shown){j.register(this.getRoot(),this.getContext());x.push(this);this._resizeListener=this._resizeListener||Event.listen(window,'resize',this.updatePosition.bind(this));}return this;},hide:function(){j.remove(this.getRoot());x.remove(this);this._resizeListener&&this._resizeListener.remove();this._resizeListener=null;return this.parent.hide();},updatePosition:function(){var z=this.getContext();if(!z)return false;var aa=r.isFixed(z)&&!r.isFixed(this.getInsertParent());if(!aa&&!z.offsetParent)return false;var ba=this._getOrientation();this.inform('adjust',ba.reset());if(!ba.isValid())return false;this._updateWrapperPosition(ba);this._updateWrapperClass(ba);var ca=this.getRoot();k.conditionClass(ca,'uiContextualLayerPositionerFixed',aa);var da,ea,fa;if(aa){da='viewport';ea=new s(0,0);fa=document.body.offsetWidth;}else{da='document';var ga=ca.offsetParent;if(!ga)return false;ea=s.getElementPosition(ga,da);fa=ga.offsetWidth;if(ga!==document.body)ea=ea.sub(new s(ga.scrollLeft,ga.scrollTop));}var ha=s.getElementPosition(z,da),ia=ha.x-ea.x,ja=ha.y-ea.y,ka=p.isRTL();if(ba.getPosition()==='below')ja+=z.offsetHeight;if((ba.getPosition()==='right'||(ba.isVertical()&&ba.getAlignment()==='right'))!=ka)ia+=z.offsetWidth;var la=ba.getOffsetX();if(ba.isVertical()&&ba.getAlignment()==='center')la+=(z.offsetWidth-this._content.offsetWidth)/2;if(ka)la*=-1;var ma='left',na=ia+la;if(v(ba)!==ka){ma='right';na=fa-na;}r.set(ca,ma,na+'px');r.set(ca,ma==='left'?'right':'left','');var oa=this.getInsertScrollParent(),pa;if(oa!==window){pa=oa.clientWidth;}else pa=document.documentElement.clientWidth;var qa=s.getElementPosition(ca).x;if(ma==='left'){r.set(ca,'width',(pa-qa)+'px');}else r.set(ca,'width',qa+ca.offsetWidth+'px');r.set(ca,'top',(ja+ba.getOffsetY())+'px');var ra=u(z,this.getInsertParent());r.set(ca,'z-index',ra>200?ra:'');this.inform('reposition',ba);return true;},_updateWrapperPosition:function(z){var aa=z.getPosition()==='above';r.set(this._contentWrapper,'bottom',aa?'0':null);var ba=p.isRTL()?'left':'right',ca=v(z);r.set(this._contentWrapper,ba,ca?'0':null);},_updateWrapperClass:function(z){var aa=z.getClassName();if(aa===this._orientationClass)return;if(this._orientationClass)k.removeClass(this._contentWrapper,this._orientationClass);this._orientationClass=aa;k.addClass(this._contentWrapper,aa);},simulateOrientation:function(z,aa){var ba=z.getClassName();if(ba===this._orientationClass){return aa();}else{if(this._orientationClass)k.removeClass(this._contentWrapper,this._orientationClass);k.addClass(this._contentWrapper,ba);var ca=aa();k.removeClass(this._contentWrapper,ba);if(this._orientationClass)k.addClass(this._contentWrapper,this._orientationClass);return ca;}},destroy:function(){this.parent.destroy();this._contentWrapper=null;this._content=null;return this;}});function y(){this._default={_position:'above',_alignment:'left',_offsetX:0,_offsetY:0,_valid:true};this.reset();}y.OPPOSITE={above:'below',below:'above',left:'right',right:'left'};t(y.prototype,{setPosition:function(z){this._position=z;return this;},setAlignment:function(z){this._alignment=z;return this;},getOppositePosition:function(){return y.OPPOSITE[this.getPosition()];},invalidate:function(){this._valid=false;return this;},getPosition:function(){return this._position||'above';},getAlignment:function(){return this._alignment||'left';},getOffsetX:function(){var z=this._offsetX||0;if(!this.isVertical()){if(this._default._position!==this._position)z*=-1;}else if(this._default._alignment!==this._alignment)z*=-1;return z;},getOffsetY:function(){var z=this._offsetY||0;if(this.isVertical()&&this._default._position!==this._position)z*=-1;return z;},getClassName:function(){var z=this.getAlignment(),aa=this.getPosition();if(aa==='below'){if(z==='left'){return 'uiContextualLayerBelowLeft';}else if(z==='right'){return 'uiContextualLayerBelowRight';}else return 'uiContextualLayerBelowCenter';}else if(aa==='above'){if(z==='left'){return 'uiContextualLayerAboveLeft';}else if(z==='right'){return 'uiContextualLayerAboveRight';}else return 'uiContextualLayerAboveCenter';}else if(aa==='left'){return 'uiContextualLayerLeft';}else return 'uiContextualLayerRight';},isValid:function(){return this._valid;},isVertical:function(){return this.getPosition()==='above'||this.getPosition()==='below';},reset:function(z,aa){t(this,this._default);return this;},setDefaultPosition:function(z){this._default._position=z;return this;},setDefaultAlignment:function(z){this._default._alignment=z;return this;},setDefaultOffsetX:function(z){this._default._offsetX=z;return this;},setDefaultOffsetY:function(z){this._default._offsetY=z;return this;}});e.exports=w;});
__d("ContextualLayerDimensions",["DOM","Locale","Rect","Vector","ViewportBounds","ge","getOverlayZIndex"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Locale'),i=b('Rect'),j=b('Vector'),k=b('ViewportBounds'),l=b('ge'),m=b('getOverlayZIndex'),n={getViewportRect:function(o){var p=l('globalContainer'),q=o.getContext(),r=(p&&g.contains(p,q))||m(q)<300,s=i.getViewportBounds();if(r){s.t+=k.getTop();if(h.isRTL()){s.l+=k.getRight();}else s.r-=k.getRight();}return s;},getLayerRect:function(o,p){var q=o.getContext(),r=j.getElementPosition(q,'viewport'),s=o.simulateOrientation(p,function(){return j.getElementDimensions(o.getContent());}),t=r.y+p.getOffsetY();if(p.getPosition()==='above'){t-=s.y;}else if(p.getPosition()==='below')t+=q.offsetHeight;var u=r.x+p.getOffsetX();if(p.isVertical()){var v=p.getAlignment();if(v==='center'){u+=(q.offsetWidth-s.x)/2;}else if((v==='right')!==h.isRTL())u+=q.offsetWidth-s.x;}else if((p.getPosition()==='right')!==h.isRTL()){u+=q.offsetWidth;}else u-=s.x;return new i(t,u+s.x,t+s.y,u,'viewport');}};e.exports=n;});
__d("ContextualLayerAutoFlip",["array-extensions","event-extensions","ContextualLayerDimensions","DOM","Vector","copyProperties"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('ContextualLayerDimensions'),h=b('DOM'),i=b('Vector'),j=b('copyProperties');function k(l){this._layer=l;}j(k.prototype,{_subscription:null,enable:function(){this._subscription=this._layer.subscribe('adjust',this._adjustOrientation.bind(this));if(this._layer.isShown())this._layer.updatePosition();},disable:function(){this._subscription.unsubscribe();this._subscription=null;if(this._layer.isShown())this._layer.updatePosition();},_adjustOrientation:function(l,m){var n=this._getValidPositions(m);if(!n.length){m.invalidate();return;}var o=g.getViewportRect(this._layer),p=this._getValidAlignments(m);for(var q=0;q<p.length;q++){m.setAlignment(p[q]);for(var r=0;r<n.length;r++){m.setPosition(n[r]);var s=g.getLayerRect(this._layer,m);if(o.contains(s))return;}}m.setPosition(n[0]).setAlignment(p[0]);},_getValidPositions:function(l){var m=[l.getPosition(),l.getOppositePosition()],n=this._layer.getContextScrollParent();if(n===window||n===h.getDocumentScrollElement())return m;var o=this._layer.getContext(),p=i.getElementPosition(n,'viewport').y,q=i.getElementPosition(o,'viewport').y;if(l.isVertical()){return m.filter(function(s){if(s==='above'){return q>=p;}else{var t=p+n.offsetHeight,u=q+o.offsetHeight;return u<=t;}});}else{var r=p+n.offsetHeight;if(q>=p&&q+o.offsetHeight<=r){return m;}else return [];}},_getValidAlignments:function(l){var m=['left','center','right'],n=l.getAlignment(),o=m.indexOf(n);if(o>0){m.splice(o,1);m.unshift(n);}return m;}});e.exports=k;});
__d("Tooltip",["event-extensions","ARIA","AsyncRequest","copyProperties","ContextualLayer","ContextualLayerAutoFlip","CSS","DataStore","DOM","Style","URI","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ARIA'),h=b('AsyncRequest'),i=b('copyProperties'),j=b('ContextualLayer'),k=b('ContextualLayerAutoFlip'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('Style'),p=b('URI'),q=b('tx'),r=null,s=null,t=null,u=[];function v(){if(!s){t=n.create('div',{className:'tooltipContent'});var ca=n.create('i',{className:'arrow'}),da=n.create('div',{className:'uiTooltipX'},[t,ca]);s=new j({},da);s.enableBehavior(k);}}function w(ca){return i({position:ca.getAttribute('data-tooltip-position')||'above',alignH:ca.getAttribute('data-tooltip-alignh')||'left'},m.get(ca,'tooltip'));}function x(ca,da){var ea=w(ca);m.set(ca,'tooltip',{content:da.content||ea.content,position:da.position||ea.position,alignH:da.alignH||ea.alignH});ca.setAttribute('data-hover','tooltip');}function y(ca,da){ba.set(ca,"Loading...");new h(da).setHandler(function(ea){ba.set(ca,ea.getPayload());}).setErrorHandler(bagofholding).send();}var z=/(\r\n|[\r\n])/;function aa(ca){return ca.split(z).map(function(da){return z.test(da)?n.create('br'):da;});}var ba={process:function(ca,da){if(!n.contains(ca,da))return;if(ca!==r){var ea=ca.getAttribute('data-tooltip-uri');if(ea){ca.removeAttribute('data-tooltip-uri');y(ca,ea);}var fa=ca.getAttribute('title');if(fa){ca.setAttribute('title','');var ga=w(ca);!ga.content&&ba.set(ca,fa);}ba.show(ca);}},remove:function(ca){m.remove(ca,'tooltip');ca.removeAttribute('data-hover');ca.removeAttribute('data-tooltip-position');ca.removeAttribute('data-tooltip-alignh');ca===r&&ba.hide();},hide:function(){if(r){s.hide();r=null;while(u.length)u.pop().remove();}},set:function(ca,da,ea,fa){if(ea||fa)x(ca,{position:ea,alignH:fa});if(da instanceof p){if(ca===r){y(ca,da);}else ca.setAttribute('data-tooltip-uri',da);}else{if(typeof da!=='string')da=n.create('div',{},da);x(ca,{content:da});ca===r&&ba.show(ca);}},show:function(ca){v();ba.hide();var da=w(ca);if(!da.content)return;var ea=0,fa=0;if(da.position==='left'||da.position==='right'){fa=(ca.offsetHeight-20)/2;}else if(da.alignH!=='center'){var ga=ca.offsetWidth;if(ga<18)ea=(ga-18)/2*(da.alignH==='right'?-1:1);}s.setContext(ca).setOffsetX(ea).setOffsetY(fa).setPosition(da.position).setAlignment(da.alignH);if(typeof da.content==='string'){l.addClass(s,'invisible_elem');var ha=n.create('span',{},aa(da.content)),ia=n.create('div',{className:'tooltipText'},ha);n.setContent(t,ia);s.show();g.notify(da.content);if(ia.offsetWidth<ha.offsetWidth){l.addClass(ia,'tooltipWrap');s.updatePosition();}l.removeClass(s,'invisible_elem');}else{n.setContent(t,da.content);s.show();g.notify(n.getText(t));}var ja=function(la){if(!n.contains(r,la.getTarget()))ba.hide();};u.push(Event.listen(document.documentElement,'mouseover',ja));u.push(Event.listen(document.documentElement,'focusin',ja));var ka=o.getScrollParent(ca);if(ka!==window)u.push(Event.listen(ka,'scroll',ba.hide));u.push(Event.listen(ca,'click',ba.hide));r=ca;}};Event.listen(window,'scroll',ba.hide);e.exports=ba;});
__d("MercuryThreadMetadataRenderer",["event-extensions","CSS","DOM","Emote","HTML","LiveTimer","MercuryAttachment","MercuryMessages","MercuryParticipants","MercurySeenByAll","MercuryServerRequests","MercuryThreads","Tooltip","URI","cx","createArrayFrom","tx","MercuryImageTemplates","MercuryThreadlistIconTemplates","MercuryStatusTemplates","MercuryConstants","MercuryConfig"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Emote'),j=b('HTML'),k=b('LiveTimer'),l=b('MercuryAttachment'),m=b('MercuryMessages'),n=b('MercuryParticipants'),o=b('MercurySeenByAll'),p=b('MercuryServerRequests'),q=b('MercuryThreads'),r=b('Tooltip'),s=b('URI'),t=b('cx'),u=c('MercuryImageTemplates'),v=c('MercuryThreadlistIconTemplates'),w=c('MercuryStatusTemplates'),x=c('MercuryConstants'),y=c('MercuryConfig'),z=b('createArrayFrom'),aa=b('tx');e.exports={renderLiveTimestamp:function(fa,ga,ha,ia){if(ga){fa.setAttribute('data-utime',Math.floor(ia/1000));fa.setAttribute('title',ga);if(!ha)ha=Date.format(y['24h_times']?'H:i':'g:ia',Math.floor(ia/1000));k.updateNode(fa,ha);k.addTimeStamps(fa);g.show(fa);}},renderMessageSourceTags:function(fa,ga,ha,ia){var ja=x.MercuryMessageSourceTags,ka='',la='',ma='';if(ha.contains(ja.MESSENGER)){ka="Sent from Messenger";la=new s('/mobile/messenger');ma="-cx-PRIVATE-webMessengerMessageGroup__sourceMessenger";}else if(ha.contains(ja.CHAT)){ka="Sent from Chat";ma="-cx-PRIVATE-webMessengerMessageGroup__sourceChat";}else if(ha.contains(ja.EMAIL)){if(ia){ka=aa._("Sent from {email}",{email:ia});}else ka="Sent from Email";ma="-cx-PRIVATE-webMessengerMessageGroup__sourceEmail";}else if(ha.contains(ja.MOBILE)){ka="Sent from Mobile";la=new s('/mobile/');ma="-cx-PRIVATE-webMessengerMessageGroup__sourceMobile";}if(ma){r.set(fa,ka);g.addClass(ga,ma);if(la){fa.setAttribute('href',la);}else fa.removeAttribute('href');}else g.hide(fa);},renderMessageLocation:function(fa,ga,ha){var ia=s('/ajax/messaging/hovercard/map.php').setQueryData(ha);fa.setAttribute('data-hovercard',ia);g.removeClass(fa,"-cx-PRIVATE-webMessengerMessageGroup__noLocation");g.show(ga);},renderCoreThreadlist:function(fa,ga,ha,ia,ja){q.getThreadMeta(fa,function(ka){ia=ia||{};this.renderThreadImage(ka.thread_id,ga.getNode('image'));ea(ka.thread_id,ga.getNode('name'),ia);if(ka.folder&&ja)da(ga.getNode('folderBadge'),ka.folder);var la=ga.getNode('timestamp');this.renderLiveTimestamp(la,ka.timestamp_absolute,ka.timestamp_relative,ka.timestamp);this.renderSnippet(ka.thread_id,ga.getNode('snippet'));ha(ga,ka);}.bind(this));},renderCommaSeparatedParticipantList:function(fa,ga,ha){ha=ha||{};ha.last_separator_uses_and=false;return ea(fa,ga,ha);},renderAndSeparatedParticipantList:function(fa,ga,ha){ha=ha||{};ha.last_separator_uses_and=true;return ea(fa,ga,ha);},renderSnippet:function(fa,ga){q.getThreadMeta(fa,function(ha){var ia=h.create('span');g.addClass(ia,'MercuryRepliedIndicator');h.appendContent(ga,ia);o.updateOnSeenChange(ia,ha);if(ha.snippet_has_attachment)if(!ha.snippet&&ha.snippet_attachments){ha.snippet_attachments.forEach(function(ma){if(ma.attach_type!=x.MercuryAttachmentType.FILE)return;var na=l.getAttachIconClass(ma.icon_type),oa=v[':fb:mercury:attachment-icon-text'].build().getRoot();h.appendContent(oa,ma.name);g.addClass(oa,na);h.appendContent(ga,oa);}.bind(this));}else{var ja=v[':fb:mercury:attachment-indicator'].build().getRoot();h.appendContent(ga,ja);}if(ha.is_forwarded_snippet){var ka;if(ha.snippet){ka="Forwarded Message:";}else ka="Forwarded Message";h.appendContent(ga,h.create('strong',{className:'mercuryLeftAlignStatusIndicator'},ka));}var la=ha.snippet;if(la)if(la.substr(0,4)=='?OTR'){la="[encrypted message]";}else la=la.replace(/\r\n|[\r\n]/g," ");h.appendContent(ga,j(i.htmlEmote(la)));}.bind(this));},renderTitanLink:function(fa,ga,ha){var ia=fa.indexOf(':'),ja=new s().setSubdomain('www'),ka,la;if(fa.substr(0,ia)=='user'){ja.setPath('/messages/'+fa.substr(ia+1));ga.setAttribute('href',ja.toString());ha&&ha();}else p.getServerThreadID(fa,function(ma){if(y.MessagesMercuryIntegrationGK){la='selection';}else la='read';ja.setPath('/messages/');ja.setQueryData({action:la,tid:ma});ga.setAttribute('href',ja.toString());ha&&ha();});},renderThreadImage:function(fa,ga){q.getThreadMeta(fa,function(ha){if(ha.image_src){this._renderThreadImageSingle(ha.image_src,ga);return;}var ia=[],ja=ha.participants.filter(function(ka){return ka!=n.user;});if(!ja.length){ia=[n.user];}else if(ja.length==1){ia=[ja[0]];}else{ia=ja.slice(0,3);if(ia.length==2)ia.push(n.user);}n.getMulti(ia,function(ka){var la=ia.map(function(ma){return ka[ma];});this.renderParticipantImages(la,ga);}.bind(this));}.bind(this));},renderParticipantImages:function(fa,ga){if(fa.length>2){this._renderThreadImageSplit(fa,ga);}else this._renderThreadImageSingle(fa[0].image_src,ga);},renderErrorIndicator:function(fa,ga){var ha=w[':fb:mercury:error-indicator'].render(),ia;switch(fa){case x.MercuryActionStatus.REQUEST_ERROR:case x.MercuryActionStatus.TRANSPORT_ERROR:case x.MercuryActionStatus.FAILED_UNKNOWN_REASON:case x.MercuryActionStatus.UNABLE_TO_CONFIRM:ia="This message failed to send. Click to send again.";break;default:throw new Error('Invalid error code '+fa);}r.set(ha,ia,'above','center');if(ga){Event.listen(ha,'click',ga);g.addClass(ha,'mercuryClickableErrorIndicator');}return ha;},renderResendIndicator:function(){return w[':fb:mercury:resend-indicator'].render();},renderStatusIndicator:function(fa,ga){var ha=x.MercuryActionStatus,ia;if(fa==ha.RESENDING){ia=this.renderResendIndicator();}else if(fa!==undefined&&fa!=ha.UNSENT&&fa!=ha.UNCONFIRMED&&fa!=ha.SUCCESS)ia=this.renderErrorIndicator(fa,ga);return ia;},renderParticipantList:function(fa,ga,ha,ia){var ja={abbr_mode:true,last_separator_uses_and:true,link_mode:true,names_renderer:true};ia=ia||{};var ka=null;if(ia.names_renderer){ka=ia.names_renderer(ga);}else ka=ga.map(function(na){return na.name;});var la=null;if(ka.length==1){la=ka[0];}else if(ka.length==2){var ma={participant1:ka[0],participant2:ka[1]};if(ia.last_separator_uses_and){la=aa._("{participant1} and {participant2}",ma);}else la=aa._("{participant1}, {participant2}",ma);}else if(ia.last_separator_uses_and){if(ia.abbr_mode){la=h.tx._("{participant1} and {others_link}",{participant1:ka[0],others_link:ca(fa,ha-1,ia.link_mode)});}else if(ka.length==3){la=aa._("{participant1}, {participant2}, and {participant3}",{participant1:ka[0],participant2:ka[1],participant3:ka[2]});}else la=h.tx._("{participant1}, {participant2}, and {others_link}",{participant1:ka[0],participant2:ka[1],others_link:ca(fa,ha-2,ia.link_mode)});}else if(ka.length==3){la=aa._("{participant1}, {participant2}, {participant3}",{participant1:ka[0],participant2:ka[1],participant3:ka[2]});}else la=h.tx._("{participant1}, {participant2}, {participant3}, {others_link}",{participant1:ka[0],participant2:ka[1],participant3:ka[2],others_link:ca(fa,ha-3,ia.link_mode)});return la;},renderShortNames:function(fa){if(fa.length==1)return [fa[0].name];return fa.map(function(ga){return ga.short_name;});},_renderThreadImageSingle:function(fa,ga){var ha=u[':fb:mercury:thread-image:single'].build().getRoot();ha.src=fa;h.setContent(ga,ha);},_renderThreadImageSplit:function(fa,ga){var ha=u[':fb:mercury:thread-image:split'].build().setNodeProperty('left','src',fa[0].image_src).setNodeProperty('topRight','src',fa[1].image_src).setNodeProperty('bottomRight','src',fa[2].image_src);h.setContent(ga,ha.getRoot());}};function ba(fa,ga){var ha=fa;if(ga&&ga>1)ha=h.tx._("{conversation_title} ({unread_count})",{conversation_title:fa,unread_count:ga});return ha;}function ca(fa,ga,ha){var ia=p.getServerThreadIDNow(fa),ja=ga>1?aa._("{others_count} others",{others_count:ga}):"1 other";if(ha&&ia){var ka=s('/ajax/messaging/profile_browser/profile_browser.php').setQueryData({tid:ia}),la=h.create('a',{className:'hoverlistLink',href:ka,rel:'dialog'},ja);return la;}else return ja;}function da(fa,ga){z(fa).forEach(function(ha){h.setContent(ha,ga);});}function ea(fa,ga,ha){ga=z(ga);var ia={callback:true,check_length:true,show_unread_count:true};ha=ha||{};var ja={};for(var ka in ha)if(ia[ka]){ja[ka]=ha[ka];delete ha[ka];}q.getThreadMeta(fa,function(la){if(la.name){var ma=ba(la.name,ja.show_unread_count?la.unread_count:0);ga.forEach(function(oa){h.setContent(oa,ma);});ja.callback&&ja.callback(ma);return;}var na=la.participants;if(la.participants.length>1)na=la.participants.filter(function(oa){return oa!=n.user;});n.getMulti(na,function(oa){var pa=na.map(function(ua){return oa[ua];}),qa=e.exports.renderParticipantList(fa,pa,na.length,ha);qa=ba(qa,ja.show_unread_count?la.unread_count:0);var ra=ha.abbr_mode,sa={};for(var ta in ha)sa[ta]=ha[ta];sa.abbr_mode=true;ga.forEach(function(ua){h.setContent(ua,qa);if(ja.check_length&&!ra&&ua.scrollWidth>ua.clientWidth){var va=e.exports.renderParticipantList(fa,pa,na.length,sa);va=ba(va,ja.show_unread_count?la.unread_count:0);h.setContent(ua,va);}}.bind(this));ja.callback&&ja.callback(qa);}.bind(this));}.bind(this));}});
__d("ModalLayer",["event-extensions","CSS","DOMQuery","ScrollAwareDOM","Style","URI","UserAgent","Vector","copyProperties","csx","debounce","ge"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOMQuery'),i=b('ScrollAwareDOM'),j=b('Style'),k=b('URI'),l=b('UserAgent'),m=b('Vector'),n=b('copyProperties'),o=b('csx'),p=b('debounce'),q=b('ge'),r=0,s=null,t=null;function u(){if(!t)t=h.scry(document.body,".-cx-PRIVATE-fbLayout__root")[0];return t;}function v(){h.scry(document.body,'div.swfObject').forEach(function(x){var y=x.getAttribute('data-swfid');if(y&&window[y]){var z=window[y];z.addParam('autostart','false');z.addParam('autoplay','false');z.addParam('play','false');z.addVariable('video_autoplay','0');z.addVariable('autoplay','0');z.addVariable('play','0');var aa=k(z.getAttribute('swf'));aa.addQueryData({autoplay:'0'});aa.setPath(aa.getPath().replace('autoplay=1','autoplay=0'));z.setAttribute('swf',aa.toString());z.write(x);}});}function w(x){this._layer=x;}n(w.prototype,{_subscription:null,_resizeListener:null,enable:function(){if(!u())return;this._subscription=this._layer.subscribe(['show','hide'],function(x){x=='show'?this._addModal():this._removeModal();}.bind(this));if(this._layer.isShown())this._addModal();},disable:function(){this._subscription.unsubscribe();this._subscription=null;if(this._layer.isShown())this._removeModal();},_addModal:function(){g.addClass(this._layer.getRoot(),'modalWrapper');if(r++===0){s=m.getScrollPosition();var x=u(),y=x.offsetTop-s.y;j.set(x,'top',y+'px');g.addClass(document.documentElement,'modalOpen');if(l.ie()<7){var z=this._layer.getRoot(),aa=function(){var ca=-y+Math.max(z.offsetHeight,z.scrollHeight);j.set(x,'height',ca+'px');};aa();this._resizeListener=Event.listen(window,'resize',p(aa,100));}var ba=h.getDocumentScrollElement();ba.scrollTop=0;this._scrollSubscription=i.subscribe('scroll',function(ca,da){var ea=x.offsetTop-da.delta.y;j.set(x,'top',ea+'px');s=s.add(da.delta);return false;});if(l.firefox()<13)v.defer();}},_removeModal:function(){g.removeClass(this._layer.getRoot(),'modalWrapper');if(--r===0){g.removeClass(document.documentElement,'modalOpen');var x=u();j.set(x,'top','');if(l.ie()<7){j.set(x,'height','');this._resizeListener.remove();this._resizeListener=null;}var y=h.getDocumentScrollElement();y.scrollTop=s.y;this._scrollSubscription.unsubscribe();this._scrollSubscription=null;}}});e.exports=w;});
__d("DialogX",["event-extensions","function-extensions","AccessibleLayer","Arbiter","ArbiterMixin","Class","DOM","Layer","LayerButtons","LayerFormHooks","ModalLayer","Parent","Style","UserAgent","Vector","copyProperties","cx","debounce","getOverlayZIndex"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('AccessibleLayer'),h=b('Arbiter'),i=b('ArbiterMixin'),j=b('Class'),k=b('DOM'),l=b('Layer'),m=b('LayerButtons'),n=b('LayerFormHooks'),o=b('ModalLayer'),p=b('Parent'),q=b('Style'),r=b('UserAgent'),s=b('Vector'),t=b('copyProperties'),u=b('cx'),v=b('debounce'),w=b('getOverlayZIndex');function x(z,aa){this.parent.construct(this,z,aa);}j.extend(x,l);t(x,i);t(x.prototype,{_modal:false,_ie:null,_wrapper:null,_configure:function(z,aa){this.parent._configure(z,aa);if(z.modal){this._modal=true;this.enableBehavior(o);}if(z.autohide)var ba=this.subscribe('show',function(){ba.unsubscribe();this.hide.shield(this).defer(z.autohide);}.bind(this));},_getDefaultBehaviors:function(){return this.parent._getDefaultBehaviors().concat([y,g,m,n]);},_buildWrapper:function(z,aa){var ba=k.create('div',{className:"-cx-PRIVATE-uiDialog__content"},aa),ca;this._ie=r.ie();if(this._ie>6&&this._ie<9){ca=[k.create('div',{className:"-cx-PRIVATE-uiDialog__vertical"}),k.create('div',{className:"-cx-PRIVATE-uiDialog__horizontal"}),k.create('div',{className:"-cx-PRIVATE-uiDialog__topLeft"}),k.create('div',{className:"-cx-PRIVATE-uiDialog__topRight"}),k.create('div',{className:"-cx-PRIVATE-uiDialog__bottomLeft"}),k.create('div',{className:"-cx-PRIVATE-uiDialog__bottomRight"}),ba];}else ca=k.create('div',{className:"-cx-PRIVATE-uiDialog__border"},ba);this._wrapper=k.create('div',{className:"-cx-PRIVATE-uiDialog__wrapper"},ca);this.setWidth(z.width);var da="-cx-PRIVATE-uiDialog__positioner";if(z.className)da+=' '+z.className;var ea=k.create('div',{className:da},this._wrapper);if(z.id)ea.id=z.id;return ea;},_getContentRoot:function(){return this._wrapper;},updatePosition:function(){var z=s.getViewportDimensions().y-s.getElementDimensions(this._wrapper).y,aa;if(z<250){if(z>80){aa=z/2;}else aa=40;}else aa=125;if(!this._modal&&(!this._ie||this._ie<7))if(aa<=40){this.enableBehavior(o);}else this.disableBehavior(o);if(this._ie<7){var ba=s.getScrollPosition().y;q.set(this._wrapper,'top',aa+ba+'px');}else q.set(this._wrapper,'margin-top',aa+'px');if(this._causalElement){var ca=w(this._causalElement,this.getInsertParent());q.set(this.getRoot(),'z-index',ca>200?ca:'');}},setWidth:function(z){z=Math.floor(z);if(this._ie>6&&this._ie<9)z-=20;q.set(this._wrapper,'width',z+'px');}});function y(z){this._layer=z;}t(y.prototype,{_subscription:null,_resize:null,enable:function(){this._subscription=this._layer.subscribe(['show','hide'],function(z){if(z==='show'){this._attach();h.inform('layer_shown',{type:'DialogX'});}else{this._detach();h.inform('layer_hidden',{type:'DialogX'});}}.bind(this));},disable:function(){this._subscription.unsubscribe();this._subscription=null;this._resize&&this._detach();},_attach:function(){this._layer.updatePosition();this._resize=Event.listen(window,'resize',v(this._layer.updatePosition.bind(this._layer)));},_detach:function(){this._resize.remove();this._resize=null;}});e.exports=x;});
__d("AsyncDialog",["AsyncRequest","copyProperties","CSS","cx","DialogX","DOM","Parent","tx","URI"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('copyProperties'),i=b('CSS'),j=b('cx'),k=b('DialogX'),l=b('DOM'),m=b('Parent'),n=b('tx'),o=b('URI'),p=new k({width:465,className:"-cx-PRIVATE-uiDialog__loadingDialog"},l.create('div',{className:"-cx-PRIVATE-uiDialog__loadingText"},"Loading...")),q=1,r=[],s=0;function t(){s--;if(!s)p.hide();}function u(w,x){var y=q++;r[y]=x;h(w.getData(),{__asyncDialog:y});var z=false;s++;p.show();w.setInterceptHandler(function(aa){z=true;t();});w.setFinallyHandler(function(aa){var ba=aa.getPayload();if(ba&&ba.asyncURL)v.send(new g(ba.asyncURL));if(!z)t();});w.send();}var v={send:function(w,x){u(w,x||bagofholding);},bootstrap:function(w,x,y){var z=m.byClass(x,'stat_elem')||x;if(z&&i.hasClass(z,'async_saving'))return false;var aa=new o(w).getQueryData();aa.causal_element=x?l.getID(x):null;var ba=y==='dialog',ca=new g().setURI(w).setData(aa).setMethod(ba?'GET':'POST').setReadOnly(ba).setRelativeTo(x).setStatusElement(z).setNectarModuleDataSafe(x);v.send(ca);},respond:function(w,x){var y=r[w];if(y){y(x);delete r[w];}}};e.exports=v;});
__d("AsyncLayout",["AjaxPipeRequest","Arbiter","AsyncResponse","AsyncRequest","CSS","DOM","HTML","NavigationMessage","PageTransitions","URI","$","copyProperties","ge","goURI"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('AsyncResponse'),j=b('AsyncRequest'),k=b('CSS'),l=b('DOM'),m=b('HTML'),n=b('NavigationMessage'),o=b('PageTransitions'),p=b('URI'),q=b('$'),r=b('copyProperties'),s=b('ge'),t=b('goURI');function u(v){this.canvasID=v;if(s('rightCol'))this.auxiliaryID='rightCol';if(s('headerArea'))this.headerID='headerArea';if(s('toolbarContainer'))this.toolbarID='toolbarContainer';this.waitingForAux=false;o.registerHandler(this.catchPageTransition.bind(this));this.subscription=h.subscribe(n.NAVIGATION_BEGIN,this.onNavigate.bind(this));}r(u.prototype,{catchPageTransition:function(v){this.subscription.unsubscribe();return false;},getCanvasID:function(v){return v.sidecol?'contentCol':'contentArea';},onNavigate:function(v,w){var x=w.useAjaxPipe;w=w.params;if(w.endpoint){if(this.request){this.request.setFinallyHandler(bagofholding);this.request.abort();}if(this.sideRequest)this.sideRequest.abort();if(x){this.request=new g().setURI(w.endpoint).setData(w).setCanvasId(this.getCanvasID(w)).setFinallyHandler(this.finallyHandler.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFirstResponseCallback(this.firstResponseCallback.bind(this)).send();}else{w.handled=true;this.waitingForAux=w.sidecol;var y=!!w.iframe,z=new j().setOption('useIframeTransport',y).setURI(new p(w.endpoint)).setReadOnly(true).setMethod('GET').setData(w).setHandler(this.onResponse.bind(this)).setErrorHandler(this.errorHandler.bind(this)).setFinallyHandler(this.finallyHandler.bind(this));this.request=z;z.send();}}},onSideResponse:function(v){var w=v.getPayload();if(w&&this.auxiliaryID)this.receivedAux(w);},receivedAux:function(v){!this.waitingForAux;this.waitingForAux=false;l.setContent(q(this.auxiliaryID),m(v));},onResponse:function(v){var w=v.getPayload();if(w.redirect){t(w.redirect);}else{var x=w.html||w;l.setContent(q(this.canvasID),m(x));if(w.side_html&&this.auxiliaryID)this.receivedAux(w.side_html);if(this.headerID&&!w.keep_header){var y=q(this.headerID);l.setContent(y,m(w.header_html||''));k.conditionShow(y,w.header_html);}if(w.toolbar_html&&this.toolbarID)l.setContent(q(this.toolbarID),m(w.toolbar_html));if(w.js)(new Function(w.js))();k.conditionClass('contentCol','hasRightCol',this.auxiliaryID&&!w.noRightSide);var z=s('rightCol');if(z&&w.noRightSide)l.empty(z);}var aa=v.getRequest().getData();h.inform(n.NAVIGATION_COMPLETED,aa.key);},errorHandler:function(v){i.verboseErrorHandler(v);h.inform(n.NAVIGATION_FAILED);this.request=null;},firstResponseCallback:function(v){window.scrollTo(0,0);h.inform(n.NAVIGATION_FIRST_RESPONSE);},finallyHandler:function(v){this.request=null;o.transitionComplete(true);h.inform(n.NAVIGATION_COMPLETED);}});e.exports=u;});
__d("ContextualLayerHideOnScroll",["event-extensions","Class","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties');function i(j){this._layer=j;}h(i.prototype,{_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('contextchange',this._handleContextChange.bind(this)),this._layer.subscribe('show',this.attach.bind(this)),this._layer.subscribe('hide',this.detach.bind(this))];},disable:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this.detach();},attach:function(){if(this._listener)return;var j=this._layer.getContextScrollParent();if(j===window)return;this._listener=Event.listen(j,'scroll',this._layer.hide.bind(this._layer));},detach:function(){this._listener&&this._listener.remove();this._listener=null;},_handleContextChange:function(){this.detach();if(this._layer.isShown())this.attach();}});e.exports=i;});
__d("BasicTypeaheadRenderer",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(i,j){var k=[];if(i.icon)k.push(g.create('img',{alt:'',src:i.icon}));if(i.text)k.push(g.create('span',{className:'text'},[i.text]));if(i.subtext)k.push(g.create('span',{className:'subtext'},[i.subtext]));var l=g.create('li',{className:i.type||''},k);l.setAttribute('role','option');if(i.text)l.setAttribute('aria-label',i.text);return l;}h.className='basic';e.exports=h;});
__d("TypeaheadView",["event-extensions","ArbiterMixin","ARIA","BasicTypeaheadRenderer","Class","CSS","DOM","Parent","$","copyProperties","ge","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('ARIA'),i=b('BasicTypeaheadRenderer'),j=b('Class'),k=b('CSS'),l=b('DOM'),m=b('Parent'),n=b('$'),o=b('copyProperties'),p=b('ge'),q=b('tx');function r(s,t){this.element=this.content=n(s);o(this,t);}o(r.prototype,g,{events:['highlight','render','reset','select','beforeRender','next','prev'],renderer:i,autoSelect:false,accessibleResultsText:"Autocomplete results are available. Use the up and down arrow keys to navigate the results.",accessibleEmptyText:"No autocomplete results are available.",ignoreMouseover:false,init:function(){this.init=bagofholding;this.initializeEvents();this.reset();},initializeEvents:function(){Event.listen(this.element,{mouseup:this.mouseup.bind(this),mouseover:this.mouseover.bind(this)});},setTypeahead:function(s){this.typeahead=s;},getElement:function(){return this.element;},mouseup:function(event){if(event.button!=2){this.select(true);event.kill();}},mouseover:function(event){if(this.ignoreMouseover){this.ignoreMouseover=false;return;}if(this.visible)this.highlight(this.getIndex(event));},reset:function(s){if(!s)this.disableAutoSelect=false;this.justRendered=false;this.justShown=false;this.index=-1;this.items=[];this.results=[];this.value='';this.content.innerHTML='';this.inform('reset');return this;},getIndex:function(event){return this.items.indexOf(m.byTag(event.getTarget(),'li'));},getSelection:function(){var s=this.results[this.index]||null;return this.visible?s:null;},isEmpty:function(){return !this.results.length;},isVisible:function(){return this.visible;},show:function(){k.show(this.element);if(this.results&&this.results.length)if(this.autoSelect){h.notify(q._("{name} is auto-selected. Use the up and down arrow keys to navigate more results.",{name:this.getItemText(this.selected)}));}else h.notify(this.accessibleResultsText);this.typeahead&&this.element.setAttribute('aria-expanded','true');this.visible=true;return this;},hide:function(){k.hide(this.element);h.notify('');this.typeahead&&this.typeahead.setAttribute('aria-expanded','false');this.visible=false;return this;},render:function(s,t,u){this.value=s;if(!t.length){if(this.results.length&&s)h.notify(this.accessibleEmptyText);this.reset(true);return;}this.justRendered=true;if(!this.results.length){this.justShown=true;if(!this.autoSelect&&this.isVisible()&&t.length)h.notify(this.accessibleResultsText);}var v={results:t,value:s};this.inform('beforeRender',v);t=v.results;var w=this.getDefaultIndex(t);if(this.index>0&&this.index!==this.getDefaultIndex(this.results)){var x=this.results[this.index];for(var y=0,z=t.length;y<z;++y)if(x.uid==t[y].uid){w=y;break;}}this.results=t;l.setContent(this.content,this.buildResults(t));this.items=this.getItems();this.highlight(w,false);this.inform('render',t);},getItems:function(){return l.scry(this.content,'li');},buildResults:function(s){var t,u=null;if(typeof this.renderer=='function'){t=this.renderer;u=this.renderer.className||'';}else{t=a.TypeaheadRenderers[this.renderer];u=this.renderer;}t=t.bind(this);var v=s.map(function(x,y){return x.node||t(x,y);}),w=l.create('ul',{className:u,id:'typeahead_list_'+(this.typeahead?l.getID(this.typeahead):l.getID(this.element))},v);w.setAttribute('role','listbox');return w;},getDefaultIndex:function(s){var t=(this.autoSelect&&!this.disableAutoSelect);return this.index<0&&!t?-1:0;},next:function(){this.highlight(this.index+1);this.inform('next',this.selected);},prev:function(){this.highlight(this.index-1);this.inform('prev',this.selected);},getItemText:function(s){var t='';if(s){t=s.getAttribute('aria-label');if(!t){t=l.getText(s);s.setAttribute('aria-label',t);}}return t;},setIsViewingSelectedItems:function(s){this.viewingSelected=s;return this;},getIsViewingSelectedItems:function(){return this.viewingSelected;},highlight:function(s,t){var u=true;this.selected&&k.removeClass(this.selected,'selected');if(s>this.items.length-1){s=-1;}else if(s<-1)s=this.items.length-1;if(s>=0&&s<this.items.length){if(this.selected&&this.getItemText(this.items[s])===this.getItemText(this.selected))u=false;this.selected=this.items[s];k.addClass(this.selected,'selected');}this.index=s;this.disableAutoSelect=(s==-1);var v=(s!==-1),w=this.getItemText(this.selected);if(s!==-1&&this.isVisible()&&w&&this.autoSelect)if(this.justShown){h.notify(q._("{name} is auto-selected. Use the up and down arrow keys to navigate more results.",{name:w}));this.justRendered=false;this.justShown=false;v=false;}else if(u&&this.justRendered){h.notify(q._("{name} is auto-selected.",{name:w}));this.justRendered=false;v=false;}if(u&&v)h.announce(w);if(t!==false)this.inform('highlight',{index:s,selected:this.results[s],element:this.selected});},select:function(s){var t=this.index,u=this.results[t];if(u){this.inform('select',{index:t,clicked:!!s,selected:u});this.inform('afterSelect');}}});e.exports=r;});
__d("BucketedTypeaheadView",["Class","DOM","TypeaheadView","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DOM'),i=b('TypeaheadView'),j=b('copyProperties');function k(l,m){this.parent.construct(this,l,m);}g.extend(k,i);j(k.prototype,{render:function(l,m,n){m=this.buildBuckets(l,m);return this.parent.render(l,m,n);},highlight:function(l,m){if(l==-1&&this.index!==0)l=this.index;if(l>=0&&l<this.items.length&&this.results[l].type=='header')l=l+1;this.parent.highlight(l,m);},buildBuckets:function(l,m){if(!this.typeObjects)return m;var n=[],o={};for(var p=0;p<m.length;++p){var q=m[p],r=q.render_type||q.type;if(!o.hasOwnProperty(r)){o[r]=n.length;n.push([this.buildBucketHeader(r)]);}q.classNames=r;q.groupIndex=o[r];q.indexInGroup=n[q.groupIndex].length-1;n[q.groupIndex].push(q);}var s=[];for(var t=0;t<n.length;++t)s=s.concat(n[t]);return s;},buildBucketHeader:function(l){var m=this.typeObjects[l];if(m.markup){m.text=m.markup;delete m.markup;}return this.typeObjects[l];},buildResults:function(l){var m=this.parent.buildResults(l);if(this.typeObjects){return h.create('div',{className:'bucketed'},[m]);}else return m;},select:function(l){var m=this.results[this.index];if(m&&m.type!='header')this.parent.select(l);},getDefaultIndex:function(l){var m=(this.autoSelect&&!this.disableAutoSelect),n=l.length===0?-1:(l[0].type=='header'?1:0);return this.index<0&&!m?-1:n;},prev:function(){var l=this.results[this.index-1];if(l&&l.type=='header')this.index--;return this.parent.prev();},next:function(){var l=this.results[this.index+1];if(l&&l.type=='header')this.index++;return this.parent.next();}});e.exports=k;});
__d("ContextualTypeaheadView",["event-extensions","Class","ContextualLayer","ContextualLayerAutoFlip","ContextualLayerHideOnScroll","CSS","DOM","Style","BucketedTypeaheadView","Vector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('ContextualLayer'),i=b('ContextualLayerAutoFlip'),j=b('ContextualLayerHideOnScroll'),k=b('CSS'),l=b('DOM'),m=b('Style'),n=b('BucketedTypeaheadView'),o=b('Vector'),p=b('copyProperties');function q(r,s){this.parent.construct(this,r,s);}g.extend(q,n);p(q.prototype,{init:function(){this.initializeLayer();this.parent.init();},initializeLayer:function(){this.context=this.getContext();this.wrapper=l.create('div');l.appendContent(this.wrapper,this.element);k.addClass(this.element,'uiContextualTypeaheadView');this.layer=new h({context:this.context,position:'below',causalElement:this.causalElement},this.wrapper);this.layer.enableBehavior(j);if(m.isFixed(this.context))this.layer.enableBehavior(i);this.subscribe('render',this.renderLayer.bind(this));},show:function(){this.layer.show();o.getElementDimensions(this.context).setElementWidth(this.wrapper);return this.parent.show();},hide:function(){this.layer.hide();return this.parent.hide();},renderLayer:function(){if(!this.isVisible())return;if(this.layer.isShown()){this.layer.updatePosition();}else this.layer.show();},getContext:function(){return this.element.parentNode;}});e.exports=q;});
__d("TypeaheadUtil",["function-extensions"],function(a,b,c,d,e,f){b('function-extensions');var g=/[ ]+/g,h=/[^ ]+/g,i=/[.,+*?$|#{}()\^\-\[\]\\\/!@%'"~=<>_:;\u2010\u2011\u2012\u2013\u2014\u2015\u30fb\uff1a]/g,j={},k={a:"\u0430 \u00e0 \u00e1 \u00e2 \u00e3 \u00e4 \u00e5",b:"\u0431",c:"\u0446 \u00e7 \u010d",d:"\u0434 \u00f0 \u010f \u0111",e:"\u044d \u0435 \u00e8 \u00e9 \u00ea \u00eb \u011b",f:"\u0444",g:"\u0433 \u011f",h:"\u0445 \u0127",i:"\u0438 \u00ec \u00ed \u00ee \u00ef \u0131",j:"\u0439",k:"\u043a \u0138",l:"\u043b \u013e \u013a \u0140 \u0142",m:"\u043c",n:"\u043d \u00f1 \u0148 \u0149 \u014b",o:"\u043e \u00f8 \u00f6 \u00f5 \u00f4 \u00f3 \u00f2",p:"\u043f",r:"\u0440 \u0159 \u0155",s:"\u0441 \u015f \u0161 \u017f",t:"\u0442 \u0165 \u0167 \u00fe",u:"\u0443 \u044e \u00fc \u00fb \u00fa \u00f9 \u016f",v:"\u0432",y:"\u044b \u00ff \u00fd",z:"\u0437 \u017e",ae:"\u00e6",oe:"\u0153",ts:"\u0446",ch:"\u0447",ij:"\u0133",sh:"\u0448",ss:"\u00df",ya:"\u044f"};for(var l in k){var m=k[l].split(' ');for(var n=0;n<m.length;n++)j[m[n]]=l;}var o={};function p(v){return v?v.replace(i,' '):'';}function q(v){v=(''+v).toLowerCase();var w='',x='';for(var y=v.length;y--;){x=v.charAt(y);w=(j[x]||x)+w;}return w.replace(g,' ');}function r(v){var w=[],x=h.exec(v);while(x){x=x[0];w.push(x);x=h.exec(v);}return w;}function s(v,w){v=''+v;if(!o.hasOwnProperty(v)){var x=q(v),y=p(x);o[v]={value:v,flatValue:x,tokens:r(y),isPrefixQuery:y&&y[y.length-1]!=' '};}if(w&&typeof o[v].sortedTokens=='undefined'){o[v].sortedTokens=o[v].tokens.slice();o[v].sortedTokens.sort(function(z,aa){return aa.length-z.length;});}return o[v];}function t(v,w,x){var y=s(w,v=='prefix'),z=v=='prefix'?y.sortedTokens:y.tokens,aa=s(x).tokens,ba={},ca=y.isPrefixQuery&&v=='query'?z.length-1:null,da=function(ea,fa){for(var ga=0;ga<aa.length;++ga){var ha=aa[ga];if(!ba[ga]&&(ha==ea||((v=='query'&&fa===ca||v=='prefix')&&ha.indexOf(ea)===0)))return (ba[ga]=true);}return false;};return z.length&&z.every(da);}var u={parse:s,isExactMatch:t.curry('exact'),isQueryMatch:t.curry('query'),isPrefixMatch:t.curry('prefix')};e.exports=u;});
__d("DataSource",["array-extensions","ArbiterMixin","AsyncRequest","Class","TypeaheadUtil","copyProperties","createArrayFrom","createObjectFrom"],function(a,b,c,d,e,f){b('array-extensions');var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('Class'),j=b('TypeaheadUtil'),k=b('copyProperties'),l=b('createArrayFrom'),m=b('createObjectFrom');function n(o){this._maxResults=o.maxResults||10;this.token=o.token;this.queryData=o.queryData||{};this.queryEndpoint=o.queryEndpoint||'';this.bootstrapData=o.bootstrapData||{};this.bootstrapEndpoint=o.bootstrapEndpoint||'';this._exclusions=o.exclusions||[];this._indexedFields=o.indexedFields||['text','tokens'];this._alwaysPrefixMatch=o.alwaysPrefixMatch||false;this._deduplicationKey=o.deduplicationKey||null;this._minExactMatchLength=4;this._filters=[];}k(n.prototype,g,{events:['bootstrap','query','respond'],init:function(){this.init=bagofholding;this._fields=m(this._indexedFields);this._activeQueries=0;this.dirty();},dirty:function(){this.value='';this._bootstrapped=false;this._bootstrapping=false;this._data={};this.localCache={};this.queryCache={};this.inform('dirty',{});return this;},bootstrap:function(){if(this._bootstrapped)return;this.bootstrapWithoutToken();this._bootstrapped=true;this._bootstrapping=true;this.inform('bootstrap',{bootstrapping:true});},bootstrapWithoutToken:function(){this.fetch(this.bootstrapEndpoint,this.bootstrapData,{bootstrap:true,token:this.token});},bootstrapWithToken:function(){var o=k({},this.bootstrapData);o.token=this.token;this.fetch(this.bootstrapEndpoint,o,{bootstrap:true,replaceCache:true});},query:function(o,p,q){this.inform('beforeQuery',{value:o});var r=this.buildUids(o,[],q),s=this.respond(o,r);this.value=o;this.inform('query',{value:o,results:s});var t=j.parse(o).flatValue;if(p||!t||!this.queryEndpoint||this.getQueryCache().hasOwnProperty(t)||!this.shouldFetchMoreResults(s))return false;this.inform('queryEndpoint',{value:o});this.fetch(this.queryEndpoint,this.getQueryData(o,r),{value:o,exclusions:q});return true;},shouldFetchMoreResults:function(o){return o.length<this._maxResults;},getQueryData:function(o,p){var q=k({value:o},this.queryData||{});p=p||[];if(p.length)q.existing_ids=p.join(',');if(this._bootstrapping)q.bsp=true;return q;},setQueryData:function(o,p){if(p)this.queryData={};k(this.queryData,o);return this;},setBootstrapData:function(o,p){if(p)this.bootstrapData={};k(this.bootstrapData,o);return this;},getExclusions:function(){return l(this._exclusions);},setExclusions:function(o){this._exclusions=o||[];},addFilter:function(o){var p=this._filters;p.push(o);return {remove:function(){p.splice(p.indexOf(o),1);}};},clearFilters:function(){this._filters=[];},respond:function(o,p,q){var r=this.buildData(p);this.inform('respond',{value:o,results:r,isAsync:!!q});return r;},asyncErrorHandler:bagofholding,fetch:function(o,p,q){if(!o)return;var r=new h().setURI(o).setData(p).setMethod('GET').setReadOnly(true).setHandler(function(s){this.fetchHandler(s,q||{});}.bind(this));if(o===this.queryEndpoint)r.setFinallyHandler(function(){this._activeQueries--;if(!this._activeQueries)this.inform('activity',{activity:false});}.bind(this));r.setErrorHandler(this.asyncErrorHandler);this.inform('beforeFetch',{request:r,fetch_context:q});r.send();if(o===this.queryEndpoint){if(!this._activeQueries)this.inform('activity',{activity:true});this._activeQueries++;}},fetchHandler:function(o,p){var q=p.value,r=p.exclusions;if(!q&&p.replaceCache)this.localCache={};this.addEntries(o.getPayload().entries,q);this.inform('fetchComplete',{response:o,value:q,fetch_context:p});var s=(!q&&this.value)?this.value:q;this.respond(s,this.buildUids(s,[],r),true);if(!q){if(this._bootstrapping){this._bootstrapping=false;this.inform('bootstrap',{bootstrapping:false});}if(p.token&&o.getPayload().token!==p.token)this.bootstrapWithToken();}},addEntries:function(o,p){var q=this.processEntries(l(o||[]),p),r=this.buildUids(p,q);if(p){var s=this.getQueryCache();s[j.parse(p).flatValue]=r;}else this.fillCache(r);},processEntries:function(o,p){return o.map(function(q,r){var s=(q.uid=q.uid+''),t=this.getEntry(s);if(!t){t=q;t.query=p;this.setEntry(s,t);}else k(t,q);t.index===undefined&&(t.index=r);return s;},this);},getAllEntries:function(){return this._data||{};},getEntry:function(o){return this._data[o]||null;},setEntry:function(o,p){this._data[o]=p;},fillCache:function(o){var p=this.localCache;o.forEach(function(q){var r=this.getEntry(q);if(!r)return;r.bootstrapped=true;var s=j.parse(this.getTextToIndex(r)).tokens;for(var t=0,u=s.length;t<u;++t){var v=s[t];if(!p.hasOwnProperty(v))p[v]={};p[v][q]=true;}},this);},getTextToIndex:function(o){if(o.textToIndex&&!o.needs_update)return o.textToIndex;var p=[];for(var q in this._fields){var r=o[q];if(r)p.push(r.join?r.join(' '):r);}o.needs_update=false;return (o.textToIndex=p.join(' '));},mergeUids:function(o,p,q,r){var s=function(t,u){var v=this.getEntry(t),w=this.getEntry(u);if(v.extended_match!==w.extended_match)return v.extended_match?1:-1;if(v.index!==w.index)return v.index-w.index;if(v.text.length!==w.text.length)return v.text.length-w.text.length;return v.uid<w.uid;}.bind(this);this._checkExtendedMatch(r,o);return this.deduplicateByKey(o.sort(s).concat(p,q));},_checkExtendedMatch:function(o,p){var q=this._alwaysPrefixMatch?j.isPrefixMatch:j.isQueryMatch;for(var r=0;r<p.length;++r){var s=this.getEntry(p[r]);s.extended_match=s.tokens?!q(o,s.text):false;}},buildUids:function(o,p,q){if(!p)p=[];if(!o)return p;if(!q)q=[];var r=this.buildCacheResults(o,this.localCache),s=this.buildQueryResults(o),t=this.mergeUids(r,s,p,o),u=m(q.concat(this._exclusions)),v=t.filter(function(w){if(u.hasOwnProperty(w)||!this.getEntry(w))return false;for(var x=0;x<this._filters.length;++x)if(!this._filters[x](this.getEntry(w),o))return false;return (u[w]=true);},this);return this.uidsIncludingExact(o,v,u);},uidsIncludingExact:function(o,p,q){var r=p.length;if(o.length<this._minExactMatchLength||r<=this._maxResults)return p;for(var s=0;s<r;++s){var t=this.getEntry(p[s]);t.text_lower||(t.text_lower=t.text.toLowerCase());if(t.text_lower===j.parse(o).flatValue){if(s>=this._maxResults){var u=p.splice(s,1);p.splice(this._maxResults-1,0,u);}break;}}return p;},buildData:function(o){var p=[],q=Math.min(o.length,this._maxResults);for(var r=0;r<q;++r)p.push(this.getEntry(o[r]));return p;},findQueryCache:function(o){var p=0,q=null,r=this.getQueryCache();for(var s in r)if(o.indexOf(s)===0&&s.length>p){p=s.length;q=s;}return r[q]||[];},buildQueryResults:function(o){var p=j.parse(o).flatValue,q=this.findQueryCache(p);if(this.getQueryCache().hasOwnProperty(p))return q;return this.filterQueryResults(o,q);},filterQueryResults:function(o,p){var q=this._alwaysPrefixMatch?j.isPrefixMatch:j.isQueryMatch;return p.filter(function(r){return q(o,this.getTextToIndex(this.getEntry(r)));},this);},buildCacheResults:function(o,p){var q=j.parse(o,this._alwaysPrefixMatch),r=this._alwaysPrefixMatch?q.sortedTokens:q.tokens,s=r.length,t=q.isPrefixQuery?s-1:null,u={},v={},w={},x=[],y=false,z={},aa=0;for(var ba=0;ba<s;++ba){var ca=r[ba];if(!z.hasOwnProperty(ca)){aa++;z[ca]=true;}else continue;for(var da in p)if((!u.hasOwnProperty(da)&&da===ca)||((this._alwaysPrefixMatch||t===ba)&&da.indexOf(ca)===0)){if(da===ca){if(v.hasOwnProperty(da))y=true;u[da]=true;}else{if(u.hasOwnProperty(da)||v.hasOwnProperty(da))y=true;v[da]=true;}for(var ea in p[da])if(ba===0||(w.hasOwnProperty(ea)&&w[ea]==aa-1))w[ea]=aa;}}for(var fa in w)if(w[fa]==aa)x.push(fa);if(y||aa<s)x=this.filterQueryResults(o,x);return x;},deduplicateByKey:function(o){if(!this._deduplicationKey)return o;var p=m(o.map(this._getDeduplicationKey.bind(this)),o);return o.filter(function(q){return p[this._getDeduplicationKey(q)]==q;}.bind(this));},_getDeduplicationKey:function(o){var p=this.getEntry(o);return p[this._deduplicationKey]||'__'+o+'__';},getQueryCache:function(){return this.queryCache;},setMaxResults:function(o){this._maxResults=o;this.value&&this.respond(this.value,this.buildUids(this.value));},updateToken:function(o){this.token=o;this.dirty();return this;}});e.exports=n;});
__d("FullScreen",["event-extensions","Arbiter","CSS","UserAgent","copyProperties","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('UserAgent'),j=b('copyProperties'),k=b('throttle'),l=j(new g(),{listenForEvent:function(m){var n=k(this.onChange,0,this);Event.listen(m,{webkitfullscreenchange:n,mozfullscreenchange:n,fullscreenchange:n});Event.listen(document,{webkitfullscreenchange:n,mozfullscreenchange:n,fullscreenchange:n});},enableFullScreen:function(m){this.listenForEvent(m);if(m.webkitRequestFullScreen){if(i.chrome()){m.webkitRequestFullScreen(Element.ALLOW_KEYBOARD_INPUT);}else m.webkitRequestFullScreen();}else if(m.mozRequestFullScreen){m.mozRequestFullScreen();}else if(m.requestFullScreen){m.requestFullScreen();}else return false;return true;},disableFullScreen:function(){if(document.webkitCancelFullScreen){document.webkitCancelFullScreen();}else if(document.mozCancelFullScreen){document.mozCancelFullScreen();}else if(document.cancelFullScreen){document.cancelFullScreen();}else if(document.exitFullScreen){document.exitFullScreen();}else return false;return true;},isFullScreen:function(){return (document.webkitIsFullScreen||document.fullScreen||document.mozFullScreen);},toggleFullScreen:function(m){if(this.isFullScreen()){this.disableFullScreen();return false;}else return this.enableFullScreen(m);return false;},onChange:function(){var m=this.isFullScreen();h.conditionClass(document.body,'fullScreen',m);this.inform('changed');},isSupported:function(){return (document.webkitCancelFullScreen&&i.chrome())||document.mozCancelFullScreen||document.cancelFullScreen||document.exitFullScreen;}});e.exports=l;});
__d("ImageUtils",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h={hasLoaded:function(i){if(i.naturalWidth!==undefined){return i.complete&&i.width!==0;}else if(i.height==20&&i.width==20&&i.complete){return false;}else if(i.complete===undefined&&g.safari()<500){var j=new Image();j.src=i.src;return j.complete;}return i.complete;}};e.exports=h;});
__d("flattenArray",[],function(a,b,c,d,e,f){function g(h){var i=[];while(h.length){var j=h.pop();if(Array.isArray(j)){Array.prototype.push.apply(h,j);}else i.push(j);}return i.reverse();}e.exports=g;});
__d("JSXDOM",["DOM","flattenArray"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('flattenArray'),i=['a','br','button','checkbox','dd','div','dl','dt','h1','h2','h3','h4','h5','h6','hr','i','iframe','img','input','label','li','option','p','pre','select','span','strong','table','td','textarea','th','tr','ul'],j={};i.forEach(function(k){var l=function(m){var n;if(m.children){n=h(m.children);delete m.children;}return g.create(k,m,n);};j[k]=l;});e.exports=j;});
__d("KeyStatus",["event-extensions"],function(a,b,c,d,e,f){b('event-extensions');var g=null,h=null;function i(){if(!h)h=Event.listen(window,'blur',function(){g=null;j();});}function j(){if(h){h.remove();h=null;}}Event.listen(document.documentElement,'keydown',function(l){g=Event.getKeyCode(l);i();},Event.Priority.URGENT);Event.listen(document.documentElement,'keyup',function(l){g=null;j();},Event.Priority.URGENT);var k={isKeyDown:function(){return !!g;},getKeyDownCode:function(){return g;}};e.exports=k;});
__d("Menu",["event-extensions","Arbiter","CSS","DataStore","DOM","HTML","Keys","Parent","Run","Style","UserAgent","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('HTML'),l=b('Keys'),m=b('Parent'),n=b('Run'),o=b('Style'),p=b('UserAgent'),q=b('copyProperties'),r=null,s='menu:mouseover',t=null;function u(ca){if(h.hasClass(ca,'uiMenuContainer'))return ca;return m.byClass(ca,'uiMenu');}function v(ca){return m.byClass(ca,'uiMenuItem');}function w(ca){if(document.activeElement){var da=v(document.activeElement);return ca.indexOf(da);}return -1;}function x(ca){return j.find(ca,'a.itemAnchor');}function y(ca){return h.hasClass(ca,'checked');}function z(ca){return !h.hasClass(ca,'disabled')&&o.get(ca,'display')!=='none';}function aa(event){var ca=document.activeElement;if(!ca||!m.byClass(ca,'uiMenu')||!j.isNodeOfType(ca,['input','textarea'])){var da=v(event.getTarget());da&&r.focusItem(da);}}function ba(ca){p.firefox()&&x(ca).blur();r.inform('select',{menu:u(ca),item:ca});}n.onLoad(function(){var ca={};ca.click=function(event){var da=v(event.getTarget());if(da&&z(da)){ba(da);var ea=x(da),fa=ea.href,ga=ea.getAttribute('rel');return (ga&&ga!=='ignore')||(fa&&fa.charAt(fa.length-1)!=='#');}};ca.keydown=function(event){var da=event.getTarget();if(event.getModifiers().any)return;if(!t||j.isNodeOfType(da,['input','textarea']))return;var ea=Event.getKeyCode(event),fa;switch(ea){case l.UP:case l.DOWN:var ga=r.getEnabledItems(t);fa=w(ga);r.focusItem(ga[fa+(ea===l.UP?-1:1)]);return false;case l.SPACE:var ha=v(da);if(ha){ba(ha);event.prevent();}break;default:var ia=String.fromCharCode(ea).toLowerCase(),ja=r.getEnabledItems(t);fa=w(ja);var ka=fa,la=ja.length;while((~fa&&(ka=++ka%la)!==fa)||(!~fa&&++ka<la)){var ma=r.getItemLabel(ja[ka]);if(ma&&ma.charAt(0).toLowerCase()===ia){r.focusItem(ja[ka]);return false;}}}};Event.listen(document.documentElement,ca);});r=e.exports=q(new g(),{focusItem:function(ca){if(ca&&z(ca)){this._removeSelected(u(ca));h.addClass(ca,'selected');x(ca).focus();}},getEnabledItems:function(ca){return r.getItems(ca).filter(z);},getCheckedItems:function(ca){return r.getItems(ca).filter(y);},getItems:function(ca){return j.scry(ca,'li.uiMenuItem');},getItemLabel:function(ca){return ca.getAttribute('data-label',2)||'';},isItemChecked:function(ca){return h.hasClass(ca,'checked');},register:function(ca,da){ca=u(ca);if(!i.get(ca,s))i.set(ca,s,Event.listen(ca,'mouseover',aa));if(da!==false)t=ca;},setItemEnabled:function(ca,da){if(!da&&!j.scry(ca,'span.disabledAnchor')[0])j.appendContent(ca,j.create('span',{className:j.find(ca,'a').className+' disabledAnchor'},k(x(ca).innerHTML)));h.conditionClass(ca,'disabled',!da);},toggleItem:function(ca){var da=!r.isItemChecked(ca);r.setItemChecked(ca,da);},setItemChecked:function(ca,da){h.conditionClass(ca,'checked',da);x(ca).setAttribute('aria-checked',da);},unregister:function(ca){ca=u(ca);var da=i.remove(ca,s);da&&da.remove();t=null;this._removeSelected(ca);},_removeSelected:function(ca){r.getItems(ca).filter(function(da){return h.hasClass(da,'selected');}).forEach(function(da){h.removeClass(da,'selected');});}});});
__d("PrivacyConst",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={FRIENDS_MINUS_ACQUAINTANCES:127,FACEBOOK_EMPLOYEES:112,CUSTOM:111,EVERYONE:80,NETWORKS_FRIENDS_OF_FRIENDS:60,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SELF:10,NOBODY:0},i={EVERYONE:80,NETWORKS_FRIENDS:55,FRIENDS_OF_FRIENDS:50,ALL_FRIENDS:40,SOME_FRIENDS:30,SELF:10,NO_FRIENDS:0},j={BaseValue:h,FriendsValue:i};e.exports=j;});
__d("Toggler",["array-extensions","event-extensions","Arbiter","ArbiterMixin","Class","ContextualDialogX","ContextualThing","CSS","DataStore","Dialog","DOM","copyProperties","createArrayFrom","ge","getObjectValues"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('ContextualDialogX'),k=b('ContextualThing'),l=b('CSS'),m=b('DataStore'),n=b('Dialog'),o=b('DOM'),p=b('copyProperties'),q=b('createArrayFrom'),r=b('ge'),s=b('getObjectValues'),t=[],u;function v(){v=bagofholding;Event.listen(document.documentElement,'click',function(event){var z=event.getTarget();t.forEach(function(aa){aa.clickedTarget=z;aa.active&&!aa.sticky&&!k.containsIncludingLayers(aa.getActive(),z)&&!aa.inTargetFlyout(z)&&aa.inActiveDialog()&&aa.hide();});},Event.Priority.URGENT);}var w=function(){this.active=null;this.togglers={};this.setSticky(false);t.push(this);this.subscribe(['show','hide'],w.inform.bind(w));return v();};p(w.prototype,h,{show:function(z){var aa=x(this,z),ba=aa.active;if(z!==ba){ba&&aa.hide();aa.active=z;l.addClass(z,'openToggler');var ca=o.scry(z,'a[rel="toggle"]');if(ca.length>0&&ca[0].getAttribute('data-target'))l.removeClass(r(ca[0].getAttribute('data-target')),'toggleTargetClosed');o.appendContent(z,aa.getToggler('next'));o.prependContent(z,aa.getToggler('prev'));aa.inform('show',aa);}},hide:function(z){var aa=x(this,z),ba=aa.active;if(ba&&(!z||z===ba)){l.removeClass(ba,'openToggler');var ca=o.scry(ba,'a[rel="toggle"]');if(ca.length>0&&ca[0].getAttribute('data-target'))l.addClass(r(ca[0].getAttribute('data-target')),'toggleTargetClosed');s(aa.togglers).forEach(o.remove);aa.inform('hide',aa);aa.active=null;}},toggle:function(z){var aa=x(this,z);if(aa.active===z){aa.hide();}else aa.show(z);},getActive:function(){return x(this).active;},isShown:function(){return x(this).active&&l.hasClass(x(this).active,'openToggler');},inTargetFlyout:function(z){var aa=y(this.getActive());return aa&&k.containsIncludingLayers(aa,z);},inActiveDialog:function(){var z=n.getCurrent();return !z||o.contains(z.getRoot(),this.getActive());},getToggler:function(z){var aa=x(this);if(!aa.togglers[z]){aa.togglers[z]=o.create('button',{className:'hideToggler',onfocus:function(){var ba=o.scry(aa.active,'a[rel="toggle"]')[0];ba&&ba.focus();aa.hide();}});aa.togglers[z].setAttribute('type','button');}return this.togglers[z];},setSticky:function(z){var aa=x(this);z=z!==false;if(z!==aa.sticky){aa.sticky=z;if(z){aa._pt&&aa._pt.unsubscribe();}else aa._pt=g.subscribe('page_transition',aa.hide.bind(aa,null));}return aa;}});p(w,w.prototype);p(w,{bootstrap:function(z){var aa=z.parentNode;w.getInstance(aa).toggle(aa);},createInstance:function(z){var aa=new w().setSticky(true);m.set(z,'toggler',aa);return aa;},getInstance:function(z){while(z){var aa=m.get(z,'toggler');if(aa)return aa;if(l.hasClass(z,'uiToggleContext'))return w.createInstance(z);z=z.parentNode;}return (u=u||new w());},listen:function(z,aa,ba){return w.subscribe(q(z),function(ca,da){if(da.getActive()===aa)return ba(ca,da);});},subscribe:(function(z){return function(aa,ba){aa=q(aa);if(aa.contains('show'))t.forEach(function(ca){if(ca.getActive())ba.curry('show',ca).defer();});return z(aa,ba);};})(w.subscribe.bind(w))});function x(z,aa){if(z instanceof w)return z;return w.getInstance(aa);}function y(z){var aa=o.scry(z,'a[rel="toggle"]');if(aa.length>0&&aa[0].getAttribute('data-target'))return r(aa[0].getAttribute('data-target'));}e.exports=w;});
__d("Selector",["event-extensions","Arbiter","Button","ContextualLayer","copyProperties","CSS","DataStore","DOM","HTML","Input","Keys","KeyStatus","Menu","Parent","Style","Toggler","Tooltip","Vector"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Button'),i=b('ContextualLayer'),j=b('copyProperties'),k=b('CSS'),l=b('DataStore'),m=b('DOM'),n=b('HTML'),o=b('Input'),p=b('Keys'),q=b('KeyStatus'),r=b('Menu'),s=b('Parent'),t=b('Style'),u=b('Toggler'),v=b('Tooltip'),w=b('Vector'),x,y,z=[],aa;function ba(ma){return s.byClass(ma,'uiSelector');}function ca(ma){return s.byClass(ma,'uiSelectorButton');}function da(){if(!y){y=new i({position:'below'},m.create('div'));k.addClass(y.getRoot(),'uiSelectorContextualLayer');}return y;}function ea(ma){return m.scry(ma,'select')[0];}function fa(ma){return m.find(ma,'div.uiSelectorMenuWrapper');}function ga(){ga=bagofholding;r.subscribe('select',function(ma,na){if(!x||!na||na.menu!==la.getSelectorMenu(x))return;var oa=ha(x),pa=ia(na.item);if(pa){var qa=x,ra=la.isOptionSelected(na.item),sa=la.inform('select',{selector:qa,option:na.item,clone:aa});if(sa===false)return;if(oa||!ra){la.setSelected(qa,la.getOptionValue(na.item),!ra);la.inform('toggle',{selector:qa,option:na.item});la.inform('change',{selector:qa});g.inform('Form/change',{node:qa});if(ja(qa))l.set(qa,'dirty',true);}}if(!oa||!pa)x&&la.toggle(x);});}function ha(ma){return !!ma.getAttribute('data-multiple');}function ia(ma){return k.hasClass(ma,'uiSelectorOption');}function ja(ma){return !!ma.getAttribute('data-autosubmit');}var ka={keydown:function(event){var ma=event.getTarget();if(m.isNodeOfType(ma,['input','textarea']))return;switch(Event.getKeyCode(event)){case p.DOWN:case p.SPACE:case p.UP:if(ca(ma)){var na=ba(ma);la.toggle(na);return false;}break;case p.ESC:if(x){la.toggle(x);return false;}break;}},mouseover:function(event){var ma=s.byAttribute(event.getTarget(),'ajaxify');if(ma&&k.hasClass(ma,'uiSelectorButton'))la.loadMenu(ba(ma));}};Event.listen(document.documentElement,ka);u.subscribe(['show','hide'],function(ma,na){var oa=ba(na.getActive());if(oa){ga();var pa=la.getSelectorButton(oa),qa=la.getSelectorMenu(oa),ra=ma==='show';pa.setAttribute('aria-expanded',ra?'true':'false');if(ra){x=oa;if(k.hasClass(pa,'uiButtonDisabled')){la.setEnabled(oa,false);return false;}qa=qa||la.loadMenu(oa);var sa=t.getScrollParent(oa),ta=sa!==window&&sa!==m.getDocumentScrollElement();if(ta||k.hasClass(oa,'uiSelectorUseLayer')){if(ta)z.push(Event.listen(sa,'scroll',function(){na.hide();}));aa=m.create('div',{className:oa.className});k.addClass(aa,'invisible_elem');w.getElementDimensions(oa).setElementDimensions(aa);m.replace(oa,aa);var ua=k.hasClass(oa,'uiSelectorRight'),va=k.hasClass(oa,'uiSelectorBottomUp');da().setContext(aa).setContent(oa).setPosition(va?'above':'below').setAlignment(ua?'right':'left').show();}r.register(qa);if(q.isKeyDown()){var wa=r.getCheckedItems(qa);if(!wa.length)wa=r.getEnabledItems(qa);r.focusItem(wa[0]);}}else{x=null;if(aa){while(z.length)z.pop().remove();m.replace(aa,oa);da().hide();aa=null;}qa&&r.unregister(qa);if(ja(oa)&&l.get(oa,'dirty')){var xa=m.scry(oa,'input.submitButton')[0];xa&&xa.click();l.remove(oa,'dirty');}}k.conditionClass(la.getSelectorButton(oa),'selected',ra);la.inform(ra?'open':'close',{selector:oa,clone:aa});}});var la=j(new g(),{attachMenu:function(ma,na,oa){ma=ba(ma);if(ma){x&&r.unregister(la.getSelectorMenu(x));m.setContent(fa(ma),na);x&&r.register(la.getSelectorMenu(ma));aa&&da().updatePosition();if(oa){var pa=ma.getAttribute('data-name');pa&&oa.setAttribute('name',pa);if(!ha(ma))oa.setAttribute('multiple',false);var qa=ea(ma);if(qa){m.replace(qa,oa);}else m.insertAfter(ma.firstChild,oa);}return true;}},getOption:function(ma,na){var oa=la.getOptions(ma),pa=oa.length;while(pa--)if(na===la.getOptionValue(oa[pa]))return oa[pa];return null;},getOptions:function(ma){var na=r.getItems(la.getSelectorMenu(ma));return na.filter(ia);},getEnabledOptions:function(ma){var na=r.getEnabledItems(la.getSelectorMenu(ma));return na.filter(ia);},getSelectedOptions:function(ma){return r.getCheckedItems(la.getSelectorMenu(ma));},getOptionText:function(ma){return r.getItemLabel(ma);},getOptionValue:function(ma){var na=ba(ma),oa=ea(na),pa=la.getOptions(na).indexOf(ma);return pa>=0?oa.options[pa+1].value:'';},getSelectorButton:function(ma){return m.find(ma,'a.uiSelectorButton');},getSelectorMenu:function(ma){return m.scry(ma,'div.uiSelectorMenu')[0];},getValue:function(ma){var na=ea(ma);if(!na)return null;if(!ha(ma))return na.value;var oa=[],pa=na.options;for(var qa=1,ra=pa.length;qa<ra;qa++)if(pa[qa].selected)oa.push(pa[qa].value);return oa;},isOptionSelected:function(ma){return r.isItemChecked(ma);},listen:function(ma,na,oa){return this.subscribe(na,function(pa,qa){if(qa.selector===ma)return oa(qa,pa);});},loadMenu:function(ma){var na=la.getSelectorMenu(ma);if(!na){var oa=la.getSelectorButton(ma),pa=oa.getAttribute('ajaxify');if(pa){d(['AsyncRequest'],function(ra){ra.bootstrap(pa,oa);});var qa=n('<div class="uiSelectorMenuWrapper uiToggleFlyout">'+'<div class="uiMenu uiSelectorMenu loading">'+'<ul class="uiMenuInner">'+'<li><span></span></li>'+'</ul>'+'</div>'+'</div>');m.appendContent(oa.parentNode,qa);na=la.getSelectorMenu(ma);oa.removeAttribute('onmouseover');}}return na;},setButtonLabel:function(ma,na){var oa=la.getSelectorButton(ma),pa=parseInt(oa.getAttribute('data-length'),10);na=na||oa.getAttribute('data-label')||'';h.setLabel(oa,na);if(typeof na==='string'){k.conditionClass(oa,'uiSelectorBigButtonLabel',na.length>pa);if(pa&&na.length>pa){oa.setAttribute('title',na);}else oa.removeAttribute('title');}},setButtonTooltip:function(ma,na){var oa=la.getSelectorButton(ma),pa=s.byTag(oa,'a');pa&&v.set(pa,na||oa.getAttribute('data-tooltip')||'');},updateButtonARIALabel:function(ma,na){var oa=la.getSelectorButton(ma),pa=s.byTag(oa,'a');if(pa){var qa=oa.getAttribute('data-ariaprefix');if(qa)oa.setAttribute('aria-label',qa+': '+na);}},setEnabled:function(ma,na){if(!na&&x&&ba(ma)===x)la.toggle(ma);h.setEnabled(la.getSelectorButton(ma),na);},setOptionEnabled:function(ma,na){r.setItemEnabled(ma,na);},setSelected:function(ma,na,oa){oa=oa!==false;var pa=la.getOption(ma,na);if(!pa)return;var qa=la.isOptionSelected(pa);if(oa!==qa){if(!ha(ma)&&!qa){var ra=la.getSelectedOptions(ma)[0];ra&&r.toggleItem(ra);}r.toggleItem(pa);}la.updateSelector(ma);},toggle:function(ma){u.toggle(m.scry(ba(ma),'div.wrap')[0]);},updateSelector:function(ma){var na=la.getOptions(ma),oa=la.getSelectedOptions(ma),pa=ea(ma).options,qa=[],ra=[];for(var sa=0,ta=na.length;sa<ta;sa++){var ua=oa.contains(na[sa]);pa[sa+1].selected=ua;if(ua){var va=la.getOptionText(na[sa]);qa.push(va);ra.push(na[sa].getAttribute('data-tooltip')||va);}}pa[0].selected=!oa.length;var wa=k.hasClass(ma,'uiSelectorDynamicLabel'),xa=k.hasClass(ma,'uiSelectorDynamicTooltip');if(wa||xa){var ya='';if(ha(ma)){var za=la.getSelectorButton(ma);ya=za.getAttribute('data-delimiter')||', ';}qa=qa.join(ya);ra=ra.join(ya);if(wa){la.setButtonLabel(ma,qa);la.updateButtonARIALabel(ma,qa);}xa&&la.setButtonTooltip(ma,ra);}}});e.exports=la;});
__d("TextInputControl",["event-extensions","function-extensions","Class","DOMControl","Input","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Class'),h=b('DOMControl'),i=b('Input'),j=b('copyProperties');function k(l){this.parent.construct(this,l);var m=this.getRoot(),n=function(){this.update.bind(this).defer();}.bind(this);Event.listen(m,{keydown:n,paste:n});}g.extend(k,h);j(k.prototype,{setMaxLength:function(l){i.setMaxLength(this.getRoot(),l);return this;},getValue:function(){return i.getValue(this.getRoot());},isEmpty:function(){return i.isEmpty(this.getRoot());},setValue:function(l){i.setValue(this.getRoot(),l);this.update();return this;},clear:function(){return this.setValue('');},setPlaceholderText:function(l){i.setPlaceholder(this.getRoot(),l);return this;}});e.exports=k;});
__d("TextMetrics",["array-extensions","event-extensions","DOM","Style","UserAgent","debounce"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('DOM'),h=b('Style'),i=b('UserAgent'),j=b('debounce'),k;function l(){if(typeof k==='undefined'){var n=g.create('div',{className:'webkitZoomTest'}),o=function(){g.appendContent(document.body,n);k=100/n.clientHeight;g.remove(n);};Event.listen(window,'resize',j(o,100));o();}return k;}function m(n){this._node=n;this._shadow=g.create('textarea',{className:'textMetrics'});var o=['fontSize','fontStyle','fontWeight','fontFamily','wordWrap'];o.forEach(function(q){h.set(this._shadow,q,h.get(n,q));}.bind(this));var p=h.get(n,'lineHeight');if(i.chrome()||i.safari())p=Math.round(parseInt(p,10)*l())+'px';h.set(this._shadow,'lineHeight',p);document.body.appendChild(this._shadow);}m.prototype.measure=function(){var n=this._node,o=this._shadow,p=n.clientWidth-h.getFloat(n,'paddingLeft')-h.getFloat(n,'paddingRight');h.set(o,'width',Math.max(p,0)+'px');o.value=n.value+'...';return {width:o.scrollWidth,height:o.scrollHeight};};m.prototype.destroy=function(){g.remove(this._shadow);};e.exports=m;});
__d("TextAreaControl",["event-extensions","Arbiter","ArbiterMixin","Class","CSS","DOMControl","Style","TextInputControl","TextMetrics","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DOMControl'),l=b('Style'),m=b('TextInputControl'),n=b('TextMetrics'),o=b('copyProperties');function p(q){this.autogrow=j.hasClass(q,'uiTextareaAutogrow');this.parent.construct(this,q);this.width=null;Event.listen(q,'focus',this._handleFocus.bind(this));}i.extend(p,m);o(p.prototype,h,{setAutogrow:function(q){this.autogrow=q;return this;},onupdate:function(){this.parent.onupdate();if(this.autogrow){var q=this.getRoot();if(!this.metrics)this.metrics=new n(q);if(typeof this.initialHeight==='undefined'){this.isBorderBox=l.get(q,'box-sizing')==='border-box'||l.get(q,'-moz-box-sizing')==='border-box'||l.get(q,'-webkit-box-sizing')==='border-box';this.borderBoxOffset=l.getFloat(q,'padding-top')+l.getFloat(q,'padding-bottom')+l.getFloat(q,'border-top-width')+l.getFloat(q,'border-bottom-width');this.initialHeight=q.offsetHeight-this.borderBoxOffset;}var r=this.metrics.measure(),s=Math.max(this.initialHeight,r.height);if(this.isBorderBox)s+=this.borderBoxOffset;if(s!==this.height){this.height=s;l.set(q,'height',s+'px');g.inform('reflow');this.inform('resize');}}else if(this.metrics){this.metrics.destroy();this.metrics=null;}},resetHeight:function(){this.height=-1;this.update();},_handleFocus:function(){this.width=null;}});p.getInstance=function(q){return k.getInstance(q)||new p(q);};e.exports=p;});
__d("Token",["CSS","DataStore","DOM","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('copyProperties'),k=b('tx');function l(m,n){this.info=m;this.paramName=n;}j(l.prototype,{getInfo:function(){return this.info;},getText:function(){return this.info.text;},getValue:function(){return this.info.uid;},isFreeform:function(){return !!this.info.freeform;},getElement:function(){if(!this.element)this.setElement(this.createElement());return this.element;},setElement:function(m){h.set(m,'Token',this);this.element=m;return this;},isRemovable:function(){return g.hasClass(this.element,'removable');},createElement:function(){var m=this.paramName,n=this.getText(),o=this.getValue(),p=i.create('a',{href:'#','aria-label':k._("Remove {item}",{item:n}),className:'remove uiCloseButton uiCloseButtonSmall'}),q=i.create('input',{type:'hidden',value:o,name:m+'[]',autocomplete:'off'}),r=i.create('input',{type:'hidden',value:n,name:'text_'+m+'[]',autocomplete:'off'}),s=i.create('span',{className:'removable uiToken'},[n,q,r,p]);return s;}});e.exports=l;});
__d("Typeahead",["array-extensions","event-extensions","ArbiterMixin","BehaviorsMixin","Class","DataStore","DOM","Parent","Run","copyProperties","ge"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Class'),j=b('DataStore'),k=b('DOM'),l=b('Parent'),m=b('Run'),n=b('copyProperties'),o=b('ge');function p(q,r,s,t){this.args={data:q,view:r,core:s};j.set(t,'Typeahead',this);this.element=t;}p.getInstance=function(q){var r=l.byClass(q,'uiTypeahead');return r?j.get(r,'Typeahead'):null;};n(p.prototype,g,h,{init:function(q){this.init=bagofholding;this.getCore();this.proxyEvents();this.initBehaviors(q||[]);this.inform('init',this);this.data.bootstrap();this.core.focus();},getData:function(){if(!this.data){var q=this.args.data;this.data=q;this.data.init();}return this.data;},getView:function(){if(!this.view){var q=this.args.view,r=o(q.node_id);if(!r){r=k.create('div',{className:'uiTypeaheadView'});k.appendContent(this.element,r);}if(typeof q.ctor==='string'){this.view=new window[q.ctor](r,q.options||{});}else this.view=new q.ctor(r,q.options||{});this.view.init();this.view.setTypeahead(this.element);}return this.view;},getCore:function(){if(!this.core){var q=this.args.core;if(typeof q.ctor==='string'){this.core=new window[q.ctor](q.options||{});}else this.core=new q.ctor(q.options||{});this.core.init(this.getData(),this.getView(),this.getElement());}return this.core;},getElement:function(){return this.element;},swapData:function(q){var r=this.core;this.data=this.args.data=q;q.init();if(r){r.data=q;r.initData();r.reset();}q.bootstrap();return q;},proxyEvents:function(){[this.data,this.view,this.core].forEach(function(q){q.subscribe(q.events,this.inform.bind(this));},this);},initBehaviors:function(q){q.forEach(function(r){if(typeof r==='string'){if(a.TypeaheadBehaviors&&a.TypeaheadBehaviors[r]){a.TypeaheadBehaviors[r](this);}else m.onLoad(function(){if(a.TypeaheadBehaviors)(a.TypeaheadBehaviors[r]||bagofholding)(this);}.bind(this));}else this.enableBehavior(r);},this);}});p.initNow=function(q,r,s){if(s)s.init(q);q.init(r);};p.init=function(q,r,s,t){if(!k.isNodeOfType(q,['input','textarea']))q=k.scry(q,'input')[0]||k.scry(q,'textarea')[0];var u=false;try{u=document.activeElement===q;}catch(v){}if(u){p.initNow(r,s,t);}else var w=Event.listen(q,'focus',function(){p.initNow(r,s,t);w.remove();});};e.exports=p;});
__d("TypeaheadCore",["event-extensions","Arbiter","ArbiterMixin","Class","CSS","DOM","Input","InputSelection","Keys","UserAgent","bind","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DOM'),l=b('Input'),m=b('InputSelection'),n=b('Keys'),o=b('UserAgent'),p=b('bind'),q=b('copyProperties');function r(s){q(this,s);}q(r.prototype,h,{events:['blur','focus','unselect','loading'],keepFocused:true,resetOnSelect:false,resetOnKeyup:true,setValueOnSelect:false,queryTimeout:250,preventFocusChangeOnTab:false,init:function(s,t,u){this.init=bagofholding;this.data=s;this.view=t;this.root=u;this.initInput();this.inputWrap=k.find(u,'div.wrap');this.hiddenInput=k.find(u,'input.hiddenInput');this.value='';this.nextQuery=null;this.selectedText=null;if(this.setValueOnSelect&&j.hasClass(this.inputWrap,'selected'))this.selectedText=this.getValue();this.initView();this.initData();this.initEvents();this.initToggle();this._exclusions=[];},initInput:function(){this.element=k.find(this.root,'.textInput');var s=k.scry(this.element,'input')[0];if(s)this.element=s;},initView:function(){this.view.subscribe('highlight',function(s,t){this.element.focus();this.element.setAttribute('aria-activedescendant',(t.index!==-1)?k.getID(t.element):'');}.bind(this));this.view.subscribe('select',function(s,t){this.select(t.selected);}.bind(this));this.view.subscribe('afterSelect',function(){this.afterSelect();}.bind(this));},initData:function(){this.data.subscribe('respond',function(s,t){if(t.forceDisplay||t.value==this.getValue()&&!this.element.disabled)this.view.render(t.value,t.results,t.isAsync);}.bind(this));this.data.subscribe('activity',function(s,t){this.fetching=t.activity;if(!this.fetching)this.nextQuery&&this.performQuery();if(this.loading!=this.fetching){this.loading=this.fetching;this.inform('loading',{loading:this.loading});}}.bind(this));},initEvents:function(){Event.listen(this.view.getElement(),{mouseup:this.viewMouseup.bind(this),mousedown:this.viewMousedown.bind(this)});var s={blur:p(this,'blur'),focus:p(this,'focus'),click:p(this,'click'),keyup:p(this,'keyup'),keydown:p(this,'keydown')};if(o.firefox())s.text=s.keyup;if(o.firefox()<4){s.keypress=s.keydown;delete s.keydown;}Event.listen(this.element,s);Event.listen(this.element,'keypress',p(this,'keypress'));},initToggle:function(){this.subscribe('blur',this.view.hide.bind(this.view));this.subscribe('focus',this.view.show.bind(this.view));},viewMousedown:function(){this.selecting=true;},viewMouseup:function(){this.selecting=false;},blur:function(){if(this.selecting){this.selecting=false;return;}this.inform('blur');},click:function(){var s=m.get(this.element);if(s.start==s.end)this.element.select();},focus:function(){this.checkValue();this.inform('focus');},keyup:function(){if(this.resetOnKeyup&&!this.getValue())this.view.reset();this.checkValue();},keydown:function(event){if(!this.view.isVisible()||this.view.isEmpty()){this.checkValue.bind(this).defer();return;}switch(Event.getKeyCode(event)){case n.TAB:this.handleTab(event);return;case n.UP:this.view.prev();break;case n.DOWN:this.view.next();break;case n.ESC:this.view.reset();break;default:this.checkValue.bind(this).defer();return;}event.kill();},keypress:function(event){if(this.view.getSelection()&&Event.getKeyCode(event)==n.RETURN){this.view.select();event.kill();}},handleTab:function(event){if(this.preventFocusChangeOnTab)if(this.view.getSelection()){event.kill();}else event.preventDefault();this.view.select();},select:function(s){if(s&&this.setValueOnSelect){this.setValue(s.text);this.setHiddenValue(s.uid);this.selectedText=s.text;j.addClass(this.inputWrap,'selected');}},afterSelect:function(){this.keepFocused?this.element.focus():this.element.blur();this.resetOnSelect?this.reset():this.view.reset();},unselect:function(){if(this.setValueOnSelect){this.selectedText=null;j.removeClass(this.inputWrap,'selected');}this.setHiddenValue();this.inform('unselect',this);},setEnabled:function(s){var t=s===false;this.element.disabled=t;j.conditionClass(this.root,'uiTypeaheadDisabled',t);},reset:function(){this.unselect();this.setValue();!this.keepFocused&&l.reset(this.element);this.view.reset();this.inform('reset');},getElement:function(){return this.element;},setExclusions:function(s){this._exclusions=s;},getExclusions:function(){return this._exclusions;},setValue:function(s){this.value=this.nextQuery=s||'';l.setValue(this.element,this.value);},setHiddenValue:function(s){this.hiddenInput.value=(s||s===0)?s:'';g.inform('Form/change',{node:this.hiddenInput});},getValue:function(){return l.getValue(this.element);},getHiddenValue:function(){return this.hiddenInput.value||'';},checkValue:function(){var s=this.getValue();if(s==this.value)return;if(this.selectedText&&this.selectedText!=s)this.unselect();var t=Date.now(),u=t-this.time;this.time=t;this.value=this.nextQuery=s;this.performQuery(u);},performQuery:function(s){if(this.selectedText)return;s=s||0;if(this.fetching&&s<this.queryTimeout){this.data.query(this.nextQuery,true,this._exclusions);}else{this.data.query(this.nextQuery,false,this._exclusions);this.nextQuery=null;}}});e.exports=r;});
__d("URLScraper",["event-extensions","ArbiterMixin","Class","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('Class'),i=b('copyProperties');function j(ga){this.input=ga;this.enable();}i(j.prototype,g,{reset:function(){this.lastPermissiveMatch=null;},enable:function(){if(this.events)return;var ga=function(ha){setTimeout(this.check.bind(this,ha),30);};this.events=Event.listen(this.input,{paste:ga.bind(this,false),keydown:ga.bind(this,true)});},disable:function(){if(!this.events)return;for(var event in this.events)this.events[event].remove();this.events=null;},check:function(ga){var ha=this.input.value;if(ga&&j.trigger(ha))return;var ia=j.match(ha),ja=j.permissiveMatch(ha);if(ja&&(ja!=this.lastPermissiveMatch)){this.lastPermissiveMatch=ja;this.inform('match',{url:ia,alt_url:ja});}}});var k='!"#%&\'()*,-./:;<>?@[\\]^_`{|}',l='\u2000-\u206F\u00ab\u00bb',m='(?:25[0-5]|2[0-4][0-9]|1[0-9]{2}|[1-9]?[0-9])',n='(?:(?:ht|f)tps?)://',o='(?:(?:'+m+'[.]){3}'+m+')',p='(?:\\b)www\\d{0,3}[.]',q='[^\\s'+k+l+']',r='(?:(?:[.:\\-_%@]|'+q+')*'+q+')',s='(?:[.][a-z]{2,4})',t='(?::\\d+){0,1}',u='(?=[\/?#])',v='(?:'+'(?:'+n+r+t+')|'+'(?:'+o+t+')|'+'(?:'+p+r+s+t+')|'+'(?:'+r+s+t+u+')'+')',w='[\/#?]',x='\\([^\\s()<>]+\\)',y='[^\\s()<>]+',z='[^\\s'+k+l+']',aa='(?:'+'(?:'+w+')'+'(?:'+'(?:'+x+'|'+y+')*'+'(?:'+x+'|'+z+')'+')*'+')*',ba=new RegExp('('+'(?:'+v+')'+'(?:'+aa+')'+')','im'),ca='(?:'+'(?:'+w+')'+'(?:'+'(?:'+x+'|'+y+')*'+')*'+')*',da=new RegExp('('+'(?:'+v+')'+'(?:'+ca+')'+')','im'),ea=new RegExp('('+'(?:'+n+r+t+')|'+'(?:'+p+r+s+t+')'+')'),fa=/[\s'";]/;j.match=function(ga){return j.matchToPattern(ga,ba);};j.permissiveMatch=function(ga){return j.matchToPattern(ga,da);};j.matchToPattern=function(ga,ha){var ia=(ha.exec(ga)||[])[1]||null;if(ia&&ia.indexOf('@')!=-1){return (ea.exec(ia))?ia:null;}else return ia;};j.trigger=function(ga){return !fa.test(ga.charAt(ga.length-1));};e.exports=j;});
__d("XHPTemplate",["event-extensions","DataStore","DOM","HTML","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DataStore'),h=b('DOM'),i=b('HTML'),j=b('copyProperties');function k(m){this._model=m;}j(k.prototype,{render:function(){if(i.isHTML(this._model))this._model=h.setContent(document.createDocumentFragment(),this._model)[0];return this._model.cloneNode(true);},build:function(){return new l(this.render());}});j(k,{getNode:function(m,n){return k.getNodes(m)[n];},getNodes:function(m){var n=g.get(m,'XHPTemplate:nodes');if(!n){n={};var o=h.scry(m,'[data-jsid]');o.push(m);var p=o.length;while(p--){var q=o[p];n[q.getAttribute('data-jsid')]=q;q.removeAttribute('data-jsid');}g.set(m,'XHPTemplate:nodes',n);}return n;}});function l(m){this._root=m;this._populateNodes();}j(l.prototype,{_populateNodes:function(){this._nodes={};this._leaves={};var m=this._root.getElementsByTagName('*');for(var n=0,o=m.length;n<o;n++){var p=m[n],q=p.getAttribute('data-jsid');if(q){p.removeAttribute('data-jsid');this._nodes[q]=p;this._leaves[q]=!p.childNodes.length;}}},getRoot:function(){return this._root;},getNode:function(m){return this._nodes[m];},setNodeProperty:function(m,n,o){this.getNode(m)[n]=o;return this;},setNodeContent:function(m,n){if(!this._leaves[m])throw new Error("Can't setContent on non-leaf node: "+m);h.setContent(this.getNode(m),n);return this;}});e.exports=k;});
__d("reportData",["EagleEye","userAction"],function(a,b,c,d,e,f){var g=b('EagleEye'),h=b('userAction');function i(j,k){k=k||{};var l={ft:(k.ft||{}),gt:(k.gt||{})},m='-',n=a.ArbiterMonitor,o=(!!n)?n.getActFields():[],p=(!n)?'r':'a',q=[Date.now(),h.getCurrentUECount(),m,j,m,m,p,a.URI?a.URI.getRequestURI(true,true).getUnqualifiedURI().toString():location.pathname+location.search+location.hash,l,0,0,0,0].concat(o);g.log('act',q);}e.exports=i;});
__d("setTimeoutAcrossTransitions",[],function(a,b,c,d,e,f){function g(h,i){return setTimeout(h,i,false);}e.exports=g;});
__d("endsWith",[],function(a,b,c,d,e,f){function g(h,i){return h.indexOf(i,h.length-i.length)>-1;}e.exports=g;});
__d("legacy:onvisible",["OnVisible"],function(a,b,c,d){a.OnVisible=b('OnVisible');},3);
__d("PhotoEverstoreLogger",["event-extensions","AsyncRequest","copyProperties","ImageUtils"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('copyProperties'),i=b('ImageUtils'),j={BATCH_WINDOW_MS:500,storedLog:[]};function k(){}h(k,{_log:function(m){j.storedLog.push(m);if(j.storedLog.length==1)setTimeout(l,j.BATCH_WINDOW_MS,false);},logImmediately:function(m){k._log(m);},registerForLogging:function(m){if(i.hasLoaded(m)){k._log(m.src);}else Event.listen(m,'load',function(event){k._log(m.src);});}});function l(){var m=j.storedLog;j.storedLog=[];var n=JSON.stringify(m);new g().setURI('/ajax/photos/logging/everstore_logging.php').setData({loggedUrls:n}).setMethod('POST').setOption('suppressErrorHandlerWarning',true).setOption('suppressErrorAlerts',true).send();}e.exports=k;});
__d("PhotoSessionLog",["AsyncRequest","Run","Vector","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Run'),i=b('Vector'),j=b('copyProperties');function k(){}j(k,{UNKNOWN:0,ESC:1,X:2,OUTSIDE:3,UNLOAD:4,NAVIGATE:5,AGGREGATE:6,LEAVE:7,PERMALINK:0,SNOWLIFT:6,AGGREGATION_COUNT:20,set:null,time:null,views:0,fbidList:[],details:{},width:0,height:0,first:false,last:false,logIds:false,version:null,buttonLikes:0,pagingAction:'',faceTagImpressions:0,cycle:false,endOfRelevant:false,relevantCount:0,initLogging:function(l){this.set=null;this.time=new Date();this.views=0;this.hiResLoads=0;this.fullScreenViews={};this.first=true;this.last=false;this.logIds=false;this.version=l;this.buttonLikes=0;this.pagingAction='';this.faceTagImpressions=0;this.cycle=false;this.endOfRelevant=false;this.relevantCount=0;if(l===k.SNOWLIFT){var m=i.getViewportDimensions();this.width=m.x;this.height=m.y;}},setLogFbids:function(l){this.logIds=l;},setPhotoSet:function(l){this.set=l;},addButtonLike:function(){this.buttonLikes++;},setPagingAction:function(l){this.pagingAction=l;},addFaceTagImpression:function(){this.faceTagImpressions++;},setCycle:function(l){this.cycle=l;},setEndOfRelevant:function(l){this.endOfRelevant=l;},setRelevantCount:function(l){this.relevantCount=l;},setEndMetrics:function(l){this.endMetrics=l;},addPhotoView:function(l,m,n){if(this.logIds&&this.views>=this.AGGREGATION_COUNT)this.logPhotoViews(this.AGGREGATE);this.views++;if(l)this.fbidList.push([l.fbid,l.owner,Date.now()]);if(m)this.hiResLoads++;if(n)this.fullScreenViews[l.fbid]=true;},logEnterFullScreen:function(l){this.fullScreenViews[l]=true;},addDetailData:function(l,m){if(!this.details[l])this.details[l]={t:m.num_tags,l:m.has_location,c:m.has_caption,cm:m.comment_count,lk:m.like_count,w:m.width,h:m.height,ad:'{}',p:this.pagingAction};},updateAdData:function(l,m){if(this.details[l])this.details[l].ad=JSON.stringify(m);},logPhotoViews:function(l){if((!this.views)||(this.version===k.SNOWLIFT&&l==k.LEAVE))return;if(l!=this.AGGREGATE)this.last=true;var m={set:this.set,time:new Date()-this.time,fbids:this.logIds?this.fbidList:[],details:this.logIds?this.details:{},first:this.first,last:this.last,close:l?l:this.UNKNOWN,button_likes:this.buttonLikes,version:this.version,face_imp:this.faceTagImpressions,endmetric:this.endMetrics,cycle:this.cycle,end_relev:this.endOfRelevant,relev_count:this.relevantCount};if(this.version===k.SNOWLIFT){var n=i.getViewportDimensions();m.width=n.x||this.width;m.height=n.y||this.height;if(this.hiResLoads>0)m.hires_loads=this.hiResLoads;if(this.last){var o=Object.keys(this.fullScreenViews).length;if(o>0)m.fullscreen=o;}}new g().setURI('/ajax/photos/logging/session_logging.php').setAllowCrossPageTransition(true).setOption('asynchronous',(l!=k.UNLOAD)).setOption('suppressErrorHandlerWarning',true).setData(m).send();this.views=0;this.hiResLoads=0;this.fbidList=[];this.details={};this.first=false;this.buttonLikes=0;if(this.last){this.set=null;this.logIds=false;this.fullScreenViews={};}}});h.onUnload(function(){k.logPhotoViews(k.UNLOAD);});h.onLeave(function(){k.logPhotoViews(k.LEAVE);});e.exports=k;});
__d("UIPagelet",["AjaxPipeRequest","AsyncRequest","DOM","HTML","URI","copyProperties","ge"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('AsyncRequest'),i=b('DOM'),j=b('HTML'),k=b('URI'),l=b('copyProperties'),m=b('ge');function n(o,p,q,r){this._id=o||null;this._element=m(o||i.create('div'));this._src=p||null;this._context_data=q||{};this._data=r||{};this._handler=bagofholding;this._request=null;this._use_ajaxpipe=false;this._is_bundle=true;this._allow_cross_page_transition=false;this._append=false;return this;}n.loadFromEndpoint=function(o,p,q,r){r=r||{};var s='/ajax/pagelet/generic.php/';if(r.intern)s='/intern'+s;var t=(s+o).replace(/\/+/g,'/');if(r.subdomain)t=k(t).setSubdomain(r.subdomain);var u=new n(p,t,q).setUseAjaxPipe(r.usePipe).setBundleOption(o.substring(0,8)!='/intern/'&&r.bundle!==false).setAppend(r.append).setJSNonBlock(r.jsNonblock).setDisplayCallback(r.displayCallback).setConstHeight(r.constHeight).setAllowCrossPageTransition(r.crossPage);r.handler&&u.setHandler(r.handler);u.go();return u;};l(n.prototype,{getElement:function(o){o=o||false;if(o)this._element=m(this._id);return this._element;},setHandler:function(o){this._handler=o;return this;},go:function(o,p){if(arguments.length>=2||typeof o=='string'){this._src=o;this._data=p||{};}else if(arguments.length==1)this._data=o;this.refresh();return this;},setAllowCrossPageTransition:function(o){this._allow_cross_page_transition=o;return this;},setBundleOption:function(o){this._is_bundle=o;return this;},refresh:function(o){var p=function(s){this._request=null;if(o&&this._id)this._element=m(this._id);var t=j(s.getPayload());if(this._append){i.appendContent(this._element,t);}else i.setContent(this._element,t);this._handler();}.bind(this);if(this._use_ajaxpipe){this._request=new g();this._request.setCanvasId(this._id).setAppend(this._append).setConstHeight(this._constHeight).setJSNonBlock(this._jsNonblock).setDisplayCallback(this._displayCallback);}else{var q=this._displayCallback;this._request=new h().setMethod('GET').setReadOnly(true).setOption('bundle',this._is_bundle).setHandler(function(s){if(q){q(p.curry(s));}else p(s);});}var r={};l(r,this._context_data);l(r,this._data);this._request.setURI(this._src).setAllowCrossPageTransition(this._allow_cross_page_transition).setData({data:JSON.stringify(r)}).send();return this;},cancel:function(){if(this._request)this._request.abort();},setUseAjaxPipe:function(o){this._use_ajaxpipe=!!o;return this;},setAppend:function(o){this._append=!!o;return this;},setJSNonBlock:function(o){this._jsNonblock=!!o;return this;},setDisplayCallback:function(o){this._displayCallback=o;return this;},setConstHeight:function(o){this._constHeight=!!o;return this;}});e.exports=n;});
__d("PhotoStreamCache",["array-extensions","HTML","PhotosConst","PhotoEverstoreLogger","Rect","UIPagelet","URI","Vector","copyProperties","createArrayFrom"],function(a,b,c,d,e,f){b('array-extensions');var g=b('HTML'),h=b('PhotosConst'),i=b('PhotoEverstoreLogger'),j=b('Rect'),k=b('UIPagelet'),l=b('URI'),m=b('Vector'),n=b('copyProperties'),o=b('createArrayFrom');function p(){}n(p,{ERROR:'error',HTML:'html',IMAGE_DATA:'image',EXTRA:'extra',BUFFER_SIZE:3,INIT_BUCKET_SIZE:4,FULL_BUCKET_SIZE:12,ERROR_ID:-1,INIT_PLACEHOLDER:1});n(p.prototype,{init:function(q,r){this.version=q;this.pageletName=r;this.bufferSize=p.BUFFER_SIZE;this.fullBucketSize=p.FULL_BUCKET_SIZE;this.initError=false;this.isActive=true;this.leftLock=false;this.rightLock=false;this.reset();},reset:function(){this.cache={image:{},extra:{},html:{}};this.fbidList=[];this.loaded=false;this.allLoaded=false;this.permalinkMap={};this.position=0;this.totalCount=null;this.firstCursor=null;this.firstCursorIndex=null;},waitForInitData:function(){this.fbidList.push(p.INIT_PLACEHOLDER);},destroy:function(){this.reset();this.isActive=false;},isLoaded:function(){return this.loaded;},canPage:function(){if(!this.isLoaded())return false;if(this.totalCount!==null)return this.totalCount>1;return this.getLength()>1;},errorInCurrent:function(){if(this.initError){return true;}else if(!this.isLoaded())return false;return this.checkErrorAt(this.getCursor());},getLength:function(){return this.fbidList.length;},getPhotoSet:function(){return this.photoSetQuery.set;},getPhotoSetQuery:function(){return this.photoSetQuery;},getCurrentImageData:function(){return this.getImageData(this.getCursor());},getImageData:function(q){return this.getCacheContent(q,p.IMAGE_DATA);},getCurrentHtml:function(){return this.getCacheContent(this.getCursor(),p.HTML);},getCurrentExtraData:function(){return this.getCacheContent(this.getCursor(),p.EXTRA);},getCacheContent:function(q,r){if(!q||q===p.ERROR_ID||q===p.INIT_PLACEHOLDER)return null;return this.cache[r][q];},getCursorPos:function(){return this.position;},getCursor:function(){if(this.position>=0&&this.position<this.getLength())return this.fbidList[this.position];return null;},getCursorForURI:function(q){return this.permalinkMap[q];},calculatePositionForMovement:function(q){var r=this.position+q;if(this.allLoaded){var s=this.getLength();r=(s+r%s)%s;}return r;},isValidMovement:function(q){if(!this.isLoaded()||!this.canPage())return false;var r=this.calculatePositionForMovement(q);return this.getCursor()>0||(r>=0&&r<this.getLength());},moveCursor:function(q){if(!this.isValidMovement(q))return;this.position=this.calculatePositionForMovement(q);if(q!==0)this.loadMoreIfNeccessary(q>0);},checkErrorAt:function(q){if(!this.isLoaded())return false;if(q===p.ERROR_ID)return true;return false;},getRelativeMovement:function(q){for(var r=0;r<this.getLength();r++)if(this.fbidList[r]==q)return r-this.position;return null;},preloadImages:function(q){var r,s,t=this.getLength(),u=this.cache.image,v=p.BUFFER_SIZE;if(t>v*2){r=(this.position+t-v%t)%t;s=(this.position+v)%t;}else{r=0;s=t-1;}while(r!=s){var w=this.fbidList[r];if(u[w]&&u[w].url)if(q&&!u[w].resource){u[w].resource=new Image();u[w].resource.src=u[w].url;if(u[w].everstoreLogThis===true)i.logImmediately(u[w].resource.src);}else if(!q&&!u[w].small){u[w].small=new Image();u[w].small.src=u[w].smallurl||u[w].url;if(u[w].everstoreLogThis===true)i.logImmediately(u[w].small.src);}r=(r+1)%t;}},loadMoreIfNeccessary:function(q){if(this.allLoaded||(q&&this.rightLock)||(!q&&this.leftLock))return;var r=q?1:-1,s=this.position+this.bufferSize*r;if(s<0&&!this.checkErrorAt(this.getEndCursor(false))){this.leftLock=true;this.fetch(this.fullBucketSize,false);}else if(s>this.getLength()&&!this.checkErrorAt(this.getEndCursor(true))){this.rightLock=true;this.fetch(this.fullBucketSize,true);}},getEndCursor:function(q){return q?this.fbidList[this.getLength()-1]:this.fbidList[0];},calculateRelativeIndex:function(q,r,s){if(!this.totalCount)return null;var t=this.fbidList.indexOf(r),u=this.fbidList.indexOf(s);if(t===-1||u===-1)return null;var v=u-t;return (q+v+this.totalCount)%this.totalCount;},fetch:function(q,r){var s=this.getEndCursor(r),t=n({cursor:s,version:this.version,end:this.getEndCursor(!r),fetchSize:r?q:-1*q},this.photoSetQuery);if(this.totalCount&&this.firstCursorIndex!==null){t.total=this.totalCount;t.cursorIndex=this.calculateRelativeIndex(this.firstCursorIndex,this.firstCursor,s);}k.loadFromEndpoint(this.pageletName,null,t,{usePipe:true,jsNonblock:true,crossPage:true});},storeToCache:function(q){var r={};if(!this.isActive)return r;if('error' in q){this.processErrorResult(q.error);r.error=true;return r;}if('init' in q){this.processInitResult(q.init);r.init={logids:q.init.logids,fbid:q.init.fbid,loggedin:q.init.loggedin,fromad:q.init.fromad};}if('image' in q){this.processImageResult(q.image);r.image=true;}if('data' in q){this.processDataResult(q.data);r.data=true;}return r;},processInitResult:function(q){if(this.loaded)return;this.loaded=true;this.photoSetQuery=q.query;if(q.bufferSize)this.bufferSize=q.bufferSize;if(q.fullBucketSize)this.fullBucketSize=q.fullBucketSize;if(this.fbidList.length===0){this.fbidList.push(q.fbid);this.rightLock=true;}else{var r=this.fbidList.indexOf(p.INIT_PLACEHOLDER);if(r!=-1)this.fbidList[r]=q.fbid;}this.firstCursor=q.fbid;if('initIndex' in q&&'totalCount' in q){this.firstCursorIndex=q.initIndex;this.totalCount=q.totalCount;}if(this.version==h.VIEWER_PERMALINK)this.fetch(p.INIT_BUCKET_SIZE,true);},processImageResult:function(q){for(var r in q){if(r===this.firstCursor&&q[r].everstoreLogThis)i.logImmediately(q[r].url);this.cache.image[r]=q[r];if(q[r].dimensions)this.cache.image[r].dimensions=m.deserialize(q[r].dimensions);if(q[r].smalldims)this.cache.image[r].smalldims=m.deserialize(q[r].smalldims);this.permalinkMap[l(q[r].info.permalink).getUnqualifiedURI().toString()]=r;}},attachToFbidsList:function(q,r,s){if(this.allLoaded)return;if(r===-1){for(var t=q.length-1;t>=0;t--){this.fbidList.unshift(q[t]);this.position++;}this.leftLock=false;}else{for(var u=0;u<q.length;u++)this.fbidList.push(q[u]);this.rightLock=false;}if(s)this.setAllLoaded();},setAllLoaded:function(){this.allLoaded=true;if(this.getCursor()===null)this.position=this.calculatePositionForMovement(0);},processDataResult:function(q){for(var r in q){if(!this.cache.html[r])this.cache.html[r]={};for(var s in q[r].html){var t=q[r].html[s];if(typeof t==='string')t=g(t).getRootNode();this.cache.html[r][s]=o(t.childNodes);}if(!('extra' in q[r])){this.cache.extra[r]=null;continue;}this.cache.extra[r]={tagRects:{}};if(!Array.isArray(q[r].extra.tagRects))for(var u in q[r].extra.tagRects)if(q[r].extra.tagRects[u])this.cache.extra[r].tagRects[u]=j.deserialize(q[r].extra.tagRects[u]);}},processErrorResult:function(q){if(!this.isLoaded()){this.initError=true;return;}var r=q.side,s=[p.ERROR_ID];this.attachToFbidsList(s,r);},setTotalCount:function(q){this.totalCount=q;},setFirstCursorIndex:function(q){this.firstCursorIndex=q;}});e.exports=p;});
__d("PhotoSnowliftAds",["array-extensions","event-extensions","copyProperties","CSS","DataStore","DOM","PhotoSessionLog","UIPagelet","URI","Vector"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('copyProperties'),h=b('CSS'),i=b('DataStore'),j=b('DOM'),k=b('PhotoSessionLog'),l=b('UIPagelet'),m=b('URI'),n=b('Vector'),o={DEFAULT_UNITS_REFRESH_RATE:30000,UNITS_REGISTER_DELAY:1000,root:null,availableDimensions:null,loadQuery:null,lastLoadTime:0,minAds:100,units:null,isLogAdData:null,showSmallerAd:false,egoEnabled:false,refreshUnitsRate:null,adsStatus:'null',adsEvents:{},resetEvents:function(){this.adsStatus='reset';this.adsEvents={};},addEvent:function(p,q){if(q)this.adsStatus=p;var r=Date.now();this.adsEvents[p+'_'+r]=r;},init:function(p,q,r){this.reset();this.root=p;this.snowlift=q;this.showSmallerAd=r.showsmallerad;this.egoEnabled=r.ego_enabled;this.minAds=r.min_ads;this.addEvent('init',true);this.refreshUnitsRate=o.DEFAULT_UNITS_REFRESH_RATE;if(r.refresh_fast)this.refreshUnitsRate=r.refresh_rate;},reset:function(){this.lastLoadTime=0;this.units=[];this.resetEvents();this.addEvent('reset',true);},resize:function(p){this.availableDimensions=p;this.loadQuery=this.snowlift.getLoadQuery();this.processResize();},calculateUnitSizes:function(p,q){var r={};p.forEach(function(s){var t=s.root.firstChild.offsetHeight;s.units.forEach(function(v){if(!h.hasClass(v,'hidden')){var w=this.getHeight(v.firstChild,q);t-=w;}}.bind(this));var u={height:t,visible:false};s.units.forEach(function(v){var w=this.getIsAds(v),x=this.getHeight(v.firstChild,q),y=this.getUnitId(v);r[y]={height:x,visible:false,priority:0,is_ads:w,section_ref:u};}.bind(this));}.bind(this));return r;},calculateVisibleUnits:function(p,q,r){var s=0,t=this.getUnitPriority(q);t.forEach(function(u){if(q.hasOwnProperty(u)){var v=q[u],w=v.height;if(!v.section_ref.visible)w+=v.section_ref.height;v.height_below=r-w;v.visible=v.height_below>=0&&w>0;if(v.visible){v.section_ref.visible=true;r-=w;s++;}}}.bind(this));return q;},displayUnits:function(p,q){p.forEach(function(r){var s=false;r.units.forEach(function(t){var u=this.getUnitId(t),v=q[u],w=v.visible,x=v.height_below,y=v.is_ads;h.conditionClass(t,'hidden',!w);s=s||w;this.calcUnitStats(this.units[y][u],w,x);}.bind(this));h.conditionClass(r.root,'hidden',!s);}.bind(this));},getUnitPriority:function(p){var q=[],r=0,s=0;for(var t in p){var u=p[t];q.push(t);var v=this.minAds+r+s;if(u.is_ads){if(s<this.minAds)v=s;s++;}else r++;u.priority=v;}q=q.sort(function(w,x){var y=p[w],z=p[x];return y.priority-z.priority;}.bind(this));return q;},updateUnitsStatus:function(){var p=this.availableDimensions.x,q=this.availableDimensions.y,r=this.calculateUnitSizes(this.sections,p);r=this.calculateVisibleUnits(this.sections,r,q);this.displayUnits(this.sections,r);},calcUnitStats:function(p,q,r){var s=Date.now();if(p.visible)p.totalTime+=s-p.lastShowTime;if(p.trackingCode!==null&&p.totalTime>=this.UNITS_REGISTER_DELAY){var t=p.trackingCode;p.trackingCode=null;this.registerImpression(t,p.registerUrl);}p.visible=q;p.heightBelow=r;p.lastShowTime=s;},prepareResize:function(){var p=function(q){var r=j.create('div',{className:'inner'}),s=j.create('div',{className:'wrapper'},r);j.replace(q,s);j.setContent(r,q);return s;};this.sections=j.scry(this.root,'div.ego_section').map(function(q){return {root:p(q),units:j.scry(q,'div.ego_unit').map(p)};});},processResize:function(){if(this.isLoading||this.lastLoadTime===0||this.availableDimensions===null){this.setLogData();return;}this.updateUnitsStatus();this.setLogData();var p=this.nextRegisterTime();if(p!==Infinity)this.processResize.bind(this).defer(p,true);},setIsLogAdData:function(p){this.isLogAdData=p;this.addEvent('setIsLogAdData',false);this.setLogData();},setLogData:function(){var p=this.snowlift.getImageId();if(this.isLogAdData&&p){var q=n.getElementDimensions(this.snowlift.getImage()),r=n.getElementDimensions(this.snowlift.getRHCHeader()),s=n.getElementDimensions(this.snowlift.getRHCBody()),t=n.getElementDimensions(this.snowlift.getRHCFooter()),u={query_set:this.snowlift.getLoadQuery().set,window_x:window.innerWidth,window_y:window.innerHeight,image_x:q.x,image_y:q.y,header_x:r.x,header_y:r.y,body_x:s.x,body_y:s.y,footer_x:t.x,footer_y:t.y,ads_below_space:this.getAdsBelowSpace(),time:Date.now(),adsStatus:this.adsStatus,adsEvents:this.adsEvents};k.updateAdData(p,u);}},getAdsBelowSpace:function(){var p=[],q=this.units[1];for(var r in q)if(q.hasOwnProperty(r))p.push(q[r].heightBelow);return p;},getIsAds:function(p){var q=j.scry(p,'div.fbAdUnit');return q.length;},getUnitId:function(p){if(this.getIsAds(p)){return this.getAdId(p);}else return this.getEgoId(p);},getEgoId:function(p){var q=j.find(p,'div.fbEgoUnit'),r=q.getAttribute('data-ego'),s=JSON.parse(r).egoid;return s;},getAdId:function(p){var q=j.find(p,'div.fbAdUnit'),r=q.getAttribute('data-ad'),s=JSON.parse(r).adid;return s;},nextRegisterTime:function(){var p=Infinity,q=g(g({},this.units[0]),this.units[1]);for(var r in q)if(q.hasOwnProperty(r)){var s=q[r];if(s.trackingCode!==null&&s.visible)p=Math.min(p,this.UNITS_REGISTER_DELAY-s.totalTime);}return p;},getHeight:function(p,q){var r=i.get(p,'height');if(r&&r.x===q)return r.y;return this.cacheHeight(p,q);},cacheHeight:function(p,q){var r={x:q,y:p.offsetHeight};i.set(p,'height',r);return r.y;},loadAdsAndEgo:function(){this.resetEvents();this.addEvent('adsRequested',true);l.loadFromEndpoint('WebEgoPane',this.root.id,{pid:34,data:[this.loadQuery.set,true,this.egoEnabled]},{crossPage:true,bundle:false});},unitsLoaded:function(p,q){var r;if(q){r='/ai.php';this.addEvent('adsLoaded',true);}else{r='/ajax/ei.php';this.addEvent('egoLoaded',true);}var s={};for(var t in p)if(p.hasOwnProperty(t))s[t]={trackingCode:p[t],totalTime:0,lastShowTime:0,heightBelow:-10000,visible:false,registerUrl:r};this.units[q]=s;if(q)this.waitForImages(this.imagesLoaded.bind(this));},imagesLoaded:function(){this.prepareResize();this.addEvent('imagesLoaded',true);this.lastLoadTime=Date.now();this.isLoading=false;this.processResize();h.removeClass(this.root,'loading');},loadAdsFromUserActivity:function(){var p=Date.now(),q=this.refreshUnitsRate;if(!this.isLoading&&p-this.lastLoadTime>q){h.addClass(this.root,'loading');this.isLoading=true;this.loadAdsAndEgo();}},registerImpression:function(p,q){var r=j.create('iframe',{src:m(q).addQueryData({aed:p}),width:0,height:0,frameborder:0,scrolling:'no',className:'fbEmuTracking'});r.setAttribute('aria-hidden','true');j.appendContent(this.root,r);},waitForImages:function(p){var q=j.scry(this.root,'img.img'),r=q.length,s=r;if(s===0)p();var t=function(){s--;if(s===0)p.defer();};for(var u=0;u<r;u++){var v=q[u];if(v.complete){t();}else Event.listen(v,{load:t,error:t,abort:t});}}};e.exports=o;});
__d("PhotoViewer",["Bootloader","copyProperties"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('copyProperties');function i(){this.image=null;this.root=null;this.stream=null;}h(i,{bootstrap:function(j,k){g.loadModules(['PhotoSnowlift'],function(l){l.bootstrap(j,k);});}});h(i.prototype,{getEventPrefix:bagof(null),getEventString:function(j){var k=this.getEventPrefix();if(k)return k+'.'+j;return null;},getImage:function(){return this.image;},getPosition:function(){return this.stream?this.stream.getCursor():null;},getRoot:function(){return this.root;},getSourceString:bagof(null),getVersionConst:bagof(null)});e.exports=i;});
__d("ScrollableArea",["array-extensions","event-extensions","Animation","ArbiterMixin","CSS","DataStore","DOM","Parent","Run","SimpleDrag","Style","UserAgent","Vector","copyProperties"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('Animation'),h=b('ArbiterMixin'),i=b('CSS'),j=b('DataStore'),k=b('DOM'),l=b('Parent'),m=b('Run'),n=b('SimpleDrag'),o=b('Style'),p=b('UserAgent'),q=b('Vector'),r=b('copyProperties');function s(t,u){if(!t)return;u=u||{};this._elem=t;this._wrap=k.find(t,'div.uiScrollableAreaWrap');this._body=k.find(this._wrap,'div.uiScrollableAreaBody');this._content=k.find(this._body,'div.uiScrollableAreaContent');this._track=k.find(t,'div.uiScrollableAreaTrack');this._gripper=k.find(this._track,'div.uiScrollableAreaGripper');this._options=u;this.adjustGripper.bind(this).defer();this._listeners=[Event.listen(this._wrap,'scroll',this._handleScroll.bind(this))];if(u.fade!==false)this._listeners.push(Event.listen(t,'mouseenter',this.showScrollbar.shield(this)),Event.listen(t,'mousemove',this._handleMousemove.bind(this)),Event.listen(t,'mouseout',this.hideScrollbar.shield(this)));if(p.safari()||p.chrome()){this._listeners.push(Event.listen(t,'mousedown',function(){var v=Event.listen(window,'mouseup',function(){if(t.scrollLeft)t.scrollLeft=0;v.remove();});}));}else if(p.firefox())this._wrap.addEventListener('DOMMouseScroll',function(event){event.axis===event.HORIZONTAL_AXIS&&event.preventDefault();},false);this.initDrag();j.set(this._elem,'ScrollableArea',this);if(!u.persistent)m.onLeave(this.destroy.bind(this));}r(s,{renderDOM:function(){var t=k.create('div',{className:'uiScrollableAreaContent'}),u=k.create('div',{className:'uiScrollableAreaBody'},t),v=k.create('div',{className:'uiScrollableAreaWrap'},u),w=k.create('div',{className:'uiScrollableArea native'},v);return {root:w,wrap:v,body:u,content:t};},fromNative:function(t,u){if(!i.hasClass(t,'uiScrollableArea')||!i.hasClass(t,'native'))return;u=u||{};i.removeClass(t,'native');var v=k.create('div',{className:'uiScrollableAreaTrack'},k.create('div',{className:'uiScrollableAreaGripper'}));if(u.fade!==false){i.addClass(t,'fade');i.addClass(v,'invisible_elem');}else i.addClass(t,'nofade');k.appendContent(t,v);var w=new s(t,u);w.resize();return w;},getInstance:function(t){var u=l.byClass(t,'uiScrollableArea');return u?j.get(u,'ScrollableArea'):null;},poke:function(t){var u=s.getInstance(t);u&&u.poke();}});r(s.prototype,h,{initDrag:function(){var t=new n(this._gripper);t.subscribe('start',function(u,event){if(!((event.which&&event.which===1)||(event.button&&event.button===1)))return;var v=q.getEventPosition(event).y,w=this._gripper.offsetTop,x=t.subscribe('update',function(z,event){var aa=q.getEventPosition(event).y-v,ba=this._elem.clientHeight,ca=this._content.offsetHeight,da=this._track.offsetHeight,ea=ba/ca*da,fa=ca-this._wrap.offsetHeight,ga=w+aa,ha=da-ea;ga=Math.max(Math.min(ga,ha),0);var ia=ga/ha*fa;this._wrap.scrollTop=ia;}.bind(this)),y=t.subscribe('end',function(){t.unsubscribe(x);t.unsubscribe(y);});}.bind(this));},adjustGripper:function(){var t=this._elem.clientHeight,u=this._content.offsetHeight,v=this._track.offsetHeight,w=t/u*v;if(w<v){o.set(this._gripper,'height',w+'px');var x=this._wrap.scrollTop/u*v;o.set(this._gripper,'top',x+'px');i.show(this._gripper);}else i.hide(this._gripper);this._checkContentBoundaries();return this;},_checkContentBoundaries:function(){i.conditionClass(this._elem,'contentBefore',this._wrap.scrollTop>0);i.conditionClass(this._elem,'contentAfter',!this.isScrolledToBottom());},destroy:function(){this._listeners.forEach(function(t){t.remove();});this._listeners.length=0;},_handleMousemove:function(event){var t=q.getElementPosition(this._track).x,u=q.getElementDimensions(this._track).x;if(Math.abs(t+u/2-q.getEventPosition(event).x)<25){this.showScrollbar(false);}else this.hideScrollbar();},_handleScroll:function(event){this.adjustGripper();if(this._options.fade!==false)this.showScrollbar();this.inform('scroll');},hideScrollbar:function(t){if(!this._scrollbarVisible)return this;this._scrollbarVisible=false;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(t){o.set(this._track,'opacity',0);i.addClass.curry(this._track,'invisible_elem');}else this._hideTimeout=function(){if(this._hideAnimation){this._hideAnimation.stop();this._hideAnimation=null;}this._hideAnimation=(new g(this._track)).from('opacity',1).to('opacity',0).duration(250).ondone(i.addClass.curry(this._track,'invisible_elem')).go();}.bind(this).defer(750);return this;},resize:function(){var t=q.getElementDimensions(this._elem).x;if(!this._options.fade)t-=10;t=Math.max(0,t);o.set(this._body,'width',t+'px');return this;},showScrollbar:function(t){this.adjustGripper();if(this._scrollbarVisible)return this;this._scrollbarVisible=true;if(this._hideTimeout){clearTimeout(this._hideTimeout);this._hideTimeout=null;}if(this._hideAnimation){this._hideAnimation.stop();this._hideAnimation=null;}o.set(this._track,'opacity',1);i.removeClass(this._track,'invisible_elem');if(t!==false)this.hideScrollbar();return this;},isScrolledToBottom:function(){return this._wrap.scrollTop>=this._wrap.scrollHeight-this._wrap.clientHeight;},scrollToBottom:function(t){this.setScrollTop(this._wrap.scrollHeight,t);},scrollToTop:function(t){this.setScrollTop(0,t);},scrollIntoView:function(t,u){var v=this._wrap.clientHeight,w=t.offsetHeight,x=this._wrap.scrollTop,y=x+v,z=t.offsetTop,aa=z+w;if(z<x||v<w){this.setScrollTop(z,u);}else if(aa>y)this.setScrollTop(x+(aa-y),u);},poke:function(){var t=this._wrap.scrollTop;this._wrap.scrollTop+=1;this._wrap.scrollTop-=1;this._wrap.scrollTop=t;return this.showScrollbar(false);},getScrollTop:function(){return this._wrap.scrollTop;},getScrollHeight:function(){return this._wrap.scrollHeight;},setScrollTop:function(t,u){if(u!==false){if(this._scrollTopAnimation)this._scrollTopAnimation.stop();this._scrollTopAnimation=(new g(this._wrap)).to('scrollTop',t).ease(g.ease.end).go();}else this._wrap.scrollTop=t;}});e.exports=s;});
__d("PhotoSnowlift",["array-extensions","event-extensions","function-extensions","Arbiter","AsyncDialog","AsyncRequest","Bootloader","Class","CSS","Dialog","DOM","DOMControl","DOMScroll","FullScreen","ImageUtils","KeyEventController","Keys","LinkController","Locale","PageTransitions","Parent","PhotosConst","PhotoSessionLog","PhotoSnowliftAds","PhotoStreamCache","PhotosUtils","PhotoViewer","Rect","ScrollableArea","Style","Toggler","UIPagelet","URI","UserAgent","Vector","$","computeRelativeURI","copyProperties","createArrayFrom","ge","goURI","tx","userAction"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('AsyncDialog'),i=b('AsyncRequest'),j=b('Bootloader'),k=b('Class'),l=b('CSS'),m=b('Dialog'),n=b('DOM'),o=b('DOMControl'),p=b('DOMScroll'),q=b('FullScreen'),r=b('ImageUtils'),s=b('KeyEventController'),t=b('Keys'),u=b('LinkController'),v=b('Locale'),w=b('PageTransitions'),x=b('Parent'),y=b('PhotosConst'),z=b('PhotoSessionLog'),aa=b('PhotoSnowliftAds'),ba=b('PhotoStreamCache'),ca=b('PhotosUtils'),da=b('PhotoViewer'),ea=b('Rect'),fa=b('ScrollableArea'),ga=b('Style'),ha=b('Toggler'),ia=b('UIPagelet'),ja=b('URI'),ka=b('UserAgent'),la=b('Vector'),ma=b('$'),na=b('computeRelativeURI'),oa=b('copyProperties'),pa=b('createArrayFrom'),qa=b('ge'),ra=b('goURI'),sa=b('tx'),ta=b('userAction'),ua=b('event-extensions').$E;function va(){this.parent.construct(this);}oa(va,{STATE_ERROR:'error',STATE_HTML:'html',STATE_IMAGE_PIXELS:'image_pixels',STATE_IMAGE_DATA:'image',LOADING_TIMEOUT:2000,PAGER_FADE:3000,FULL_SCREEN_PADDING:10,STAGE_HIRES_MAX:{x:2048,y:2048},STAGE_NORMAL_MAX:{x:960,y:960},STAGE_MIN:{x:520,y:520},SIDEBAR_SIZE_MAX:340,SIDEBAR_SIZE_MIN:285,STAGE_CHROME:{x:102,y:42},VIDEO_BOTTOM_BAR_SPACE:40,GOPREV_AREA:120,TIMELINE_STRETCH_WIDTH:843,TIMELINE_STRETCH_MIN:480,MIN_TAG_DISTANCE:83,_instance:null,getInstance:function(){if(!va._instance)va._instance=new va();return va._instance;},initInstance:function(wa,xa){va.getInstance().init(wa,xa);},addPhotoFbids:function(wa,xa,ya,za){va.getInstance().addPhotoFbids(wa,xa,ya,za);},attachFollowFlyout:function(wa){n.insertAfter(ma('fbPhotoSnowliftSubscribe'),wa);},attachSubscribeFlyout:function(wa){n.insertAfter(ma('fbPhotoSnowliftSubscribe'),wa);},attachTagger:function(wa){va.getInstance().attachTagger(wa);},preload:function(wa,xa){va.getInstance().preload(wa,xa);},bootstrap:function(wa,xa){if(xa&&xa.getAttribute('data-vaultbox')){j.loadModules(['VaultBox'],function(ya){ya.bootstrap(wa,xa);});return;}va.getInstance().bootstrap(wa,xa);},closeRefresh:function(){va.getInstance().closeRefresh();},deletePhoto:function(wa){va.getInstance().deletePhoto(wa);},getImage:function(){return va.getInstance().getImage();},getImageId:function(){return va.getInstance().getImageId();},getLoadQuery:function(){return va.getInstance().getLoadQuery();},getRHCBody:function(){return va.getInstance().getRHCBody();},getRHCFooter:function(){return va.getInstance().getRHCFooter();},getRHCHeader:function(){return va.getInstance().getRHCHeader();},getRoot:function(){return va.getInstance().getRoot();},likePhotoSkipConfirmation:function(wa){va.getInstance().likePhotoSkipConfirmation(wa);},saveTagsFromPayload:function(wa){va.getInstance().saveTagsFromPayload(wa);},saveTagsFromPayloadDelayed:function(wa){va.saveTagsFromPayload.curry(wa).defer(2000);},handleServerError:function(wa,xa){va.getInstance().handleServerError(wa,xa);},storeFromData:function(wa){va.getInstance().storeFromData(wa);},swapData:function(){va.getInstance().swapData();},switchVideo:function(wa,xa,ya){va.getInstance().switchVideo(wa,xa,ya);},touchMarkup:bagofholding,updateTotalCount:function(wa,xa,ya){va.getInstance().updateTotalCount(wa,xa,ya);}});k.extend(va,da);oa(va.prototype,{switchTimer:null,imageRefreshTimer:null,imageLoadingTimer:null,lastPage:0,currentMinSize:null,extraClass:null,currentImageSize:null,resetUriStack:true,thumbSrc:null,shouldStretch:false,stageMax:va.STAGE_NORMAL_MAX,stageChrome:va.STAGE_CHROME,stagePagerPrev:null,ua:null,showHiRes:false,showHover:false,skipLikePhotoConfirmation:false,preload:function(wa,xa){j.loadModules(['fb-photos-snowlift-css','Live','PhotoTagApproval','PhotoTagger','PhotoTags','TagTokenizer','fb-photos-snowlift-fullscreen-css'],bagofholding);var ya=this.getImageSrc(ja(wa).getQueryData());if(ya)(new Image()).src=ya;},bootstrap:function(wa,xa){this.preload(wa,xa);aa.reset();this.resetUriStack=true;if(this.isOpen)if(this.openExplicitly){this.closeCleanup();this.resetUriStack=false;}else return;this.ua=ta('snowlift',xa,null,'FORCE').set_namespace('snowlift').set_ua_id('open');this.returningToStart=false;this.loading&&l.removeClass(this.loading,'loading');if(xa){l.addClass((this.loading=xa),'loading');this.getThumbAndSize(xa);}else this.loading=null;g.inform('PhotoSnowlift.GO',wa,g.BEHAVIOR_STATE);this.loadFrameIfUninitialized();},getEventPrefix:function(){return 'PhotoSnowlift';},getRoot:function(){return this.root;},getSourceString:function(){return 'snowlift';},getVersionConst:function(){return y.VIEWER_SNOWLIFT;},getImage:function(){return this.image;},getImageId:function(){return this.stream.getCursor();},getRHCHeader:function(){return this.rhcHeader;},getRHCBody:function(){return this.ufiForm;},getRHCFooter:function(){return this.rhcFooter;},getLoadQuery:function(){return this.loadQuery;},getOwnerId:function(){var wa=this.stream.getCurrentImageData();if(wa)return wa.info.owner;return null;},getThumbAndSize:function(wa){this.currentImageSize=null;this.thumbSrc=null;var xa=ja(wa.getAttribute('ajaxify')).getQueryData();if(!xa.size&&!xa.share_id)return;this.currentImageSize=new la(0,0);if(xa.size){var ya=la.deserialize(xa.size);if(!ya.x||!ya.y)return;this.currentImageSize=ya;}if(!l.hasClass(wa,'uiMediaThumb')&&!l.hasClass(wa,'uiPhotoThumb')&&!l.hasClass(wa,'uiScaledThumb')&&!l.hasClass(wa,'uiVideoThumb'))return;if(wa.getAttribute('data-cropped'))return;var za=n.scry(wa,'img')[0],ab=n.scry(wa,'i')[0],bb=x.byAttribute(wa,'data-size');this.shouldStretch=bb&&this.currentImageSize&&za&&bb.getAttribute('data-size')==="2"&&this.currentImageSize.x>this.currentImageSize.y&&this.currentImageSize.x<=va.TIMELINE_STRETCH_WIDTH&&za.offsetWidth===va.TIMELINE_STRETCH_WIDTH;var cb;if(za){cb=za.src;}else if(ab){cb=ga.get(ab,'backgroundImage').replace(/.*url\("?([^"]*)"?\).*/,'$1');}else return;this.thumbSrc=cb;},loadFrameIfUninitialized:function(){if(this.root)return;new i('/ajax/photos/snowlift/init.php').setAllowCrossPageTransition(true).setMethod('GET').setReadOnly(true).send();},init:function(wa,xa){this.showHiRes=xa.hires;this.showHover=xa.pivot_hover;z.setEndMetrics(xa.pivot_end_metric);this.fullscreen=xa.hires&&q.isSupported();this.showOGVideos=xa.og_videos;this.stageMax=this.showHiRes?va.STAGE_HIRES_MAX:va.STAGE_NORMAL_MAX;var ya=qa('fbPhotoSnowlift');if(!ya){ya=n.appendContent(document.body,wa)[0];this.initialLoad=false;}if(this.root==ya)return;this.initializeNodes(ya);aa.init(this.sideAdUnit,this,xa);if(!this.subscription){u.registerHandler(this.handleNavigateAway.bind(this));this.subscription=g.subscribe('PhotoSnowlift.GO',function(za,ab){this.openExplicitly=true;this.loading&&l.removeClass(this.loading,'loading');this.open(ab);}.bind(this));}this.transitionHandlerRegistered=false;this.returningToStart=false;w.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;g.subscribe('PhotoTagApproval.HILITE_TAG',this.onHiliteTag.bind(this));g.subscribe('PhotoTagApproval.UPDATE_TAG_BOX',this.onUpdateTagBox.bind(this));if(this.fullscreen)q.subscribe('changed',this.onFullScreenChange.bind(this));},onFullScreenChange:function(){if(q.isFullScreen()){if(!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))this.collapseRHC();var wa=this.stream.getCurrentImageData();if(wa&&wa.url&&this.image.src!==wa.url&&this.shouldShowHiRes(wa))this.switchImage(wa.url);this.adjustForResize();}else this.uncollapseRHC();ha.hide();},initializeNodes:function(wa){this.root=wa;this.container=n.find(wa,'div.fbPhotoSnowliftContainer');this.popup=n.find(this.container,'div.fbPhotoSnowliftPopup');this.rhc=n.find(this.popup,'div.rhc');this.rhcHeader=n.find(this.rhc,'div.rhcHeader');this.rhcFooter=n.find(this.rhc,'div.rhcFooter');this.ufiForm=n.find(this.rhc,'form.fbPhotosSnowliftFeedbackForm');this.ufiInputContainer=ma('fbPhotoSnowliftFeedbackInput');this.scroller=n.find(this.ufiForm,'div.rhcScroller');this.scrollerBody=n.find(this.scroller,'div.uiScrollableAreaBody');this.stageWrapper=n.find(this.popup,'div.stageWrapper');this.errorBox=n.find(this.stageWrapper,'div.stageError');this.image=n.find(this.stageWrapper,'img.spotlight');this.stage=n.find(this.stageWrapper,'div.stage');this.videoStage=n.find(this.stageWrapper,'div.videoStage');if(this.showOGVideos)this.ogVideoStage=n.find(this.stageWrapper,'div.ogVideoStage');this.prevPager=n.find(this.root,'a.snowliftPager.prev');this.nextPager=n.find(this.root,'a.snowliftPager.next');this.stageActions=n.find(wa,'div.stageActions');this.buttonActions=n.find(this.stageActions,'div.fbPhotosPhotoButtons');this.sideAdUnit=ma('fbPhotoSnowliftAdsSide');l.conditionClass(this.root,'fullScreenAvailable',this.fullscreen);},initializeScroller:function(){this.initializeScroller=bagofholding;this.scrollableArea=fa.fromNative(this.scroller,{fade:true,persistent:true});var wa=function(event){var xa=ua(event).getTarget();if(n.contains(this.ufiInputContainer,xa)){var ya=o.getInstance(xa);if(ya){this.scrollableArea.scrollToBottom();var za=ya.subscribe('resize',function(){var bb=this.scrollableArea.isScrolledToBottom();this.adjustScroller();bb&&this.scrollableArea.scrollToBottom();}.bind(this)),ab=Event.listen(xa,'blur',function(){ya.unsubscribe(za);ab.remove();});}}}.bind(this);g.subscribe('ufi/comment',function(xa,ya){if(this.ufiForm===ya.form){this.adjustScrollerIfNecessary();this.scrollableArea.scrollToBottom();}}.bind(this));Event.listen(this.rhc,'click',function(event){var xa=event.getTarget();if(x.byTag(xa,'a')||x.byTag(xa,'button')||n.isNodeOfType(xa,'input'))this.adjustScrollerIfNecessary();}.bind(this));g.subscribe('reflow',function(){if(this.isOpen)this.adjustScroller();}.bind(this));g.subscribe(['reflow','CommentUFI.Pager'],function(){if(this.isOpen)this.adjustScroller();}.bind(this));if(this.ufiForm.attachEvent){this.ufiForm.attachEvent('onfocusin',wa);}else this.ufiForm.addEventListener('focus',wa,true);},openHandler:function(wa){if(this.isOpen||wa.getPath()!='/photo.php'||this.returningToStart||wa.getQueryData().closeTheater||wa.getQueryData().permPage||wa.getQueryData().makeprofile){this.openHandlerRegistered=false;return false;}this.open(wa);this._uriStack.push(ja(wa).getQualifiedURI().toString());w.transitionComplete();return true;},getImageSrc:function(wa){if(wa.smallsrc){if(!wa.size)return wa.smallsrc;var xa=la.deserialize(wa.size),ya=this.getStageSize(xa);if(ya.x<=va.STAGE_NORMAL_MAX.x&&ya.y<=va.STAGE_NORMAL_MAX.y)return wa.smallsrc;}return wa.src;},open:function(wa){var xa=ja(wa).getQueryData(),ya=this.getImageSrc(xa);if(ya){delete xa.src;delete xa.smallsrc;}if(this.resetUriStack)this._uriStack=[];if(!this.initialLoad){xa.firstLoad=true;this.initialLoad=true;}this.sessionID=Date.now();this.loadQuery=oa(xa,{ssid:this.sessionID});this.isOpen=true;this.pagersShown=false;this.refreshOnClose=false;this.hilitedTag=null;this.loadingStates={image:false,html:false};this.replaceUrl=false;this.isOGVideo=xa.hasOwnProperty('share_id');this.stream=new ba();if(!this.isOGVideo)this.stream.init(y.VIEWER_SNOWLIFT,'PhotoViewerPagelet');this.fetchInitialData();this.setLoadingState(va.STATE_HTML,true);this.rhcCollapsed=false;s.registerKey('ESCAPE',this.closeListener.bind(this));j.loadModules(['fb-photos-snowlift-css'],this._open.bind(this,wa,ya));},getViewerPagelet:function(){if(this.isOGVideo){return 'OGViewerPagelet';}else return 'PhotoViewerInitPagelet';},_open:function(wa,xa){this.createLoader(xa);l.show(this.root);(function(){var ab=la.getScrollPosition();l.addClass(document.documentElement,'theaterMode');var bb=p.getScrollbarSize();if(bb===0){this.extraClass='zeroScrollbar';}else if(bb===20){this.extraClass='scrollbar20';}else this.extraClass='defaultScrollbar';l.addClass(document.body,this.extraClass);p.scrollTo(ab,0);}).defer();this.ua&&this.ua.add_event('frame');g.inform('layer_shown',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.OPEN');this.stageHandlers=[Event.listen(window,'resize',this.adjustForResize.bind(this)),Event.listen(this.root,'click',this.closeListener.bind(this)),Event.listen(this.stageWrapper,'click',this.buttonListener.bind(this)),Event.listen(this.stageWrapper,'mouseleave',function(event){this.unhiliteAllTags();this.hidePagers();}.bind(this)),Event.listen(this.stageWrapper,'mousemove',this.hilitePagerOnMouseMove.bind(this)),Event.listen(this.stageWrapper,'mousemove',this.hiliteTagsOnMouseMove.bind(this))];this.stageHandlers.push(Event.listen(this.container,'click',(function(event){var ab=event.getTarget();if(x.byClass(ab,'rotateRight')){this.rotate('right');}else if(x.byClass(ab,'rotateLeft')){this.rotate('left');}else if(this.fullscreen)if(x.byClass(ab,'fbPhotoSnowliftFullScreen')){this.toggleFullScreen();}else if(x.byClass(ab,'fbPhotoSnowliftCollapse'))this.toggleCollapse();}).bind(this)));var ya=qa('fbPhotoSnowliftFeedback');if(ya)this.stageHandlers.push(Event.listen(ya,'click',function(event){if(x.byClass(event.getTarget(),'like_link'))this.toggleLikeButton();var ab=x.byClass(event.getTarget(),'uiUfiCollapsedComment');if(ab)l.addClass(ab,'uiUfiCollapsedCommentToggle');}.bind(this)));var za=qa('fbPhotoSnowliftOnProfile');if(za)this.stageHandlers.push(Event.listen(za,'click',function(event){if(x.byClass(event.getTarget(),'fbPhotoRemoveFromProfileLink'))this.refreshOnClose=true;}.bind(this)));if(this.resetUriStack)this.startingURI=ja.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI();if(!xa)this.setLoadingState(va.STATE_IMAGE_DATA,true);if(!this.transitionHandlerRegistered){w.registerHandler(this.transitionHandler.bind(this));this.transitionHandlerRegistered=true;}z.initLogging(z.SNOWLIFT);this.relevantCount=ja(wa).getQueryData().relevant_count;z.setRelevantCount(this.relevantCount);if(ka.firefox()<13)this.turnFlashAutoplayOff.defer();(function(){this.root.focus();}).bind(this).defer();},toggleFullScreen:function(){var wa=q.toggleFullScreen(document.documentElement);if(wa){var xa=this.stream.getCurrentImageData();if(xa&&xa.url&&this.image.src!==xa.url&&this.shouldShowHiRes(xa))(new Image()).src=xa.url;z.logEnterFullScreen(this.stream.getCursor());}},getStream:function(){return this.stream;},fetchInitialData:function(){if(!this.isOGVideo){this.ua&&this.ua.add_event('init_data');this.stream.waitForInitData();}ia.loadFromEndpoint(this.getViewerPagelet(),null,this.loadQuery,{usePipe:true,jsNonblock:true,crossPage:true});},turnFlashAutoplayOff:function(){n.scry(document,'div.swfObject').forEach(function(wa){var xa=wa.getAttribute('data-swfid');if(xa&&window[xa]){var ya=window[xa];ya.addParam('autostart','false');ya.addParam('autoplay','false');ya.addParam('play','false');ya.addVariable('video_autoplay','0');ya.addVariable('autoplay','0');ya.addVariable('play','0');var za=ja(ya.getAttribute('swf'));za.addQueryData({autoplay:'0'});za.setPath(za.getPath().replace('autoplay=1','autoplay=0'));ya.setAttribute('swf',za.toString());ya.write(wa);}});},toggleCollapse:function(){if(this.rhcCollapsed){this.uncollapseRHC();}else this.collapseRHC();},collapseRHC:function(){this.rhcCollapsed=true;l.addClass(this.root,'collapseRHC');this.adjustForResize();},uncollapseRHC:function(){this.rhcCollapsed=false;l.removeClass(this.root,'collapseRHC');this.adjustForResize();},closeHandler:function(){if(!this.isOpen)return;if(ja.getMostRecentURI().addQueryData({closeTheater:1}).getUnqualifiedURI().toString()==this.startingURI.toString()){this.close();return;}this.close();this.returnToStartingURI(this.refreshOnClose);},returnToStartingURI:function(wa,xa){if(!wa)if(xa){this.squashNextTransition(ra.curry(xa));}else this.squashNextTransition();this.returningToStart=true;var ya=g.subscribe('page_transition',function(){this.returningToStart=false;ya.unsubscribe();}),za=wa||isNaN(ka.opera()),ab=this._uriStack.length;if(za&&ab<window.history.length){window.history.go(-ab);}else{var bb=this.startingURI,cb=new ja(bb).removeQueryData('closeTheater');if(bb.getQueryData().sk=='approve'&&bb.getPath()=='/profile.php'){cb.removeQueryData('highlight');cb.removeQueryData('notif_t');}ra(cb);}},squashNextTransition:function(wa){this.squashNext=true;w.registerHandler(function xa(){if(this.squashNext){this.squashNext=false;if(wa)wa.defer();w.transitionComplete();return true;}return false;}.bind(this));},handleNavigateAway:function(wa){var xa=na(w._most_recent_uri.getQualifiedURI(),wa.getAttribute('href'));if(this.isOpen&&(xa instanceof ja)&&xa.getUnqualifiedURI().toString()!=this.startingURI.toString()&&xa.getPath()!='/photo.php'){if(!this.closingAction)this.closingAction=z.NAVIGATE;this.close();this.returnToStartingURI(false,xa);return false;}return true;},closeListener:function(event){if(this.isOpen&&!m.getCurrent()){if(Event.getKeyCode(event)==t.ESC){if(!l.hasClass(this.root,'taggingMode')&&!l.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.closingAction=z.ESC;Event.kill(event);this.closeHandler();}return;}var wa=event.getTarget(),xa=x.byClass(wa,'closeTheater'),ya=xa||wa==this.root||wa==n.find(this.root,'div.fbPhotoSnowliftOuter')||wa==n.find(this.root,'div.fbPhotoSnowliftInner');if(ya){if(q.isFullScreen()){if(xa)q.toggleFullScreen();return;}if(xa){this.closingAction=z.X;}else this.closingAction=z.OUTSIDE;Event.kill(event);this.closeHandler();}}},close:function(){if(!this.isOpen)return;if(this.fullscreen)q.disableFullScreen();ta('snowlift',null,null,'FORCE').set_namespace('snowlift').set_ua_id('close');l.hide(this.root);this.openExplicitly=false;this.closeCleanup.bind(this).defer();},closeCleanup:function(){var wa=la.getScrollPosition();l.removeClass(document.documentElement,'theaterMode');l.removeClass(document.body,this.extraClass);p.scrollTo(wa,0);l.removeClass(this.root,'dataLoaded');s.getInstance().resetHandlers();z.logPhotoViews(this.closingAction);this.destroy();l.hide(this.errorBox);l.hide(this.image);this.currentImageSize=null;this.thumbSrc=null;this.shouldStretch=false;this.resetUriStack=true;l.removeClass(this.stageWrapper,'showVideo');n.empty(this.videoStage);this.ogVideoStage&&n.empty(this.ogVideoStage);this.uncollapseRHC();this.currentMinSize=null;this.setStagePagersState('reset');this.recacheData();n.empty(this.sideAdUnit);this.stream.destroy();var xa=this.closingAction===z.NAVIGATE;this.closingAction=null;if(!this.openHandlerRegistered){w.registerHandler(this.openHandler.bind(this));this.openHandlerRegistered=true;}g.inform('layer_hidden',{type:'PhotoSnowlift'});g.inform('PhotoSnowlift.CLOSE',xa);this.root.setAttribute('aria-busy','true');this.isOpen=false;},createLoader:function(wa){if(this.currentImageSize===null){this.adjustStageSize(va.STAGE_MIN);}else{var xa=this.getStageSize(this.currentImageSize);xa=new la(Math.max(xa.x,va.STAGE_MIN.x),Math.max(xa.y,va.STAGE_MIN.y));var ya=this.getImageSizeInStage(this.currentImageSize,xa);if(this.thumbSrc===null){this.adjustStageSize(ya);}else this.useImage(n.create('img',{className:'spotlight',alt:'',src:this.thumbSrc,style:{width:ya.x+'px',height:ya.y+'px'}}),ya,false);}this.setLoadingState(this.STATE_IMAGE_PIXELS,true);if(wa)(function(){var za=new Image();za.onload=a.async_callback(function(){if(!this.isOpen||this.pendingImageUrl!=wa)return;if(!this.stream||!this.stream.errorInCurrent()){this.switchImage(wa,this.currentImageSize);this.ua&&this.ua.add_event('image');this.setLoadingState(va.STATE_IMAGE_DATA,false);}}.bind(this),'photo_theater');za.src=this.pendingImageUrl=wa;}).bind(this).defer();l.hide(this.stageActions);this.setStagePagersState('disabled');},initDataFetched:function(wa){z.setPhotoSet(this.stream.getPhotoSet());z.setLogFbids(wa.logids);var xa=this.stream.getCurrentImageData();z.addPhotoView(xa.info,this.shouldShowHiRes(xa),this.fullscreen&&q.isFullScreen());if(!this.pageHandlers){this.pageHandlers=[Event.listen(this.root,'click',this.pageListener.bind(this)),Event.listen(this.root,'mouseleave',this.mouseLeaveListener.bind(this))];s.registerKey('LEFT',this.pageListener.bind(this));s.registerKey('RIGHT',this.pageListener.bind(this));s.registerKey('L',this.likePhotoWithKey.bind(this),function(event,ya){event=ua(event);return (ya=='onkeyup'&&s.filterEventTargets(event,ya)&&s.filterEventModifiers(event,ya));});}l.show(this.stageActions);this.root.setAttribute('aria-busy','false');this.isLoggedInViewer=wa.loggedin;this.disableAds=!this.isLoggedInViewer||wa.fromad;this.loadAds();},adjustScrollerIfNecessary:function(){clearTimeout(this.scrollerTimeout);this.scrollerTimeout=this.adjustScroller.bind(this).defer();},adjustScroller:function(){clearTimeout(this.scrollerTimeout);this.initializeScroller();this.scrollableArea.resize();var wa=la.getElementDimensions(this.rhc),xa=wa.y;xa-=la.getElementDimensions(this.rhcHeader).y;xa-=la.getElementDimensions(this.ufiInputContainer).y;var ya=la.getElementDimensions(this.scrollerBody).y;if(ya>=xa){ga.set(this.scroller,'height',xa+'px');l.addClass(this.rhc,'pinnedUfi');xa=0;}else{ga.set(this.scroller,'height','auto');l.removeClass(this.rhc,'pinnedUfi');xa-=ya;}var za=la.getElementDimensions(this.ufiInputContainer).y;ga.set(this.ufiForm,'padding-bottom',za+'px');aa.resize(new la(wa.x,xa));this.scrollableArea.adjustGripper();},adjustForResize:function(){this.currentMinSize=null;this.adjustStageSize();this.adjustForNewData();},shouldShowHiRes:function(wa){if(!this.showHiRes||!wa||!wa.smallurl)return false;var xa=this.getStageSize(wa.dimensions),ya=this.getImageSizeInStage(wa.dimensions,xa);return (ya.x>va.STAGE_NORMAL_MAX.x||ya.y>va.STAGE_NORMAL_MAX.y);},getImageURL:function(wa){if(wa.video){return null;}else if(wa.smallurl&&!this.shouldShowHiRes(wa))return wa.smallurl;return wa.url;},getImageDimensions:function(wa){if(wa.smalldims&&(!this.shouldShowHiRes(wa)||this.image.src===wa.smallurl))return wa.smalldims;return wa.dimensions;},getStageSize:function(wa,xa){var ya=la.getViewportDimensions(),za=new la(wa.x,wa.y);if(xa)za=new la(Math.max(wa.x,xa.x),Math.max(wa.y,xa.y));var ab,bb;if(this.fullscreen&&q.isFullScreen()){return new la((this.rhcCollapsed?screen.width:screen.width-va.SIDEBAR_SIZE_MAX),screen.height-va.FULL_SCREEN_PADDING*2);}else{ab=Math.min(za.x,this.stageMax.x,(ya.x-va.SIDEBAR_SIZE_MAX-va.STAGE_CHROME.x));bb=Math.min(za.y,this.stageMax.y,ya.y-va.STAGE_CHROME.y);}if(ab===0&&bb===0)return new la(0,0);var cb=ab/bb,db=za.x/za.y;if(cb<db)return new la(ab,Math.ceil(ab/db));return new la(Math.ceil(bb*db),bb);},getImageSizeInStage:function(wa,xa){var ya=wa.x,za=wa.y;if(ya>=xa.x||za>=xa.y){var ab=xa.x/xa.y,bb=ya/za;if(ab<bb){ya=xa.x;za=Math.ceil(ya/bb);}else if(ab>bb){za=xa.y;ya=Math.ceil(za*bb);}else{ya=xa.x;za=xa.y;}}return new la(ya,za);},adjustStageSize:function(wa){var xa=this.currentImageSize;if(wa){xa=wa;}else{var ya=this.stream&&this.stream.getCurrentImageData();if(ya)xa=this.getImageDimensions(ya);}if(!xa)return;this.currentImageSize=xa;var za=0;if(this.shouldStretch&&!this.getVideoOnStage()&&xa.x>xa.y&&xa.x<=va.TIMELINE_STRETCH_WIDTH&&xa.x>=va.TIMELINE_STRETCH_MIN){xa.y=Math.round(xa.y*va.TIMELINE_STRETCH_WIDTH/xa.x);xa.x=va.TIMELINE_STRETCH_WIDTH;}else if(this.getVideoOnStage()){za=va.VIDEO_BOTTOM_BAR_SPACE*2;xa.y+=za;}var ab=this.getStageSize(xa,this.currentMinSize);if(!this.currentMinSize)this.currentMinSize=new la(0,0);this.currentMinSize=new la(Math.max(ab.x,va.STAGE_MIN.x,this.currentMinSize.x),Math.max(ab.y,va.STAGE_MIN.y,this.currentMinSize.y));var bb=this.currentMinSize.x+va.SIDEBAR_SIZE_MAX;if(this.rhcCollapsed)bb=this.currentMinSize.x;this.popup.style.cssText='width:'+bb+'px;'+'height:'+this.currentMinSize.y+'px;';var cb=this.currentMinSize.y-za+'px';if(ka.firefox()||ka.ie()<8){var db=ga.get(this.stageWrapper,'font-size');if(ka.ie()&&db.indexOf('px')<0){var eb=n.create('div');eb.style.fontSize=db;eb.style.height='1em';db=eb.style.pixelHeight;}cb=((this.currentMinSize.y-za)/parseFloat(db))+'em';}this.stageWrapper.style.cssText='width:'+this.currentMinSize.x+'px;'+'line-height:'+cb+';';if(ka.ie()<8){ga.set(this.root,'height',la.getViewportDimensions().y+'px');ga.set(this.container,'min-height',(this.currentMinSize.y+va.STAGE_CHROME.y)+'px');}var fb=this.getImageSizeInStage(xa,this.currentMinSize);this.image.style.cssText='width:'+fb.x+'px;'+'height:'+fb.y+'px;';this.adjustScrollerIfNecessary();},adjustForNewData:function(){if(!this.image)return;var wa=n.scry(this.stage,'div.tagsWrapper')[0],xa=la.getElementDimensions(this.image);if(wa){ga.set(wa,'width',xa.x+'px');ga.set(wa,'height',xa.y+'px');if(ka.ie()<=7){var ya=n.scry(this.root,'div.tagContainer')[0];if(ya)l.conditionClass(wa,'ie7VerticalFix',la.getElementDimensions(ya).y>xa.y);}}},setLoadingState:function(wa,xa){switch(wa){case va.STATE_IMAGE_PIXELS:l.conditionClass(this.root,'imagePixelsLoading',xa);break;case va.STATE_IMAGE_DATA:this.loadingStates[wa]=xa;l.conditionClass(this.root,'imageLoading',xa);break;case va.STATE_HTML:this.loadingStates[wa]=xa;l.conditionClass(this.root,'dataLoading',xa);this.rhc.setAttribute('aria-busy',xa?'true':'false');break;}},destroy:function(){this.stageHandlers.forEach(function(wa){wa.remove();});if(this.pageHandlers){this.pageHandlers.forEach(function(wa){wa.remove();});this.pageHandlers=null;}},checkState:function(wa){if(wa!=va.STATE_ERROR&&!this.loadingStates[wa])return;switch(wa){case va.STATE_IMAGE_DATA:var xa=this.stream.getCurrentImageData();if(xa){var ya=this.getImageURL(xa);if(ya){this.switchImage(ya,null,true);}else if(xa.video)this.switchVideo(xa.video,true);this.setLoadingState(wa,false);}break;case va.STATE_HTML:if(this.stream.getCurrentHtml()){this.swapData();this.setLoadingState(wa,false);}break;default:if(this.stream.errorInCurrent()){l.hide(this.image);l.show(this.errorBox);}break;}},buttonListener:function(event){var wa=event.getTarget(),xa=Date.now();if(x.byClass(wa,'fbPhotoTagApprovalBox'))return;if(xa-this.lastPage<350)return;if(x.byClass(wa,'fbPhotosPhotoLike')){this.likePhoto();}else if(x.byClass(wa,'tagApproveIgnore'))this.updateTagBox(event,wa);},likePhoto:function(){z.addButtonLike();var wa=ma('fbPhotoSnowliftFeedback'),xa=n.scry(wa,'button.like_link')[0];if(xa){xa.click();}else{xa=n.find(wa,'a.UFILikeLink');xa.click();this.toggleLikeButton();}},toggleLikeButton:function(){var wa=n.scry(this.buttonActions,'a.fbPhotosPhotoLike')[0];if(wa){l.toggleClass(wa,'viewerLikesThis');l.removeClass(wa,'viewerAlreadyLikedThis');}},likePhotoWithKey:function(){if(this.skipLikePhotoConfirmation){this.likePhoto();}else h.send(new i('/photos/confirm_like.php'));},likePhotoSkipConfirmation:function(wa){this.skipLikePhotoConfirmation=wa;this.likePhoto();},updateTagBox:function(wa,xa){this.unhiliteAllTags();var ya=qa(wa);if(!ya)return;l.addClass(ya,'tagBox');l.addClass(ya,'tagBoxPendingResponse');l.removeClass(ya,'tagBoxPending');l.hide(n.find(ya,'span.tagForm'));if(xa){l.show(n.find(ya,'span.tagApproved'));}else l.show(n.find(ya,'span.tagIgnored'));},rotate:function(wa){var xa=this.stream.getCursor();if(this.getVideoOnStage()){var ya=(wa=='left')?270:90;j.loadModules(['VideoRotate'],function(ab){new ab(xa).motionRotate(ya);});return;}var za=oa({fbid:xa,cs_ver:y.VIEWER_SNOWLIFT},this.stream.getPhotoSetQuery());za[wa]=1;this.setLoadingState(va.STATE_IMAGE_DATA,true);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);l.hide(this.image);new i('/ajax/photos/photo/rotate/').setAllowCrossPageTransition(true).setData(za).setErrorHandler(this.rotationError.bind(this,xa)).setFinallyHandler(this.rotationComplete.bind(this,xa)).setMethod('POST').setReadOnly(false).send();},rotationComplete:function(wa,xa){if(wa==this.stream.getCursor()){this.setLoadingState(va.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));this.swapData();}},rotationError:function(wa,xa){if(wa==this.stream.getCursor()){this.setLoadingState(va.STATE_IMAGE_DATA,false);this.switchImage(this.getImageURL(this.stream.getCurrentImageData()));j.loadModules(['AsyncResponse'],function(ya){ya.defaultErrorHandler(xa);});}},saveTagsFromPayload:function(wa){this.storeFromData(wa);if('data' in wa&&this.stream.getCursor() in wa.data)this.swapData();},saveEdit:function(){if(!l.hasClass(this.root,'fbPhotoSnowliftEditMode'))return;j.loadModules(['PhotoInlineEditor','Form'],function(wa,xa){var ya=wa.getInstance(this.getViewerConst());ya&&xa.bootstrap(ya.getForm().controller);}.bind(this));},mouseLeaveListener:function(event){this.unhiliteAllTags();this.reHilitePendingTag();},hilitePagerOnMouseMove:function(event){var wa=la.getEventPosition(event),xa=la.getElementPosition(this.stage);if(v.isRTL()){var ya=la.getElementDimensions(this.stage);this.stagePagerPrev=ya.x-(wa.x-xa.x)<va.GOPREV_AREA;}else this.stagePagerPrev=wa.x-xa.x<va.GOPREV_AREA;l.conditionClass(this.prevPager,'hilightPager',this.stagePagerPrev);l.conditionClass(this.nextPager,'hilightPager',!this.stagePagerPrev);var za,ab=event.getTarget();if(!x.byClass(ab,'snowliftOverlay')&&!x.byClass(ab,'bottomBarActions')&&!x.byClass(ab,'snowliftPager'))za=va.PAGER_FADE;this.showPagers(za);},showPagers:function(wa){clearTimeout(this.fadePagerTimer);this.setStagePagersState('active');if(typeof wa!=='undefined')this.fadePagerTimer=this.hidePagers.bind(this).defer(wa);},hidePagers:function(){var wa=n.scry(this.getRoot(),'.fbPhotosPhotoActionsMenu')[0];if(wa)return;clearTimeout(this.fadePagerTimer);this.setStagePagersState('inactive');},unhiliteAllTags:function(){n.scry(this.stage,'div.tagsWrapper div.hover').forEach(function(wa){l.removeClass(wa,'hover');});this.hilitedTag=null;},switchHilitedTags:function(wa,xa){if(this.switchTimer!==null){clearTimeout(this.switchTimer);this.switchTimer=null;}this.unhiliteAllTags();var ya=qa(wa);if(ya){this.hilitedTag=wa;l.addClass(ya,'hover');if(l.hasClass(ya,'tagBoxPending')&&!l.hasClass(ya,'showPendingTagName')&&xa===true){n.scry(this.stage,'div.tagsWrapper div.showPendingTagName').forEach(function(za){l.removeClass(za,'showPendingTagName');});l.addClass(ya,'showPendingTagName');}}},reHilitePendingTag:function(){var wa=qa(this.hilitedTag);if(wa&&l.hasClass(wa,'showPendingTagName'))return;var xa=n.scry(this.stage,'div.tagsWrapper div.showPendingTagName')[0];if(xa)this.switchHilitedTags(xa.id);},hiliteTagsOnMouseMove:function(event){if(!this.stream.getCurrentExtraData()||this.getVideoOnStage())return;if(this.switchTimer!==null)return;var wa=event.getTarget();if(x.byClass(wa,'fbPhotoSnowliftTagApproval')||x.byClass(wa,'tagPointer'))return;var xa=x.byClass(wa,'tagBoxPending'),ya=(this.hilitedTag&&l.hasClass(ma(this.hilitedTag),'tagBoxPending')),za=((!this.hilitedTag&&xa)||(!ya&&xa));if(za){this.switchHilitedTags(xa.id);return;}if(xa&&(xa.id==this.hilitedTag))return;var ab=250,bb=ca.absoluteToNormalizedPosition(this.image,la.getEventPosition(event)),cb=ca.getNearestBox(this.stream.getCurrentExtraData().tagRects,bb);if(!cb){if(!ya){this.unhiliteAllTags();this.reHilitePendingTag();}return;}if(this.currentTagHasPrecedence(bb))return;var db=null;if(ya){var eb={};eb[this.hilitedTag]=this.stream.getCurrentExtraData().tagRects[this.hilitedTag];db=ca.getNearestBox(eb,bb);}if(db!==null&&ya)return;if(this.hilitedTag!=cb)if(ya){this.switchTimer=this.switchHilitedTags.bind(this,cb).defer(ab);}else{if(this.showHover){if(!this.seenTags)this.seenTags=[];if(!this.seenTags[cb]){z.addFaceTagImpression();this.seenTags[cb]=true;}}this.switchHilitedTags(cb);}},currentTagHasPrecedence:function(wa){if(!this.hilitedTag)return false;var xa=this.stream.getCurrentExtraData().tagRects[this.hilitedTag],ya=new ea(xa.t+(xa.h()/2),xa.r,xa.b,xa.l,xa.domain);return ya.contains(wa);},getVideoOnStage:function(){var wa=this.stream&&this.stream.getCurrentImageData();return wa&&wa.video;},shouldPageOnAction:function(wa,xa){var ya=n.isNode(xa)&&(x.byClass(xa,'snowliftPager')||x.byClass(xa,'stagePagers')),za=n.isNode(xa)&&x.byClass(xa,'stage'),ab=((za&&l.hasClass(this.root,'taggingMode'))||x.byClass(xa,'tagBoxPending')||x.byClass(xa,'tagBoxPendingResponse')||x.byClass(xa,'fbPhotoTagApprovalBox')||x.byClass(xa,'tag'));if(ab)return false;return wa==t.LEFT||wa==t.RIGHT||ya||za;},pageListener:function(event){var wa=Event.getKeyCode(event),xa=event.getTarget();if(!this.shouldPageOnAction(wa,xa))return;var ya=0;if(wa==t.RIGHT){ya=1;z.setPagingAction('key_right');}else if(wa==t.LEFT){ya=-1;z.setPagingAction('key_left');}else if(x.byClass(xa,'next')){ya=1;z.setPagingAction('click_next');}else if(x.byClass(xa,'prev')){ya=-1;z.setPagingAction('click_prev');}else if(!this.stagePagerPrev){ya=1;z.setPagingAction('click_stage');}else{ya=-1;z.setPagingAction('click_stage_back');}if(l.hasClass(this.root,'fbPhotoSnowliftEditMode')){this.warnLeavePage(ya);}else{this.page(ya);ta('a',xa,event,'FORCE').set_namespace('snowlift').set_ua_id(z.pagingAction);}},warnLeavePage:function(wa){new m().setTitle("Are you sure you want to leave this page?").setBody("You have unsaved changes that will be lost if you leave the page.").setButtons([{name:'leave_page',label:"Leave this Page",handler:this.page.bind(this,wa)},{name:'continue_editing',label:"Stay on this Page",className:'inputaux'}]).show();},page:function(wa,xa){if(!this.stream.isValidMovement(wa)){this.showPagers(va.PAGER_FADE);return;}this.lastPage=Date.now();this.unhiliteAllTags();this.seenTags=[];var ya=this.getVideoOnStage();if(ya)this.switchVideo(ya,false);if(this.relevantCount!==undefined){this.relevantCount-=wa;if(this.relevantCount===0)z.setEndOfRelevant(true);}g.inform('PhotoSnowlift.PAGE');ha.hide();this.recacheData();this.stream.moveCursor(wa);l.hide(this.image);if(this.stream.errorInCurrent()){this.setLoadingState(va.STATE_HTML,true);l.show(this.errorBox);return;}var za=this.stream.getCurrentImageData();if(za){var ab=this.getImageURL(za);if(ab){this.switchImage(ab,null,true);}else if(za.video)this.switchVideo(za.video,true);if(!xa){this.replaceUrl=true;ra(za.info.permalink);}}else{this.setLoadingState(va.STATE_IMAGE_PIXELS,true);this.setLoadingState(va.STATE_IMAGE_DATA,true);}if(this.stream.getCurrentHtml()){this.swapData();}else this.setLoadingState(va.STATE_HTML,true);this.disableAds=!this.isLoggedInViewer;this.loadAds();if(this.cycleFound&&this.stream.firstCursor===this.stream.getCursor())z.setCycle(true);},logImpressionDetailsForPhoto:function(){var wa=[].concat(n.scry(ma('fbPhotoSnowliftTagList'),'input.photoImpressionDetails'),n.scry(ma('fbPhotoSnowliftFeedback'),'input.photoImpressionDetails'));if(wa.length===0)return;var xa={};for(var ya=0;ya<wa.length;ya++)xa[wa[ya].name]=wa[ya].value;if(this.getVideoOnStage()){xa.width=0;xa.height=0;}else{var za=this.getImageDimensions(this.stream.getCurrentImageData());xa.width=za.x;xa.height=za.y;}z.addDetailData(this.stream.getCursor(),xa);aa.setIsLogAdData(true);},loadAds:function(){if(this.disableAds)return;aa.loadAdsFromUserActivity();},transitionHandler:function(wa){if(wa.getQueryData().closeTheater||wa.getQueryData().permPage||wa.getQueryData().makeprofile||this.returningToStart){if(this.isOpen)this.close();this.transitionHandlerRegistered=false;return false;}if(this.replaceUrl){this.replaceUrl=false;this._uriStack.push(wa.getQualifiedURI().toString());w.transitionComplete();return true;}var xa=this._uriStack.length;if(xa>=2&&this._uriStack[xa-2]==wa.getQualifiedURI().toString())this._uriStack.pop();var ya=this.stream.getCursorForURI(wa.getUnqualifiedURI().toString());if(ya){var za=this.stream.getRelativeMovement(ya);this.page(za,true);w.transitionComplete();return true;}if(this.isOpen){this.close();w.transitionComplete();return true;}this.transitionHandlerRegistered=false;return false;},recacheData:function(){if(!this.loadingStates.html){var wa=this.stream.getCurrentHtml();for(var xa in wa){wa[xa]=pa(ma(xa).childNodes);n.empty(ma(xa));}}},reloadIfTimeout:function(){if(!r.hasLoaded(this.image)){var wa=this.makeNewImage(this.image.src,true);Event.listen(wa,'load',this.useImage.bind(this,wa,null,true));}},useImage:function(wa,xa,ya){if(ya&&r.hasLoaded(this.image))return;n.replace(this.image,wa);this.image=wa;this.adjustStageSize(xa);},makeNewImage:function(wa,xa){if(this.imageLoadingTimer){clearTimeout(this.imageLoadingTimer);this.imageLoadingTimer=null;}else if(!xa)this.imageRefreshTimer=setTimeout(this.reloadIfTimeout.bind(this),va.LOADING_TIMEOUT);var ya=n.create('img',{className:'spotlight',alt:''});ya.setAttribute('aria-describedby','fbPhotosSnowliftCaption');ya.setAttribute('aria-busy','true');Event.listen(ya,'load',a.async_callback(function(){clearTimeout(this.imageRefreshTimer);this.image.setAttribute('aria-busy','false');this.setLoadingState(this.STATE_IMAGE_PIXELS,false);(function(){if(this.isOpen){this.adjustStageSize();this.adjustForNewData();}}).bind(this).defer();}.bind(this),'photo_theater'));ya.src=wa;return ya;},switchImage:function(wa,xa,ya){l.hide(this.image);l.hide(this.errorBox);this.setLoadingState(this.STATE_IMAGE_PIXELS,true);var za=this.stream&&this.stream.getCurrentImageData();if(za)z.addPhotoView(za.info,this.shouldShowHiRes(za),this.fullscreen&&q.isFullScreen());this.useImage(this.makeNewImage(wa,false),xa,false);if(ya)this.stream.preloadImages(this.shouldShowHiRes(za));},switchVideo:function(wa,xa,ya){var za='swf_'+wa,ab=ya?this.ogVideoStage:this.videoStage,bb=ya?'showOGVideo':'showVideo';if(xa){l.addClass(this.stageWrapper,bb);var cb=n.create('div',{className:'videoStageContainer'});n.appendContent(ab,cb);cb.id=wa;if(window[za]&&!qa(za))window[za].write(wa);this.adjustStageSizeForVideo.bind(this,za).defer();}else{window[za]&&window[za].addVariable('video_autoplay',0);this.videoLoadTimer&&clearTimeout(this.videoLoadTimer);n.empty(ab);l.removeClass(this.stageWrapper,'showVideo');l.removeClass(this.stageWrapper,'showOGVideo');}},checkVideoStatus:function(wa){if(this.videoLoadTimer)clearTimeout(this.videoLoadTimer);var xa=this.getVideoOnStage();if(!xa){return;}else{var ya='swf_'+xa;if(wa!==ya)return;this.adjustStageSizeForVideo(wa);}},adjustStageSizeForVideo:function(wa){var xa=qa(wa);if(!xa){this.videoLoadTimer=setTimeout(this.checkVideoStatus.bind(this,wa),200);}else this.adjustStageSize(new la(xa.width,xa.height));},handleServerError:function(wa,xa){n.setContent(this.errorBox,wa);this.storeFromData(xa);},swapData:function(){var wa,xa=this.stream.getCurrentHtml();if(xa){this.setLoadingState(va.STATE_HTML,false);for(var ya in xa){wa=qa(ya);wa&&n.setContent(wa,xa[ya]);}g.inform('PhotoSnowlift.DATA_CHANGE',this.stream.getCurrentImageData().info,g.BEHAVIOR_STATE);if(this.stream.getCurrentExtraData())g.inform('PhotoSnowlift.EXTRA_DATA_CHANGE',this.stream.getCurrentExtraData(),g.BEHAVIOR_STATE);}this.showPagers(va.PAGER_FADE);this.adjustScroller();this.scrollableArea.showScrollbar(false);this.adjustForNewData();this.logImpressionDetailsForPhoto();},updateTotalCount:function(wa,xa,ya){var za=this.stream.getCurrentHtml();if(za){var ab=ma('fbPhotoSnowliftPositionAndCount');n.replace(ab,ya);ab=ya;l.show(ab);var bb='fbPhotoSnowliftPositionAndCount';za[bb]=pa(ab.childNodes);}this.stream.setTotalCount(wa);this.stream.setFirstCursorIndex(xa);},addPhotoFbids:function(wa,xa,ya,za){if(za&&this.sessionID&&za!=this.sessionID)return;var ab=this.stream.getCursor()===null;this.stream.attachToFbidsList(wa,xa,ya);if(ya&&ab)this.page(0,true);this.cycleFound=ya;if(!this.pagersShown&&this.stream.canPage())this.setStagePagersState('ready');},attachTagger:function(wa){n.appendContent(this.stageActions,wa);},storeFromData:function(wa){if(!this.isOpen)return;if(wa.ssid&&this.sessionID&&this.sessionID!=wa.ssid)return;var xa=this.stream.storeToCache(wa);if('error' in xa){this.checkState(va.STATE_ERROR);return;}if('init' in xa){this.initDataFetched(xa.init);if(this.openExplicitly){this.replaceUrl=true;ra(this.stream.getCurrentImageData().info.permalink);}if(this.stream.canPage())this.setStagePagersState('ready');this.ua&&this.ua.add_event('ufi');}if('image' in xa)this.checkState(va.STATE_IMAGE_DATA);if('data' in xa)this.checkState(va.STATE_HTML);},setStagePagersState:function(wa){switch(wa){case 'ready':l.addClass(this.root,'pagingReady');this.pagersShown=true;this.ua&&this.ua.add_event('arrows');return;case 'active':l.addClass(this.root,'pagingActivated');return;case 'inactive':l.removeClass(this.root,'pagingActivated');return;case 'disabled':case 'reset':l.removeClass(this.root,'pagingReady');return;}},deletePhoto:function(wa){this.closeRefresh();},closeRefresh:function(){this.refreshOnClose=true;this.closeHandler();},onHiliteTag:function(wa,xa){if(xa.version!=y.VIEWER_SNOWLIFT)return;var ya=xa.tag;if(ya){this.switchHilitedTags(ya,true);}else this.unhiliteAllTags();},onUpdateTagBox:function(wa,xa){if(xa.version==y.VIEWER_SNOWLIFT)this.updateTagBox(xa.id,xa.approve);}});e.exports=va;});
__d("TypeaheadBestName",["TypeaheadUtil","copyProperties"],function(a,b,c,d,e,f){var g=b('TypeaheadUtil'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){var j=this._typeahead.getView();this._subscription=j.subscribe('beforeRender',function(k,l){var m=l.value;for(var n=0;n<l.results.length;++n){var o=l.results[n];if(o.alternate_names==null)continue;if(g.isQueryMatch(m,o.default_name)){o.text=o.default_name;return;}for(var p=0;p<o.alternate_names.length;p++)if(g.isQueryMatch(m,o.alternate_names[p])){o.text=o.alternate_names[p];return;}o.text=o.default_name;}});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:BestNameTypeaheadBehavior",["TypeaheadBestName"],function(a,b,c,d){var e=b('TypeaheadBestName');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.buildBestAvailableNames=function(f){f.enableBehavior(e);};},3);
function ufi_add_ft_hidden_node(a){if(a.link_data)return;var b=collect_data_attribs(a,['ft']).ft;if(Object.keys(b).length){var c=DOM.create('input',{type:'hidden',name:'link_data',value:JSON.stringify(b)});a.appendChild(c);}}function ufi_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.commentable_item').forEach(ufi_add_ft_hidden_node);});}function question_add_all_link_data(){Bootloader.loadComponents('dom-collect',function(){DOM.scry(document.body,'form.fbEigenpollForm').forEach(ufi_add_ft_hidden_node);DOM.scry(document.body,'form.fbQuestionPollForm').forEach(ufi_add_ft_hidden_node);});}
__d("legacy:UIPagelet",["UIPagelet"],function(a,b,c,d){a.UIPagelet=b('UIPagelet');},3);
__d("Scrollable",["event-extensions","Parent","UserAgent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Parent'),h=b('UserAgent'),i=function(event){var k=g.byClass(event.getTarget(),'scrollable');if(!k)return;if((typeof event.axis!=='undefined'&&event.axis===event.HORIZONTAL_AXIS)||(event.wheelDeltaX&&!event.wheelDeltaY))return;var l=event.wheelDelta?event.wheelDelta:-event.detail,m=k.scrollHeight,n=k.clientHeight;if(m>n){var o=k.scrollTop;if((l>0&&o===0)||(l<0&&o>=m-n)){event.prevent();}else if(h.ie()<9)if(k.currentStyle){var p=k.currentStyle.fontSize;if(p.indexOf('px')<0){var q=document.createElement('div');q.style.fontSize=p;q.style.height='1em';p=q.style.pixelHeight;}else p=parseInt(p,10);k.scrollTop=o-Math.round(l/120*p);event.prevent();}}},j=document.documentElement;if(h.firefox()){j.addEventListener('DOMMouseScroll',i,false);}else Event.listen(j,'mousewheel',i);});
__d("legacy:Toggler",["Toggler"],function(a,b,c,d){a.Toggler=b('Toggler');},3);
__d("legacy:Button",["Button"],function(a,b,c,d){a.Button=b('Button');},3);
__d("legacy:ScrollableArea",["ScrollableArea"],function(a,b,c,d){a.ScrollableArea=b('ScrollableArea');},3);
function FutureSideNav(){FutureSideNav.instance&&FutureSideNav.instance.uninstall();FutureSideNav.instance=this;}FutureSideNav.instance=null;FutureSideNav.getInstance=function(){return FutureSideNav.instance||new FutureSideNav();};copy_properties(FutureSideNav.prototype,{init:function(a,b,c){this.root=a;this.items={};this.sections={};this.editor=null;this.editing=false;this.selected=null;this.loading=null;this.keyParam='sk';this.defaultKey=b;this.uri=URI.getRequestURI();this.ajaxPipe=c;this.ajaxPipeEndpoints={};this.sidecol=true;this._installed=true;this._handlePageTransitions=true;PageTransitions.registerHandler(function(d){return this._handlePageTransitions&&this.handlePageTransition(d);}.bind(this));this._eventHandlers=[];this._arbiterSubscriptions=[Arbiter.subscribe(NavigationMessage.NAVIGATION_COMPLETED,this.navigationComplete.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_FAILED,this.navigationFailed.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_COUNT_UPDATE,this.navigationCountUpdate.bind(this)),Arbiter.subscribe(NavigationMessage.NAVIGATION_SELECT,this.navigationSelect.bind(this)),Arbiter.subscribe(ChannelConstants.getArbiterType('nav_update_counts'),this.navigationCountUpdateFromPresence.bind(this))];this._explicitHover=[];this._ensureHover('sideNavItem');this._eventHandlers.push(Event.listen(window,'resize',this._handleResize.bind(this)));this._checkNarrow();this._selectorSubscriptions=[];window.Selector&&this._selectorSubscriptions.push(Selector.subscribe(['open','close'],function(d,e){var f=Parent.byClass(e.selector,'sideNavItem');f&&CSS.conditionClass(f,'editMenuOpened',d==='open');}));onleaveRegister(this.uninstall.bind(this));},_handleResize:(function(){var a;return function(){a&&clearTimeout(a);a=this._checkNarrow.bind(this).defer(200);};})(),_checkNarrow:function(){CSS.conditionClass(this.root,'uiNarrowSideNav',Vector2.getElementPosition(this.root).x<20);},_ensureHover:function(a){if(ua.ie()<8)Bootloader.loadComponents('explicit-hover',function(){this._explicitHover.push(new ExplicitHover(this.root,a));}.bind(this));},uninstall:function(){if(this._installed){this._installed=false;this._handlePageTransitions=false;this._arbiterSubscriptions.forEach(Arbiter.unsubscribe);this._selectorSubscriptions.forEach(Selector.unsubscribe.bind(Selector));this._eventHandlers.forEach(function(a){a.remove();});this._explicitHover.forEach(function(a){a.uninstall();});}},initSection:function(a,b){this._initItems(b);this._initSection(a);},addItem:function(a,b){this._initItem(a,b);},_initItems:function(a){var b=function(c,d){var e=this._initItem(c,d);if(c.children)c.children.forEach(function(f){b(f,e);});}.bind(this);$A(a).forEach(function(c){b(c,null);});},_initItem:function(a,b){var c=this.items[a.id]=this._constructItem(a,b);if(c.equals(this.selected)||a.selected)this.setSelected(c);var d=c.getLinkNode();d&&this._eventHandlers.push(Event.listen(d,'click',function(event){return !this.editing;}.bind(this)));return c;},_initSection:function(a){var b=this.sections[a.id]=this._constructSection(a);this._eventHandlers.push(Event.listen(b.node,'click',this.handleSectionClick.bind(this,b)));DOM.scry(b.node,'div.bookmarksMenuButton').forEach(CSS.show);return b;},_constructItem:function(a,b){return new FutureSideNavItem(a,b);},_constructSection:function(a){return new FutureSideNavSection(a);},handleSectionClick:function(a,event){var b=this._getEventTarget(event,'a'),c=this._getItemForNode(b);if(!b){return;}else if(CSS.hasClass(b.parentNode,'uiMenuItem')){this._handleMenuClick(a,c,b.parentNode,event);}else this._handleLinkClick(a,b,event);},_getEventTarget:function(event,a){var b=event.getTarget();if(b.tagName!==a.toUpperCase()){return Parent.byTag(b,a);}else return b;},_handleMenuClick:function(a,b,c,event){if(CSS.hasClass(c,'rearrange'))this.beginEdit(a);},_handleLinkClick:function(a,b,event){if(CSS.hasClass(b,'navEditDone')){this.editing?this.endEdit():this.beginEdit(a);event.kill();}},getItem:function(a){if(this._isCurrentPath(a)){return this._getItemForKey(this._getKey(a.getQueryData())||this.defaultKey);}else return this._getItemForPath(a.getPath());},getNodeForKey:function(a){var b=this._getItemForKey(a);if(b)return b.node;},_isCurrentPath:function(a){return a.getDomain()===this.uri.getDomain()&&a.getPath()===this.uri.getPath();},_getKey:function(a){return a[this.keyParam];},_getItemForNode:function(a){a=Parent.byClass(a,'sideNavItem');return a&&this.items[a.id];},_getItemForKey:function(a){return this._findItem(function(b){return b.matchKey(a);});},_getItemForPath:function(a){return this._findItem(function(b){return b.matchPath(a);});},_findItem:function(a){for(var b in this.items)if(a(this.items[b]))return this.items[b];},removeItem:function(a){if(a&&this.items[a.id]){DOM.remove(a.node);delete this.items[a.id];}},removeItemByKey:function(a){this.removeItem(this._getItemForKey(a));},moveItem:function(a,b,c){var d=DOM.find(a.node,'ul.uiSideNav');(c?DOM.prependContent:DOM.appendContent)(d,b.node);},setLoading:function(a){this.loading&&this.loading.hideLoading();this.loading=a;this.loading&&this.loading.showLoading();},setSelected:function(a){this.setLoading(null);if(this.selected){this.selected.hideSelected();this.selected.getTop().hideChildren();}this.selected=a;if(this.selected){this.selected.showSelected();this.selected.getTop().showChildren();}},handlePageTransition:function(a){var b=this.getItem(a),c=b&&b.endpoint&&this._doPageTransition(b,a);return c;},_doPageTransition:function(a,b){this.setLoading(a);this._sendPageTransition(a.endpoint,copy_properties(this._getTransitionData(a,b),b.getQueryData()));return true;},_sendPageTransition:function(a,b){b.endpoint=a;Arbiter.inform(NavigationMessage.NAVIGATION_BEGIN,{useAjaxPipe:this._useAjaxPipe(a),params:b});},_getTransitionData:function(a,b){var c={};c.sidecol=this.sidecol;c.path=b.getPath();c[this.keyParam]=a.textKey;c.key=a.textKey;return c;},_useAjaxPipe:function(a){return this.ajaxPipe||this.ajaxPipeEndpoints[a];},navigationComplete:function(){this.loading&&this.setSelected(this.loading);},navigationFailed:function(){this.setLoading(null);},navigationSelect:function(a,b){var c=this._getItemForKey(this._getKey(b));if(b.asLoading){this.setLoading(c);}else this.setSelected(c);},navigationCountUpdate:function(a,b){var c=this._getItemForKey(b&&b.key);if(c)if(typeof b.count!=="undefined"){c.setCount(b.count,b.hide);}else if(typeof b.increment!=="undefined")c.incrementCount(b.increment,b.hide);},navigationCountUpdateFromPresence:function(a,b){b=b.obj;if(b)if(!b.class_name||b.class_name&&CSS.hasClass(this.root,b.class_name))if(b.items)for(var c=0;c<b.items.length;c++)this.navigationCountUpdate(a,b.items[c]);},beginEdit:function(a){if(!this.editing){this.editing=true;CSS.addClass(this.root,'editMode');this._updateTrackingData();Bootloader.loadComponents('sortable-side-nav-js',this._initEditor.bind(this,a));}},endEdit:function(){if(this.editing){CSS.removeClass(this.root,'editMode');this.editor.endEdit();this.editor=null;this.editing=false;this._updateTrackingData();}},_updateTrackingData:function(a){var b=this.root.getAttribute('data-gt')||"{}";try{b=JSON.parse(b);if(this.editing){b.editing=true;}else delete b.editing;this.root.setAttribute('data-gt',JSON.stringify(b));}catch(c){}},_initEditor:function(a){this.editor=a.getEditor();this.editor.beginEdit();}});function FutureSideNavSection(a){this.id=a.id;this.node=this.node||$(a.id);this.editEndpoint=a.editEndpoint;}copy_properties(FutureSideNavSection.prototype,{equals:function(a){return a&&a.id===this.id;},getEditor:function(){return new SortableSideNav(DOM.find(this.node,'ul.uiSideNav'),this.editEndpoint);}});function FutureSideNavItem(a,b){this.id=a.id;this.up=b;this.endpoint=a.endpoint;this.type=a.type;this.node=a.node||$(a.id);this.paths=a.path?$A(a.path):[];this.keys=a.key?$A(a.key):[];var c=this._findKeys(this.keys);this.numericKey=c.numeric||this.keys[0];this.textKey=c.text||this.keys[0];this._pathPattern=this._buildRegex(this.paths);this._keyPattern=this._buildRegex(this.keys);this.hideLoading();this.hideSelected();}copy_properties(FutureSideNavItem.prototype,{equals:function(a){return a&&a.id===this.id;},getLinkNode:function(){return (DOM.scry(this.node,'a.item')[0]||DOM.scry(this.node,'a.subitem')[0]);},matchPath:function(a){return this._matchInput(this._pathPattern,a);},matchKey:function(a){return this._matchInput(this._keyPattern,a);},_matchInput:function(a,b){var c=a&&a.exec(b);return c&&c.slice(1);},getTop:function(){return this.isTop()?this:this.up.getTop();},isTop:function(a){return !this.up;},setCount:function(a,b){return this._updateCount(a,true);},incrementCount:function(a,b){return this._updateCount(a,false);},_updateCount:function(a,b,c){var d=DOM.scry(this.node,'span.count')[0],e=d&&DOM.scry(d,'span.countValue')[0];if(e){var f=b?0:parseInt(DOM.getText(e),10),g=Math.max(0,f+a),h=this.isTop()?'hidden':'hiddenSubitem';DOM.setContent(e,g);c&&CSS.conditionClass(this.node,h,!g);CSS.conditionClass(d,'hidden_elem',!g);if(this.isTop()){var i=DOM.scry(this.node,'div.linkWrap')[0];if(i){CSS.conditionClass(i,'noCount',!g);CSS.conditionClass(i,'hasCount',g);}}}Arbiter.inform('NavigationMessage.COUNT_UPDATE_DONE');},showLoading:function(){CSS.addClass(this.node,'loading');},hideLoading:function(){CSS.removeClass(this.node,'loading');},showSelected:function(){CSS.addClass(this.node,'selectedItem');CSS.hasClass(this.node,'hider')&&CSS.addClass(this._getExpanderParent(),'expandedMode');},hideSelected:function(){CSS.removeClass(this.node,'selectedItem');},showChildren:function(){CSS.addClass(this.node,'open');},hideChildren:function(){CSS.removeClass(this.node,'open');},_getExpanderParent:function(){return Parent.byClass(this.node,'expandableSideNav');},_buildRegex:function(a){if(a.length){var b=a.map(function(c){if(typeof c==="string"){return c.replace(/([^a-z0-9_])/ig,'\\$1');}else if(c&&c.regex)return c.regex;});return new RegExp('^(?:'+b.join('|')+')$');}},_findKeys:function(a){var b=/^(app|group|fl)_/,c={};for(var d=0;d<a.length;d++){var e=b.test(a[d]);if(e&&!c.numeric){c.numeric=a[d];}else if(!e&&!c.text)c.text=a[d];if(c.numeric&&c.text)break;}return c;}});
__d("legacy:Tooltip",["Tooltip"],function(a,b,c,d){a.Tooltip=b('Tooltip');},3);
__d("CompactTypeaheadRenderer",["DOM"],function(a,b,c,d,e,f){var g=b('DOM');function h(i,j){var k=[],l=i.photo;if(l){if(l instanceof Array){var m=[g.create('span',{className:'splitpic leftpic'},[g.create('img',{alt:'',src:l[0]})]),g.create('span',{className:'splitpic'+(l[2]?' toppic':'')},[g.create('img',{alt:'',src:l[1]})])];if(l[2])m.push(g.create('span',{className:'splitpic bottompic'},[g.create('img',{alt:'',src:l[2]})]));l=g.create('span',{className:'splitpics clearfix'},m);}else l=g.create('img',{alt:'',src:l});k.push(l);}if(i.text)k.push(g.create('span',{className:'text'},[i.text]));var n=i.subtext,o=i.category;if(n||o){var p=[];n&&p.push(n);n&&o&&p.push(" \u00b7 ");o&&p.push(o);k.push(g.create('span',{className:'subtext'},p));}var q=g.create('li',{className:i.type||''},k);q.setAttribute('role','option');if(i.text)q.setAttribute('aria-label',i.text);return q;}h.className='compact';e.exports=h;});
__d("legacy:bind",["bind"],function(a,b,c,d){a.bind=b('bind');},3);
__d("legacy:JSLogger",["JSLogger"],function(a,b,c,d){a.JSLogger=b('JSLogger');},3);
__d("PagesVoiceBar",["$","Arbiter","AsyncRequest","CSS","ChannelConstants","DOM","PageTransitions"],function(a,b,c,d,e,f){var g=b('$'),h=b('Arbiter'),i=b('AsyncRequest'),j=b('CSS'),k=b('ChannelConstants'),l=b('DOM'),m=b('PageTransitions'),n='PagesVoiceBar/toggle',o='PagesVoiceBar/initialized',p='PagesVoiceBar/switchVoice',q='page_transition',r='pages_voice_bar_sync',s=null,t=null,u=false,v=false;function w(){v=!v;j.conditionClass(document.body,'hasVoiceBar',v);}function x(da,ea){new i('/ajax/pages/switch_voice.php').setData(ea).setHandler(function(fa){ba();}).send();}function y(){s=null;}function z(da,ea){if(ea.obj.profile_id&&ea.obj.profile_id==s)ba();}function aa(da){h.subscribe(o,da);}function ba(){m.getNextURI().go();}var ca={initVoiceBar:function(){if(u)return;t=g('pagesVoiceBarContent');v=j.hasClass(document.body,'hasVoiceBar');h.subscribe(n,w);h.subscribe(p,x);h.subscribe(q,y);h.subscribe(k.getArbiterType(r),z);u=true;h.inform(o,null,h.BEHAVIOR_STATE);},update:function(da,ea){aa(function(){s=ea;l.setContent(t,da);});}};e.exports=ca;});
__d("AsyncUploadRequest",["ArbiterMixin","AsyncRequest","Form","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('Form'),j=b('copyProperties');function k(m){this.setURI(m);}k.isSupported=function(){return ('FileList' in window)&&('FormData' in window);};j(k.prototype,g,{_limit:10,setAllowCrossOrigin:function(m){this._allowCrossOrigin=!!m;return this;},setData:function(m){this._data=m;return this;},setFiles:function(m){var n={};for(var o in m){var p=m[o];if(Array.isArray(p)){n[o]=p;}else{n[o]=[];if(p instanceof window.FileList){for(var q=0;q<p.length;q++)n[o].push(p.item(q));}else if(p instanceof window.File)n[o].push(p);}}this._files=n;return this;},setLimit:function(m){this._limit=m;return this;},setRelativeTo:function(m){this._relativeTo=m;return this;},setStatusElement:function(m){this._statusElement=m;return this;},setURI:function(m){this._uri=m;return this;},send:function(){if(this._inFlight)return;this._inFlight=true;this._uploads=[];for(var m in this._files)this._files[m].forEach(function(n){this._uploads.push(new l(m,n));}.bind(this));if(this._uploads.length){this._waiting=this._uploads.slice(0);this._pending=[];this._processQueue();}else this._processUpload(new l(null,null));},_processQueue:function(){while(this._pending.length<this._limit){if(!this._waiting.length)break;var m=this._waiting.shift();this._processUpload(m);this._pending.push(m);}},_processUpload:function(m){this.inform('start',m);var n=i.createFormData(this._data);if(m.getFile())n.append(m.getName(),m.getFile());new h().setAllowCrossOrigin(this._allowCrossOrigin).setURI(this._uri).setRawData(n).setRelativeTo(this._relativeTo).setStatusElement(this._statusElement).setHandler(this._success.bind(this,m)).setErrorHandler(this._failure.bind(this,m)).setUploadProgressHandler(this._progress.bind(this,m)).setInitialHandler(this._initial.bind(this,m)).send();},_initial:function(m){this.inform('initial',m);},_success:function(m,n){this.inform('success',m.handleSuccess(n));this._complete(m);},_failure:function(m,n){this.inform('failure',m.handleFailure(n));this._complete(m);},_progress:function(m,event){this.inform('progress',m.handleProgress(event));},_complete:function(m){this._pending.remove(m);this._processQueue();if(!this._pending.length){this._inFlight=false;this.inform('complete',this._uploads);}}});var l=function(m,n){this._name=m;this._file=n;this._success=null;this._response=null;this._progressEvent=null;};j(l.prototype,{getName:function(){return this._name;},getFile:function(){return this._file;},isComplete:function(){return this._success!==null;},isSuccess:function(){return this._success===true;},getResponse:function(){return this._response;},getProgressEvent:function(){return this._progressEvent;},handleSuccess:function(m){this._success=true;this._response=m;this._progressEvent=null;return this;},handleFailure:function(m){this._success=false;this._response=m;this._progressEvent=null;return this;},handleProgress:function(event){this._progressEvent=event;return this;}});e.exports=k;});
__d("FileForm",["event-extensions","ArbiterMixin","AsyncRequest","AsyncUploadRequest","AsyncResponse","BehaviorsMixin","DataStore","DOMQuery","Env","Form","JSONPTransport","URI","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('AsyncRequest'),i=b('AsyncUploadRequest'),j=b('AsyncResponse'),k=b('BehaviorsMixin'),l=b('DataStore'),m=b('DOMQuery'),n=b('Env'),o=b('Form'),p=b('JSONPTransport'),q=b('URI'),r=b('copyProperties');function s(u){var v={},w=m.scry(u,'input[type="file"]');w.forEach(function(x){v[x.name]=x.files;});return v;}function t(u,v,w){if(u.getAttribute('rel')==='async')throw new Error('FileForm cannot be used with Primer forms.');if(u.getAttribute('method').toUpperCase()!=='POST')throw new Error('FileForm must be used with POST forms.');this._form=u;this._form.enctype=this._form.encoding='multipart/form-data';v&&this.enableBehaviors(v);this._options=w||{};this.setAllowCrossOrigin(this._options.allowCrossOrigin);this.setUploadInParallel(this._options.uploadInParallel);this._listener=Event.listen(this._form,'submit',this._submit.bind(this));l.set(this._form,'FileForm',this);}t.getInstance=function(u){return l.get(u,'FileForm');};r(t.prototype,g,k,{getRoot:function(){return this._form;},setAllowCrossOrigin:function(u){this._allowCrossOrigin=!!u;return this;},setUploadInParallel:function(u){this._uploadInParallel=!!u;return this;},_submit:function(event){this.inform('submit');var u='FormData' in window;if(u)if(!q(this._form.action).isSameOrigin()&&!this._allowCrossOrigin)u=false;return u?this._sendViaXHR(event):this._sendViaFrame(event);},_sendViaFrame:function(event){var u=new h();u.setStatusElement(this._form);u.addStatusIndicator();u.setOption('useIframeTransport',true);var v=u.handleResponse.bind(u),w=new p('iframe',this._form.action,v),x=w.createTransportFrame(),y=w.getRequestURI().addQueryData({__iframe:true,__user:n.user});this._form.setAttribute('action',y.toString());this._form.setAttribute('target',x.name);u.setURI(y);u.setHandler(this.success.bind(this,null));u.setErrorHandler(this.failure.bind(this,null));u.setInitialHandler(this.initial.shield(this,null));},_sendViaXHR:function(event){var u;if(this._uploadInParallel&&i.isSupported()){u=new i().setData(o.serialize(this._form)).setFiles(s(this._form));var v=[u.subscribe('progress',function(w,x){this.progress(x,x.getProgressEvent());}.bind(this)),u.subscribe('initial',function(w,x){this.initial(x,x.getResponse());}.bind(this)),u.subscribe('success',function(w,x){this.success(x,x.getResponse());}.bind(this)),u.subscribe('failure',function(w,x){this.failure(x,x.getResponse());}.bind(this)),u.subscribe('complete',function(){while(v.length)v.pop().unsubscribe();})];}else u=new h().setRawData(o.createFormData(this._form)).setHandler(this.success.bind(this,null)).setErrorHandler(this.failure.bind(this,null)).setUploadProgressHandler(this.progress.bind(this,null)).setInitialHandler(this.initial.shield(this,null));u.setAllowCrossOrigin(this._allowCrossOrigin).setRelativeTo(this._form).setStatusElement(this._form).setURI(this._form.action).send();return false;},initial:function(u){return this.inform('initial',u);},success:function(u,v){if(this.inform('success',v,u)!==false)Event.fire(this._form,'success',{response:v});},failure:function(u,v){if(this.inform('failure',v,u)!==false)if(Event.fire(this._form,'error',{response:v})!==false)j.defaultErrorHandler(v);},progress:function(u,event){this.inform('progress',event,u);},destroy:function(){this._listener.remove();this._listener=null;this._form.enctype=this._form.encoding=null;l.remove(this._form,'FileForm');}});e.exports=t;});
__d("Composer",["function-extensions","Arbiter","ArbiterMixin","Button","Class","CSS","DOM","Env","FileForm","HTML","Input","PageTransitions","Parent","Run","ServerJS","TextAreaControl","URI","URLScraper","$","copyProperties","ge","tx","event-extensions"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Button'),j=b('Class'),k=b('CSS'),l=b('DOM'),m=b('Env'),n=b('FileForm'),o=b('HTML'),p=b('Input'),q=b('PageTransitions'),r=b('Parent'),s=b('Run'),t=b('ServerJS'),u=b('TextAreaControl'),v=b('URI'),w=b('URLScraper'),x=b('$'),y=b('copyProperties'),z=b('ge'),aa=b('tx');b('event-extensions');var ba=b('event-extensions').$E,ca=1,da=4,ea={},fa=function(){var ja=l.scry(this.root,'span.linkAttachment')[0];if(!ja&&this.isMetaComposer)ja=l.scry(this.root,'span.attachmentAcceptsLink')[0];if(!ja)return;var ka=r.byTag(ja,'form');this.scraper=new w(this.input);this.scraper.subscribe('match',function(la,ma){if(this.isMetaComposer){var na=this.form.xhpc_targetid,oa=new v('/ajax/metacomposer/attachment/link/scraper.php');oa.addQueryData({scrape_url:encodeURIComponent(ma.url),alt_scrape_url:encodeURIComponent(ma.alt_url),targetid:na.value});ka.action=oa.toString();}else{k.show(ja);ka.action='/ajax/composer/attachment/link/scraper.php?scrape_url='+encodeURIComponent(ma.url);}ka.xhpc.value=ja.id;ka.xhpc.disabled=false;ka.xhpc.click();}.bind(this));this.isMetaComposer&&this.scraper.check();},ga=function(ja){if(this.inform('submit')===false){ja.kill();return false;}if(this.submitHandler)return (new Function(this.submitHandler)).apply(this.form);};function ha(ja,ka,la,ma,na){ea[ja.id]=this;this.root=ja;this.resetCfg=ka;this.dataSource=ma;this.lazyEndpoint=this.resetCfg&&this.resetCfg.lazyEndpoint;this.focus=l.find(ja,'div.focus_target');this.form=l.find(ja,'form.attachmentForm');this.content=l.find(ja,'div.attachmentContent');this.isMetaComposer=la;if(this.isMetaComposer){this.messageBox=l.find(ja,'div.uiMetaComposerMessageBox');this.metaArea=l.find(ja,'div.attachmentMetaArea');this.bottomArea=l.find(ja,'div.attachmentBottomArea');this.barArea=l.find(ja,'div.attachmentBarArea');this.blurb=l.find(ja,'div.uiMetaComposerMessageBox div.textBlurb');this.input=l.find(ja,'div.uiMetaComposerMessageBox textarea.input');this.button=l.find(ja,'div.uiMetaComposerMessageBox label.submitBtn');this.privacy=l.find(ja,'div.uiMetaComposerMessageBox li.privacyWidget');this.boosting=l.scry(ja,'div.uiMetaComposerMessageBox li.boostingWidget');}else{this.blurb=l.find(ja,'div.uiComposerMessageBox div.textBlurb');this.input=l.find(ja,'div.uiComposerMessageBox textarea.input');this.button=l.find(ja,'div.uiComposerMessageBox label.submitBtn');this.privacy=l.find(ja,'div.uiComposerMessageBox li.privacyWidget');this.boosting=[];}Event.listen(this.form,'submit',ga.bind(this));if(this.isMetaComposer){Event.listen(this.input,'focus',this.onFocus.bind(this));if(na){if(document.activeElement===this.input)this.onFocus.bind(this).defer();}else if(r.byClass(this.input,'child_was_focused'))this.onFocus.bind(this).defer();}g.inform('xhpc/construct/'+ja.id,this,g.BEHAVIOR_STATE);}y(ha.prototype,h,{init:function(ja){this.mentionsInput=ja;if(this.mentionsInput)this.mentionsInput.subscribe('init',function(){var ka=this.mentionsInput.getTypeahead().getView();ka.subscribe(['reset','render'],function(la){k.conditionClass(this.root,'uiComposerMention',(la=='render'));}.bind(this));}.bind(this));fa.call(this);this.inform('init',null,g.BEHAVIOR_PERSISTENT);this.setupListen();s.onBeforeUnload(this._handleUnsavedChanges.bind(this));},setupListen:function(){Event.listen(this.root,'click',this.clickHandler.bind(this));},clickHandler:function(event){var ja=event.getTarget();if(r.byClass(ja,'collapsedPostButton'))this.focusInput.bind(this).defer();},setBlurb:function(ja){l.setContent(this.blurb,ja);},setEnabled:function(ja){i.setEnabled(this.button,ja);},getEndpoint:function(){return this.form.getAttribute('action');},setEndpoint:function(ja){this.form.setAttribute('action',ja);},setLoading:function(ja){k.conditionClass(this.root,'async_saving',!!ja);},setContentVisible:function(ja){k.conditionClass(this.root,'uiComposerHideContent',!ja);},setMessageBoxVisible:function(ja){k.conditionClass(this.root,'uiComposerHideMessageBox',!ja);},setInputVisible:function(ja){k.conditionClass(this.root,'uiComposerHideInput',!ja);},setStatusBoxVisible:function(ja){k.conditionClass(this.root,'uiComposerHideStatusBox',!ja);},setTopicTaggerVisible:function(ja){k.conditionClass(this.root,'uiTagComposerHidden',!ja);},mutate:function(ja){if(this.lastComposerInput)p.setValue(this.input,p.getValue(z(this.lastComposerInput)));var ka=z(ja.xhpc);if(ka){var la=l.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ja.confirmAugmentation&&la!==ka)return;la&&k.removeClass(la,'uiComposerAttachmentSelected');k.addClass(ka,'uiComposerAttachmentSelected');if(!ja.disableCache)Event.listen(ka,'click',function(na){ba(na).stop();ja.disableCache=true;this.mutate(ja);}.bind(this));}if(!ja.keepContentAreas){this.setContentVisible(false);l.empty(this.content);if(this.isMetaComposer){this.mentionsInput&&this.mentionsInput.setAuxContent(null);l.empty(this.metaArea);l.empty(this.bottomArea);l.empty(this.barArea);}}if(ja.content){l.setContent(this.content,o(ja.content));this.setContentVisible(true);}if(this.isMetaComposer){ja.metaContent&&l.setContent(this.metaArea,o(ja.metaContent));ja.bottomContent&&l.setContent(this.bottomArea,o(ja.bottomContent));ja.barContent&&l.setContent(this.barArea,o(ja.barContent));}this.setMessageBoxVisible(!ja.messageBoxHidden);k.conditionClass(this.root,'uiComposerWhiteMessageBox',!ja.messageBoxHidden&&!ja.inputHidden&&!ja.content);this.setInputVisible(!ja.inputHidden);this.setStatusBoxVisible(!ja.statusBoxHidden);k.conditionShow(this.privacy,!ja.privacyWidgetHidden);if(this.boosting.length>0)k.conditionShow(this.boosting[0],!ja.boostingWidgetHidden);if(!ja.keepContentAreas){p.setPlaceholder(this.input,ja.placeholder);i.setLabel(this.button,ja.buttonLabel);}this.setBlurb(o(ja.blurb));if(ja.autoscrape){this.scraper&&this.scraper.enable();}else this.scraper&&this.scraper.disable();this.setEnabled(!ja.disabled);this.setTopicTaggerVisible(!ja.hideTopicTagger);this.setEndpoint(ja.endpoint);if(ja.formType==ca){this.form.setAttribute('rel','async');}else this.form.removeAttribute('rel');this.form.removeAttribute('target');if(ja.formType==da){if(!this._fileForm){this._fileForm=new n(this.form);this._fileForm.setAllowCrossOrigin(m.allowCrossOriginComposerUpload);this._fileForm.subscribe('submit',this.setLoading.bind(this,true));this._fileForm.subscribe('failure',this.setLoading.bind(this,false));}}else if(this._fileForm){this._fileForm.destroy();this._fileForm=null;}this.submitHandler=ja.submitHandler;this.lazyEndpoint=ja.lazyEndpoint;k.addClass(this.root,'uiComposerInteracted');k.addClass(this.root,'uiComposerOpen');if(ja.messageBoxFocused){var ma=document.activeElement;if(ma===document.body||r.byClass(ma,'attachmentLink'))this.focusInput.bind(this).defer();}if(ja.inputElement){p.setValue(z(ja.inputElement),p.getValue(this.input));u.getInstance(z(ja.inputElement)).update();}else u.getInstance(this.input).update();this.lastComposerInput=ja.inputElement;g.inform('composer/mutate',this);},subscribeToMutate:function(ja){return g.subscribe('composer/mutate',function(ka,la){if(la===this)ja();}.bind(this));},unsubscribeFromMutate:function(ja){ja.unsubscribe();},reset:function(ja){if(!ja){p.reset(this.input);this.mentionsInput&&this.mentionsInput.reset();this.scraper&&this.scraper.reset();}if(this.isMetaComposer){l.empty(this.metaArea);l.empty(this.bottomArea);l.empty(this.barArea);}if(this.resetCfg){this.mutate(this.resetCfg);}else{var ka=l.scry(this.root,'.uiComposerAttachmentSelected')[0];if(ka)k.removeClass(ka,'uiComposerAttachmentSelected');}k.removeClass(this.root,'uiComposerInteracted');k.setClass(this.focus,'focus_target');this.setLoading(false);g.inform('composer/reset');},onFocus:function(){if(this.lazyEndpoint){var ja=l.find(this.root,'form.attachmentSelectForm'),ka=new v(this.lazyEndpoint);ka.addQueryData({isAugmentation:true});ja.action=ka.toString();var la=l.scry(this.root,'.uiComposerAttachmentSelected')[0];ja.xhpc.value=la&&la.id;ja.xhpc.click();k.removeClass.curry(this.root,'async_saving').defer();}this.inform('focus');},focusInput:function(){p.focus(this.input);},getInput:function(){return this.input;},updateDataSourceToken:function(ja){if(this.dataSource)this.dataSource.updateToken(ja);},_handleUnsavedChanges:function(){var ja=q.getNextURI();if(ja.getQueryData().hasOwnProperty('theater'))return;if(this.input.offsetParent!==null&&!p.isEmpty(this.input)&&!(a.Dialog&&a.Dialog.getCurrent()))return "You haven't finished your post yet. Do you want to leave without finishing?";}});var ia;y(ha,{setNodeToConfigure:function(ja){ia=ja;},configure:function(ja,ka,la){var ma=r.byClass(ia,'uiComposer').id,na=g.subscribe('xhpc/construct/'+ma,function(oa,pa){(function(){na.unsubscribe();}).defer();pa.mutate(ja);pa.subscribe('init',function(){new t().handle(ka);new Function(la)();if(ja.attachmentJS)new Function(ja.attachmentJS).call(pa);});});},publish:function(ja,ka){ka=ka||{};ka.composer_id=ja;ka.composer=ha.getInstance(ja);ka.composer&&ka.composer.reset(false);if(ka.streamNode){ka.streamStory=ka.streamNode;}else if(ka.streamMarkup)ka.streamStory=o(ka.streamMarkup).getRootNode();g.inform('composer/publish',ka);},finish:function(ja){ha.getInstance(ja).setLoading(false);},getInstance:function(ja){var ka=r.byClass(x(ja),'uiComposer');return ka?ea[ka.id]:null;}});e.exports=ha;});
__d("legacy:Composer",["Composer"],function(a,b,c,d){a.Composer=b('Composer');},3);
function MetaComposerMessageBox(){}copy_properties(MetaComposerMessageBox.prototype,{init:function(a,b){this.inputContainer=DOM.scry(a,'div.inputContainer')[0];this.textInput=DOM.scry(a,'textarea.mentionsTextarea')[0];this.metaArea=DOM.scry(a,'div.attachmentMetaArea')[0];this.bottomArea=DOM.scry(a,'div.attachmentBottomArea')[0];this.barArea=DOM.scry(a,'div.attachmentBarArea')[0];Event.listen(this.inputContainer,'click',function(c){var d=c.getTarget();if(!DOM.contains(this.metaArea,d)&&d!==this.textInput)this.textInput.focus();}.bind(this));}});
__d("legacy:ScrollAwareDOM",["ScrollAwareDOM"],function(a,b,c,d){a.ScrollAwareDOM=b('ScrollAwareDOM');},3);
__d("MultiBootstrapDataSource",["Class","DataSource"],function(a,b,c,d,e,f){var g=b('Class'),h=b('DataSource');function i(j){this._bootstrapEndpoints=j.bootstrapEndpoints;this.parent.construct(this,j);}g.extend(i,h);i.prototype.bootstrapWithoutToken=function(){for(var j=0;j<this._bootstrapEndpoints.length;j++)this.fetch(this._bootstrapEndpoints[j].endpoint,this._bootstrapEndpoints[j].data||{},{bootstrap:true});};e.exports=i;});
__d("MentionsInputMatchers",[],function(a,b,c,d,e,f){var g=['@','\\uff20','+','\\uff0b'].join(''),h='.,*?$|#{}()\\^\\-\\[\\]\\\\\/!%&\'"~=<>_:;',i='\\b[A-Z][^ A-Z'+h+']',j='([^'+g+h+']|['+h+'][^ '+h+'])',k='(?:^|\\s)(?:['+g+']('+j+'{0,20}))',l='(?:(?:'+i+'+)|'+k+')',m='(?:'+i+'{4,})',n={trigger:new RegExp('['+g+']$'),mainMatcher:new RegExp(k+'$'),autoMatcher:new RegExp(l+'$'),userMatcher:new RegExp(m+'$')};e.exports=n;});
__d("MentionsInput",["event-extensions","function-extensions","Arbiter","ArbiterMixin","Class","CSS","DataStore","DOM","HTML","Input","InputSelection","Parent","StringEscape","Style","Typeahead","TypeaheadUtil","UserAgent","copyProperties","MentionsInputMatchers"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('CSS'),k=b('DataStore'),l=b('DOM'),m=b('HTML'),n=b('Input'),o=b('InputSelection'),p=b('Parent'),q=b('StringEscape'),r=b('Style'),s=b('Typeahead'),t=b('TypeaheadUtil'),u=b('UserAgent'),v=b('copyProperties'),w=q.htmlize,x=b('MentionsInputMatchers');function y(z,aa,ba,ca,da,ea){k.set(z,'MentionsInput',this);this._root=z;this._typeahead=aa;this._input=ba;var fa=false;try{fa=document.activeElement===this._input;}catch(ga){}if(fa){this.init.bind(this,ca,da,ea).defer();}else var ha=Event.listen(this._input,'focus',function(){this.init.bind(this,ca,da,ea).defer();ha.remove();}.bind(this));}y.getInstance=function(z){var aa=p.byClass(z,'uiMentionsInput');return aa?k.get(aa,'MentionsInput'):null;};y.generateDataFromTextWithEntities=function(z){var aa=z.text,ba={};(z.ranges||[]).forEach(function(ca){var da=ca.entities[0];if(!da.external)ba[da.id]=aa.substr(ca.offset,ca.length);});return {flattened:aa,mention_data:ba};};v(y.prototype,h,{init:function(z,aa,ba){this.init=Function.prototype;this._initialized=true;this._highlighter=l.find(this._root,'.highlighter');this._highlighterInner=this._highlighter.firstChild;this._highlighterContent=l.find(this._root,'.highlighterContent');this._hiddenInput=l.find(this._root,'.mentionsHidden');this._placeholder=this._input.getAttribute('placeholder')||'';this._maxMentions=z.max||6;this._metrics=ba;if(u.firefox()<4){this._input.blur();setTimeout(function(){this._input.focus();}.bind(this));}if(!this._hiddenInput.name){var ca=this._input.name;this._input.name=ca+'_text';this._hiddenInput.name=ca;}this._initEvents();this._initTypeahead();this.reset(aa);this.inform('init',null,g.BEHAVIOR_STATE);},reset:function(z){if(!this._initialized)return;this._mentioned={};this._orderedUIDs=[];this._numMentioned=0;this._filterData=null;this._hiddenInput&&(this._hiddenInput.value='');this._highlighterContent&&l.empty(this._highlighterContent);this._highlighterAuxContent&&l.remove(this._highlighterAuxContent);this._highlighterAuxContent=null;n.setPlaceholder(this._input,this._placeholder);r.set(this._typeahead.getElement(),'height','auto');if(z){n.setValue(this._input,z.flattened);for(var aa in z.mention_data)this._addToken({uid:aa,text:z.mention_data[aa],type:'unknown'});}this._updateTypeahead();this._updateWidth();this._update();},getValue:function(){return n.getValue(this._input);},getRawValue:function(){this._update();return n.getValue(this._hiddenInput);},checkValue:function(){var z=this._typeahead.getCore().getValue();if(x.trigger.exec(z)||z==='')this.inform('sessionEnd',{});},getTypeahead:function(){return this._typeahead;},_initEvents:function(){var z=this._update.bind(this);Event.listen(this._input,{input:z,keyup:z,change:z,focus:this._updateWidth.bind(this)});if(this._metrics){this._metrics._reset();this._metrics.bindSessionStart(this._typeahead,'render',true);this._metrics.bindSessionEnd(this._typeahead.getView(),'select',true);this._metrics.bindSessionEnd(this,'sessionEnd',false);Event.listen(this._input,'keyup',function(event){this.checkValue.bind(this).defer();}.bind(this));}},_initTypeahead:function(){this._typeahead.subscribe('select',function(da,ea){var fa=ea.selected;this._addToken({uid:fa.uid,text:fa.text,type:fa.type});this.updateValue();}.bind(this));var z=this._input,aa=null,ba=function(){if(aa===null){aa=n.getSubmitOnEnter(z);n.setSubmitOnEnter(z,false);}},ca=function(){if(aa!==null){n.setSubmitOnEnter(z,aa);aa=null;}};this._typeahead.subscribe('render',ba);this._typeahead.subscribe('reset',ca);this._typeahead.subscribe('highlight',function(da,ea){ea.index>=0?ba():ca();});this._typeahead.subscribe('query',function(){this._filterData=null;}.bind(this));this._typeahead.getCore().suffix='';this._typeahead.getData().addFilter(this._filterResults.bind(this));},_filterResults:function(z){if(this._filterData===null){var aa=o.get(this._input).start||0;for(var ba=0;ba<this._offsets.length;ba++){var ca=this._offsets[ba];if(aa>ca[0]&&aa<=ca[1]){this._filterData={caretIsInsideMention:true};return false;}}var da=this._typeahead.getCore();this._filterData={value:da.getValue(),rawValue:da.getRawValue()};}if(this._filterData.caretIsInsideMention)return false;if(x.mainMatcher.test(this._filterData.rawValue))return true;if(z.type!='user')return false;if(x.userMatcher.test(this._filterData.value))return true;return t.isExactMatch(this._filterData.value,this._typeahead.getData().getTextToIndex(z));},_addToken:function(z){var aa=z.uid;if(!this._mentioned.hasOwnProperty(aa)){this._mentioned[aa]=z;this._orderedUIDs.push(aa);this._numMentioned++;this._updateTypeahead();}},_removeToken:function(z){if(this._mentioned.hasOwnProperty(z)){delete this._mentioned[z];this._orderedUIDs.remove(z);this._numMentioned--;this._updateTypeahead();}},_reduceToken:function(z,aa){var ba=aa.split(' '),ca=[];for(var da=0;da<ba.length;da++)if(z.indexOf(ba[da])!=-1)ca.push(ba[da]);ba=ca;for(da=1;da<ba.length;da++)for(var ea=1;ea<ba[da-1].length+1;ea++)if(z.indexOf(ba[da-1].substr(0,ea)+ba[da])!=-1)ba.splice(da-1,1);while(z.indexOf(ba.join(' '))==-1)ba.splice(0,1);return ba.join(' ');},_update:function(){var z=this.getValue();if(z==this._value)return;this._updateTokens();this.updateValue();this._updateDirection();},_updateTokens:function(){var z=this.getValue(),aa=false;for(var ba=0;ba<this._orderedUIDs.length;++ba){var ca=this._orderedUIDs[ba],da=this._mentioned[ca],ea=da.text,fa;if(da.type=='user'&&(fa=this._reduceToken(z,ea))!==''){if(fa==ea.substring(0,ea.lastIndexOf(' '))&&z==this._value.substring(0,this._value.length-1)){z=z.substring(0,z.lastIndexOf(' '));aa=true;}da.text=fa;}else if(!ea||z.indexOf(ea)==-1||typeof ea!=='string')this._removeToken(ca);}this._value=z;if(aa)n.setValue(this._input,z);},updateValue:function(){var z=this.getValue(),aa=this._orderedUIDs,ba=[],ca,da,ea,fa;for(fa=0;fa<aa.length;++fa){da=this._mentioned[aa[fa]].text;z=z.replace(da,function(ga,ha){ba.push([ha,ha+da.length]);return da;});}for(fa=0;fa<aa.length;++fa){ea=aa[fa];da=this._mentioned[ea].text;z=z.replace(da,'@['+ea+':]');}ca=w(z);for(fa=0;fa<aa.length;++fa){ea=aa[fa];da=this._mentioned[ea].text;ca=ca.replace('@['+ea+':]','<b>'+w(da)+'</b>');da=da.replace(/[\\\]:]/g,function(ga){return '\\'+ga;});z=z.replace('@['+ea+':]','@['+ea+':'+da+']');}if(u.ie()){ca=ca.replace(/ {2}/g,'&nbsp;<wbr />&nbsp;<wbr />');ca=ca.replace(/ (?=[^\/]|\/[^>])/g,'&nbsp;<wbr />');}this._offsets=ba;this._hiddenInput.value=z;l.setContent(this._highlighterContent,m(ca));this._updateHighlighter();this._updateHeight();},_updateDirection:function(){var z=r.get(this._input,'direction');if(z==this._dir)return;this._dir=z;r.set(this._highlighter,'direction',z);if(z=='rtl'){r.set(this._highlighter,'text-align','right');}else r.set(this._highlighter,'text-align','left');},_updateWidth:function(){var z=r.getFloat.curry(this._input),aa=this._input.offsetWidth-z('paddingLeft')-z('paddingRight')-z('borderLeftWidth')-z('borderRightWidth');if(u.firefox())aa-=2;if(u.ie()<=7){aa-=r.getFloat(this._highlighterInner,'paddingLeft');this._highlighter.style.zoom=1;}this._highlighterInner.style.width=Math.max(aa,0)+'px';},_updateHeight:function(){if(this._highlighterAuxContent){var z=this._highlighter.offsetHeight,aa=this._typeahead.getElement();if(z>aa.offsetHeight){r.set(aa,'height',z+'px');g.inform('reflow');}}},_updateTypeahead:function(){var z=this._typeahead.getCore(),aa=null;if(!this._maxMentions||this._numMentioned<this._maxMentions)aa=x.autoMatcher;z.matcher=aa;z.setExclusions(this._orderedUIDs);this.inform('update',{mentioned:this._mentioned});},setPlaceholder:function(z){this._placeholder=z;if(!this.hasAuxContent())n.setPlaceholder(this._input,z);},_updateHighlighter:function(){if(this._highlighterContent)j.conditionShow(this._highlighterContent,this._numMentioned>0||this.hasAuxContent());},setAuxContent:function(z){if(this._highlighterContent){if(!this._highlighterAuxContent){this._highlighterAuxContent=l.create('span',{className:'highlighterAuxContent'});l.insertAfter(this._highlighterContent,this._highlighterAuxContent);}l.setContent(this._highlighterAuxContent,z);if(z){n.setPlaceholder(this._input,'');}else n.setPlaceholder(this._input,this._placeholder);this._updateHighlighter();this._updateHeight();}},hasAuxContent:function(){var z=this.getAuxContentRoot();return z&&z.innerHTML.length>0;},getAuxContentRoot:function(){return this._highlighterAuxContent;},addMention:function(z){var aa=this.getValue();n.setValue(this._input,aa+" "+z.text);this._addToken(z);this._update();},getMentions:function(){return this._mentioned;}});e.exports=y;});
__d("OptimisticUFI",["event-extensions","Arbiter","AsyncRequest","AsyncResponse","CommentPrelude","CSS","DOM","Form","HTML","Input","MentionsInput","Parent","StringEscape","XHPTemplate","randomInt"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncRequest'),i=b('AsyncResponse'),j=b('CommentPrelude'),k=b('CSS'),l=b('DOM'),m=b('Form'),n=b('HTML'),o=b('Input'),p=b('MentionsInput'),q=b('Parent'),r=b('StringEscape'),s=b('XHPTemplate'),t=b('randomInt'),u={_commentSeqNo:0,init:function(v){this._commentTemplate=v;if(!this._loaded){Event.listen(document.documentElement,'click',this._clickHandler.bind(this),Event.Priority.URGENT);this._loaded=true;}},_clickHandler:function(event){var v=event.getTarget(),w=v.name=='comment'&&v.parentNode&&q.byClass(v,'optimistic_submit');if(!w)return true;var x=v.form,y=l.scry(x,'textarea')[0];if(o.isEmpty(y))return true;j.uncollapse(x);var z,aa,ba=l.scry(v,'^.commentList li.uiUfiAddComment')[0];if(!ba){z=this._commentTemplate.render();aa=s.getNode(z,'text');l.setContent(aa,n(r.htmlize(y.value.trim())));}var ca=l.scry(x,'ul.commentList')[0];if(!ca)return true;var da;if(ba){da=ba.previousSibling;k.show(da);k.hide(ba);}else{k.show(ca.parentNode);ca.appendChild(z);da=ca.lastChild;}var ea=t(0,4294967295);da.id='optimistic_comment_'+ea+'_'+this._commentSeqNo++;var fa=m.serialize(x);fa.comment_replace=da.id;fa.comment=1;function ga(){new h(m.getAttribute(x,'action')).setData(fa).setRelativeTo(x).setErrorHandler(function(ia){k.addClass(da,'uiUfiCommentFailed');i.defaultErrorHandler(ia);}).setServerDialogCancelHandler(function(){l.remove(da);}).send();}if(!ba)Event.listen(s.getNode(z,'retry_link'),'click',ga);ga();y.value=y.style.height='';y.focus();var ha=p.getInstance(y);ha&&ha.reset();if(ba){l.remove(ba);}else g.inform('ufi/comment',{form:x});return false;}};e.exports=u;});
__d("UFIUpdate",["CommentPrelude","CSS","DOM","DOMQuery","HTML","MentionsInput","Parent","ScrollableArea","ScrollAwareDOM"],function(a,b,c,d,e,f){var g=b('CommentPrelude'),h=b('CSS'),i=b('DOM'),j=b('DOMQuery'),k=b('HTML'),l=b('MentionsInput'),m=b('Parent'),n=b('ScrollableArea'),o=b('ScrollAwareDOM'),p={expandFeedback:function(q,r,s){i.scry(q,r).forEach(function(t){g.expand(t,s);});},uncollapseFeedback:function(q){g.uncollapse(m.byTag(i.find(q,'.fbUfi'),'form'));},multiContentReplaceGlobal:function(q,r){this.multiContentReplace(document.documentElement,q,r);},multiContentReplace:function(q,r,s){s=s instanceof k?s.getRootNode():s;i.scry(q,r).forEach(function(t){o.replace(t,s.cloneNode(true));});},refocusCommentBox:function(q,r){var s=i.find(q,'textarea');s.value=s.style.height="";if(r){s.blur();s.focus.defer();}else document.documentElement.onfocusin({target:s});},resetMentionsInput:function(q){var r=l.getInstance(i.find(q,'div.uiMentionsInput'));r&&r.reset();},insertAtBottom:function(q,r,s,t){var u=i.scry(q,'.comment_'+s).length;if(r)u+=i.scry(q,'#'+r).length;if(!u){var v=i.find(q,'.commentList'),w=n.getInstance(v),x=w&&w.isScrolledToBottom();o.appendContent(v,t);x&&w.scrollToBottom(false);}},updateUnsubscribeLink:function(q,r){var s=i.scry(q,'.unsub_link')[0];if(s){i.replace(s,r);}else i.insertAfter(i.find(q,'.comment_link'),[" \xB7 ",r]);},updateSeenCount:function(q){j.scry(q,'.uiUfiSeenBar').forEach(function(t){h.hide(t);});j.scry(q,'.uiUfiViewSeenCount').forEach(function(t){h.hide(t);});var r=j.scry(q,'.uiUfiLike')[0];if(r&&r.childNodes.length===0)r=null;r=r||j.scry(q,'.uiUfiSeenBar')[0];if(!r)return;var s=j.scry(r,'.uiUfiViewSeenCount')[0];if(!s)return;h.show(s);h.show(r);}};e.exports=p;});
__d("legacy:MentionsInput",["MentionsInput"],function(a,b,c,d){a.MentionsInput=b('MentionsInput');},3);
__d("TypeaheadAreaCore",["Class","InputSelection","TypeaheadCore","copyProperties"],function(a,b,c,d,e,f){var g=b('Class'),h=b('InputSelection'),i=b('TypeaheadCore'),j=b('copyProperties');function k(l){this.parent.construct(this,l);this.matcher=new RegExp(this.matcher+'$');this.preventFocusChangeOnTab=true;}g.extend(k,i);j(k.prototype,{prefix:'',suffix:', ',matcher:"\\b[^,]*",click:bagofholding,select:function(l){this.parent.select(l);var m=this.element.value,n=this.prefix+l.text+this.suffix;this.expandBounds(m,n);var o=m.substring(0,this.start),p=m.substring(this.end);this.element.value=o+n+p;h.set(this.element,o.length+n.length);},expandBounds:function(l,m){l=l.toLowerCase().trim();m=m.toLowerCase();var n,o,p,q,r=/\s/;o=l.substring(this.start,this.end);p=m.indexOf(o);n=this.start;while(n>=0&&p>=0){q=l.charAt(n-1);if(!q||r.test(q))this.start=n;o=q+o;p=m.indexOf(o);n--;}o=l.substring(this.start,this.end);p=m.indexOf(o);n=this.end;while(n<=l.length&&p>=0){q=l.charAt(n);if(!q||r.test(q))this.end=n;o=o+q;p=m.indexOf(o);n++;}},getRawValue:function(){var l=h.get(this.element).start||0;return this.parent.getValue().substring(0,l);},getValue:function(){var l=this.matcher&&this.matcher.exec(this.getRawValue());if(!l)return '';var m=l[0],n=l.index+m.length;m=m.replace(/^\s/,'');var o=m.length;m=m.replace(/\s$/,'');var p=o-m.length;this.start=n-o;this.end=n+p;return l[1]||l[0];}});e.exports=k;});
__d("TypeaheadMetrics",["event-extensions","AsyncRequest","copyProperties","Typeahead"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('copyProperties'),i=b('Typeahead');function j(k){this.extraData={};h(this,k);}h(j.prototype,{endPoint:'/ajax/typeahead/record_basic_metrics.php',init:function(k){this.init=bagofholding;this.core=k.getCore();this.view=k.getView();this.data=k.getData();this.stats={};this.sessionActive=false;this._sessionStartEvents=[];this._sessionEndEvents=[];this._reset();this.initEvents();},_reset:function(){this.stats={};this.avgStats={};this.sessionActive=false;this.sid=Math.floor(Date.now()*Math.random());this.data.setQueryData({sid:this.sid});},recordSelect:function(k){var l=k.selected;if(l.uid==null){this.recordStat('selected_id','SELECT_NULL');}else this.recordStat('selected_id',l.uid);this.recordStat('selected_type',l.type);this.recordStat('selected_position',k.index);this.recordStat('selected_with_mouse',k.clicked?1:0);this._sessionEnd();},bindSessionStart:function(k,event,l){if(l)for(var m=0;m<this._sessionStartEvents.length;++m){var n=this._sessionStartEvents[m];n.obj.unsubscribe(n.token);}this._sessionStartEvents.push({obj:k,token:k.subscribe(event,function(o,p){this._sessionStart();}.bind(this))});},bindSessionEnd:function(k,event,l){if(l)for(var m=0;m<this._sessionEndEvents.length;++m){var n=this._sessionEndEvents[m];n.obj.unsubscribe(n.token);}this._sessionEndEvents.push({obj:k,token:k.subscribe(event,function(o,p){this._sessionEnd();}.bind(this))});},initEvents:function(){this.bindSessionStart(this.core,'focus',false);this.bindSessionEnd(this.core,'blur',false);this.view.subscribe('select',function(k,l){this.recordSelect(l);}.bind(this));this.bindSessionEnd(this.view,'select',false);this.view.subscribe('render',function(k,l){this.results=l;}.bind(this));this.data.subscribe('beforeQuery',function(k,l){if(!l.value)return;this.query=l.value;this.recordCountStat('num_queries');}.bind(this));this.data.subscribe('beforeFetch',function(k,l){if(l.fetch_context.bootstrap){this.bootstrapBegin=Date.now();}else l.fetch_context.queryBegin=Date.now();}.bind(this));this.data.subscribe('fetchComplete',function(k,l){if(l.fetch_context.bootstrap){this.recordAvgStat('bootstrap_latency',Date.now()-this.bootstrapBegin);var m={};l.response.payload.entries.forEach(function(n){if(!m[n.type]){m[n.type]=1;}else m[n.type]++;});this.recordStat('bootstrap_response_types',m);this.bootstrapped=true;}else this.recordAvgStat('avg_query_latency',Date.now()-l.fetch_context.queryBegin);}.bind(this));this.data.subscribe('dirty',function(k,l){this.bootstrapped=false;});},_sessionStart:function(){if(this.sessionActive)return;this.sessionActive=true;},_sessionEnd:function(){if(!this.sessionActive)return;this.sessionActive=false;this.submit();this._reset();},recordStat:function(k,l){this.stats[k]=l;},recordCountStat:function(k){var l=this.stats[k];this.stats[k]=l?l+1:1;},recordAvgStat:function(k,l){if(this.avgStats[k]){this.avgStats[k][0]+=l;++this.avgStats[k][1];}else this.avgStats[k]=[l,1];},submit:function(){if(Object.keys(this.stats).length){h(this.stats,this.extraData);if(this.results){var k=(this.results).map(function(n,o){return n.uid;});this.recordStat('candidate_results',JSON.stringify(k));}if(this.query)this.recordStat('query',this.query);if(this.sid)this.recordStat('sid',this.sid);if(this.bootstrapped)this.recordStat('bootstrapped',1);for(var l in this.avgStats){var m=this.avgStats[l];this.stats[l]=m[0]/m[1];}new g().setURI(this.endPoint).setMethod('POST').setData({stats:this.stats}).send();this._reset();}}});j.register=function(k,l,m){if(document.activeElement===k){l.init(m);}else var n=Event.listen(k,'focus',function(){l.init(m);n.remove();});};e.exports=j;});
__d("TypeaheadHoistFriends",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._typeahead=i;}g(h.prototype,{_subscription:null,enable:function(){var i=this._typeahead.getView();this._subscription=i.subscribe('beforeRender',function(j,k){var l=[],m=[];for(var n=0;n<k.results.length;++n){var o=k.results[n];if(o.type=='user'&&o.bootstrapped){m.push(o);}else l.push(o);}k.results=m.concat(l);});},disable:function(){this._typeahead.getView().unsubscribe(this._subscription);this._subscription=null;}});e.exports=h;});
__d("legacy:HoistFriendsTypeaheadBehavior",["TypeaheadHoistFriends"],function(a,b,c,d){var e=b('TypeaheadHoistFriends');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.hoistFriends=function(f){f.enableBehavior(e);};},3);
__d("sprintf",[],function(a,b,c,d,e,f){function g(h,i){i=Array.prototype.slice.call(arguments,1);var j=0;return h.replace(/%s/g,function(k){return i[j++];});}e.exports=g;});
__d("Log",["sprintf"],function(a,b,c,d,e,f){var g=b('sprintf'),h={DEBUG:3,INFO:2,WARNING:1,ERROR:0};function i(k,l){var m=Array.prototype.slice.call(arguments,2),n=g.apply(null,m);if(j.level>=k&&window.console)console[l in console?l:'log'](n);}var j={level:-1,Level:h,debug:i.bind(null,h.DEBUG,'debug'),info:i.bind(null,h.INFO,'debug'),warn:i.bind(null,h.WARNING,'debug'),error:i.bind(null,h.ERROR,'debug')};e.exports=j;});
__d("resolveWindow",[],function(a,b,c,d,e,f){function g(h){var i=window,j=h.split('.');try{for(var l=0;l<j.length;l++){var m=j[l],n=/^frames\[['"]?([a-zA-Z0-9\-_]+)['"]?\]$/.exec(m);if(n){i=i.frames[n[1]];}else if(m==='opener'||m==='parent'||m==='top'){i=i[m];}else return null;}}catch(k){return null;}return i;}e.exports=g;});
__d("XD",["function-extensions","Arbiter","DOM","DOMDimensions","Log","URI","UserAgent","copyProperties","isInIframe","resolveWindow"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Arbiter'),h=b('DOM'),i=b('DOMDimensions'),j=b('Log'),k=b('URI'),l=b('UserAgent'),m=b('copyProperties'),n=b('isInIframe'),o=b('resolveWindow'),p='fb_xdm_frame_'+location.protocol.replace(':',''),q={_callbacks:[],_opts:{autoResize:false,allowShrink:true,channelUrl:null,hideOverflow:false,resizeTimeout:100,resizeWidth:false,expectResizeAck:false,resizeAckTimeout:6000},_lastResizeAckId:0,_resizeCount:0,_resizeTimestamp:0,_shrinker:null,init:function(s){this._opts=m(m({},this._opts),s);if(this._opts.autoResize)this._startResizeMonitor();g.subscribe('Connect.Unsafe.resize.ack',function(t,u){if(!u.id)u.id=this._resizeCount;if(u.id>this._lastResizeAckId)this._lastResizeAckId=u.id;}.bind(this));},send:function(s,t){t=t||this._opts.channelUrl;if(!t)return;var u={},v=new k(t);m(u,s);m(u,k.explodeQuery(v.getFragment()));var w=new k(u.origin),x=w.getDomain()+(w.getPort()?':'+w.getPort():''),y=o(u.relation.replace(/^parent\./,'')),z=y.frames[p];z?z.proxyMessage(k.implodeQuery(u),[x]):j.warn('No such frame "'+p+'" to proxyMessage to');},_computeSize:function(){var s=i.getDocumentDimensions(),t=0;if(this._opts.resizeWidth){var u=document.body;if(u.clientWidth<u.scrollWidth){t=s.width;}else{var v=u.childNodes;for(var w=0;w<v.length;w++){var x=v[w],y=x.offsetLeft+x.offsetWidth;if(y>t)t=y;}}t=Math.max(t,q.forced_min_width);}s.width=t;if(this._opts.allowShrink){if(!this._shrinker)this._shrinker=h.create('div');h.appendContent(document.body,this._shrinker);s.height=this._shrinker.offsetTop;}return s;},_startResizeMonitor:function(){var s,t=document.documentElement;if(this._opts.hideOverflow){t.style.overflow='hidden';document.body.style.overflow='hidden';}setInterval((function(){var u=this._computeSize(),v=Date.now(),w=this._lastResizeAckId<this._resizeCount&&(v-this._resizeTimestamp)>this._opts.resizeAckTimeout;if(!s||(this._opts.expectResizeAck&&w)||(this._opts.allowShrink&&s.width!=u.width)||(!this._opts.allowShrink&&s.width<u.width)||(this._opts.allowShrink&&s.height!=u.height)||(!this._opts.allowShrink&&s.height<u.height)){s=u;this._resizeCount++;this._resizeTimestamp=v;var x={type:'resize',height:u.height,ackData:{id:this._resizeCount}};if(u.width&&u.width!=0)x.width=u.width;try{if(k(document.referrer).isFacebookURI()&&n()&&window.name&&window.parent.location&&window.parent.location.toString&&k(window.parent.location).isFacebookURI()){var z=window.parent.document.getElementsByTagName('iframe');for(var aa=0;aa<z.length;aa=aa+1)if(z[aa].name==window.name){if(this._opts.resizeWidth)z[aa].style.width=x.width+'px';z[aa].style.height=x.height+'px';}}this.send(x);}catch(y){this.send(x);}}}).bind(this),this._opts.resizeTimeout);}},r=m({},q);e.exports.UnverifiedXD=r;e.exports.XD=q;a.UnverifiedXD=r;a.XD=q;});
__d("legacy:connect-xd",["XD"],function(a,b,c,d){a.UnverifiedXD=b('XD').UnverifiedXD;a.XD=b('XD').XD;},3);
__d("legacy:startsWith",["startsWith"],function(a,b,c,d){a.startsWith=b('startsWith');},3);
__d("legacy:input-methods",["Input","copyProperties"],function(a,b,c,d){var e=b('Input'),f=b('copyProperties');f(a.Input||(a.Input={}),e);},3);
__d("RequiredFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('required')&&g.isEmpty(i[j])){i[j].focus();return false;}},Event.Priority.URGENT);});
__d("PopupWindow",["DOMDimensions","DOMQuery","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('DOMDimensions'),h=b('DOMQuery'),i=b('UserAgent'),j=b('copyProperties'),k={_opts:{allowShrink:true,strategy:'vector',timeout:100,widthElement:null},init:function(l){j(k._opts,l);setInterval(k._resizeCheck,k._opts.timeout);},_resizeCheck:function(){var l=g.getViewportDimensions(),m=k._getDocumentSize(),n=m.height-l.height,o=m.width-l.width;if(o<0&&!k._opts.widthElement)o=0;o=o>1?o:0;if(!k._opts.allowShrink&&n<0)n=0;if(n||o)try{window.console&&window.console.firebug;window.resizeBy(o,n);if(o)window.moveBy(o/-2,0);}catch(p){}},_getDocumentSize:function(){var l=g.getDocumentDimensions();if(k._opts.strategy==='offsetHeight')l.height=document.body.offsetHeight;if(k._opts.widthElement){var m=h.scry(document.body,k._opts.widthElement)[0];if(m)l.width=g.getElementDimensions(m).width;}if(window.Dialog&&Dialog.max_bottom&&Dialog.max_bottom>l.height)l.height=Dialog.max_bottom;return l;},open:function(l,m,n){var o=typeof window.screenX!='undefined'?window.screenX:window.screenLeft,p=typeof window.screenY!='undefined'?window.screenY:window.screenTop,q=typeof window.outerWidth!='undefined'?window.outerWidth:document.body.clientWidth,r=typeof window.outerHeight!='undefined'?window.outerHeight:(document.body.clientHeight-22),s=parseInt(o+((q-n)/2),10),t=parseInt(p+((r-m)/2.5),10),u=('width='+n+',height='+m+',left='+s+',top='+t);return window.open(l,'_blank',u);}};e.exports=k;});
__d("legacy:popup-resizer",["PopupWindow"],function(a,b,c,d){a.PopupResizer=b('PopupWindow');},3);
__d("legacy:ContextualDialogX",["ContextualDialogX"],function(a,b,c,d){a.ContextualDialogX=b('ContextualDialogX');},3);
WidgetArbiter={_findSiblings:function(){if(WidgetArbiter._siblings)return;WidgetArbiter._siblings=[];for(var a=parent.frames.length-1;a>=0;a--)try{if(parent.frames[a]&&parent.frames[a].Arbiter&&parent.frames[a].Arbiter.inform)WidgetArbiter._siblings.push(parent.frames[a].Arbiter);}catch(b){}},inform:function(){WidgetArbiter._findSiblings();var a=$A(arguments);WidgetArbiter._siblings.forEach(function(b){b.inform.apply(b,a);});}};
WindowComm={_callbacks:{},makeHandler:function(a,b){b=b||'opener';var c='f'+(Math.random()*(1<<30)).toString(16).replace('.','');WindowComm._callbacks[c]=a;return new URI('/connect/window_comm.php').setQueryData({_id:c,_relation:b}).getQualifiedURI().toString();},_recv:function(a){var b=new URI(a).getQueryData();WindowComm._callbacks[b._id](b);}};
var Base64=(function(){var a='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function b(e){e=(e.charCodeAt(0)<<16)|(e.charCodeAt(1)<<8)|e.charCodeAt(2);return String.fromCharCode(a.charCodeAt(e>>>18),a.charCodeAt((e>>>12)&63),a.charCodeAt((e>>>6)&63),a.charCodeAt(e&63));}var c='>___?456789:;<=_______'+'\0\1\2\3\4\5\6\7\b\t\n\13\f\r\16\17\20\21\22\23\24\25\26\27\30\31'+'______\32\33\34\35\36\37 !"#$%&\'()*+,-./0123';function d(e){e=(c.charCodeAt(e.charCodeAt(0)-43)<<18)|(c.charCodeAt(e.charCodeAt(1)-43)<<12)|(c.charCodeAt(e.charCodeAt(2)-43)<<6)|c.charCodeAt(e.charCodeAt(3)-43);return String.fromCharCode(e>>>16,(e>>>8)&255,e&255);}return {encode:function(e){e=unescape(encodeURI(e));var f=(e.length+2)%3;e=(e+'\0\0'.slice(f)).replace(/[\s\S]{3}/g,b);return e.slice(0,e.length+f-2)+'=='.slice(f);},decode:function(e){e=e.replace(/[^A-Za-z0-9+\/]/g,'');var f=(e.length+3)&3;e=(e+'AAA'.slice(f)).replace(/..../g,d);e=e.slice(0,e.length+f-3);try{return decodeURIComponent(escape(e));}catch(g){throw new Error('Not valid UTF-8');}},encodeObject:function(e){return Base64.encode(JSON.stringify(e));},decodeObject:function(e){return JSON.parse(Base64.decode(e));},encodeNums:function(e){return String.fromCharCode.apply(String,e.map(function(f){return a.charCodeAt((f|-(f>63))&-(f>0)&63);}));}};})();
__d("PopoverMenuInterface",["Arbiter","ArbiterMixin","Class","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('copyProperties');function k(){}j(k.prototype,h,{getRoot:bagofholding,onShow:bagofholding,onHide:bagofholding,focusAnItem:bagof(false),blur:bagofholding,handleKeydown:bagof(false),done:function(){this.inform('done');}});e.exports=k;});
__d("Popover",["event-extensions","Arbiter","ArbiterMixin","Class","ContextualLayer","ContextualLayerHideOnScroll","CSS","DataStore","DOM","Input","KeyStatus","LayerHideOnEscape","Toggler","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('Class'),j=b('ContextualLayer'),k=b('ContextualLayerHideOnScroll'),l=b('CSS'),m=b('DataStore'),n=b('DOM'),o=b('Input'),p=b('KeyStatus'),q=b('LayerHideOnEscape'),r=b('Toggler'),s=b('copyProperties');r.subscribe(['show','hide'],function(u,v){var w=m.get(v.getActive(),'Popover');if(w)if(u==='show'){w.showLayer();}else w.hideLayer();});function t(u,v,w,x){this._root=u;this._triggerElem=v;this._behaviors=w;this._config=x;if(!(v.nodeName==='A'&&v.rel==='toggle'))Event.listen(v,'click',function(){r.bootstrap(v);});m.set(u,'Popover',this);}s(t.prototype,h,{_layer:null,_closeListener:null,ensureInit:function(){if(!this._layer)this._init();},showLayer:function(){this.ensureInit();this._layer.show();r.show(this._root);l.addClass(this._root,'selected');this.inform('show');this._triggerElem.setAttribute('aria-expanded','true');},hideLayer:function(){this._layer.hide();this._triggerElem.setAttribute('aria-expanded','false');},isShown:function(){return this._layer.isShown();},setLayerContent:function(u){this.ensureInit();this._layer.setContent(u);},_init:function(){var u=new j({context:this._triggerElem,position:'below'},n.create('div'));u.enableBehaviors([k,q]);r.createInstance(u.getRoot()).setSticky(false);u.subscribe('hide',this._onLayerHide.bind(this));this._behaviors&&u.enableBehaviors(this._behaviors);this._layer=u;if(this._config.alignh)this._layer.setAlignment(this._config.alignh);if(this._config.layer_content)this._layer.setContent(this._config.layer_content);this.inform('init',null,g.BEHAVIOR_PERSISTENT);},_onLayerHide:function(){r.hide(this._root);l.removeClass(this._root,'selected');this.inform('hide');if(p.isKeyDown())o.focus(this._triggerElem);}});e.exports=t;});
__d("PopoverAsyncMenuLoading",["Class","copyProperties","DOM","PopoverMenuInterface"],function(a,b,c,d,e,f){var g=b('Class'),h=b('copyProperties'),i=b('DOM'),j=b('PopoverMenuInterface');function k(l){this.parent.construct(this);this._className=l||'';}g.extend(k,j);h(k.prototype,{_root:null,getRoot:function(){if(!this._root)this._root=i.create('div',{className:this._className},i.create('div',{className:'uiMenuXBorder'},i.create('div',{className:'uiMenuX uiMenuXLoading'},i.create('span',{className:'spinner'}))));return this._root;}});e.exports=k;});
__d("PopoverMenu",["event-extensions","Arbiter","ArbiterMixin","ARIA","BehaviorsMixin","Class","Input","Keys","KeyStatus","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('ArbiterMixin'),i=b('ARIA'),j=b('BehaviorsMixin'),k=b('Class'),l=b('Input'),m=b('Keys'),n=b('KeyStatus'),o=b('copyProperties');function p(q,r,s,t){this._popover=q;this._triggerElem=r;this._initialMenu=s;q.subscribe('init',this._onLayerInit.bind(this));q.subscribe('show',this._onPopoverShow.bind(this));q.subscribe('hide',this._onPopoverHide.bind(this));t&&this.enableBehaviors(t);}o(p.prototype,h,j);o(p.prototype,{_keydownListener:null,_popoverShown:false,setMenu:function(q){this._menu=q;var r=q.getRoot();this._popover.setLayerContent(r);q.subscribe('done',this._onMenuDone.bind(this));if(this._popoverShown)this._menu.onShow();i.owns(this._triggerElem,r);this.inform('setMenu',null,g.BEHAVIOR_PERSISTENT);},getPopover:function(){return this._popover;},getTriggerElem:function(){return this._triggerElem;},getMenu:function(){return this._menu;},_onLayerInit:function(){this.setMenu(this._initialMenu);},_onPopoverShow:function(){if(this._menu){this._menu.onShow();if(n.isKeyDown())this._menu.focusAnItem();this._keydownListener=Event.listen(document.documentElement,'keydown',this._handleKeydown.bind(this));}this._popoverShown=true;},_onPopoverHide:function(){if(this._menu)this._menu.onHide();if(this._keydownListener){this._keydownListener.remove();this._keydownListener=null;}this._popoverShown=false;},_handleKeydown:function(q){if(q.getModifiers().any)return;var r=Event.getKeyCode(q);switch(r){case m.RETURN:return;case m.UP:case m.DOWN:this._menu.handleKeydown(r);break;default:if(this._menu.handleKeydown(r)===false){this._menu.blur();this._menu.handleKeydown(r);}break;}q.prevent();},_onMenuDone:function(q){this._popover.hideLayer.bind(this._popover).defer();if(n.isKeyDown())l.focus(this._triggerElem);}});e.exports=p;});
__d("PopoverAsyncMenu",["event-extensions","AsyncRequest","Class","CSS","DOM","PopoverAsyncMenuLoading","PopoverMenu","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Class'),i=b('CSS'),j=b('DOM'),k=b('PopoverAsyncMenuLoading'),l=b('PopoverMenu'),m=b('copyProperties'),n={},o=0;function p(q,r,s,t,u){this._endpoint=t;this._loadingMenu=s;this._instanceId=o++;n[this._instanceId]=this;this._mouseoverListener=Event.listen(r,'mouseover',this._fetchMenu.bind(this));this.parent.construct(this,q,r,null,u);}p.setMenu=function(q,r){n[q].setMenu(r);};h.extend(p,l);m(p.prototype,{_fetched:false,_mouseoverListener:null,_onLayerInit:function(){if(!this._menu)this.setMenu(this._loadingMenu);this._fetchMenu();},_fetchMenu:function(){if(this._fetched)return;new g().setURI(this._endpoint).setData({pmid:this._instanceId}).send();this._fetched=true;if(this._mouseoverListener){this._mouseoverListener.remove();this._mouseoverListener=null;}}});e.exports=p;});
__d("PopoverMenuOverlappingBorder",["function-extensions","CSS","DOM","Style","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('copyProperties');function k(l){this._popoverMenu=l;this._popover=l.getPopover();this._triggerElem=l.getTriggerElem();}j(k.prototype,{_shortBorder:null,_setMenuSubscription:null,_showSubscription:null,_menuSubscription:null,enable:function(){this._setMenuSubscription=this._popoverMenu.subscribe('setMenu',this._onSetMenu.bind(this));},disable:function(){this._popoverMenu.unsubscribe(this._setMenuSubscription);this._setMenuSubscription=null;this._removeBorderSubscriptions();this._removeShortBorder();},_onSetMenu:function(){this._removeBorderSubscriptions();this._menu=this._popoverMenu.getMenu();this._renderShortBorder(this._menu.getRoot());this._showSubscription=this._popover.subscribe('show',this._updateBorder.bind(this));this._menuSubscription=this._menu.subscribe(['change','resize'],Function.prototype.defer.shield(this._updateBorder.bind(this)));this._updateBorder();},_updateBorder:function(){var l=this._menu.getRoot(),m=this._triggerElem.offsetWidth;i.set(l,'min-width',m+'px');var n=Math.max(l.offsetWidth-m,0);i.set(this._shortBorder,'width',n+'px');},_renderShortBorder:function(l){this._shortBorder=h.create('div',{className:'uiMenuXShortBorder'});h.appendContent(l,this._shortBorder);g.addClass(l,'uiMenuXWithShortBorder');},_removeShortBorder:function(){if(this._shortBorder){h.remove(this._shortBorder);this._shortBorder=null;g.removeClass(this._popoverMenu.getMenu().getRoot(),'uiMenuXShortBorder');}},_removeBorderSubscriptions:function(){if(this._showSubscription){this._popover.unsubscribe(this._showSubscription);this._showSubscription=null;}if(this._menuSubscription){this._menu.unsubscribe(this._menuSubscription);this._menuSubscription=null;}}});e.exports=k;});
function tz_calculate(a){var b=new Date(),c=b.getTimezoneOffset()/30,d=b.getTime()/1000,e=Math.round((a-d)/1800),f=Math.round(c+e)%48;if(f==0){return 0;}else if(f>24){f-=Math.ceil(f/48)*48;}else if(f<-28)f+=Math.ceil(f/-48)*48;return f*30;}function tz_autoset(a,b){if(!a||undefined==b)return;if(window.tz_autoset.calculated)return;window.tz_autoset.calculated=true;var c=-tz_calculate(a);if(c!=b){var d='/ajax/autoset_timezone_ajax.php';new AsyncRequest().setURI(d).setData({gmt_off:c}).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding).setOption('suppressErrorAlerts',true).send();}}
__d("UserAgent",[],function(a,b,c,d,e,f){var g=false,h,i,j,k,l,m,n,o,p,q,r,s,t,u;function v(){if(g)return;g=true;var x=navigator.userAgent,y=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))/.exec(x),z=/(Mac OS X)|(Windows)|(Linux)/.exec(x);r=/\b(iPhone|iP[ao]d)/.exec(x);s=/\b(iP[ao]d)/.exec(x);p=/Android/i.exec(x);t=/FBAN\/\w+;/i.exec(x);u=/Mobile/i.exec(x);q=!!(/Win64/.exec(x));if(y){h=y[1]?parseFloat(y[1]):NaN;if(h&&document.documentMode)h=document.documentMode;i=y[2]?parseFloat(y[2]):NaN;j=y[3]?parseFloat(y[3]):NaN;k=y[4]?parseFloat(y[4]):NaN;if(k){y=/(?:Chrome\/(\d+\.\d+))/.exec(x);l=y&&y[1]?parseFloat(y[1]):NaN;}else l=NaN;}else h=i=j=l=k=NaN;if(z){if(z[1]){var aa=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(x);m=aa?parseFloat(aa[1].replace('_','.')):true;}else m=false;n=!!z[2];o=!!z[3];}else m=n=o=false;}var w={ie:function(){return v()||h;},ie64:function(){return w.ie()&&q;},firefox:function(){return v()||i;},opera:function(){return v()||j;},safari:function(){return v()||k;},chrome:function(){return v()||l;},windows:function(){return v()||n;},osx:function(){return v()||m;},linux:function(){return v()||o;},iphone:function(){return v()||r;},mobile:function(){return v()||(r||s||p||u);},nativeApp:function(){return v()||t;},android:function(){return v()||p;},ipad:function(){return v()||s;}};e.exports=w;});
__d("FBDesktopDetect",["UserAgent"],function(a,b,c,d,e,f){var g=b('UserAgent'),h='facebook.desktopplugin',i={mimeType:'application/x-facebook-desktop-1',isPluginInstalled:function(){if(g.osx())return false;var j=null;if(a.ActiveXObject){try{j=new a.ActiveXObject(h);if(j)return true;}catch(k){}}else if(a.navigator&&a.navigator.plugins){a.navigator.plugins.refresh(false);for(var l=0,m=a.navigator.plugins.length;l<m;l++){j=a.navigator.plugins[l];if(j.length&&j[0].type===this.mimeType)return true;}}return false;}};e.exports=i;});
__d("Cookie",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h={set:function(i,j,k,l,m){if(g.no_cookies&&i!='tpa')return;document.cookie=i+"="+encodeURIComponent(j)+"; "+(k?"expires="+(new Date(Date.now()+k)).toGMTString()+"; ":"")+"path="+(l||'/')+"; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1')+(m?"; secure":"");},clear:function(i){document.cookie=i+"=; expires=Thu, 01-Jan-1970 00:00:01 GMT; "+"path=/; domain="+window.location.hostname.replace(/^.*(\.facebook\..*)$/i,'$1');},get:function(i){var j=document.cookie.match('(?:^|;\\s*)'+i+'=(.*?)(?:;|$)');return (j?decodeURIComponent(j[1]):j);}};e.exports=h;});
__d("legacy:cookie",["Cookie"],function(a,b,c,d){var e=b('Cookie');a.getCookie=e.get;a.setCookie=e.set;a.clearCookie=e.clear;},3);
__d("QueryString",[],function(a,b,c,d,e,f){var g={encode:function(h){var i=[];Object.keys(h).forEach(function(j){var k=h[j];if(typeof k==='undefined')return;if(k===null){i.push(j);return;}i.push(encodeURIComponent(j)+'='+encodeURIComponent(k));});return i.join('&');},decode:function(h){var i={};if(h==='')return i;var j=h.split('&'),k=j.length;while(k--){var l=j[k].split('=',2);i[decodeURIComponent(l[0])]=l.length===2?decodeURIComponent(l[1]):null;}return i;},appendToUrl:function(h,i){return h+(~h.indexOf('?')?'&':'?')+(typeof i==='string'?i:g.encode(i));}};e.exports=g;});
__d("URI",["copyProperties","goURI"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('goURI');function i(j){if(!(this instanceof i))return new i(j||window.location.href);this.parse(j||'');}g(i,{getRequestURI:function(j,k){j=j===undefined||j;var l=a.PageTransitions;if(j&&l&&l.isInitialized()){return l.getCurrentURI(!!k).getQualifiedURI();}else return new i(window.location.href);},getMostRecentURI:function(){var j=a.PageTransitions;if(j&&j.isInitialized()){return j.getMostRecentURI().getQualifiedURI();}else return new i(window.location.href);},getNextURI:function(){var j=a.PageTransitions;if(j&&j.isInitialized()){return j.getNextURI().getQualifiedURI();}else return new i(window.location.href);},expression:/(((\w+):\/\/)([^\/:]*)(:(\d+))?)?([^#?]*)(\?([^#]*))?(#(.*))?/,arrayQueryExpression:/^(\w+)((?:\[\w*\])+)=?(.*)/,explodeQuery:function(j){if(!j)return {};var k={};j=j.replace(/%5B/ig,'[').replace(/%5D/ig,']');j=j.split('&');for(var l=0,m=j.length;l<m;l++){var n=j[l].match(i.arrayQueryExpression);if(!n){var o=j[l].split('=');k[i.decodeComponent(o[0])]=o[1]===undefined?null:i.decodeComponent(o[1]);}else{var p=n[2].split(/\]\[|\[|\]/).slice(0,-1),q=n[1],r=i.decodeComponent(n[3]||'');p[0]=q;var s=k;for(var t=0;t<p.length-1;t++)if(p[t]){if(s[p[t]]===undefined)if(p[t+1]&&!p[t+1].match(/^\d+$/)){s[p[t]]={};}else s[p[t]]=[];s=s[p[t]];}else{if(p[t+1]&&!p[t+1].match(/^\d+$/)){s.push({});}else s.push([]);s=s[s.length-1];}if(s instanceof Array&&p[p.length-1]===''){s.push(r);}else s[p[p.length-1]]=r;}}return k;},implodeQuery:function(j,k,l){k=k||'';if(l===undefined)l=true;var m=[];if(j===null||j===undefined){m.push(l?i.encodeComponent(k):k);}else if(j instanceof Array){for(var n=0;n<j.length;++n)try{if(j[n]!==undefined)m.push(i.implodeQuery(j[n],k?(k+'['+n+']'):n,l));}catch(o){}}else if(typeof(j)=='object'){if(('nodeName' in j)&&('nodeType' in j)){m.push('{node}');}else for(var p in j)try{if(j[p]!==undefined)m.push(i.implodeQuery(j[p],k?(k+'['+p+']'):p,l));}catch(o){}}else if(l){m.push(i.encodeComponent(k)+'='+i.encodeComponent(j));}else m.push(k+'='+j);return m.join('&');},encodeComponent:function(j){return encodeURIComponent(j).replace(/%5D/g,"]").replace(/%5B/g,"[");},decodeComponent:function(j){return decodeURIComponent(j.replace(/\+/g,' '));},INVALID_DOMAIN:'invalid.invalid',sanitizeDomain:function(j){var k=new RegExp('[\\x00-\\x2c\\x2f\\x3b-\\x40\\x5c\\x5e\\x60\\x7b-\\x7f'+'\\uFDD0-\\uFDEF\\uFFF0-\\uFFFF'+'\\u2047\\u2048\\uFE56\\uFE5F\\uFF03\\uFF0F\\uFF1F]');if(k.test(j)){return i.INVALID_DOMAIN;}else return j;}});g(i.prototype,{parse:function(j){var k=j.toString().match(i.expression);g(this,{protocol:k[3]||'',domain:i.sanitizeDomain(k[4]||''),port:k[6]||'',path:k[7]||'',query_s:k[9]||'',fragment:k[11]||''});return this;},setProtocol:function(j){this.protocol=j;return this;},getProtocol:function(){return this.protocol;},setQueryData:function(j){this.query_s=i.implodeQuery(j);return this;},addQueryData:function(j){return this.setQueryData(g(this.getQueryData(),j));},removeQueryData:function(j){if(!Array.isArray(j))j=[j];var k=this.getQueryData();for(var l=0,m=j.length;l<m;++l)delete k[j[l]];return this.setQueryData(k);},getQueryData:function(){return i.explodeQuery(this.query_s);},setFragment:function(j){this.fragment=j;return this;},getFragment:function(){return this.fragment;},setDomain:function(j){this.domain=i.sanitizeDomain(j);return this;},getDomain:function(){return this.domain;},setPort:function(j){this.port=j;return this;},getPort:function(){return this.port;},setPath:function(j){this.path=j;return this;},getPath:function(){return this.path.replace(/^\/+/,'/');},isEmpty:function(){return !(this.path||this.protocol||this.domain||this.port||this.query_s||this.fragment);},toString:function(){var j='';this.protocol&&(j+=this.protocol+'://');this.domain&&(j+=this.domain);this.port&&(j+=':'+this.port);if(this.domain&&!this.path)j+='/';this.path&&(j+=this.path);this.query_s&&(j+='?'+this.query_s);this.fragment&&(j+='#'+this.fragment);return j;},valueOf:function(){return this.toString();},isFacebookURI:function(){if(!i._facebookURIRegex)i._facebookURIRegex=new RegExp('(^|\\.)facebook\\.com([^.]*)$','i');return (!this.domain||i._facebookURIRegex.test(this.domain));},isQuicklingEnabled:function(){var j=a.Quickling;return j&&j.isActive()&&j.isPageActive(this);},getRegisteredDomain:function(){if(!this.domain)return '';if(!this.isFacebookURI())return null;var j=this.domain.split('.'),k=j.indexOf('facebook');return j.slice(k).join('.');},getUnqualifiedURI:function(){return new i(this).setProtocol(null).setDomain(null).setPort(null);},getQualifiedURI:function(){var j=new i(this);if(!j.getDomain()){var k=i();j.setProtocol(k.getProtocol()).setDomain(k.getDomain()).setPort(k.getPort());}return j;},isSameOrigin:function(j){var k=j||window.location.href;if(!(k instanceof i))k=new i(k.toString());if(this.getProtocol()&&this.getProtocol()!=k.getProtocol())return false;if(this.getDomain()&&this.getDomain()!=k.getDomain())return false;if(this.getPort()&&this.getPort()!=k.getPort())return false;return true;},go:function(j){h(this,j);},setSubdomain:function(j){var k=new i(this).getQualifiedURI(),l=k.getDomain().split('.');if(l.length<=2){l.unshift(j);}else l[0]=j;return k.setDomain(l.join('.'));},getSubdomain:function(){if(!this.getDomain())return '';var j=this.getDomain().split('.');if(j.length<=2){return '';}else return j[0];},setSecure:function(j){return this.setProtocol(j?'https':'http');},isSecure:function(){return this.getProtocol()=='https';}});e.exports=i;});
__d("XHR",["Env"],function(a,b,c,d,e,f){var g=b('Env'),h={create:function(){try{return a.XMLHttpRequest?new a.XMLHttpRequest():new ActiveXObject("MSXML2.XMLHTTP.3.0");}catch(i){}},getAsyncParams:function(i){var j={__user:g.user,__a:1};if(i=='POST'&&g.fb_dtsg)j.fb_dtsg=g.fb_dtsg;if(g.fb_isb)j.fb_isb=g.fb_isb;return j;}};e.exports=h;});
__d("AsyncSignal",["Env","ErrorUtils","QueryString","URI","XHR","copyProperties"],function(a,b,c,d,e,f){var g=b('Env'),h=b('ErrorUtils'),i=b('QueryString'),j=b('URI'),k=b('XHR'),l=b('copyProperties');function m(n,o){this.data=o||{};if(g.tracking_domain&&n.charAt(0)=='/')n=g.tracking_domain+n;this.uri=n;}m.prototype.setHandler=function(n){this.handler=n;return this;};m.prototype.send=function(){var n=this.handler,o=this.data,p=new Image();if(n)p.onload=p.onerror=function(){h.applyWithGuard(n,null,[p.height==1]);};o.asyncSignal=(Math.random()*10000|0)+1;var q=new j(this.uri).isFacebookURI();l(o,k.getAsyncParams(q?'POST':'GET'));p.src=i.appendToUrl(this.uri,o);return this;};e.exports=m;});
__d("legacy:async-signal",["AsyncSignal"],function(a,b,c,d){a.AsyncSignal=b('AsyncSignal');},3);
__d("legacy:uri",["URI"],function(a,b,c,d){a.URI=b('URI');},3);
function detect_broken_proxy_cache(a,b){var c=getCookie(b);if((c!=a)&&(c!=null)&&(a!='0')){var d={c:'si_detect_broken_proxy_cache',m:b+' '+a+' '+c},e=new URI('/common/scribe_endpoint.php').getQualifiedURI().toString();new AsyncSignal(e,d).send();}}
__d("NavigationMessage",[],function(a,b,c,d,e,f){var g={NAVIGATION_BEGIN:'NavigationMessage/navigationBegin',NAVIGATION_SELECT:'NavigationMessage/navigationSelect',NAVIGATION_FIRST_RESPONSE:'NavigationMessage/navigationFirstResponse',NAVIGATION_COMPLETED:'NavigationMessage/navigationCompleted',NAVIGATION_FAILED:'NavigationMessage/navigationFailed',NAVIGATION_COUNT_UPDATE:'NavigationMessage/navigationCount',NAVIGATION_FAVORITE_UPDATE:'NavigationMessage/navigationFavoriteUpdate',NAVIGATION_ITEM_REMOVED:'NavigationMessage/navigationItemRemoved',NAVIGATION_ITEM_HIDDEN:'NavigationMessage/navigationItemHidden',INTERNAL_LOADING_BEGIN:'NavigationMessage/internalLoadingBegin',INTERNAL_LOADING_COMPLETED:'NavigationMessage/internalLoadingCompleted'};e.exports=g;});
__d("createObjectFrom",["hasArrayNature"],function(a,b,c,d,e,f){var g=b('hasArrayNature');function h(i,j){var k={},l=g(j);if(typeof j=='undefined')j=true;for(var m=i.length;m--;)k[i[m]]=l?j[m]:j;return k;}e.exports=h;});
__d("DOMQuery",["CSS","UserAgent","createArrayFrom","createObjectFrom","ge"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('UserAgent'),i=b('createArrayFrom'),j=b('createObjectFrom'),k=b('ge'),l={find:function(m,n){var o=l.scry(m,n);return o[0];},scry:function(m,n){if(!m||!m.getElementsByTagName)return [];var o=n.split(' '),p=[m];for(var q=0;q<o.length;q++){if(p.length===0)break;if(o[q]==='')continue;var r=o[q],s=o[q],t=[],u=false;if(r.charAt(0)=='^')if(q===0){u=true;r=r.slice(1);}else return [];r=r.replace(/\./g,' .');r=r.replace(/\#/g,' #');r=r.replace(/\[/g,' [');var v=r.split(' '),w=v[0]||'*',x=w=='*',y=v[1]&&v[1].charAt(0)=='#';if(y){var z=k(v[1].slice(1),true);if(z&&(x||z.tagName.toLowerCase()==w))for(var aa=0;aa<p.length;aa++)if(u&&l.contains(z,p[aa])){t=[z];break;}else if(document==p[aa]||l.contains(p[aa],z)){t=[z];break;}}else{var ba=[],ca=p.length,da,ea=!u&&s.indexOf('[')<0&&document.querySelectorAll;for(var fa=0;fa<ca;fa++){if(u){da=[];var ga=p[fa].parentNode;while(l.isElementNode(ga)){if(x||ga.tagName.toLowerCase()==w)da.push(ga);ga=ga.parentNode;}}else if(ea){da=p[fa].querySelectorAll(s);}else da=p[fa].getElementsByTagName(w);var ha=da.length;for(var ia=0;ia<ha;ia++)ba.push(da[ia]);}if(!ea)for(var ja=1;ja<v.length;ja++){var ka=v[ja],la=ka.charAt(0)=='.',ma=ka.substring(1);for(fa=0;fa<ba.length;fa++){var na=ba[fa];if(!na)continue;if(la){if(!g.hasClass(na,ma))delete ba[fa];continue;}else{var oa=ka.slice(1,ka.length-1);if(oa.indexOf('=')==-1){if(na.getAttribute(oa)===null){delete ba[fa];continue;}}else{var pa=oa.split('='),qa=pa[0],ra=pa[1];ra=ra.slice(1,ra.length-1);if(na.getAttribute(qa)!=ra){delete ba[fa];continue;}}}}}for(fa=0;fa<ba.length;fa++)if(ba[fa]){t.push(ba[fa]);if(u)break;}}p=t;}return p;},getText:(function(){var m=document.createElement('div'),n=m.textContent!=null?'textContent':'innerText';return function(o){if(l.isTextNode(o)){return o.data;}else if(l.isElementNode(o)){return o[n];}else return '';};})(),getSelection:function(){var m=window.getSelection,n=document.selection;if(m){return m()+'';}else if(n)return n.createRange().text;return null;},contains:function(m,n){m=k(m);n=k(n);if(!m||!n){return false;}else if(m===n){return true;}else if(l.isTextNode(m)){return false;}else if(l.isTextNode(n)){return l.contains(m,n.parentNode);}else if(m.contains){return m.contains(n);}else if(m.compareDocumentPosition){return !!(m.compareDocumentPosition(n)&16);}else return false;},getRootElement:function(){var m=null;if(window.Quickling&&Quickling.isActive())m=k('content');return m||document.body;},isNode:function(m){return !!(m&&(typeof Node=='object'?m instanceof Node:typeof m=="object"&&typeof m.nodeType=='number'&&typeof m.nodeName=='string'));},isNodeOfType:function(m,n){var o=i(n).join('|').toUpperCase().split('|'),p=j(o);return l.isNode(m)&&m.nodeName in p;},isElementNode:function(m){return l.isNode(m)&&m.nodeType==1;},isTextNode:function(m){return l.isNode(m)&&m.nodeType==3;},getDocumentScrollElement:function(m){m=m||document;var n=h.chrome()||h.safari();return !n&&m.compatMode==='CSS1Compat'?m.documentElement:m.body;}};e.exports=l;});
__d("Style",["DOMQuery","$"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h=b('$');function i(l){return l.replace(/([A-Z])/g,'-$1').toLowerCase();}function j(l,m){var n=k.get(l,m);return (n==='auto'||n==='scroll');}var k={set:function(l,m,n){switch(m){case 'opacity':l.style.opacity=n;l.style.filter=n!==''?'alpha(opacity='+n*100+')':'';break;case 'float':l.style.cssFloat=l.style.styleFloat=n;break;default:m=m.replace(/-(.)/g,function(o,p){return p.toUpperCase();});l.style[m]=n;}return l;},get:function(l,m){l=h(l);m=m.replace(/-(.)/g,function(o,p){return p.toUpperCase();});var n;if(window.getComputedStyle){n=window.getComputedStyle(l,null);if(n)return n.getPropertyValue(i(m));}if(document.defaultView&&document.defaultView.getComputedStyle){n=document.defaultView.getComputedStyle(l,null);if(n)return n.getPropertyValue(i(m));if(m=="display")return "none";}if(l.currentStyle)return l.currentStyle[m];return l.style&&l.style[m];},getFloat:function(l,m){return parseFloat(k.get(l,m),10);},getOpacity:function(l){l=h(l);var m=k.get(l,'filter'),n=null;if(m&&(n=/(\d+(?:\.\d+)?)/.exec(m))){return parseFloat(n.pop())/100;}else if(m=k.get(l,'opacity')){return parseFloat(m);}else return 1;},isFixed:function(l){while(l&&l!==document.documentElement){if(k.get(l,'position')==='fixed')return true;l=l.parentNode;}return false;},getScrollParent:function(l){if(!l)return null;while(l!==document.body){if(j(l,'overflow')||j(l,'overflowY')||j(l,'overflowX'))return l;l=l.parentNode;}return window;}};e.exports=k;});
__d("legacy:css",["CSS","Style","copyProperties"],function(a,b,c,d){var e=b('CSS'),f=b('Style'),g=b('copyProperties'),h={};g(h,e,{setStyle:f.set,getStyle:f.get,getStyleFloat:f.getFloat,getOpacity:f.getOpacity,isFixed:f.isFixed,getScrollParent:f.getScrollParent});a.CSS=h;},3);
__d("DataStore",[],function(a,b,c,d,e,f){var g={},h=1;function i(l){if(typeof l=='string'){return 'str_'+l;}else return 'elem_'+(l.__FB_TOKEN||(l.__FB_TOKEN=[h++]))[0];}function j(l){var m=i(l);return g[m]||(g[m]={});}var k={set:function(l,m,n){if(!l)throw new TypeError('DataStore.set: namespace is required, got '+(typeof l));var o=j(l);o[m]=n;return l;},get:function(l,m,n){if(!l)throw new TypeError('DataStore.get: namespace is required, got '+(typeof l));var o=j(l),p=o[m];if(typeof p==='undefined'&&l.getAttribute){var q=l.getAttribute('data-'+m);p=(null===q)?undefined:q;}if((n!==undefined)&&(p===undefined))p=o[m]=n;return p;},remove:function(l,m){if(!l)throw new TypeError('DataStore.remove: namespace is required, got '+(typeof l));var n=j(l),o=n[m];delete n[m];return o;},purge:function(l){delete g[i(l)];}};e.exports=k;});
__d("DOMEvent",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this.event=i||window.event;this.target=this.event.target||this.event.srcElement;}g(h.prototype,{preventDefault:function(){var i=this.event;i.preventDefault?i.preventDefault():i.returnValue=false;return this;},stopPropagation:function(){var i=this.event;i.stopPropagation?i.stopPropagation():i.cancelBubble=true;return this;},kill:function(){this.stopPropagation().preventDefault();return this;}});e.exports=h;});
__d("getObjectValues",["hasArrayNature"],function(a,b,c,d,e,f){var g=b('hasArrayNature');function h(i){var j=[];for(var k in i)j.push(i[k]);return j;}e.exports=h;});
__d("event-extensions",["event-form-bubbling","DataStore","DOMQuery","DOMEvent","ErrorUtils","Parent","UserAgent","$","copyProperties","getObjectValues"],function(a,b,c,d,e,f){b('event-form-bubbling');var g=b('DataStore'),h=b('DOMQuery'),i=b('DOMEvent'),j=b('ErrorUtils'),k=b('Parent'),l=b('UserAgent'),m=b('$'),n=b('copyProperties'),o=b('getObjectValues');Event.DATASTORE_KEY='Event.listeners';if(!Event.prototype)Event.prototype={};function p(y,z,aa){this.target=y;this.type=z;this.data=aa;}n(p.prototype,{getData:function(){this.data=this.data||{};return this.data;},stop:function(){new i(this).stopPropagation();return this;},prevent:function(){new i(this).preventDefault();return this;},kill:function(){this.stop().prevent();return false;},getTarget:function(){return new i(this).target||null;}});function q(y){if(y instanceof p)return y;y=y||window.event||{};if(!y._inherits_from_prototype)for(var z in Event.prototype)try{y[z]=Event.prototype[z];}catch(aa){}return y;}n(Event.prototype,{_inherits_from_prototype:true,getRelatedTarget:function(){var y=this.relatedTarget||(this.fromElement===this.srcElement?this.toElement:this.fromElement);return y?m(y):null;},getModifiers:function(){var y={control:!!this.ctrlKey,shift:!!this.shiftKey,alt:!!this.altKey,meta:!!this.metaKey};y.access=l.osx()?y.control:y.alt;y.any=y.control||y.shift||y.alt||y.meta;return y;},isMiddleClick:function(){if(this.which)return this.which===2;return this.button&&this.button===4;}});n(Event.prototype,p.prototype);n(Event,{listen:function(y,z,aa,ba){if(typeof y=='string')y=m(y);if(typeof ba=='undefined')ba=Event.Priority.NORMAL;if(typeof z=='object'){var ca={};for(var da in z)ca[da]=Event.listen(y,da,z[da],ba);return ca;}if(z.match(/^on/i))throw new TypeError("Bad event name `"+z+"': use `click', not `onclick'.");if(y.nodeName=='LABEL'&&z=='click'){var ea=y.getElementsByTagName('input');y=ea.length==1?ea[0]:y;}else if(y===window&&z==='scroll'){var fa=h.getDocumentScrollElement();if(fa!==document.documentElement&&fa!==document.body)y=fa;}var ga=g.get(y,s,{});if(u[z]){var ha=u[z];z=ha.base;aa=ha.wrap(aa);}v(y,z);var ia=ga[z];if(!(ba in ia))ia[ba]=[];var ja=ia[ba].length,ka=new x(aa,ia[ba],ja);ia[ba].push(ka);return ka;},stop:function(y){new i(y).stopPropagation();return y;},prevent:function(y){new i(y).preventDefault();return y;},kill:function(y){new i(y).kill();return false;},getKeyCode:function(event){event=new i(event).event;if(!event)return false;switch(event.keyCode){case 63232:return 38;case 63233:return 40;case 63234:return 37;case 63235:return 39;case 63272:case 63273:case 63275:return null;case 63276:return 33;case 63277:return 34;}if(event.shiftKey)switch(event.keyCode){case 33:case 34:case 37:case 38:case 39:case 40:return null;}return event.keyCode;},getPriorities:function(){if(!r){var y=o(Event.Priority);y.sort(function(z,aa){return z-aa;});r=y;}return r;},fire:function(y,z,aa){var ba=new p(y,z,aa),ca;do{var da=Event.__getHandler(y,z);if(da)ca=da(ba);y=y.parentNode;}while(y&&ca!==false&&!ba.cancelBubble);return ca!==false;},__fire:function(y,z,event){var aa=Event.__getHandler(y,z);if(aa)return aa(q(event));},__getHandler:function(y,z){return g.get(y,Event.DATASTORE_KEY+z);},getPosition:function(y){y=new i(y).event;var z=h.getDocumentScrollElement(),aa=y.clientX+z.scrollLeft,ba=y.clientY+z.scrollTop;return {x:aa,y:ba};}});var r=null,s=Event.DATASTORE_KEY,t=function(y){return function(z){if(!h.contains(this,z.getRelatedTarget()))return y.call(this,z);};},u={mouseenter:{base:'mouseover',wrap:t},mouseleave:{base:'mouseout',wrap:t}},v=function(y,z){var aa='on'+z,ba=w.bind(y),ca=g.get(y,s);if(z in ca)return;ca[z]={};if(y.addEventListener){y.addEventListener(z,ba,false);}else if(y.attachEvent)y.attachEvent(aa,ba);g.set(y,s+z,ba);if(y[aa]){var da=y===document.documentElement?Event.Priority._BUBBLE:Event.Priority.TRADITIONAL,ea=y[aa];y[aa]=null;Event.listen(y,z,ea,da);}if(y.nodeName==='FORM'&&z==='submit')Event.listen(y,z,Event.__bubbleSubmit.curry(y),Event.Priority._BUBBLE);},w=function(event){event=q(event);var y=event.type;if(!g.get(this,s))throw new Error("Bad listenHandler context.");var z=g.get(this,s)[y];if(!z)throw new Error("No registered handlers for `"+y+"'.");if(y=='click'&&window.userAction){var aa=k.byTag(event.getTarget(),'a'),ba=window.userAction('click',aa,event).coalesce_namespace('evt_ext');if(window.ArbiterMonitor)window.ArbiterMonitor.initUA(ba,[aa]);}var ca=Event.getPriorities();for(var da=0;da<ca.length;da++){var ea=ca[da];if(ea in z){var fa=z[ea];for(var ga=0;ga<fa.length;ga++){if(!fa[ga])continue;var ha=fa[ga].fire(this,event);if(ha===false){return event.kill();}else if(event.cancelBubble)event.stop();}}}return event.returnValue;};Event.Priority={URGENT:-20,TRADITIONAL:-10,NORMAL:0,_BUBBLE:1000};function x(y,z,aa){this._handler=y;this._container=z;this._index=aa;}n(x.prototype,{remove:function(){delete this._handler;delete this._container[this._index];},fire:function(y,event){return j.applyWithGuard(this._handler,y,[event],function(z){z.event_type=event.type;z.dom_element=y.name||y.id;z.category='eventhandler';});}});a.$E=f.$E=q;});
__d("evalGlobal",[],function(a,b,c,d,e,f){function g(h){if(typeof h!='string')throw new TypeError('JS sent to evalGlobal is not a string. Only strings are permitted.');if(!h)return;var i=document.createElement('script');try{i.appendChild(document.createTextNode(h));}catch(j){i.text=h;}var k=document.getElementsByTagName('head')[0]||document.documentElement;k.appendChild(i);k.removeChild(i);}e.exports=g;});
__d("HTML",["function-extensions","Bootloader","UserAgent","copyProperties","createArrayFrom","evalGlobal"],function(a,b,c,d,e,f){b('function-extensions');var g=b('Bootloader'),h=b('UserAgent'),i=b('copyProperties'),j=b('createArrayFrom'),k=b('evalGlobal');function l(m){if(m&&m.__html)m=m.__html;if(!(this instanceof l)){if(m instanceof l)return m;return new l(m);}this._content=m;this._defer=false;this._extra_action='';this._nodes=null;this._inline_js=bagofholding;this._rootNode=null;return this;}l.isHTML=function(m){return m&&(m instanceof l||m.__html!==undefined);};l.replaceJSONWrapper=function(m){return m&&m.__html!==undefined?new l(m.__html):m;};i(l.prototype,{toString:function(){var m=this._content||'';if(this._extra_action)m+='<script type="text/javascript">'+this._extra_action+'</scr'+'ipt>';return m;},setAction:function(m){this._extra_action=m;return this;},getAction:function(){this._fillCache();var m=function(){this._inline_js();k(this._extra_action);}.bind(this);if(this.getDeferred()){return m.defer.bind(m);}else return m;},setDeferred:function(m){this._defer=!!m;return this;},getDeferred:function(){return this._defer;},getContent:function(){return this._content;},getNodes:function(){this._fillCache();return this._nodes;},getRootNode:function(){var m=this.getNodes();if(m.length===1){this._rootNode=m[0];}else{var n=document.createDocumentFragment();for(var o=0;o<m.length;o++)n.appendChild(m[o]);this._rootNode=n;}return this._rootNode;},_fillCache:function(){if(null!==this._nodes)return;var m=this._content;if(!m){this._nodes=[];return;}m=m.replace(/(<(\w+)[^>]*?)\/>/g,function(x,y,z){return z.match(/^(abbr|br|col|img|input|link|meta|param|hr|area|embed)$/i)?x:y+'></'+z+'>';});var n=m.trim().toLowerCase(),o=document.createElement('div'),p=false,q=(!n.indexOf('<opt')&&[1,'<select multiple="multiple" class="__WRAPPER">','</select>'])||(!n.indexOf('<leg')&&[1,'<fieldset class="__WRAPPER">','</fieldset>'])||(n.match(/^<(thead|tbody|tfoot|colg|cap)/)&&[1,'<table class="__WRAPPER">','</table>'])||(!n.indexOf('<tr')&&[2,'<table><tbody class="__WRAPPER">','</tbody></table>'])||((!n.indexOf('<td')||!n.indexOf('<th'))&&[3,'<table><tbody><tr class="__WRAPPER">','</tr></tbody></table>'])||(!n.indexOf('<col')&&[2,'<table><tbody></tbody><colgroup class="__WRAPPER">','</colgroup></table>'])||null;if(null===q){o.className='__WRAPPER';if(h.ie()){q=[0,'<span style="display:none">&nbsp;</span>',''];p=true;}else q=[0,'',''];}o.innerHTML=q[1]+m+q[2];while(q[0]--)o=o.lastChild;if(p)o.removeChild(o.firstChild);o.className!='__WRAPPER';if(h.ie()){var r;if(!n.indexOf('<table')&&-1==n.indexOf('<tbody')){r=o.firstChild&&o.firstChild.childNodes;}else if(q[1]=='<table>'&&-1==n.indexOf('<tbody')){r=o.childNodes;}else r=[];for(var s=r.length-1;s>=0;--s)if(r[s].nodeName&&r[s].nodeName.toLowerCase()=='tbody'&&r[s].childNodes.length==0)r[s].parentNode.removeChild(r[s]);}var t=o.getElementsByTagName('script'),u=[];for(var v=0;v<t.length;v++)if(t[v].src){u.push(g.requestResource.bind(g,'js',t[v].src));}else u.push(k.bind(null,t[v].innerHTML));for(var v=t.length-1;v>=0;v--)t[v].parentNode.removeChild(t[v]);var w=function(){for(var x=0;x<u.length;x++)u[x]();};this._nodes=j(o.childNodes);this._inline_js=w;}});e.exports=l;});
__d("isScalar",[],function(a,b,c,d,e,f){function g(h){return (/string|number|boolean/).test(typeof h);}e.exports=g;});
__d("DOM",["event-extensions","CSS","DOMQuery","HTML","UserAgent","$","copyProperties","createArrayFrom","isScalar","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOMQuery'),i=b('HTML'),j=b('UserAgent'),k=b('$'),l=b('copyProperties'),m=b('createArrayFrom'),n=b('isScalar'),o=b('tx'),p='js_',q=0,r={};l(r,h);l(r,{create:function(u,v,w){var x=document.createElement(u);if(v)r.setAttributes(x,v);if(w!=null)r.setContent(x,w);return x;},setAttributes:function(u,v){if(v.type)u.type=v.type;for(var w in v){var x=v[w],y=(/^on/i).test(w);if(w=='type'){continue;}else if(w=='style'){if(typeof x=='string'){u.style.cssText=x;}else l(u.style,x);}else if(y){Event.listen(u,w.substr(2),x);}else if(w in u){u[w]=x;}else if(u.setAttribute)u.setAttribute(w,x);}},prependContent:function(u,v){return s(v,u,function(w){u.firstChild?u.insertBefore(w,u.firstChild):u.appendChild(w);});},insertAfter:function(u,v){var w=u.parentNode;return s(v,w,function(x){u.nextSibling?w.insertBefore(x,u.nextSibling):w.appendChild(x);});},insertBefore:function(u,v){var w=u.parentNode;return s(v,w,function(x){w.insertBefore(x,u);});},setContent:function(u,v){r.empty(u);return r.appendContent(u,v);},appendContent:function(u,v){return s(v,u,function(w){u.appendChild(w);});},replace:function(u,v){var w=u.parentNode;return s(v,w,function(x){w.replaceChild(x,u);});},remove:function(u){u=k(u);if(u.parentNode)u.parentNode.removeChild(u);},empty:function(u){u=k(u);while(u.firstChild)r.remove(u.firstChild);},getID:function(u){var v=u.id;if(!v){v=p+q++;u.id=v;}return v;}});function s(u,v,w){u=i.replaceJSONWrapper(u);if(u instanceof i&&''===v.innerHTML&&-1===u.toString().indexOf('<scr'+'ipt')){var x=j.ie();if(!x||(x>7&&!h.isNodeOfType(v,['table','tbody','thead','tfoot','tr','select','fieldset']))){var y=x?'<em style="display:none;">&nbsp;</em>':'';v.innerHTML=y+u;x&&v.removeChild(v.firstChild);return m(v.childNodes);}}else if(h.isTextNode(v)){v.data=u;return [u];}var z=document.createDocumentFragment(),aa,ba=[],ca=[];if(!Array.isArray(u))u=[u];for(var da=0;da<u.length;da++){aa=i.replaceJSONWrapper(u[da]);if(aa instanceof i){ca.push(aa.getAction());var ea=aa.getNodes();for(var fa=0;fa<ea.length;fa++){ba.push(ea[fa]);z.appendChild(ea[fa]);}}else if(n(aa)){var ga=document.createTextNode(aa);ba.push(ga);z.appendChild(ga);}else if(h.isNode(aa)){ba.push(aa);z.appendChild(aa);}}w(z);ca.forEach(function(ha){ha();});return ba;}function t(u){function v(w){return r.create('div',{},w).innerHTML;}return function(w,x){var y={};if(x)for(var z in x)y[z]=v(x[z]);return i(u(w,y));};}r.tx=t(o);r.tx._=r._tx=t(o._);e.exports=r;});
__d("legacy:dom",["DOM"],function(a,b,c,d){a.DOM=b('DOM');},3);
__d("AsyncDOM",["CSS","DOM"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i={invoke:function(j,k){for(var l=0;l<j.length;++l){var m=j[l],n=m[0],o=m[1],p=m[2],q=m[3],r=(p&&k)||null;if(o)r=h.scry(r||document.documentElement,o)[0];switch(n){case 'eval':(new Function(q)).apply(r);break;case 'hide':g.hide(r);break;case 'show':g.show(r);break;case 'setContent':h.setContent(r,q);break;case 'appendContent':h.appendContent(r,q);break;case 'prependContent':h.prependContent(r,q);break;case 'insertAfter':h.insertAfter(r,q);break;case 'insertBefore':h.insertBefore(r,q);break;case 'remove':h.remove(r);break;case 'replace':h.replace(r,q);break;default:}}}};e.exports=i;});
__d("AsyncResponse",["Bootloader","Env","copyProperties","tx"],function(a,b,c,d,e,f){var g=b('Bootloader'),h=b('Env'),i=b('copyProperties'),j=b('tx');function k(l,m){i(this,{error:0,errorSummary:null,errorDescription:null,onload:null,replay:false,payload:m||null,request:l||null,silentError:false,is_last:true});return this;}i(k,{defaultErrorHandler:function(l){try{if(!l.silentError){k.verboseErrorHandler(l);}else l.logErrorByGroup('silent',10);}catch(m){alert(l);}},verboseErrorHandler:function(l){try{var n=l.getErrorSummary(),o=l.getErrorDescription();l.logErrorByGroup('popup',10);if(l.silentError&&o=='')o="Something went wrong. We're working on getting this fixed as soon as we can. You may be able to try again.";g.loadModules(['Dialog'],function(p){new p().setTitle(n).setBody(o).setButtons([p.OK]).setModal(true).setCausalElement(this.relativeTo).show();});}catch(m){alert(l);}}});i(k.prototype,{getRequest:function(){return this.request;},getPayload:function(){return this.payload;},getError:function(){return this.error;},getErrorSummary:function(){return this.errorSummary;},setErrorSummary:function(l){l=(l===undefined?null:l);this.errorSummary=l;return this;},getErrorDescription:function(){return this.errorDescription;},getErrorIsWarning:function(){return this.errorIsWarning;},logError:function(l,m){if(window.send_error_signal){var n={err_code:this.error,vip:(h.vip||'-')};if(m){n.duration=m.duration;n.xfb_ip=m.xfb_ip;}var o=this.request.getURI();n.path=o||'-';n.aid=this.request.userActionID;if(o&&o.indexOf('scribe_endpoint.php')!=-1)l='async_error_double';send_error_signal(l,JSON.stringify(n));}},logErrorByGroup:function(l,m){if(Math.floor(Math.random()*m)==0)if(this.error==1357010||this.error<15000){this.logError('async_error_oops_'+l);}else this.logError('async_error_logic_'+l);}});e.exports=k;});
__d("HTTPErrors",[],function(a,b,c,d,e,f){var g={get:bagofholding,getAll:bagofholding};e.exports=g;});
__d("bind",[],function(a,b,c,d,e,f){function g(h,i){var j=Array.prototype.slice.call(arguments,2);if(typeof i!='string')return Function.prototype.bind.apply(i,[h].concat(j));function k(){var l=j.concat(Array.prototype.slice.call(arguments));if(h[i])return h[i].apply(h,l);}k.toString=function(){return 'bound lazily: '+h[i];};return k;}e.exports=g;});
__d("AsyncRequest",["event-extensions","Arbiter","AsyncDOM","AsyncResponse","Bootloader","CSS","Env","HTTPErrors","JSCC","Parent","Run","ServerJS","URI","UserAgent","XHR","bind","copyProperties","evalGlobal","ge","goURI","isEmpty","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('AsyncDOM'),i=b('AsyncResponse'),j=b('Bootloader'),k=b('CSS'),l=b('Env'),m=b('HTTPErrors'),n=b('JSCC'),o=b('Parent'),p=b('Run'),q=b('ServerJS'),r=b('URI'),s=b('UserAgent'),t=b('XHR'),u=b('bind'),v=b('copyProperties'),w=b('evalGlobal'),x=b('ge'),y=b('goURI'),z=b('isEmpty'),aa=b('tx');function ba(){try{return !window.loaded;}catch(ka){return true;}}function ca(ka){return ('upload' in ka)&&('onprogress' in ka.upload);}function da(ka){return 'withCredentials' in ka;}function ea(ka){return ka.status in {0:1,12029:1,12030:1,12031:1,12152:1};}function fa(ka){var la=!ka||typeof(ka)==='function';return la;}var ga=2,ha=ga;g.subscribe('page_transition',function(ka,la){ha=la.id;});function ia(ka){v(this,{transport:null,method:'POST',uri:'',timeout:null,timer:null,initialHandler:bagofholding,handler:null,uploadProgressHandler:null,errorHandler:null,transportErrorHandler:null,timeoutHandler:null,interceptHandler:bagofholding,finallyHandler:bagofholding,serverDialogCancelHandler:null,relativeTo:null,statusElement:null,statusClass:'',data:{},file:null,context:{},readOnly:false,writeRequiredParams:[],remainingRetries:0,userActionID:'-'});this.option={asynchronous:true,suppressErrorHandlerWarning:false,suppressEvaluation:false,suppressErrorAlerts:false,retries:0,jsonp:false,bundle:false,useIframeTransport:false,handleErrorAfterUnload:false};this.errorHandler=i.defaultErrorHandler;this.transportErrorHandler=u(this,'errorHandler');if(ka!==undefined)this.setURI(ka);}v(ia,{bootstrap:function(ka,la,ma){var na='GET',oa=true,pa={};if(ma||la&&(la.rel=='async-post'||la.getAttribute&&la.getAttribute('forcemethod')=='post')){na='POST';oa=false;if(ka){ka=r(ka);pa=ka.getQueryData();ka.setQueryData({});}}var qa=o.byClass(la,'stat_elem')||la;if(qa&&k.hasClass(qa,'async_saving'))return false;var ra=new ia(ka).setReadOnly(oa).setMethod(na).setData(pa).setNectarModuleDataSafe(la).setRelativeTo(la);if(la){ra.setHandler(function(ta){Event.fire(la,'success',{response:ta});});ra.setErrorHandler(function(ta){if(Event.fire(la,'error',{response:ta})!==false)i.defaultErrorHandler(ta);});}if(qa){ra.setStatusElement(qa);var sa=qa.getAttribute('data-status-class');sa&&ra.setStatusClass(sa);}if(la)Event.fire(la,'AsyncRequest/send',{request:ra});ra.send();return false;},post:function(ka,la){new ia(ka).setReadOnly(false).setMethod('POST').setData(la).send();return false;},getLastID:function(){return ga;},suppressOnloadToken:{},_inflight:[],_inflightCount:0,_inflightAdd:bagofholding,_inflightPurge:bagofholding,getInflightCount:function(){return this._inflightCount;},_inflightEnable:function(){if(s.ie()){v(ia,{_inflightAdd:function(ka){this._inflight.push(ka);},_inflightPurge:function(){ia._inflight=ia._inflight.filter(function(ka){return ka.transport&&ka.transport.readyState<4;});}});p.onUnload(function(){ia._inflight.forEach(function(ka){if(ka.transport&&ka.transport.readyState<4){ka.transport.abort();delete ka.transport;}});});}}});v(ia.prototype,{_dispatchResponse:function(ka){try{this.clearStatusIndicator();if(!this._isRelevant()){this._invokeErrorHandler(1010);return;}if(this.initialHandler(ka)===false)return;clearTimeout(this.timer);if(ka.jscc_map){var ma=(eval)(ka.jscc_map);n.init(ma);}var na;if(this.handler)try{na=this._shouldSuppressJS(this.handler(ka));}catch(oa){ka.is_last&&this.finallyHandler(ka);throw oa;}if(!na)this._handleJSResponse(ka);ka.is_last&&this.finallyHandler(ka);}catch(la){}},_shouldSuppressJS:function(ka){return ka===ia.suppressOnloadToken;},_handleJSResponse:function(ka){var la=this.getRelativeTo(),ma=ka.domops,na=ka.jsmods,oa=new q().setRelativeTo(la);if(na&&(na.define||na.instances||na.markup)){oa.handle({define:na.define,instances:na.instances,markup:na.markup});delete na.define;delete na.instances;delete na.markup;}if(ma)h.invoke(ma,la);if(na)oa.handle(na);this._handleJSRegisters(ka,'onload');if(this.lid)g.inform('tti_ajax',{s:this.lid,d:[this._sendTimeStamp||0,(this._sendTimeStamp&&this._responseTime)?(this._responseTime-this._sendTimeStamp):0]},g.BEHAVIOR_EVENT);this._handleJSRegisters(ka,'onafterload');},_handleJSRegisters:function(ka,la){var ma=ka[la];if(!ma)return;for(var na=0;na<ma.length;na++)try{(new Function(ma[na])).apply(this);}catch(oa){}},invokeResponseHandler:function(ka){if(typeof(ka.redirect)!=='undefined'){(function(){this.setURI(ka.redirect).send();}).bind(this).defer();return;}if(!this.handler&&!this.errorHandler&&!this.transportErrorHandler)return;if(typeof(ka.asyncResponse)!=='undefined'){if(!this._isRelevant()){this._invokeErrorHandler(1010);return;}var la=ka.asyncResponse;if(la.inlinejs)w(la.inlinejs);if(la.lid){this._responseTime=Date.now();if(a.CavalryLogger)this.cavalry=a.CavalryLogger.getInstance(la.lid);this.lid=la.lid;}j.setResourceMap(la.resource_map);if(la.bootloadable)j.enableBootload(la.bootloadable);var ma;if(la.getError()&&!la.getErrorIsWarning()){var na=this.errorHandler.bind(this);ma=this._dispatchErrorResponse.bind(this,la,na);}else ma=this._dispatchResponse.bind(this,la);ma=ma.defer.bind(ma);var oa=false;if(this.preBootloadHandler)oa=this.preBootloadHandler(la);la.css=la.css||[];la.js=la.js||[];j.loadResources(la.css.concat(la.js),ma,oa,this.getURI());}else if(typeof(ka.transportError)!=='undefined'){if(this._xFbServer){this._invokeErrorHandler(1008);}else this._invokeErrorHandler(1012);}else this._invokeErrorHandler(1007);},_invokeErrorHandler:function(ka){if(ba()&&!this.getOption('handleErrorAfterUnload'))return;var la;if(this.responseText===''){la=1002;}else if(this._requestAborted){la=1011;}else{try{la=ka||this.transport.status||1004;}catch(ma){la=1005;}if(false===navigator.onLine)la=1006;}if(!this.transportErrorHandler)return;var na=this.transportErrorHandler.bind(this),oa,pa,qa=true;if(la===1006){pa="No Network Connection";oa="Your browser appears to be offline. Please check your internet connection and try again.";}else if(la>=300&&la<=399){pa="Redirection";oa="Your access to Facebook was redirected or blocked by a third party at this time, please contact your ISP or reload. ";var ra=this.transport.getResponseHeader("Location");if(ra)y(ra,true);qa=true;}else{pa="Oops";oa="Something went wrong. We're working on getting this fixed as soon as we can. You may be able to try again.";}!this.getOption('suppressErrorAlerts');var sa=new i(this);v(sa,{error:la,errorSummary:pa,errorDescription:oa,silentError:qa});this._dispatchErrorResponse(sa,na);},_dispatchErrorResponse:function(ka,la){var ma=ka.getError();try{this.clearStatusIndicator();var oa=this._sendTimeStamp&&{duration:Date.now()-this._sendTimeStamp,xfb_ip:this._xFbServer||'-'};ka.logError('async_error',oa);if(!this._isRelevant()||ma===1010)return;if(ma==1357008||ma==1357007||ma==1442002||ma==1357001){var pa=ma==1357008||ma==1357007;this.interceptHandler(ka);this._displayServerDialog(ka,pa);}else if(this.initialHandler(ka)!==false){clearTimeout(this.timer);try{la(ka);}catch(qa){this.finallyHandler(ka);throw qa;}this.finallyHandler(ka);}}catch(na){}},_displayServerDialog:function(ka,la){var ma=ka.getPayload().__dialog;j.loadModules(['Dialog'],function(na){var oa=new na(ma);if(la)oa.setHandler(this._displayConfirmationHandler.bind(this,oa));oa.setCancelHandler(function(){var pa=this.getServerDialogCancelHandler();try{pa&&pa();}catch(qa){throw qa;}finally{this.finallyHandler(ka);}}.bind(this)).setCausalElement(this.relativeTo).show();}.bind(this));},_displayConfirmationHandler:function(ka){this.data.confirmed=1;v(this.data,ka.getFormData());this.send();},_handleJSONPResponse:function(ka){this.is_first=(this.is_first===undefined);var la=this._interpretResponse(ka);la.asyncResponse.is_first=this.is_first;la.asyncResponse.is_last=this.transport.hasFinished();this.invokeResponseHandler(la);if(this.transport.hasFinished())delete this.transport;},_handleXHRResponse:function(ka){var la;if(this.getOption('suppressEvaluation')){la={asyncResponse:new i(this,ka)};}else{var ma=ka.responseText,na=null;try{var pa=this._unshieldResponseText(ma);try{var qa=(eval)('('+pa+')');la=this._interpretResponse(qa);}catch(oa){na='excep';la={transportError:'eval() failed on async to '+this.getURI()};}}catch(oa){na='empty';la={transportError:oa.message};}if(na)a.send_error_signal&&a.send_error_signal('async_xport_resp',[(this._xFbServer?'1008_':'1012_')+na,this._xFbServer||'-',this.getURI(),ma.length,ma.substr(0,1600)].join(':'));}this.invokeResponseHandler(la);},_unshieldResponseText:function(ka){var la="for (;;);",ma=la.length;if(ka.length<=ma)throw new Error('Response too short on async to '+this.getURI());var na=0;while(ka.charAt(na)==" "||ka.charAt(na)=="\n")na++;na&&ka.substring(na,na+ma)==la;return ka.substring(na+ma);},_interpretResponse:function(ka){if(ka.redirect)return {redirect:ka.redirect};var la=new i(this);if(ka.__ar!=1){la.payload=ka;}else v(la,ka);return {asyncResponse:la};},_onStateChange:function(){try{if(this.transport.readyState==4){ia._inflightCount--;ia._inflightPurge();try{if(typeof(this.transport.getResponseHeader)!=='undefined'&&this.transport.getResponseHeader('X-FB-Debug'))this._xFbServer=this.transport.getResponseHeader('X-FB-Debug');}catch(la){}if(this.transport.status>=200&&this.transport.status<300){ia.lastSuccessTime=Date.now();this._handleXHRResponse(this.transport);}else if(s.safari()&&(typeof(this.transport.status)=='undefined')){this._invokeErrorHandler(1002);}else if(l.retry_ajax_on_network_error&&ea(this.transport)&&this.remainingRetries>0){this.remainingRetries--;delete this.transport;this.send(true);return;}else this._invokeErrorHandler();if(this.getOption('asynchronous')!==false)delete this.transport;}}catch(ka){if(ba())return;delete this.transport;if(this.remainingRetries>0){this.remainingRetries--;this.send(true);}else{!this.getOption('suppressErrorAlerts');a.send_error_signal&&a.send_error_signal('async_xport_resp',[1007,this._xFbServer||'-',this.getURI(),ka.message].join(':'));this._invokeErrorHandler(1007);}}},_isMultiplexable:function(){if(this.getOption('jsonp')||this.getOption('useIframeTransport'))return false;if(!this.uri.isFacebookURI())return false;if(!this.getOption('asynchronous'))return false;return true;},handleResponse:function(ka){var la=this._interpretResponse(ka);this.invokeResponseHandler(la);},setMethod:function(ka){this.method=ka.toString().toUpperCase();return this;},getMethod:function(){return this.method;},setData:function(ka){this.data=ka;return this;},_setDataHash:function(){if(this.method!='POST'||this.data.phstamp)return;var ka=r.implodeQuery(this.data).length,la='';for(var ma=0;ma<this.data.fb_dtsg.length;ma++)la+=this.data.fb_dtsg.charCodeAt(ma);this.data.phstamp='1'+la+ka;},setRawData:function(ka){this.rawData=ka;return this;},getData:function(){return this.data;},setContextData:function(ka,la,ma){ma=ma===undefined?true:ma;if(ma)this.context['_log_'+ka]=la;return this;},_setUserActionID:function(){var ka=a.ArbiterMonitor&&a.ArbiterMonitor.getUE()||'-';this.userActionID=(a.EagleEye&&a.EagleEye.getSessionID()||'-')+'/'+ka;},setURI:function(ka){var la=r(ka);if(this.getOption('useIframeTransport')&&!la.isFacebookURI())return this;if(!this._allowCrossOrigin&&!this.getOption('jsonp')&&!this.getOption('useIframeTransport')&&!la.isSameOrigin())return this;this._setUserActionID();if(!ka||la.isEmpty()){if(a.send_error_signal&&a.get_error_stack){var ma={err_code:1013,vip:'-',duration:0,xfb_ip:'-',path:window.location.href,aid:this.userActionID};a.send_error_signal('async_error',JSON.stringify(ma));a.send_error_signal('async_xport_stack',[1013,window.location.href,null,a.get_error_stack()].join(':'));}return this;}this.uri=la;return this;},getURI:function(){return this.uri.toString();},setInitialHandler:function(ka){this.initialHandler=ka;return this;},setHandler:function(ka){if(fa(ka))this.handler=ka;return this;},getHandler:function(){return this.handler;},setUploadProgressHandler:function(ka){if(fa(ka))this.uploadProgressHandler=ka;return this;},setErrorHandler:function(ka){if(fa(ka))this.errorHandler=ka;return this;},setTransportErrorHandler:function(ka){this.transportErrorHandler=ka;return this;},getErrorHandler:function(){return this.errorHandler;},getTransportErrorHandler:function(){return this.transportErrorHandler;},setTimeoutHandler:function(ka,la){if(fa(la)){this.timeout=ka;this.timeoutHandler=la;}return this;},resetTimeout:function(ka){if(!(this.timeoutHandler===null))if(ka===null){this.timeout=null;clearTimeout(this.timer);this.timer=null;}else{var la=!this._allowCrossPageTransition;this.timeout=ka;clearTimeout(this.timer);this.timer=this._handleTimeout.bind(this).defer(this.timeout,la);}return this;},_handleTimeout:function(){this.abandon();this.timeoutHandler(this);},setNewSerial:function(){this.id=++ga;return this;},setInterceptHandler:function(ka){this.interceptHandler=ka;return this;},setFinallyHandler:function(ka){this.finallyHandler=ka;return this;},getServerDialogCancelHandler:function(){return this.serverDialogCancelHandler;},setServerDialogCancelHandler:function(ka){this.serverDialogCancelHandler=ka;return this;},setPreBootloadHandler:function(ka){this.preBootloadHandler=ka;return this;},setReadOnly:function(ka){if(!(typeof(ka)!='boolean'))this.readOnly=ka;return this;},setFBMLForm:function(){this.writeRequiredParams=["fb_sig"];return this;},getReadOnly:function(){return this.readOnly;},setRelativeTo:function(ka){this.relativeTo=ka;return this;},getRelativeTo:function(){return this.relativeTo;},setStatusClass:function(ka){this.statusClass=ka;return this;},setStatusElement:function(ka){this.statusElement=ka;return this;},getStatusElement:function(){return x(this.statusElement);},_isRelevant:function(){if(this._allowCrossPageTransition)return true;if(!this.id)return true;return this.id>ha;},clearStatusIndicator:function(){var ka=this.getStatusElement();if(ka){k.removeClass(ka,'async_saving');k.removeClass(ka,this.statusClass);}},addStatusIndicator:function(){var ka=this.getStatusElement();if(ka){k.addClass(ka,'async_saving');k.addClass(ka,this.statusClass);}},specifiesWriteRequiredParams:function(){return this.writeRequiredParams.every(function(ka){this.data[ka]=this.data[ka]||l[ka]||(x(ka)||{}).value;if(this.data[ka]!==undefined)return true;return false;},this);},setOption:function(ka,la){if(typeof(this.option[ka])!='undefined')this.option[ka]=la;return this;},getOption:function(ka){typeof(this.option[ka])=='undefined';return this.option[ka];},abort:function(){if(this.transport){var ka=this.getTransportErrorHandler();this.setOption('suppressErrorAlerts',true);this.setTransportErrorHandler(bagofholding);this._requestAborted=true;this.transport.abort();this.setTransportErrorHandler(ka);}},abandon:function(){clearTimeout(this.timer);this.setOption('suppressErrorAlerts',true).setHandler(bagofholding).setErrorHandler(bagofholding).setTransportErrorHandler(bagofholding);if(this.transport){this._requestAborted=true;this.transport.abort();}},setNectarData:function(ka){if(ka){if(this.data.nctr===undefined)this.data.nctr={};v(this.data.nctr,ka);}return this;},setNectarModuleDataSafe:function(ka){if(this.setNectarModuleData)this.setNectarModuleData(ka);return this;},setNectarImpressionIdSafe:function(){if(this.setNectarImpressionId)this.setNectarImpressionId();return this;},setAllowCrossPageTransition:function(ka){this._allowCrossPageTransition=!!ka;if(this.timer)this.resetTimeout(this.timeout);return this;},setAllowCrossOrigin:function(ka){this._allowCrossOrigin=!!ka;return this;},send:function(ka){ka=ka||false;if(!this.uri)return false;!this.errorHandler&&!this.getOption('suppressErrorHandlerWarning');if(this.getOption('jsonp')&&this.method!='GET')this.setMethod('GET');if(this.getOption('useIframeTransport')&&this.method!='GET')this.setMethod('GET');this.timeoutHandler!==null&&(this.getOption('jsonp')||this.getOption('useIframeTransport'));if(!this.getReadOnly()){this.specifiesWriteRequiredParams();if(this.method!='POST')return false;}v(this.data,t.getAsyncParams(this.method));if(!z(this.context)){v(this.data,this.context);this.data.ajax_log=1;}if(l.force_param)v(this.data,l.force_param);this._setUserActionID();if(this.getOption('bundle')&&this._isMultiplexable()){ja.schedule(this);return true;}this.setNewSerial();if(!this.getOption('asynchronous'))this.uri.addQueryData({__s:1});this.finallyHandler=a.async_callback(this.finallyHandler,'final');var la,ma;if(this.method=='GET'||this.rawData){la=this.uri.addQueryData(this.data).toString();ma=this.rawData||'';}else{la=this.uri.toString();this._setDataHash();ma=r.implodeQuery(this.data);}if(this.transport)return false;if(this.getOption('jsonp')||this.getOption('useIframeTransport')){d(['JSONPTransport'],function(qa){this.transport=new qa(this.getOption('jsonp')?'jsonp':'iframe',this.uri,this._handleJSONPResponse.bind(this));this.transport.send();}.bind(this));return true;}var na=t.create();if(!na)return false;na.onreadystatechange=a.async_callback(this._onStateChange.bind(this),'xhr');if(this.uploadProgressHandler&&ca(na))na.upload.onprogress=this.uploadProgressHandler.bind(this);if(!ka)this.remainingRetries=this.getOption('retries');if(a.send_error_signal||a.ArbiterMonitor)this._sendTimeStamp=this._sendTimeStamp||Date.now();this.transport=na;try{this.transport.open(this.method,la,this.getOption('asynchronous'));}catch(oa){return false;}var pa=l.svn_rev;if(pa)this.transport.setRequestHeader('X-SVN-Rev',String(pa));if(!this.uri.isSameOrigin()&&!this.getOption('jsonp')&&!this.getOption('useIframeTransport')){if(!da(this.transport))return false;if(this.uri.isFacebookURI())this.transport.withCredentials=true;}if(this.method=='POST'&&!this.rawData)this.transport.setRequestHeader('Content-Type','application/x-www-form-urlencoded');this.addStatusIndicator();this.transport.send(ma);if(this.timeout!==null)this.resetTimeout(this.timeout);ia._inflightCount++;ia._inflightAdd(this);return true;}});function ja(){this._requests=[];}v(ja,{multiplex:null,schedule:function(ka){if(!ja.multiplex){ja.multiplex=new ja();(function(){ja.multiplex.send();ja.multiplex=null;}).defer();}ja.multiplex.add(ka);}});v(ja.prototype,{add:function(ka){this._requests.push(ka);},send:function(){var ka=this._requests;if(!ka.length)return;var la;if(ka.length===1){la=ka[0];}else{var ma=ka.map(function(na){return [na.uri.getPath(),r.implodeQuery(na.data)];});la=new ia('/ajax/proxy.php').setAllowCrossPageTransition(true).setData({data:ma}).setHandler(this._handler.bind(this)).setTransportErrorHandler(this._transportErrorHandler.bind(this));}la.setOption('bundle',false).send();},_handler:function(ka){var la=ka.getPayload().responses;if(la.length!==this._requests.length)return;for(var ma=0;ma<this._requests.length;ma++){var na=this._requests[ma],oa=na.uri.getPath();na.id=this.id;if(la[ma][0]!==oa){na.invokeResponseHandler({transportError:'Wrong response order in bundled request to '+oa});continue;}na.handleResponse(la[ma][1]);}},_transportErrorHandler:function(ka){var la={transportError:ka.errorDescription},ma=this._requests.map(function(na){na.id=this.id;na.invokeResponseHandler(la);return na.uri.getPath();});}});e.exports=ia;});
__d("DOMPosition",["DOMQuery"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h={getScrollPosition:function(){var i=g.getDocumentScrollElement();return {x:i.scrollLeft,y:i.scrollTop};},getElementPosition:function(i){if(!i)return;if(!('getBoundingClientRect' in i))return {x:0,y:0};var j=i.getBoundingClientRect(),k=document.documentElement,l=Math.round(j.left)-k.clientLeft,m=Math.round(j.top)-k.clientTop;return {x:l,y:m};}};e.exports=h;});
__d("DOMControl",["DataStore","$","copyProperties"],function(a,b,c,d,e,f){var g=b('DataStore'),h=b('$'),i=b('copyProperties');function j(k){this.root=h(k);this.updating=false;g.set(k,'DOMControl',this);}i(j.prototype,{getRoot:function(){return this.root;},beginUpdate:function(){if(this.updating)return false;this.updating=true;return true;},endUpdate:function(){this.updating=false;},update:function(k){if(!this.beginUpdate())return this;this.onupdate(k);this.endUpdate();},onupdate:function(k){}});j.getInstance=function(k){return g.get(k,'DOMControl');};e.exports=j;});
__d("Input",["CSS","DOMQuery","DOMControl"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOMQuery'),i=b('DOMControl'),j=function(l){var m=l.getAttribute('maxlength');if(m&&m>0)d(['enforceMaxLength'],function(n){n(l,m);});},k={focus:function(l){try{l.focus();}catch(m){}},isEmpty:function(l){return !(/\S/).test(l.value||'')||g.hasClass(l,'DOMControl_placeholder');},getValue:function(l){return k.isEmpty(l)?'':l.value;},setValue:function(l,m){g.removeClass(l,'DOMControl_placeholder');l.value=m||'';j(l);var n=i.getInstance(l);n&&n.resetHeight&&n.resetHeight();},setPlaceholder:function(l,m){l.setAttribute('aria-label',m);l.setAttribute('placeholder',m);if(l==document.activeElement)return;if(k.isEmpty(l)){g.conditionClass(l,'DOMControl_placeholder',m);l.value=m||'';}},reset:function(l){var m=l!==document.activeElement?(l.getAttribute('placeholder')||''):'';l.value=m;g.conditionClass(l,'DOMControl_placeholder',m);l.style.height='';},setSubmitOnEnter:function(l,m){g.conditionClass(l,'enter_submit',m);},getSubmitOnEnter:function(l){return g.hasClass(l,'enter_submit');},setMaxLength:function(l,m){if(m>0){l.setAttribute('maxlength',m);j(l);}else l.removeAttribute('maxlength');}};e.exports=k;});
__d("Form",["event-extensions","AsyncRequest","AsyncResponse","CSS","DOM","DOMPosition","DOMQuery","DataStore","Env","Input","Parent","URI","createArrayFrom","trackReferrer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('AsyncResponse'),i=b('CSS'),j=b('DOM'),k=b('DOMPosition'),l=b('DOMQuery'),m=b('DataStore'),n=b('Env'),o=b('Input'),p=b('Parent'),q=b('URI'),r=b('createArrayFrom'),s=b('trackReferrer'),t='FileList' in window,u='FormData' in window;function v(x){var y={};q.implodeQuery(x).split('&').forEach(function(z){if(z){var aa=/^([^=]*)(?:=(.*))?$/.exec(z),ba=q.decodeComponent(aa[1]),ca=aa[2]?q.decodeComponent(aa[2]):null;y[ba]=ca;}});return y;}var w={getInputs:function(x){x=x||document;return [].concat(r(l.scry(x,'input')),r(l.scry(x,'select')),r(l.scry(x,'textarea')),r(l.scry(x,'button')));},getSelectValue:function(x){return x.options[x.selectedIndex].value;},setSelectValue:function(x,y){for(var z=0;z<x.options.length;++z)if(x.options[z].value==y){x.selectedIndex=z;break;}},getRadioValue:function(x){for(var y=0;y<x.length;y++)if(x[y].checked)return x[y].value;return null;},getElements:function(x){return r(x.tagName=='FORM'?x.elements:w.getInputs(x));},getAttribute:function(x,y){return (x.getAttributeNode(y)||{}).value||null;},setDisabled:function(x,y){w.getElements(x).forEach(function(z){if(z.disabled!==undefined){var aa=m.get(z,'origDisabledState');if(y){if(aa===undefined)m.set(z,'origDisabledState',z.disabled);z.disabled=y;}else if(aa!==true)z.disabled=false;}});},bootstrap:function(x,y){var z=(w.getAttribute(x,'method')||'GET').toUpperCase();y=p.byTag(y,'button')||y;var aa=p.byClass(y,'stat_elem')||x;if(i.hasClass(aa,'async_saving'))return;if(y&&(y.form!==x||(y.nodeName!='INPUT'&&y.nodeName!='BUTTON')||y.type!='submit')){var ba=l.scry(x,'.enter_submit_target')[0];ba&&(y=ba);}var ca=w.serialize(x,y);w.setDisabled(x,true);var da=w.getAttribute(x,'ajaxify')||w.getAttribute(x,'action');s(x,da);var ea=new g(da);ea.setData(ca).setNectarModuleDataSafe(x).setReadOnly(z=='GET').setMethod(z).setRelativeTo(x).setStatusElement(aa).setInitialHandler(w.setDisabled.curry(x,false)).setHandler(function(fa){Event.fire(x,'success',{response:fa});}).setErrorHandler(function(fa){if(Event.fire(x,'error',{response:fa})!==false)h.defaultErrorHandler(fa);}).setFinallyHandler(w.setDisabled.curry(x,false)).send();},forEachValue:function(x,y,z){w.getElements(x).forEach(function(aa){if(aa.name&&!aa.disabled&&aa.type!=='submit')if(!aa.type||((aa.type==='radio'||aa.type==='checkbox')&&aa.checked)||aa.type==='text'||aa.type==='password'||aa.type==='hidden'||aa.nodeName==='TEXTAREA'){z(aa.type,aa.name,o.getValue(aa));}else if(aa.nodeName==='SELECT'){for(var ba=0,ca=aa.options.length;ba<ca;ba++){var da=aa.options[ba];if(da.selected)z('select',aa.name,da.value);}}else if(t&&aa.type==='file'){var ea=aa.files;for(var fa=0;fa<ea.length;fa++)z('file',aa.name,ea.item(fa));}});if(y&&y.name&&y.type==='submit'&&l.contains(x,y)&&l.isNodeOfType(y,['input','button']))z('submit',y.name,y.value);},createFormData:function(x,y){if(!u)return null;var z=new FormData();if(x)if(l.isNode(x)){w.forEachValue(x,y,function(ca,da,ea){z.append(da,ea);});}else{var aa=v(x);for(var ba in aa)z.append(ba,aa[ba]);}return z;},serialize:function(x,y){var z={};w.forEachValue(x,y,function(aa,ba,ca){if(aa==='file')return;w._serializeHelper(z,ba,ca);});return w._serializeFix(z);},_serializeHelper:function(x,y,z){var aa=/([^\]]+)\[([^\]]*)\](.*)/.exec(y);if(aa){x[aa[1]]=x[aa[1]]||{};var ba=0;if(aa[2]===''){while(x[aa[1]][ba]!==undefined)ba++;}else ba=aa[2];if(aa[3]===''){x[aa[1]][ba]=z;}else w._serializeHelper(x[aa[1]],ba.concat(aa[3]),z);}else x[y]=z;},_serializeFix:function(x){var y=[];for(var z in x){if(x[z] instanceof Object)x[z]=w._serializeFix(x[z]);y.push(z);}if(y.length>0){var aa=0,ba=true;y.sort().forEach(function(da){if(da!=aa++)ba=false;});if(ba){var ca=[];y.forEach(function(da){ca[da]=x[da];});return ca;}}return x;},post:function(x,y,z){var aa=document.createElement('form');aa.action=x.toString();aa.method='POST';aa.style.display='none';if(z)aa.target=z;y.fb_dtsg=n.fb_dtsg;w.createHiddenInputs(y,aa);l.getRootElement().appendChild(aa);aa.submit();return false;},createHiddenInputs:function(x,y,z,aa){z=z||{};var ba=v(x);for(var ca in ba){if(ba[ca]===null)continue;if(z[ca]&&aa){z[ca].value=ba[ca];}else{var da=j.create('input',{type:'hidden',name:ca,value:ba[ca]});z[ca]=da;y.appendChild(da);}}return z;},getFirstElement:function(x,y){y=y||['input[type="text"]','textarea','input[type="password"]','input[type="button"]','input[type="submit"]'];var z=[];for(var aa=0;aa<y.length;aa++){z=l.scry(x,y[aa]);for(var ba=0;ba<z.length;ba++){var ca=z[ba];try{var ea=k.getElementPosition(ca);if(ea.y>0&&ea.x>0)return ca;}catch(da){}}}return null;},focusFirst:function(x){var y=w.getFirstElement(x);if(y){y.focus();return true;}return false;}};e.exports=w;});
__d("legacy:dom-form",["Form"],function(a,b,c,d){a.Form=b('Form');},3);
function show(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='';}return false;}function hide(){for(var a=0;a<arguments.length;a++){var b=ge(arguments[a]);if(b&&b.style)b.style.display='none';}return false;}function shown(a){a=ge(a);return (a.style.display!='none'&&!(a.style.display==''&&a.offsetWidth==0));}function toggle(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);b.style.display=CSS.getStyle(b,"display")=='block'?'none':'block';}return false;}function toggleDisplayNone(){for(var a=0;a<arguments.length;a++){var b=$(arguments[a]);if(shown(b)){hide(b);}else show(b);}return false;}
__d("UntrustedLink",["DOM","event-extensions","URI","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('event-extensions'),i=b('URI'),j=b('UserAgent'),k=b('copyProperties');function l(m,n,o,p){this.dom=m;this.url=m.href;this.hash=n;this.func_get_params=p||function(){return {};};Event.listen(this.dom,'click',this.onclick.bind(this));Event.listen(this.dom,'mousedown',this.onmousedown.bind(this));Event.listen(this.dom,'mouseup',this.onmouseup.bind(this));Event.listen(this.dom,'mouseout',this.onmouseout.bind(this));this.onmousedown(h.$E(o));}l.bootstrap=function(m,n,o,p){if(m.__untrusted)return;m.__untrusted=true;new l(m,n,o,p);};l.prototype.getRewrittenURI=function(){var m=k({u:this.url,h:this.hash},this.func_get_params(this.dom)),n=new i('/l.php');return n.setQueryData(m).setSubdomain('www').setProtocol('http');};l.prototype.onclick=function(){(function(){this.setHref(this.url);}).bind(this).defer(100);this.setHref(this.getRewrittenURI());};l.prototype.onmousedown=function(m){if(m.button==2)this.setHref(this.getRewrittenURI());};l.prototype.onmouseup=function(){this.setHref(this.getRewrittenURI());};l.prototype.onmouseout=function(){this.setHref(this.url);};l.prototype.setHref=function(m){if(j.ie()<9){var n=g.create('span');g.appendContent(this.dom,n);this.dom.href=m;g.remove(n);}else this.dom.href=m;};e.exports=l;});
__d("legacy:dom-untrusted",["UntrustedLink"],function(a,b,c,d){a.UntrustedLink=b('UntrustedLink');},3);
__d("SystemEvents",["Arbiter","Env","ErrorUtils","UserAgent","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('Env'),i=b('ErrorUtils'),j=b('UserAgent'),k=b('copyProperties'),l=new g(),m=[],n=1000;setInterval(function(){for(var w=0;w<m.length;w++)m[w]();},n,false);function o(){return (/c_user=(\d+)/.test(document.cookie)&&RegExp.$1)||0;}var p=h.user,q=navigator.onLine;function r(){if(!q){q=true;l.inform(l.ONLINE,q);}}function s(){if(q){q=false;l.inform(l.ONLINE,q);}}if(j.ie()){if(j.ie()>=8){window.attachEvent('onload',function(){document.body.ononline=r;document.body.onoffline=s;});}else m.push(function(){(navigator.onLine?r:s)();});}else if(window.addEventListener)if(!j.chrome()){window.addEventListener('online',r,false);window.addEventListener('offline',s,false);}var t=p;m.push(function(){var w=o();if(t!=w){l.inform(l.USER,w);t=w;}});var u=Date.now();function v(){var w=Date.now(),x=w-u,y=x<0||x>10000;u=w;if(y)l.inform(l.TIME_TRAVEL,x);return y;}m.push(v);m.push(function(){if(window.onerror!=i.onerror)window.onerror=i.onerror;});a.SystemEvents=e.exports=k(l,{USER:'SystemEvents/USER',ONLINE:'SystemEvents/ONLINE',TIME_TRAVEL:'SystemEvents/TIME_TRAVEL',isPageOwner:function(w){return (w||o())==p;},isOnline:function(){return j.chrome()||q;},checkTimeTravel:v});},3);
__d("legacy:event-extensions",["event-extensions"],function(a,b,c,d){b('event-extensions');},3);
__d("LinkController",["event-extensions","DataStore","Parent","trackReferrer"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DataStore'),h=b('Parent'),i=b('trackReferrer'),j='LinkControllerHandler',k=[],l=[];function m(event){var q=h.byTag(event.getTarget(),'a'),r=q&&q.getAttribute('href',2);if(!r||q.rel||!o(r)||g.get(q,j))return;var s=Event.listen(q,'click',function(t){if(r.charAt(r.length-1)=='#'){t.prevent();return;}i(q,r);n(q,t);});g.set(q,j,s);}function n(q,event){if(q.target||event.getModifiers().any||(event.which&&event.which!=1))return;var r=k.concat(l);for(var s=0,t=r.length;s<t;s++)if(r[s](q,event)===false)return event.kill();}function o(q){var r=q.match(/^(\w+):/);return !r||r[1].match(/^http/i);}var p={registerHandler:function(q){k.push(q);},registerFallbackHandler:function(q){l.push(q);}};Event.listen(document.documentElement,'mousedown',m);Event.listen(document.documentElement,'keydown',m);e.exports=p;});
__d("legacy:link-controller",["LinkController"],function(a,b,c,d){a.LinkController=b('LinkController');},3);
__d("OnloadHooks",["Arbiter","ErrorUtils","InitialJSLoader","OnloadEvent"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ErrorUtils'),i=b('InitialJSLoader'),j=b('OnloadEvent');function k(){var r=a.CavalryLogger;if(!window.loaded&&r)r.getInstance().setTimeStamp('t_prehooks');n('onloadhooks');if(!window.loaded&&r)r.getInstance().setTimeStamp('t_hooks');window.loaded=true;g.inform('uipage_onload',true,g.BEHAVIOR_STATE);}function l(){n('onafterloadhooks');window.afterloaded=true;}function m(r,s){return h.applyWithGuard(r,null,null,function(t){t.event_type=s;t.category='runhook';});}function n(r){var s=(r=='onbeforeleavehooks')||(r=='onbeforeunloadhooks');do{var t=window[r];if(!t)break;if(!s)window[r]=null;for(var u=0;u<t.length;u++){var v=m(t[u],r);if(s&&v)return v;}}while(!s&&window[r]);}function o(){if(!window.loaded){window.loaded=true;n('onloadhooks');}if(!window.afterloaded){window.afterloaded=true;n('onafterloadhooks');}}function p(){g.registerCallback(k,[j.ONLOAD_DOMCONTENT_CALLBACK,i.INITIAL_JS_READY]);g.registerCallback(l,[j.ONLOAD_DOMCONTENT_CALLBACK,j.ONLOAD_CALLBACK,i.INITIAL_JS_READY]);g.subscribe(j.ONBEFOREUNLOAD,function(r,s){s.warn=n('onbeforeleavehooks')||n('onbeforeunloadhooks');if(!s.warn){window.loaded=false;window.afterloaded=false;}},g.SUBSCRIBE_NEW);g.subscribe(j.ONUNLOAD,function(r,s){n('onunloadhooks');},g.SUBSCRIBE_NEW);}var q={_onloadHook:k,_onafterloadHook:l,runHook:m,runHooks:n,keepWindowSetAsLoaded:o};p();a.OnloadHooks=e.exports=q;});
__d("legacy:onload-action",["OnloadHooks"],function(a,b,c,d){var e=b('OnloadHooks');a._onloadHook=e._onloadHook;a._onafterloadHook=e._onafterloadHook;a.runHook=e.runHook;a.runHooks=e.runHooks;a.keep_window_set_as_loaded=e.keepWindowSetAsLoaded;},3);
function link_rel_preload(){var a=/async(?:-post)?|dialog(?:-pipe|-post)?|theater|toggle/;document.documentElement.onmousedown=function(b){b=b||window.event;var c=b.target||b.srcElement,d=Parent.byTag(c,'A');if(!d)return;var e=d.getAttribute('ajaxify'),f=d.href,g=e||f;if(e&&f&&!(/#$/).test(f)){var h=b.which&&b.which!=1,i=b.altKey||b.ctrlKey||b.metaKey||b.shiftKey;if(h||i)return;}var j=d.rel&&d.rel.match(a);j=j&&j[0];switch(j){case 'dialog':case 'dialog-post':Bootloader.loadComponents('dialog');break;case 'dialog-pipe':Bootloader.loadComponents(['ajaxpipe','dialog']);break;case 'async':case 'async-post':Bootloader.loadComponents('async');break;case 'theater':Bootloader.loadComponents('PhotoSnowlift',function(){PhotoSnowlift.preload(g,d);});break;case 'toggle':Bootloader.loadComponents('Toggler');break;}return;};}
__d("DOMDimensions",["DOMQuery"],function(a,b,c,d,e,f){var g=b('DOMQuery'),h={getElementDimensions:function(i){return {width:i.offsetWidth||0,height:i.offsetHeight||0};},getViewportDimensions:function(){var i=(window&&window.innerWidth)||(document&&document.documentElement&&document.documentElement.clientWidth)||(document&&document.body&&document.body.clientWidth)||0,j=(window&&window.innerHeight)||(document&&document.documentElement&&document.documentElement.clientHeight)||(document&&document.body&&document.body.clientHeight)||0;return {width:i,height:j};},getDocumentDimensions:function(i){i=i||document;var j=g.getDocumentScrollElement(i),k=j.scrollWidth||0,l=j.scrollHeight||0;return {width:k,height:l};}};e.exports=h;});
__d("Vector",["event-extensions","DOMDimensions","DOMPosition","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOMDimensions'),h=b('DOMPosition'),i=b('copyProperties');function j(k,l,m){i(this,{x:parseFloat(k),y:parseFloat(l),domain:m||'pure'});}i(j.prototype,{toString:function(){return '('+this.x+', '+this.y+')';},add:function(k,l){if(arguments.length==1){if(k.domain!='pure')k=k.convertTo(this.domain);return this.add(k.x,k.y);}var m=parseFloat(k),n=parseFloat(l);return new j(this.x+m,this.y+n,this.domain);},mul:function(k,l){if(typeof l=="undefined")l=k;return new j(this.x*k,this.y*l,this.domain);},sub:function(k,l){if(arguments.length==1){return this.add(k.mul(-1));}else return this.add(-k,-l);},distanceTo:function(k){return this.sub(k).magnitude();},magnitude:function(){return Math.sqrt((this.x*this.x)+(this.y*this.y));},convertTo:function(k){if(k!='pure'&&k!='viewport'&&k!='document')return new j(0,0);if(k==this.domain)return new j(this.x,this.y,this.domain);if(k=='pure')return new j(this.x,this.y);if(this.domain=='pure')return new j(0,0);var l=j.getScrollPosition('document'),m=this.x,n=this.y;if(this.domain=='document'){m-=l.x;n-=l.y;}else{m+=l.x;n+=l.y;}return new j(m,n,k);},setElementPosition:function(k){var l=this.convertTo('document');k.style.left=parseInt(l.x)+'px';k.style.top=parseInt(l.y)+'px';return this;},setElementDimensions:function(k){return this.setElementWidth(k).setElementHeight(k);},setElementWidth:function(k){k.style.width=parseInt(this.x,10)+'px';return this;},setElementHeight:function(k){k.style.height=parseInt(this.y,10)+'px';return this;},scrollElementBy:function(k){if(k==document.body){window.scrollBy(this.x,this.y);}else{k.scrollLeft+=this.x;k.scrollTop+=this.y;}return this;}});i(j,{getEventPosition:function(k,l){l=l||'document';var m=Event.getPosition(k),n=new j(m.x,m.y,'document');return n.convertTo(l);},getScrollPosition:function(k){k=k||'document';var l=h.getScrollPosition();return new j(l.x,l.y,'document').convertTo(k);},getElementPosition:function(k,l){l=l||'document';var m=h.getElementPosition(k);return new j(m.x,m.y,'viewport').convertTo(l);},getElementDimensions:function(k){var l=g.getElementDimensions(k);return new j(l.width,l.height);},getViewportDimensions:function(){var k=g.getViewportDimensions();return new j(k.width,k.height,'viewport');},getDocumentDimensions:function(k){var l=g.getDocumentDimensions(k);return new j(l.width,l.height,'document');},deserialize:function(k){var l=k.split(',');return new j(l[0],l[1]);}});e.exports=j;});
__d("legacy:vector",["Vector"],function(a,b,c,d){a.Vector2=b('Vector');},3);
__d("legacy:async",["AsyncRequest","AsyncResponse"],function(a,b,c,d){a.AsyncRequest=b('AsyncRequest');a.AsyncResponse=b('AsyncResponse');},3);
__d("startsWith",[],function(a,b,c,d,e,f){function g(h,i,j){var k=String(h);j=Math.min(Math.max(j||0,0),k.length);return k.lastIndexOf(String(i),j)===j;}e.exports=g;});
__d("AsyncRequestNectarLogging",["AsyncRequest","Env","copyProperties","startsWith"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('Env'),i=b('copyProperties'),j=b('startsWith');i(g.prototype,{setNectarModuleData:function(k){if(this.method=='POST'){var l=h.module;if(k&&l===undefined){var m={fbpage_fan_confirm:1},n=null;for(var o=k;o&&o!=document.body;o=o.parentNode){if(!o.id||typeof o.id!=='string')continue;if(j(o.id,'pagelet_')){l=o.id;break;}if(!n&&m[o.id])n=o.id;}if(l===undefined&&n)l=n;}if(l!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._mod=l;}}},setNectarImpressionId:function(){if(this.method=='POST'){var k=h.impid;if(k!==undefined){if(this.data.nctr===undefined)this.data.nctr={};this.data.nctr._impid=k;}}}});});
__d("legacy:async-postlude",["AsyncRequestNectarLogging"],function(a,b,c,d){b('AsyncRequestNectarLogging');},3);
__d("legacy:ua",["UserAgent"],function(a,b,c,d){a.ua=b('UserAgent');},3);
__d("Animation",["CSS","DOM","Style","UserAgent"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('Style'),j=b('UserAgent');function k(l){if(a==this){return new k(l);}else{this.obj=l;this._reset_state();this.queue=[];this.last_attr=null;}}k.resolution=20;k.offset=0;k.prototype._reset_state=function(){this.state={attrs:{},duration:500};};k.prototype.stop=function(){this._reset_state();this.queue=[];return this;};k.prototype._build_container=function(){if(this.container_div){this._refresh_container();return;}if(this.obj.firstChild&&this.obj.firstChild.__animation_refs){this.container_div=this.obj.firstChild;this.container_div.__animation_refs++;this._refresh_container();return;}var l=document.createElement('div');l.style.padding='0px';l.style.margin='0px';l.style.border='0px';l.__animation_refs=1;var m=this.obj.childNodes;while(m.length)l.appendChild(m[0]);this.obj.appendChild(l);this._orig_overflow=this.obj.style.overflow;this.obj.style.overflow='hidden';this.container_div=l;this._refresh_container();};k.prototype._refresh_container=function(){this.container_div.style.height='auto';this.container_div.style.width='auto';this.container_div.style.height=this.container_div.offsetHeight+'px';this.container_div.style.width=this.container_div.offsetWidth+'px';};k.prototype._destroy_container=function(){if(!this.container_div)return;if(!--this.container_div.__animation_refs){var l=this.container_div.childNodes;while(l.length)this.obj.appendChild(l[0]);this.obj.removeChild(this.container_div);}this.container_div=null;this.obj.style.overflow=this._orig_overflow;};k.ATTR_TO=1;k.ATTR_BY=2;k.ATTR_FROM=3;k.prototype._attr=function(l,m,n){l=l.replace(/-[a-z]/gi,function(p){return p.substring(1).toUpperCase();});var o=false;switch(l){case 'background':this._attr('backgroundColor',m,n);return this;case 'margin':m=k.parse_group(m);this._attr('marginBottom',m[0],n);this._attr('marginLeft',m[1],n);this._attr('marginRight',m[2],n);this._attr('marginTop',m[3],n);return this;case 'padding':m=k.parse_group(m);this._attr('paddingBottom',m[0],n);this._attr('paddingLeft',m[1],n);this._attr('paddingRight',m[2],n);this._attr('paddingTop',m[3],n);return this;case 'backgroundColor':case 'borderColor':case 'color':m=k.parse_color(m);break;case 'opacity':m=parseFloat(m,10);break;case 'height':case 'width':if(m=='auto'){o=true;}else m=parseInt(m,10);break;case 'borderWidth':case 'lineHeight':case 'fontSize':case 'marginBottom':case 'marginLeft':case 'marginRight':case 'marginTop':case 'paddingBottom':case 'paddingLeft':case 'paddingRight':case 'paddingTop':case 'bottom':case 'left':case 'right':case 'top':case 'scrollTop':case 'scrollLeft':m=parseInt(m,10);break;default:throw new Error(l+' is not a supported attribute!');}if(this.state.attrs[l]===undefined)this.state.attrs[l]={};if(o)this.state.attrs[l].auto=true;switch(n){case k.ATTR_FROM:this.state.attrs[l].start=m;break;case k.ATTR_BY:this.state.attrs[l].by=true;case k.ATTR_TO:this.state.attrs[l].value=m;break;}};k._get_box_width=function(l){var m=parseInt(i.get(l,'paddingLeft'),10),n=parseInt(i.get(l,'paddingRight'),10),o=parseInt(i.get(l,'borderLeftWidth'),10),p=parseInt(i.get(l,'borderRightWidth'),10);return l.offsetWidth-(m?m:0)-(n?n:0)-(o?o:0)-(p?p:0);};k._get_box_height=function(l){var m=parseInt(i.get(l,'paddingTop'),10),n=parseInt(i.get(l,'paddingBottom'),10),o=parseInt(i.get(l,'borderTopWidth'),10),p=parseInt(i.get(l,'borderBottomWidth'),10);return l.offsetHeight-(m?m:0)-(n?n:0)-(o?o:0)-(p?p:0);};k.prototype.to=function(l,m){if(m===undefined){this._attr(this.last_attr,l,k.ATTR_TO);}else{this._attr(l,m,k.ATTR_TO);this.last_attr=l;}return this;};k.prototype.by=function(l,m){if(m===undefined){this._attr(this.last_attr,l,k.ATTR_BY);}else{this._attr(l,m,k.ATTR_BY);this.last_attr=l;}return this;};k.prototype.from=function(l,m){if(m===undefined){this._attr(this.last_attr,l,k.ATTR_FROM);}else{this._attr(l,m,k.ATTR_FROM);this.last_attr=l;}return this;};k.prototype.duration=function(l){this.state.duration=l?l:0;return this;};k.prototype.checkpoint=function(l,m){if(l===undefined)l=1;this.state.checkpoint=l;this.queue.push(this.state);this._reset_state();this.state.checkpointcb=m;return this;};k.prototype.blind=function(){this.state.blind=true;return this;};k.prototype.hide=function(){this.state.hide=true;return this;};k.prototype.show=function(){this.state.show=true;return this;};k.prototype.ease=function(l){this.state.ease=l;return this;};k.prototype.go=function(){var l=(new Date()).getTime();this.queue.push(this.state);for(var m=0;m<this.queue.length;m++){this.queue[m].start=l-k.offset;if(this.queue[m].checkpoint)l+=this.queue[m].checkpoint*this.queue[m].duration;}k.push(this);return this;};k.prototype._show=function(){g.show(this.obj);};k.prototype._hide=function(){g.hide(this.obj);};k.prototype._frame=function(l){var m=true,n=false,o=false,p;function q(aa){return document.documentElement[aa]||document.body[aa];}for(var r=0;r<this.queue.length;r++){var s=this.queue[r];if(s.start>l){m=false;continue;}if(s.checkpointcb){this._callback(s.checkpointcb,l-s.start);s.checkpointcb=null;}if(s.started===undefined){if(s.show)this._show();for(var t in s.attrs){if(s.attrs[t].start!==undefined)continue;switch(t){case 'backgroundColor':case 'borderColor':case 'color':p=k.parse_color(i.get(this.obj,t=='borderColor'?'borderLeftColor':t));if(s.attrs[t].by){s.attrs[t].value[0]=Math.min(255,Math.max(0,s.attrs[t].value[0]+p[0]));s.attrs[t].value[1]=Math.min(255,Math.max(0,s.attrs[t].value[1]+p[1]));s.attrs[t].value[2]=Math.min(255,Math.max(0,s.attrs[t].value[2]+p[2]));}break;case 'opacity':p=i.getOpacity(this.obj);if(s.attrs[t].by)s.attrs[t].value=Math.min(1,Math.max(0,s.attrs[t].value+p));break;case 'height':p=k._get_box_height(this.obj);if(s.attrs[t].by)s.attrs[t].value+=p;break;case 'width':p=k._get_box_width(this.obj);if(s.attrs[t].by)s.attrs[t].value+=p;break;case 'scrollLeft':case 'scrollTop':p=(this.obj===document.body)?q(t):this.obj[t];if(s.attrs[t].by)s.attrs[t].value+=p;s['last'+t]=p;break;default:p=parseInt(i.get(this.obj,t),10)||0;if(s.attrs[t].by)s.attrs[t].value+=p;break;}s.attrs[t].start=p;}if((s.attrs.height&&s.attrs.height.auto)||(s.attrs.width&&s.attrs.width.auto)){if(j.firefox()<3)o=true;this._destroy_container();for(var t in {height:1,width:1,fontSize:1,borderLeftWidth:1,borderRightWidth:1,borderTopWidth:1,borderBottomWidth:1,paddingLeft:1,paddingRight:1,paddingTop:1,paddingBottom:1})if(s.attrs[t])this.obj.style[t]=s.attrs[t].value+(typeof s.attrs[t].value=='number'?'px':'');if(s.attrs.height&&s.attrs.height.auto)s.attrs.height.value=k._get_box_height(this.obj);if(s.attrs.width&&s.attrs.width.auto)s.attrs.width.value=k._get_box_width(this.obj);}s.started=true;if(s.blind)this._build_container();}var u=(l-s.start)/s.duration;if(u>=1){u=1;if(s.hide)this._hide();}else m=false;var v=s.ease?s.ease(u):u;if(!n&&u!=1&&s.blind)n=true;if(o&&this.obj.parentNode){var w=this.obj.parentNode,x=this.obj.nextSibling;w.removeChild(this.obj);}for(var t in s.attrs)switch(t){case 'backgroundColor':case 'borderColor':case 'color':if(s.attrs[t].start[3]!=s.attrs[t].value[3]){this.obj.style[t]='rgba('+k.calc_tween(v,s.attrs[t].start[0],s.attrs[t].value[0],true)+','+k.calc_tween(v,s.attrs[t].start[1],s.attrs[t].value[1],true)+','+k.calc_tween(v,s.attrs[t].start[2],s.attrs[t].value[2],true)+','+k.calc_tween(v,s.attrs[t].start[3],s.attrs[t].value[3],false)+')';}else this.obj.style[t]='rgb('+k.calc_tween(v,s.attrs[t].start[0],s.attrs[t].value[0],true)+','+k.calc_tween(v,s.attrs[t].start[1],s.attrs[t].value[1],true)+','+k.calc_tween(v,s.attrs[t].start[2],s.attrs[t].value[2],true)+')';break;case 'opacity':i.set(this.obj,'opacity',k.calc_tween(v,s.attrs[t].start,s.attrs[t].value));break;case 'height':case 'width':this.obj.style[t]=v==1&&s.attrs[t].auto?'auto':k.calc_tween(v,s.attrs[t].start,s.attrs[t].value,true)+'px';break;case 'scrollLeft':case 'scrollTop':var y=this.obj===document.body;p=y?q(t):this.obj[t];if(s['last'+t]!==p){delete s.attrs[t];}else{var z=k.calc_tween(v,s.attrs[t].start,s.attrs[t].value,true);if(!y){z=this.obj[t]=z;}else{if(t=='scrollLeft'){a.scrollTo(z,q('scrollTop'));}else a.scrollTo(q('scrollLeft'),z);z=q(t);}s['last'+t]=z;}break;default:this.obj.style[t]=k.calc_tween(v,s.attrs[t].start,s.attrs[t].value,true)+'px';break;}if(u==1){this.queue.splice(r--,1);this._callback(s.ondone,l-s.start-s.duration);}}if(o)w[x?'insertBefore':'appendChild'](this.obj,x);if(!n&&this.container_div)this._destroy_container();return !m;};k.prototype.ondone=function(l){this.state.ondone=l;return this;};k.prototype._callback=function(l,m){if(l){k.offset=m;l.call(this);k.offset=0;}};k.calc_tween=function(l,m,n,o){return (o?parseInt:parseFloat)((n-m)*l+m,10);};k.parse_color=function(l){var m=/^#([a-f0-9]{1,2})([a-f0-9]{1,2})([a-f0-9]{1,2})$/i.exec(l);if(m){return [parseInt(m[1].length==1?m[1]+m[1]:m[1],16),parseInt(m[2].length==1?m[2]+m[2]:m[2],16),parseInt(m[3].length==1?m[3]+m[3]:m[3],16),1];}else{var n=/^rgba? *\(([0-9]+), *([0-9]+), *([0-9]+)(?:, *([0-9]+))?\)$/.exec(l);if(n){return [parseInt(n[1],10),parseInt(n[2],10),parseInt(n[3],10),n[4]?parseFloat(n[4]):1];}else if(l=='transparent'){return [255,255,255,0];}else throw 'Named color attributes are not supported.';}};k.parse_group=function(l){l=l.trim().split(/ +/);if(l.length==4){return l;}else if(l.length==3){return [l[0],l[1],l[2],l[1]];}else if(l.length==2){return [l[0],l[1],l[0],l[1]];}else return [l[0],l[0],l[0],l[0]];};k.push=function(l){if(!k.active)k.active=[];k.active.push(l);if(k.active.length===1){if(!k.requestAnimationFrame){var m=a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame;if(m)k.requestAnimationFrame=m.bind(a);}if(k.requestAnimationFrame){k.requestAnimationFrame(k._animate);}else k.timeout=setInterval(k._animate,k.resolution,false);}if(k.requestAnimationFrame)k._updateEndingTimer();k._animate(Date.now(),true);};k._updateEndingTimer=function(){if(!k.requestAnimationFrame)throw new Error('Ending timer only valid with requestAnimationFrame');var l=0;for(var m=0;m<k.active.length;m++){var n=k.active[m];for(var o=0;o<n.queue.length;o++){var p=n.queue[o].start+n.queue[o].duration;if(p>l)l=p;}}if(k.timeout){clearTimeout(k.timeout);delete k.timeout;}var q=Date.now();if(l>q)k.timeout=setTimeout(k._animate.shield(),l-q,false);};k._animate=function(l,m){l=l||Date.now();for(var n=(m===true)?k.active.length-1:0;n<k.active.length;n++)try{if(!k.active[n]._frame(l))k.active.splice(n--,1);}catch(o){k.active.splice(n--,1);}if(k.active.length===0){if(k.timeout){if(k.requestAnimationFrame){clearTimeout(k.timeout);}else clearInterval(k.timeout);delete k.timeout;}}else if(k.requestAnimationFrame)k.requestAnimationFrame(k._animate);};k.ease={};k.ease.begin=function(l){return Math.sin(Math.PI/2*(l-1))+1;};k.ease.end=function(l){return Math.sin(.5*Math.PI*l);};k.ease.both=function(l){return .5*Math.sin(Math.PI*(l-.5))+.5;};k.prependInsert=function(l,m){k.insert(l,m,h.prependContent);};k.appendInsert=function(l,m){k.insert(l,m,h.appendContent);};k.insert=function(l,m,n){i.set(m,'opacity',0);n(l,m);new k(m).from('opacity',0).to('opacity',1).duration(400).go();};e.exports=k;});
__d("legacy:animation",["Animation"],function(a,b,c,d){a.animation=b('Animation');},3);
__d("goOrReplace",["URI","UserAgent"],function(a,b,c,d,e,f){var g=b('URI'),h=b('UserAgent');function i(j,k,l){var m=new g(k);if(j.pathname=='/'&&m.getPath()!='/'&&m.isQuicklingEnabled()){var n=j.search?{}:{q:''};m=new g().setPath('/').setQueryData(n).setFragment(m.getUnqualifiedURI()).toString();k=m.toString();}if(l&&!(h.ie()<8)){j.replace(k);}else if(j.href==k){j.reload();}else j.href=k;}e.exports=i;});
__d("AjaxPipeRequest",["Arbiter","AsyncRequest","BigPipe","DOM","Env","JSCC","copyProperties","goOrReplace","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('AsyncRequest'),i=b('BigPipe'),j=b('DOM'),k=b('Env'),l=b('JSCC'),m=b('copyProperties'),n=b('goOrReplace'),o=b('ge'),p;function q(t,u){var v=o(t);if(v){if(!u)v.style.minHeight='600px';for(var w in i.pageletIDs)if(t!==w&&j.contains(v,w)){l.clearForPagelet(w);delete i.pageletIDs[w];}j.empty(v);}}function r(t,u){var v=o(t);if(v)if(!u)v.style.minHeight='100px';}function s(t,u){this._uri=t;this._query_data=u;this._request=new h();this._canvas_id=null;this._allow_cross_page_transition=true;}m(s.prototype,{setCanvasId:function(t){this._canvas_id=t;return this;},setURI:function(t){this._uri=t;return this;},setData:function(t){this._query_data=t;return this;},getData:function(t){return this._query_data;},setAllowCrossPageTransition:function(t){this._allow_cross_page_transition=t;return this;},setAppend:function(t){this._append=t;return this;},send:function(){this._request.setOption('useIframeTransport',true).setURI(this._uri).setData(m({ajaxpipe:1,ajaxpipe_token:k.ajaxpipe_token},this._query_data)).setPreBootloadHandler(this._preBootloadHandler.bind(this)).setInitialHandler(this._onInitialResponse.bind(this)).setHandler(this._onResponse.bind(this)).setMethod('GET').setReadOnly(true).setAllowCrossPageTransition(this._allow_cross_page_transition);p=this._request;this._request.send();return this;},_preBootloadFirstResponse:function(t){return false;},_fireDomContentCallback:function(){this._arbiter.inform('ajaxpipe/domcontent_callback',true,g.BEHAVIOR_STATE);},_fireOnloadCallback:function(){this._arbiter.inform('ajaxpipe/onload_callback',true,g.BEHAVIOR_STATE);},_isRelevant:function(t){return this._request==p||this._jsNonBlock;},_preBootloadHandler:function(t){var u=t.getPayload();if(!u||u.redirect||!this._isRelevant(t))return false;var v=false;if(t.is_first){!this._append&&!this._displayCallback&&q(this._canvas_id,this._constHeight);this._arbiter=new g();v=this._preBootloadFirstResponse(t);this.pipe=new i({arbiter:this._arbiter,rootNodeID:this._canvas_id,lid:this._request.lid,isAjax:true,domContentCallback:this._fireDomContentCallback.bind(this),onloadCallback:this._fireOnloadCallback.bind(this),domContentEvt:'ajaxpipe/domcontent_callback',onloadEvt:'ajaxpipe/onload_callback',jsNonBlock:this._jsNonBlock,displayCallback:this._displayCallback});}return v;},_redirect:function(t){if(t.redirect){if(t.force||!this.isPageActive(t.redirect)){var u=['ajaxpipe','ajaxpipe_token'].concat(this.getSanitizedParameters());n(window.location,URI(t.redirect).removeQueryData(u),true);}else PageTransitions.go(t.redirect,true);return true;}else return false;},isPageActive:function(t){return true;},getSanitizedParameters:function(){return [];},_versionCheck:function(t){return true;},_onInitialResponse:function(t){var u=t.getPayload();if(!this._isRelevant(t))return false;if(!u)return true;if(this._redirect(u)||!this._versionCheck(u))return false;return true;},_processFirstResponse:function(t){var u=t.getPayload();if(o(this._canvas_id)&&u.canvas_class!==null)CSS.setClass(this._canvas_id,u.canvas_class);},setFirstResponseCallback:function(t){this._firstResponseCallback=t;return this;},setFirstResponseHandler:function(t){this._processFirstResponse=t;return this;},_onResponse:function(t){var u=t.payload;if(!this._isRelevant(t))return h.suppressOnloadToken;if(t.is_first){this._processFirstResponse(t);this._firstResponseCallback&&this._firstResponseCallback();u.provides=u.provides||[];u.provides.push('uipage_onload');if(this._append)u.append=this._canvas_id;}if(u){if('content' in u.content&&this._canvas_id!==null&&this._canvas_id!='content'){u.content[this._canvas_id]=u.content.content;delete u.content.content;}this.pipe.onPageletArrive(u);}if(t.is_last)r(this._canvas_id,this._constHeight);return h.suppressOnloadToken;},setNectarModuleDataSafe:function(t){this._request.setNectarModuleDataSafe(t);return this;},setFinallyHandler:function(t){this._request.setFinallyHandler(t);return this;},setErrorHandler:function(t){this._request.setErrorHandler(t);return this;},abort:function(){this._request.abort();if(p==this._request)p=null;this._request=null;return this;},setJSNonBlock:function(t){this._jsNonBlock=t;return this;},setDisplayCallback:function(t){this._displayCallback=t;return this;},setConstHeight:function(t){this._constHeight=t;return this;},getAsyncRequest:function(){return this._request;}});m(s,{getCurrentRequest:function(){return p;},setCurrentRequest:function(t){p=t;}});e.exports=s;});
__d("Button",["event-extensions","CSS","DataStore","DOM","Parent"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DataStore'),i=b('DOM'),j=b('Parent'),k='uiButtonDisabled',l='uiButtonDepressed',m='button:blocker',n='href';function o(s,t){var u=h.get(s,m);if(t){if(u){u.remove();h.remove(s,m);}}else if(!u)h.set(s,m,Event.listen(s,'click',bagof(false),Event.Priority.URGENT));}function p(s){var t=j.byClass(s,'uiButton');if(!t)throw new Error('invalid use case');return t;}function q(s){return i.isNodeOfType(s,'a');}var r={getInputElement:function(s){s=p(s);if(q(s))throw new Error('invalid use case');return i.find(s,'input');},isEnabled:function(s){return !g.hasClass(p(s),k);},setEnabled:function(s,t){s=p(s);g.conditionClass(s,k,!t);if(q(s)){var u=s.href,v=h.get(s,n,'#');if(t){if(!u)s.href=v;}else{if(u&&u!==v)h.set(s,n,u);s.removeAttribute('href');}o(s,t);}else{var w=r.getInputElement(s);w.disabled=!t;o(w,t);}},setDepressed:function(s,t){g.conditionClass(p(s),l,t);},isDepressed:function(s){return g.hasClass(p(s),l);},setLabel:function(s,t){s=p(s);if(q(s)){var u=i.find(s,'span.uiButtonText');i.setContent(u,t);}else r.getInputElement(s).value=t;g.conditionClass(s,'uiButtonNoText',!t);},setIcon:function(s,t){if(t&&!i.isNode(t))return;s=p(s);var u=i.scry(s,'.img')[0];if(!t){u&&i.remove(u);return;}g.addClass(t,'customimg');if(u!=t)if(u){i.replace(u,t);}else i.prependContent(s,t);}};e.exports=r;});
__d("CSSSupport",[],function(a,b,c,d,e,f){var g={supportsBorderRadius:function(){var h=['KhtmlBorderRadius','OBorderRadius','MozBorderRadius','WebkitBorderRadius','msBorderRadius','borderRadius'],i=false,j=document.createElement('div');for(var k=h.length;k>=0;k--)if(i=j.style[h[k]]!==undefined)break;g.supportsBorderRadius=bagof(i);return i;}};e.exports=g;});
__d("Keys",[],function(a,b,c,d,e,f){var g={BACKSPACE:8,TAB:9,RETURN:13,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46,COMMA:188};e.exports=g;});
__d("Locale",["Style"],function(a,b,c,d,e,f){var g=b('Style'),h,i={isRTL:function(){if(h===undefined)h=('rtl'===g.get(document.body,'direction'));return h;}};e.exports=i;});
__d("getOverlayZIndex",["Style"],function(a,b,c,d,e,f){var g=b('Style');function h(i,j){j=j||document.body;var k=[];while(i&&i!==j){k.push(i);i=i.parentNode;}if(i!==j)return 0;for(var l=k.length-1;l>=0;l--){var m=k[l];if(g.get(m,'position')!='static'){var n=parseInt(g.get(m,'z-index'),10);if(!isNaN(n))return n;}}return 0;}e.exports=h;});
__d("Dialog",["array-extensions","event-extensions","AjaxPipeRequest","Animation","Arbiter","AsyncRequest","Bootloader","Button","CSS","CSSSupport","DOM","Form","HTML","Input","Keys","Locale","Parent","Run","Style","URI","UserAgent","Vector","bind","copyProperties","createArrayFrom","getObjectValues","getOverlayZIndex","tx"],function(a,b,c,d,e,f){b('array-extensions');b('event-extensions');var g=b('AjaxPipeRequest'),h=b('Animation'),i=b('Arbiter'),j=b('AsyncRequest'),k=b('Bootloader'),l=b('Button'),m=b('CSS'),n=b('CSSSupport'),o=b('DOM'),p=b('Form'),q=b('HTML'),r=b('Input'),s=b('Keys'),t=b('Locale'),u=b('Parent'),v=b('Run'),w=b('Style'),x=b('URI'),y=b('UserAgent'),z=b('Vector'),aa=b('bind'),ba=b('copyProperties'),ca=b('createArrayFrom'),da=b('getObjectValues'),ea=b('getOverlayZIndex'),fa=b('tx'),ga=function(){var ia=document.body,ja=document.createElement('div'),ka=document.createElement('div');ia.insertBefore(ja,ia.firstChild);ia.insertBefore(ka,ia.firstChild);ja.style.position='fixed';ja.style.top='20px';var la=ja.offsetTop!==ka.offsetTop;ia.removeChild(ja);ia.removeChild(ka);ga=bagof(la);return la;};function ha(ia){this._show_loading=true;this._auto_focus=true;this._submit_on_enter=false;this._fade_enabled=true;this._onload_handlers=[];this._top=125;this._uniqueID='dialog_'+ha._globalCount++;this._content=null;this._obj=null;this._popup=null;this._overlay=null;this._shim=null;this._causal_elem=null;this._previous_focus=null;this._buttons=[];this._buildDialog();if(ia)this._setFromModel(ia);ha._init();}ba(ha,{OK:{name:'ok',label:"Okay"},CANCEL:{name:'cancel',label:"Cancel",className:'inputaux'},CLOSE:{name:'close',label:"Close"},NEXT:{name:'next',label:"Next"},SAVE:{name:'save',label:"Save"},SUBMIT:{name:'submit',label:"Submit"},CONFIRM:{name:'confirm',label:"Confirm"},DELETE:{name:'delete',label:"Delete"},_globalCount:0,_bottoms:[0],max_bottom:0,_updateMaxBottom:function(){ha.max_bottom=Math.max.apply(Math,ha._bottoms);}});ba(ha,{OK_AND_CANCEL:[ha.OK,ha.CANCEL],_STANDARD_BUTTONS:[ha.OK,ha.CANCEL,ha.CLOSE,ha.SAVE,ha.SUBMIT,ha.CONFIRM,ha.DELETE],SIZE:{WIDE:555,STANDARD:445},_HALO_WIDTH:10,_BORDER_WIDTH:1,_PADDING_WIDTH:10,_PAGE_MARGIN:40,_stack:[],_isUsingCSSBorders:function(){return n.supportsBorderRadius()||y.ie()<7;},newButton:function(ia,ja,ka,la){var ma={name:ia,label:ja};if(ka)ma.className=ka;if(la)ma.handler=la;return ma;},getCurrent:function(){var ia=ha._stack;return ia.length?ia[ia.length-1]:null;},hideCurrent:function(){var ia=ha.getCurrent();ia&&ia.hide();},bootstrap:function(ia,ja,ka,la,ma,na){ja=ja||{};ba(ja,new x(ia).getQueryData());la=la||(ka?'GET':'POST');var oa=u.byClass(na,'stat_elem')||na;if(oa&&m.hasClass(oa,'async_saving'))return false;var pa=new j().setReadOnly(!!ka).setMethod(la).setRelativeTo(na).setStatusElement(oa).setURI(ia).setNectarModuleDataSafe(na).setData(ja),qa=new ha(ma).setCausalElement(na).setAsync(pa);qa.show();return false;},showFromModel:function(ia,ja){var ka=new ha(ia).setCausalElement(ja).show();if(ia.hiding)ka.hide();},_init:function(){this._init=bagofholding;v.onLeave(ha._tearDown.shield(null,false));i.subscribe('page_transition',ha._tearDown.shield(null,true));Event.listen(document.documentElement,'keydown',function(event){if(Event.getKeyCode(event)==s.ESC&&!event.getModifiers().any){if(ha._escape())event.kill();}else if(Event.getKeyCode(event)==s.RETURN&&!event.getModifiers().any)if(ha._enter())event.kill();});Event.listen(window,'resize',function(event){var ia=ha.getCurrent();ia&&ia._resetDialogObj();});},_findButton:function(ia,ja){if(ia)for(var ka=0;ka<ia.length;++ka)if(ia[ka].name==ja)return ia[ka];return null;},_tearDown:function(ia){var ja=ha._stack.slice();for(var ka=ja.length-1;ka>=0;ka--)if((ia&&!ja[ka]._cross_transition)||(!ia&&!ja[ka]._cross_quickling))ja[ka].hide();},_escape:function(){var ia=ha.getCurrent();if(!ia)return false;var ja=ia._semi_modal,ka=ia._buttons;if(!ka.length&&!ja)return false;if(ja&&!ka.length){ia.hide();return true;}var la,ma=ha._findButton(ka,'cancel');if(ia._cancelHandler){ia.cancel();return true;}else if(ma){la=ma;}else if(ka.length==1){la=ka[0];}else return false;ia._handleButton(la);return true;},_enter:function(){var ia=ha.getCurrent();if(!ia||!ia._submit_on_enter)return false;if(document.activeElement!=ia._frame)return false;var ja=ia._buttons;if(!ja)return false;ia._handleButton(ja[0]);return true;},call_or_eval:function(ia,ja,ka){if(!ja)return undefined;ka=ka||{};if(typeof ja=='string'){var la=Object.keys(ka).join(', ');ja=(eval)('({f: function('+la+') { '+ja+'}})').f;}return ja.apply(ia,da(ka));}});ba(ha.prototype,{_cross_quickling:false,_cross_transition:false,_loading:false,_showing:false,show:function(){this._showing=true;if(this._async_request){if(this._show_loading)this.showLoading();}else this._update();return this;},showLoading:function(){this._loading=true;m.addClass(this._frame,'dialog_loading_shown');this._renderDialog();return this;},hide:function(){if(!this._showing&&!this._loading)return this;this._showing=false;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}if(this._fade_enabled&&ha._stack.length<=1){this._fadeOut();}else this._hide();return this;},cancel:function(){if(!this._cancelHandler||this._cancelHandler()!==false)this.hide();},getRoot:function(){return this._obj;},getBody:function(){return o.scry(this._obj,'div.dialog_body')[0];},getButtonElement:function(ia){if(typeof ia=='string')ia=ha._findButton(this._buttons,ia);if(!ia||!ia.name)return null;var ja=o.scry(this._popup,'input'),ka=function(la){return la.name==ia.name;};return ja.filter(ka)[0]||null;},getContentNode:function(){return o.find(this._content,'div.dialog_content');},getFormData:function(){return p.serialize(this.getContentNode());},setAllowCrossPageTransition:function(ia){this._cross_transition=ia;return this;},setAllowCrossQuicklingNavigation:function(ia){this._cross_quickling=ia;return this;},setShowing:function(){this.show();return this;},setHiding:function(){this.hide();return this;},setTitle:function(ia){var ja=this._nodes.title,ka=this._nodes.title_inner,la=this._nodes.content;o.setContent(ka,this._format(ia||''));m.conditionShow(ja,!!ia);m.conditionClass(la,'dialog_content_titleless',!ia);return this;},setBody:function(ia){o.setContent(this._nodes.body,this._format(ia));return this;},setExtraData:function(ia){this._extra_data=ia;return this;},setReturnData:function(ia){this._return_data=ia;return this;},setShowLoading:function(ia){this._show_loading=ia;return this;},setFullBleed:function(ia){this._full_bleed=ia;this._updateWidth();m.conditionClass(this._obj,'full_bleed',ia);return this;},setCausalElement:function(ia){this._causal_elem=ia;return this;},setUserData:function(ia){this._user_data=ia;return this;},getUserData:function(){return this._user_data;},setAutohide:function(ia){if(ia){if(this._showing){this._autohide_timeout=setTimeout(this.hide.shield(this),ia);}else this._autohide=ia;}else{this._autohide=null;if(this._autohide_timeout){clearTimeout(this._autohide_timeout);this._autohide_timeout=null;}}return this;},setSummary:function(ia){var ja=this._nodes.summary;o.setContent(ja,this._format(ia||''));m.conditionShow(ja,!!ia);return this;},setButtons:function(ia){var ja,ka;if(!(ia instanceof Array)){ja=ca(arguments);}else ja=ia;for(var la=0;la<ja.length;++la)if(typeof ja[la]=='string'){ka=ha._findButton(ha._STANDARD_BUTTONS,ja[la]);ja[la]=ka;}this._buttons=ja;var ma=[];if(ja&&ja.length>0)for(var na=0;na<ja.length;na++){ka=ja[na];var oa=o.create('input',{type:'button',name:ka.name||'',value:ka.label}),pa=o.create('label',{className:'uiButton uiButtonLarge uiButtonConfirm'},oa);if(ka.className){ka.className.split(/\s+/).forEach(function(ra){m.addClass(pa,ra);});if(m.hasClass(pa,'inputaux')){m.removeClass(pa,'inputaux');m.removeClass(pa,'uiButtonConfirm');}if(m.hasClass(pa,'uiButtonSpecial'))m.removeClass(pa,'uiButtonConfirm');}if(ka.icon)o.prependContent(pa,o.create('img',{src:ka.icon,className:'img mrs'}));if(ka.disabled)l.setEnabled(pa,false);Event.listen(oa,'click',this._handleButton.bind(this,ka.name));for(var qa in ka)if(qa.indexOf('data-')===0&&qa.length>5)oa.setAttribute(qa,ka[qa]);ma.push(pa);}o.setContent(this._nodes.buttons,ma);this._updateButtonVisibility();return this;},setButtonsMessage:function(ia){o.setContent(this._nodes.button_message,this._format(ia||''));this._has_button_message=!!ia;this._updateButtonVisibility();return this;},_updateButtonVisibility:function(){var ia=this._buttons.length>0||this._has_button_message;m.conditionShow(this._nodes.button_wrapper,ia);m.conditionClass(this._obj,'omitDialogFooter',!ia);},setClickButtonOnEnter:function(ia,ja){this._clickOnEnterTarget=ia;if(!this._clickOnEnterListener)this._clickOnEnterListener=Event.listen(this._nodes.body,'keypress',function(event){var ka=event.getTarget();if(ka&&ka.id===this._clickOnEnterTarget)if(Event.getKeyCode(event)==s.RETURN){this._handleButton(ja);event.kill();}return true;}.bind(this));return this;},setStackable:function(ia,ja){this._is_stackable=ia;this._shown_while_stacked=ia&&ja;return this;},setHandler:function(ia){this._handler=ia;return this;},setCancelHandler:function(ia){this._cancelHandler=ha.call_or_eval.bind(null,this,ia);return this;},setCloseHandler:function(ia){this._close_handler=ha.call_or_eval.bind(null,this,ia);return this;},clearHandler:function(){return this.setHandler(null);},setPostURI:function(ia,ja){if(ja===undefined)ja=true;if(ja){this.setHandler(this._submitForm.bind(this,'POST',ia));}else this.setHandler(function(){p.post(ia,this.getFormData());this.hide();}.bind(this));return this;},setGetURI:function(ia){this.setHandler(this._submitForm.bind(this,'GET',ia));return this;},setModal:function(ia){this._modal=ia;m.conditionClass(this._obj,'generic_dialog_modal',ia);return this;},setSemiModal:function(ia){if(ia){this.setModal(true);this._semiModalListener=Event.listen(this._obj,'click',function(ja){if(!o.contains(this._popup,ja.getTarget()))this.hide();}.bind(this));}else this._semiModalListener&&this._semiModalListener.remove();this._semi_modal=ia;return this;},setWideDialog:function(ia){this._wide_dialog=ia;this._updateWidth();return this;},setContentWidth:function(ia){this._content_width=ia;this._updateWidth();return this;},setTitleLoading:function(ia){if(ia===undefined)ia=true;var ja=o.find(this._popup,'h2.dialog_title');if(ja)m.conditionClass(ja,'loading',ia);return this;},setSecure:function(ia){m.conditionClass(this._nodes.title,'secure',ia);return this;},setClassName:function(ia){ia.split(/\s+/).forEach(m.addClass.bind(m,this._obj));return this;},setFadeEnabled:function(ia){this._fade_enabled=ia;return this;},setFooter:function(ia){var ja=this._nodes.footer;o.setContent(ja,this._format(ia||''));m.conditionShow(ja,!!ia);return this;},setAutoFocus:function(ia){this._auto_focus=ia;return this;},setTop:function(ia){this._top=ia;this._resetDialogObj();return this;},onloadRegister:function(ia){ca(ia).forEach(function(ja){if(typeof ja=='string')ja=new Function(ja);this._onload_handlers.push(ja.bind(this));}.bind(this));return this;},setAsyncURL:function(ia){return this.setAsync(new j(ia));},setAsync:function(ia){var ja=function(ra){if(this._async_request!=ia)return;this._async_request=null;var sa=ra.getPayload(),ta=sa;if(this._loading)this._showing=true;if(typeof ta=='string'){this.setBody(ta);}else this._setFromModel(ta);this._update();}.bind(this),ka=ia.getData();ka.__d=1;ia.setData(ka);var la=ia.getHandler()||bagofholding;ia.setHandler(function(ra){la(ra);ja(ra);});var ma=ia,na=ma.getErrorHandler()||bagofholding,oa=ma.getTransportErrorHandler()||bagofholding,pa=function(){this._async_request=null;this._loading=false;if(this._showing&&this._shown_while_stacked){this._update();}else this._hide(this._is_stackable);}.bind(this),qa=ma.getServerDialogCancelHandler()||pa;ma.setAllowCrossPageTransition(this._cross_transition).setErrorHandler(function(ra){pa();na(ra);}).setTransportErrorHandler(function(ra){pa();oa(ra);}).setServerDialogCancelHandler(qa);ia.send();this._async_request=ia;if(this._showing)this.show();return this;},_format:function(ia){if(typeof ia=='string'){ia=q(ia);}else ia=q.replaceJSONWrapper(ia);if(ia instanceof q)ia.setDeferred(true);return ia;},_update:function(){if(!this._showing)return;if(this._autohide&&!this._async_request&&!this._autohide_timeout)this._autohide_timeout=setTimeout(aa(this,'hide'),this._autohide);m.removeClass(this._frame,'dialog_loading_shown');this._loading=false;this._renderDialog();this._runOnloads();this._previous_focus=document.activeElement;r.focus(this._frame);},_runOnloads:function(){for(var ia=0;ia<this._onload_handlers.length;++ia)try{this._onload_handlers[ia]();}catch(ja){}this._onload_handlers=[];},_updateWidth:function(){var ia=2*ha._BORDER_WIDTH;if(ha._isUsingCSSBorders())ia+=2*ha._HALO_WIDTH;if(this._content_width){ia+=this._content_width;if(!this._full_bleed)ia+=2*ha._PADDING_WIDTH;}else if(this._wide_dialog){ia+=ha.SIZE.WIDE;}else ia+=ha.SIZE.STANDARD;this._popup.style.width=ia+'px';},_updateZIndex:function(){if(!this._hasSetZIndex&&this._causal_elem){var ia=ea(this._causal_elem);this._hasSetZIndex=ia>(this._modal?400:200);w.set(this._obj,'z-index',this._hasSetZIndex?ia:'');}},_renderDialog:function(){this._updateZIndex();this._pushOntoStack();this._obj.style.height=(this._modal&&y.ie()<7)?z.getDocumentDimensions().y+'px':null;if(this._obj&&this._obj.style.display){this._obj.style.visibility='hidden';this._obj.style.display='';this.resetDialogPosition();this._obj.style.visibility='';this._obj.dialog=this;}else this.resetDialogPosition();clearInterval(this.active_hiding);this.active_hiding=setInterval(this._activeResize.bind(this),500);this._submit_on_enter=false;if(this._auto_focus){var ia=p.getFirstElement(this._content,['input[type="text"]','textarea','input[type="password"]']);if(ia){p.focusFirst.bind(this,this._content).defer();}else this._submit_on_enter=true;}var ja=z.getElementDimensions(this._content).y+z.getElementPosition(this._content).y;ha._bottoms.push(ja);this._bottom=ja;ha._updateMaxBottom();return this;},_buildDialog:function(){this._obj=o.create('div',{className:'generic_dialog',id:this._uniqueID});this._obj.style.display='none';o.appendContent(document.body,this._obj);if(!this._popup)this._popup=o.create('div',{className:'generic_dialog_popup'});this._obj.appendChild(this._popup);if(y.ie()<7&&!this._shim)k.loadModules(['IframeShim'],function(ua){this._shim=new ua(this._popup);});m.addClass(this._obj,'pop_dialog');if(t.isRTL())m.addClass(this._obj,'pop_dialog_rtl');var ia;if(ha._isUsingCSSBorders()){ia='<div class="pop_container_advanced">'+'<div class="pop_content" id="pop_content"></div>'+'</div>';}else ia='<div class="pop_container">'+'<div class="pop_verticalslab"></div>'+'<div class="pop_horizontalslab"></div>'+'<div class="pop_topleft"></div>'+'<div class="pop_topright"></div>'+'<div class="pop_bottomright"></div>'+'<div class="pop_bottomleft"></div>'+'<div class="pop_content pop_content_old" id="pop_content"></div>'+'</div>';o.setContent(this._popup,q(ia));var ja=o.find(this._popup,'div.pop_content');ja.setAttribute('tabIndex','0');ja.setAttribute('role','alertdialog');this._frame=this._content=ja;var ka=o.create('div',{className:'dialog_loading'},"Loading..."),la=o.create('span'),ma=o.create('h2',{className:'dialog_title hidden_elem',id:'title_'+this._uniqueID},la),na=o.create('div',{className:'dialog_summary hidden_elem'}),oa=o.create('div',{className:'dialog_body'}),pa=o.create('div'),qa=o.create('div',{className:'dialog_buttons_msg'}),ra=o.create('div',{className:'dialog_buttons clearfix hidden_elem'},[qa,pa]),sa=o.create('div',{className:'dialog_footer hidden_elem'}),ta=o.create('div',{className:'dialog_content'},[na,oa,ra,sa]);this._nodes={summary:na,body:oa,buttons:pa,button_message:qa,button_wrapper:ra,footer:sa,content:ta,title:ma,title_inner:la};o.setContent(this._frame,[ma,ta,ka]);},_updateShim:function(){return this._shim&&this._shim.show();},_activeResize:function(){if(this.last_offset_height!=this._content.offsetHeight){this.last_offset_height=this._content.offsetHeight;this.resetDialogPosition();}},resetDialogPosition:function(){if(!this._popup)return;this._resetDialogObj();this._updateShim();},_resetDialogObj:function(){var ia=2*ha._PAGE_MARGIN,ja=z.getViewportDimensions(),ka=ja.x-ia,la=ja.y-ia,ma=2*ha._HALO_WIDTH,na=z.getElementDimensions(this._content),oa=na.x+ma,pa=na.y+ma,qa=this._top,ra=ka-oa,sa=la-pa;if(sa<0){qa=ha._PAGE_MARGIN;}else if(qa>sa)qa=ha._PAGE_MARGIN+(Math.max(sa,0)/2);var ta=ga();if(!ta)qa+=z.getScrollPosition().y;w.set(this._popup,'marginTop',qa+'px');var ua=ta&&(ra<0||sa<0);m.conditionClass(this._obj,'generic_dialog_fixed_overflow',ua);m.conditionClass(document.documentElement,'generic_dialog_overflow_mode',ua);},_fadeOut:function(ia){if(!this._popup)return;try{new h(this._obj).duration(0).checkpoint().to('opacity',0).hide().duration(250).ondone(this._hide.bind(this,ia)).go();}catch(ja){this._hide(ia);}},_hide:function(ia){if(this._obj)this._obj.style.display='none';m.removeClass(document.documentElement,'generic_dialog_overflow_mode');this._updateShim();clearInterval(this.active_hiding);if(this._bottom){var ja=ha._bottoms;ja.splice(ja.indexOf(this._bottom),1);ha._updateMaxBottom();}if(this._previous_focus&&document.activeElement&&o.contains(this._obj,document.activeElement))r.focus(this._previous_focus);if(ia)return;this.destroy();},destroy:function(){this._popFromStack();if(this._obj){o.remove(this._obj);this._obj=null;this._shim&&this._shim.hide();this._shim=null;}this._clickOnEnterListener&&this._clickOnEnterListener.remove();if(this._close_handler)this._close_handler({return_data:this._return_data});},_handleButton:function(ia){if(typeof ia=='string')ia=ha._findButton(this._buttons,ia);var ja=ha.call_or_eval(ia,ia.handler);if(ja===false)return;if(ia.name=='cancel'){this.cancel();}else if(ha.call_or_eval(this,this._handler,{button:ia})!==false)this.hide();},_submitForm:function(ia,ja,ka){var la=this.getFormData();if(ka)la[ka.name]=ka.label;if(this._extra_data)ba(la,this._extra_data);var ma=new j().setURI(ja).setData(la).setMethod(ia).setNectarModuleDataSafe(this._causal_elem).setReadOnly(ia=='GET');this.setAsync(ma);return false;},_setFromModel:function(ia){var ja={};ba(ja,ia);for(var ka in ja){if(ka=='onloadRegister'){this.onloadRegister(ja[ka]);continue;}var la=this['set'+ka.substr(0,1).toUpperCase()+ka.substr(1)];la.apply(this,ca(ja[ka]));}},_updateBottom:function(){var ia=z.getElementDimensions(this._content).y+z.getElementPosition(this._content).y;ha._bottoms[ha._bottoms.length-1]=ia;ha._updateMaxBottom();},_pushOntoStack:function(){var ia=ha._stack;if(!ia.length)i.inform('layer_shown',{type:'Dialog'});ia.remove(this);ia.push(this);for(var ja=ia.length-2;ja>=0;ja--){var ka=ia[ja];if(!ka._is_stackable&&!ka._async_request){ka._hide();}else if(!ka._shown_while_stacked)ka._hide(true);}},_popFromStack:function(){var ia=ha._stack,ja=(ia[ia.length-1]===this);ia.remove(this);if(ia.length){if(ja)ia[ia.length-1].show();}else i.inform('layer_hidden',{type:'Dialog'});}});e.exports=ha;});
__d("legacy:dialog",["Dialog"],function(a,b,c,d){var e=b('Dialog');a.Dialog=e;},3);
__d("legacy:array-utils",["createArrayFrom","hasArrayNature"],function(a,b,c,d){a.$A=b('createArrayFrom');a.hasArrayNature=b('hasArrayNature');},3);
__d("legacy:env",["Env"],function(a,b,c,d){var e=b('Env');a.Env=e;},3);
__d("FlipDirectionOnKeypress",["event-extensions","DOM","Input","Style"],function(a,b,c,d,e,f){b('event-extensions');var g=b('DOM'),h=b('Input'),i=b('Style');Event.listen(document.documentElement,'keyup',function(event){var j=event.getTarget();if(!g.isNodeOfType(j,['input','textarea']))return;if(g.isNodeOfType(j,'input')&&j.type=='password')return;if(j.getAttribute('data-prevent-auto-flip'))return;var k=h.getValue(j),l=(j.style&&j.style.direction);if(!l){var m=0,n=true;for(var o=0;o<k.length;o++){var p=k.charCodeAt(o);if(p>=48){if(n){n=false;m++;}if(p>=1470&&p<=1920){i.set(j,'direction','rtl');return;}if(m==5){i.set(j,'direction','ltr');return;}}else n=true;}}else if(k.length===0)i.set(j,'direction','');});});
__d("PlaceholderOnsubmitFormListener",["event-extensions","Input"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Input');Event.listen(document.documentElement,'submit',function(h){var i=h.getTarget().getElementsByTagName('*');for(var j=0;j<i.length;j++)if(i[j].getAttribute('placeholder')&&g.isEmpty(i[j]))g.setValue(i[j],'');});});
__d("LiveTimer",["CSS","DOM","UserAgent","tx"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('DOM'),i=b('UserAgent'),j=b('tx'),k={restart:function(l){this.serverTime=l;this.localStartTime=Date.now()/1000;this.updateTimeStamps();},getApproximateServerTime:function(){return (this.serverTime-this.localStartTime)*1000+Date.now();},updateTimeStamps:function(){k.timestamps=h.scry(document.body,'abbr.livetimestamp');k.startLoop(20000);},addTimeStamps:function(l){if(!l)return;k.timestamps=k.timestamps||[];if(h.isNodeOfType(l,'abbr')&&g.hasClass(l,'livetimestamp')){k.timestamps.push(l);}else{var m=h.scry(l,'abbr.livetimestamp');for(var n=0;n<m.length;++n)k.timestamps.push(m[n]);}k.startLoop(0);},startLoop:function(l){this.stop();this.timeout=setTimeout(function(){k.loop();},l);},stop:function(){clearTimeout(this.timeout);},updateNode:function(l,m){k.updateNode=(i.ie()<7)?function(n,o){n.nextSibling.nodeValue=o;}:function(n,o){n.firstChild.nodeValue=o;};k.updateNode(l,m);},loop:function(l){if(l)k.updateTimeStamps();var m=Math.floor(k.getApproximateServerTime()/1000),n=-1;k.timestamps&&k.timestamps.forEach(function(p){var q=p.getAttribute('data-utime'),r=k.renderRelativeTime(m,q);if(r.text)k.updateNode(p,r.text);if(r.next!=-1&&(r.next<n||n==-1))n=r.next;});if(n!=-1){var o=Math.max(20000,n*1000);k.timeout=setTimeout(function(){k.loop();},o);}},renderRelativeTime:function(l,m){var n={text:"",next:-1};if(l-m>(12*3600)||(new Date(l*1000).getDay()!=new Date(m*1000).getDay()))return n;var o=l-m,p=Math.floor(o/60),q=Math.floor(p/60);if(p<1){n.text="a few seconds ago";n.next=60-o%60;return n;}if(q<1){if(p==1){n.text="about a minute ago";}else n.text=j._("{number} minutes ago",{number:p});n.next=60-o%60;return n;}if(q!=11)n.next=3600-o%3600;if(q==1){n.text="about an hour ago";return n;}n.text=j._("{number} hours ago",{number:q});return n;}};e.exports=k;});
__d("legacy:live-timer",["LiveTimer"],function(a,b,c,d){a.LiveTimer=b('LiveTimer');},3);
__d("BanzaiCommon",["BanzaiConfig"],function(a,b,c,d,e,f){var g=c('BanzaiConfig'),h={store:true,delay:g.MIN_WAIT||1000},i={store:false,delay:g.MAX_WAIT||60000},j,k,l,m,n;function o(){k=[];l=[];}function p(v){var w=Date.now()+v;if(!n||w<n){n=w;clearTimeout(m);m=setTimeout(r,v);}}function q(v,w,x){x=x||i;var y=[v,w];k.push(y);if(x.store)l.push(y);p(x.delay||60000);}function r(){n=null;p(i.delay);if(j.isSending())return;j.inform(u.SEND);if(k.length<=0){j.inform(u.OK);return;}var v=k;o();j.send(v);}function s(v){j=v;j.onUnload(t.store);}var t=a.sessionStorage?{store:function v(){a.sessionStorage.setItem('Banzai',JSON.stringify(k));},restore:function v(){if('Banzai' in a.sessionStorage){k=[].concat(JSON.parse(a.sessionStorage.getItem('Banzai')));l=[].concat(k);a.sessionStorage.removeItem('Banzai');}}}:{store:function(){},restore:function(){}},u={SEND:'Banzai:SEND',OK:'Banzai:OK',ERROR:'Banzai:ERROR',VITAL:h,SEND_TIMEOUT:15000,isEnabled:function(v){return g.gks&&g.gks[v];},post:q,setAdapter:s,subscribe:function(v,w){j.subscribe(v,w);}};o();t.restore();p(i.delay);e.exports=u;});
__d("BanzaiDesktop",["Arbiter","BanzaiCommon","QueryString","Run","XHR"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('BanzaiCommon'),i=b('QueryString'),j=b('Run'),k=b('XHR'),l=null,m=new g(),n='/ajax/banzai/banzai.php',o={inform:function p(q){m.inform(q);},subscribe:function(p,q){m.subscribe(p,q);},cleanup:function p(){if(l&&l.readyState<4)l.abort();if(l)l=l.onreadystatechange=null;},isSending:function p(){return !!l;},send:function p(q){var r='POST';l=k.create();l.open(r,n,true);l.setRequestHeader('Content-Type','application/x-www-form-urlencoded');l.onreadystatechange=function(){if(l.readyState>=4){var t=l.status;o.cleanup();o.inform(t==200?h.OK:h.ERROR);}};setTimeout(o.cleanup,h.SEND_TIMEOUT,false);var s=k.getAsyncParams(r);s.q=JSON.stringify(q);l.send(i.encode(s));},onUnload:function p(q){j.onUnload(q);}};h.setAdapter(o);e.exports=h;});
__d("JSLogger",[],function(a,b,c,d,e,f){var g={MAX_HISTORY:500,counts:{},categories:{},seq:0,pageId:(Math.random()*2147483648|0).toString(36)};function h(l){if(l instanceof Error&&a.ErrorUtils)l=a.ErrorUtils.normalizeError(l);try{return JSON.stringify(l);}catch(m){return '{}';}}function i(l,event,m){if(!g.counts[l])g.counts[l]={};if(!g.counts[l][event])g.counts[l][event]=0;m=m==null?1:Number(m);g.counts[l][event]+=isFinite(m)?m:0;}g.logAction=function(event,l,m){if(this.type=='bump'){i(this.cat,event,l);}else if(this.type=='rate'){(l&&i(this.cat,event+'_n',m));i(this.cat,event+'_d',m);}else{var n={cat:this.cat,type:this.type,event:event,data:l!=null?h(l):null,date:Date.now(),seq:g.seq++};g.head=g.head?(g.head.next=n):(g.tail=n);while(g.head.seq-g.tail.seq>g.MAX_HISTORY)g.tail=g.tail.next;return n;}};function j(l){if(!g.categories[l]){g.categories[l]={};var m=function(n){var o={cat:l,type:n};g.categories[l][n]=function(){if(document.domain!='facebook.com')return;var p;try{p=a.top.require&&a.top.require('JSLogger')._.logAction;}catch(q){}(p&&p.apply(o,arguments));};};m('debug');m('log');m('warn');m('error');m('bump');m('rate');}return g.categories[l];}function k(l,m){var n=[];for(var o=m||g.tail;o;o=o.next)if(!l||l(o)){var p={type:o.type,cat:o.cat,date:o.date,event:o.event,seq:o.seq};if(o.data)p.data=JSON.parse(o.data);n.push(p);}return n;}e.exports={_:g,DUMP_EVENT:'jslogger/dump',create:j,getEntries:k};});
__d("csx",[],function(a,b,c,d,e,f){function g(h){throw new Error('csx(...): Unexpected class selector transformation.');}e.exports=g;});
__d("AccessibleLayer",["event-extensions","CSS","DOM","Input","copyProperties","csx","tx"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('Input'),j=b('copyProperties'),k=b('csx'),l=b('tx');function m(n){this._layer=n;}j(m.prototype,{enable:function(){var n=this._layer.getRoot();if(n.tabIndex==-1)n.tabIndex=0;var o=h.create('a',{className:'accessible_elem',href:'#'},["Close popup and return"]);h.appendContent(n,o);this._listener=Event.listen(o,'click',this._closeListener.bind(this));this._afterShowSubscription=this._layer.subscribe('aftershow',this._onAfterShow.bind(this));},disable:function(){this._listener.remove();this._afterShowSubscription.unsubscribe();this._listener=this._afterShowSubscription=null;},_closeListener:function(event){var n=this._layer.getCausalElement();if(n){if(n.tabIndex==-1){n.tabIndex=0;g.addClass(n,"-cx-PRIVATE-accessibleLayer__noOutline");}i.focus(n);}this._layer.hide();},_onAfterShow:function(){var n=document.activeElement,o=this._layer.getRoot();if(!h.isNodeOfType(n,['input','textarea'])&&!h.contains(o,n))i.focus(o);}});e.exports=m;});
__d("BehaviorsMixin",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(l){this._behavior=l;this._enabled=false;}g(h.prototype,{enable:function(){if(!this._enabled){this._enabled=true;this._behavior.enable();}},disable:function(){if(this._enabled){this._enabled=false;this._behavior.disable();}}});var i=1;function j(l){if(!l.__BEHAVIOR_ID)l.__BEHAVIOR_ID=i++;return l.__BEHAVIOR_ID;}var k={enableBehavior:function(l){if(!this._behaviors)this._behaviors={};var m=j(l);if(!this._behaviors[m])this._behaviors[m]=new h(new l(this));this._behaviors[m].enable();return this;},disableBehavior:function(l){if(this._behaviors){var m=j(l);if(this._behaviors[m])this._behaviors[m].disable();}return this;},enableBehaviors:function(l){l.forEach(this.enableBehavior.bind(this));return this;},destroyBehaviors:function(){if(this._behaviors){for(var l in this._behaviors)this._behaviors[l].disable();this._behaviors={};}}};e.exports=k;});
__d("CacheStorage",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h={localstorage:i};function i(){this._store=a.localStorage;}i.available=function(){return !!a.localStorage;};g(i.prototype,{keys:function(){var k=[];for(var l=0;l<this._store.length;l++)k.push(this._store.key(l));return k;},get:function(k){return this._store.getItem(k);},set:function(k,l){this._store.setItem(k,l);},remove:function(k){this._store.removeItem(k);},clear:function(){this._store.clear();}});function j(k,l){this._key_prefix=l||'_cs_';this._magic_prefix='_@_';if(k=='AUTO')for(var m in h){var n=h[m];if(n.available()){k=m;break;}}if(k)if(!h[k]||!h[k].available()){this._backend=null;}else this._backend=new h[k]();this._memcache={};}g(j.prototype,{keys:function(){var k=[];if(this._backend){var l=this._backend.keys();for(var m=0;m<l.length;m++)if(l[m].substr(0,this._key_prefix.length)==this._key_prefix)k.push(l[m].substr(this._key_prefix.length));return k;}for(var n in this._memcache)k.push(n);return k;},set:function(k,l){this._memcache[k]=l;if(this._backend){if(typeof l=='string'){l=this._magic_prefix+l;}else l=JSON.stringify(l);this._backend.set(this._key_prefix+k,l);}},get:function(k,l){if(this._memcache[k]!==undefined)return this._memcache[k];var m;if(this._backend){m=this._backend.get(this._key_prefix+k);if(m!==null){if(m.substr(0,this._magic_prefix.length)==this._magic_prefix){m=m.substr(this._magic_prefix.length);}else m=JSON.parse(m);this._memcache[k]=m;}else m=undefined;}if(m===undefined&&l!==undefined){m=l;this._memcache[k]=m;if(this._backend){var n;if(typeof m=='string'){n=this._magic_prefix+m;}else n=JSON.stringify(m);this._backend.set(this._key_prefix+k,n);}}return m;},remove:function(k){delete this._memcache[k];if(this._backend)this._backend.remove(this._key_prefix+k);}});e.exports=j;});
__d("ViewportBounds",["Style","ge"],function(a,b,c,d,e,f){var g=b('Style'),h=b('ge'),i={top:[],right:[],bottom:[],left:[]};function j(n){return function(){var o=0;i[n].forEach(function(p){o=Math.max(o,p.getSize());});return o;};}function k(n){return function(o){return new l(n,o);};}function l(n,o){this.getSide=bagof(n);this.getSize=function(){return typeof o==='function'?o():o;};i[n].push(this);}l.prototype.remove=function(){i[this.getSide()].remove(this);};var m={getTop:j('top'),getRight:j('right'),getBottom:j('bottom'),getLeft:j('left'),addTop:k('top'),addRight:k('right'),addBottom:k('bottom'),addLeft:k('left')};m.addTop(function(){var n=h('blueBar');if(n&&g.isFixed(n))return h('blueBarHolder').offsetHeight;return 0;});e.exports=m;});
__d("DOMScroll",["Animation","Arbiter","DOM","DOMQuery","Vector","ViewportBounds","ge"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Arbiter'),i=b('DOM'),j=b('DOMQuery'),k=b('Vector'),l=b('ViewportBounds'),m=b('ge'),n={SCROLL:'dom-scroll',getScrollState:function(){var o=k.getViewportDimensions(),p=k.getDocumentDimensions(),q=(p.x>o.x),r=(p.y>o.y);q+=0;r+=0;return new k(q,r);},_scrollbarSize:null,_initScrollbarSize:function(){var o=i.create('p');o.style.width='100%';o.style.height='200px';var p=i.create('div');p.style.position='absolute';p.style.top='0px';p.style.left='0px';p.style.visibility='hidden';p.style.width='200px';p.style.height='150px';p.style.overflow='hidden';p.appendChild(o);document.body.appendChild(p);var q=o.offsetWidth;p.style.overflow='scroll';var r=o.offsetWidth;if(q==r)r=p.clientWidth;document.body.removeChild(p);n._scrollbarSize=q-r;},getScrollbarSize:function(){if(n._scrollbarSize===null)n._initScrollbarSize();return n._scrollbarSize;},scrollTo:function(o,p,q,r,s){if(typeof p=='undefined'||p===true)p=750;if(!(o instanceof k)){var t=k.getScrollPosition().x,u=k.getElementPosition(m(o)).y;o=new k(t,u,'document');if(!r)o.y-=l.getTop()/(q?2:1);}if(q){o.y-=k.getViewportDimensions().y/2;}else if(r){o.y-=k.getViewportDimensions().y;o.y+=r;}o=o.convertTo('document');if(p){return new g(document.body).to('scrollTop',o.y).to('scrollLeft',o.x).ease(g.ease.end).duration(p).ondone(s).go();}else if(window.scrollTo){window.scrollTo(o.x,o.y);s&&s();}h.inform(n.SCROLL);},ensureVisible:function(o,p,q,r,s){if(q===undefined)q=10;o=m(o);if(p)o=j.find(o,p);var t=k.getScrollPosition().x,u=k.getScrollPosition().y,v=u+k.getViewportDimensions().y,w=k.getElementPosition(o).y,x=w+k.getElementDimensions(o).y;w-=l.getTop();w-=q;x+=q;if(w<u){n.scrollTo(new k(t,w,'document'),r,false,false,s);}else if(x>v)if(w-(x-v)<u){n.scrollTo(new k(t,w,'document'),r,false,false,s);}else n.scrollTo(new k(t,x,'document'),r,false,true,s);},scrollToTop:function(o){var p=k.getScrollPosition();n.scrollTo(new k(p.x,0,'document'),o!==false);}};e.exports=n;});
__d("DimensionTracking",["event-extensions","AsyncSignal","Cookie","DOMDimensions","Run","isInIframe"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncSignal'),h=b('Cookie'),i=b('DOMDimensions'),j=b('Run'),k=b('isInIframe');function l(){var m=i.getViewportDimensions();h.set('wd',m.width+'x'+m.height);if(Math.random()<.01)new g('/ajax/dimension_context.php',{x:m.width,y:m.height}).send();}if(!k())j.onAfterLoad(function(){setTimeout(l,100);Event.listen(window,'resize',l);Event.listen(window,'focus',l);});});
__d("DocumentTitle",["Arbiter"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=document.title,i=null,j=1500,k=[],l=0,m=null,n=false;function o(){if(k.length>0){if(!n){p(k[l].title);l=++l%k.length;}else q();}else{clearInterval(m);m=null;q();}}function p(s){document.title=s;n=true;}function q(){r.set(i||h,true);n=false;}var r={get:function(){return h;},set:function(s,t){document.title=s;if(!t){h=s;i=null;g.inform('update_title',s);}else i=s;},blink:function(s){var t={title:s};k.push(t);if(m===null)m=setInterval(o,j);return {stop:function(){var u=k.indexOf(t);if(u>=0){k.splice(u,1);if(l>u){l--;}else if(l==u&&l==k.length)l=0;}}};}};e.exports=r;});
__d("HistoryManager",["event-extensions","function-extensions","Cookie","Env","URI","UserAgent","copyProperties","goOrReplace"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('Cookie'),h=b('Env'),i=b('URI'),j=b('UserAgent'),k=b('copyProperties'),l=b('goOrReplace'),m={_IFRAME_BASE_URI:'http://static.ak.facebook.com/common/history_manager.php',history:null,current:0,fragment:null,_setIframeSrcFragment:function(n){n=n.toString();var o=m.history.length-1;m.iframe.src=m._IFRAME_BASE_URI+'?|index='+o+'#'+encodeURIComponent(n);return m;},getIframeSrcFragment:function(){return decodeURIComponent(i(m.iframe.contentWindow.document.location.href).getFragment());},nextframe:function(n,o){if(o){m._setIframeSrcFragment(n);return;}if(n!==undefined){m.iframeQueue.push(n);}else{m.iframeQueue.splice(0,1);m.iframeTimeout=null;m.checkURI();}if(m.iframeQueue.length&&!m.iframeTimeout){var p=m.iframeQueue[0];m.iframeTimeout=setTimeout(function(){m._setIframeSrcFragment(p);},100,false);}},isInitialized:function(){return !!m._initialized;},init:function(){if(!h.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(m._initialized)return m;var n=i(),o=n.getFragment()||'';if(o.charAt(0)==='!'){o=o.substr(1);n.setFragment(o);}if(i.getRequestURI(false).getProtocol().toLowerCase()=='https')m._IFRAME_BASE_URI='https://s-static.ak.facebook.com/common/history_manager.php';k(m,{_initialized:true,fragment:o,orig_fragment:o,history:[n],callbacks:[],lastChanged:Date.now(),canonical:i('#'),fragmentTimeout:null,user:0,iframeTimeout:null,iframeQueue:[],enabled:true,debug:bagofholding});if(window.history&&history.pushState){this.lastURI=document.URL;window.history.replaceState(this.lastURI,null);Event.listen(window,'popstate',function(p){if(p&&p.state&&m.lastURI!=p.state){m.lastURI=p.state;m.lastChanged=Date.now();m.notify(i(p.state).getUnqualifiedURI().toString());}}.bind(m));if(j.safari()<534||j.chrome()<=13){setInterval(m.checkURI,42,false);m._updateRefererURI(this.lastURI);}return m;}m._updateRefererURI(i.getRequestURI(false));if(j.safari()<500||j.firefox()<2){m.enabled=false;return m;}if(j.ie()<8){m.iframe=document.createElement('iframe');k(m.iframe.style,{width:'0',height:'0',frameborder:'0',left:'0',top:'0',position:'absolute'});m._setIframeSrcFragment(o);document.body.insertBefore(m.iframe,document.body.firstChild);}else if('onhashchange' in window){Event.listen(window,'hashchange',function(){m.checkURI.bind(m).defer();});}else setInterval(m.checkURI,42,false);return m;},registerURIHandler:function(n){m.callbacks.push(n);return m;},setCanonicalLocation:function(n){m.canonical=i(n);return m;},notify:function(n){if(n==m.orig_fragment)n=m.canonical.getFragment();for(var o=0;o<m.callbacks.length;o++)try{if(m.callbacks[o](n))return true;}catch(p){}return false;},checkURI:function(){if(Date.now()-m.lastChanged<400)return;if(window.history&&history.pushState){var n=i(document.URL).removeQueryData('ref').toString(),o=i(m.lastURI).removeQueryData('ref').toString();if(n!=o){m.lastChanged=Date.now();m.lastURI=n;if(j.safari()<534)m._updateRefererURI(n);m.notify(i(n).getUnqualifiedURI().toString());}return;}if(j.ie()<8&&m.iframeQueue.length)return;if(j.safari()&&window.history.length==200){if(!m.warned)m.warned=true;return;}var p=i().getFragment();if(p.charAt(0)=='!')p=p.substr(1);if(j.ie()<8)p=m.getIframeSrcFragment();p=p.replace(/%23/g,'#');if(p!=m.fragment.replace(/%23/g,'#')){m.debug([p,' vs ',m.fragment,'whl: ',window.history.length,'QHL: ',m.history.length].join(' '));for(var q=m.history.length-1;q>=0;--q)if(m.history[q].getFragment().replace(/%23/g,'#')==p)break;++m.user;if(q>=0){m.go(q-m.current);}else m.go('#'+p);--m.user;}},_updateRefererURI:function(n){n=n.toString();if(n.charAt(0)!='/'&&n.indexOf('//')==-1)return;var o=new i(window.location);if(o.isFacebookURI()){var p=o.getPath()+window.location.search;}else var p='';var q=i(n).getQualifiedURI().setFragment(p).toString(),r=2048;if(q.length>r)q=q.substring(0,r)+'...';g.set('x-referer',q);},go:function(n,o,p){if(window.history&&history.pushState){o||typeof(n)=='number';var q=i(n).removeQueryData('ref').toString();m.lastChanged=Date.now();this.lastURI=q;if(p){window.history.replaceState(n,null,q);}else window.history.pushState(n,null,q);if(j.safari()<534)m._updateRefererURI(n);return false;}m.debug('go: '+n);if(o===undefined)o=true;if(!m.enabled)if(!o)return false;if(typeof(n)=='number'){if(!n)return false;var r=n+m.current,s=Math.max(0,Math.min(m.history.length-1,r));m.current=s;r=m.history[s].getFragment()||m.orig_fragment;r=i(r).removeQueryData('ref').getUnqualifiedURI().toString();m.fragment=r;m.lastChanged=Date.now();if(j.ie()<8){if(m.fragmentTimeout)clearTimeout(m.fragmentTimeout);m._temporary_fragment=r;m.fragmentTimeout=setTimeout(function(){window.location.hash='#!'+r;delete m._temporary_fragment;},750,false);if(!m.user)m.nextframe(r,p);}else if(!m.user)l(window.location,window.location.href.split('#')[0]+'#!'+r,p);if(o)m.notify(r);m._updateRefererURI(r);return false;}n=i(n);if(n.getDomain()==i().getDomain())n=i('#'+n.getUnqualifiedURI());var t=m.history[m.current].getFragment(),u=n.getFragment();if(u==t||(t==m.orig_fragment&&u==m.canonical.getFragment())){if(o)m.notify(u);m._updateRefererURI(u);return false;}if(p)m.current--;var v=(m.history.length-m.current)-1;m.history.splice(m.current+1,v);m.history.push(i(n));return m.go(1,o,p);},getCurrentFragment:function(){var n=m._temporary_fragment!==undefined?m._temporary_fragment:i.getRequestURI(false).getFragment();return n==m.orig_fragment?m.canonical.getFragment():n;}};e.exports=m;});
__d("JSONPTransport",["DOM","HTML","URI","copyProperties"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('HTML'),i=b('URI'),j=b('copyProperties'),k={},l=2,m='jsonp',n='iframe';function o(p,q,r){this._type=p;this._uri=q;this._handler=r;k[this.getID()]=this;}j(o,{respond:function(p,q,r){var s=k[p];if(s){if(!r)delete k[p];if(s._type==n)q=JSON.parse(JSON.stringify(q));a.async_callback(s.handleResponse.bind(s),'json')(q);}else if(a.logJSError&&!r)a.logJSError('ajax',{error:'UnexpectedJsonResponse',extra:{id:p,uri:(q.payload&&q.payload.uri)||''}});}});j(o.prototype,{getID:function(){return this._id||(this._id=l++);},hasFinished:function(){return !(this.getID() in k);},getRequestURI:function(){return i(this._uri).addQueryData({__a:1,__adt:this.getID()});},createTransportFrame:function(){var p='transport_frame_'+this.getID(),q=h('<iframe class="hidden_elem" name="'+p+'" src="javascript:void(0)" />');return g.appendContent(document.body,q)[0];},send:function(){if(this._type===m){(function(){g.appendContent(document.body,g.create('script',{src:this.getRequestURI().toString(),type:'text/javascript'}));}).bind(this).defer();}else{this._iframe=this.createTransportFrame();this._iframe.src=this.getRequestURI().toString();}},handleResponse:function(p){if(!this._aborted)this._handler(p);if(this.hasFinished())if(this._iframe){g.remove.curry(this._iframe).defer();this._iframe=null;}},abort:function(){this._aborted=true;}});e.exports=o;});
__d("OnVisible",["event-extensions","Arbiter","DOM","Run","Vector","copyProperties","throttle"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('DOM'),i=b('Run'),j=b('Vector'),k=b('copyProperties'),l=b('throttle');function m(n,o,p,q){this.element=n;this.handler=o;this.strict=p;this.buffer=q||300;this.scrollHandler=null;this.reset();i.onLeave(this.remove.bind(this));}k(m.prototype,{reset:function(){if(this.scrollListener)return;this.removed=false;this.scrollHandler=l(function(n){var o=j.getElementPosition(this.element);if(!o||this.removed){this.remove();return;}this.targetY=o.y;var p=j.getScrollPosition().y,q=j.getViewportDimensions().y,r=p+q+this.buffer;if(r>this.targetY){var s=!this.strict||(p-this.buffer<(this.targetY+j.getElementDimensions(this.element).y));if(s){this.remove();this.handler(!n);}}return true;},100,this);(function(){this.scrollListener=Event.listen(window,'scroll',this.scrollHandler);this.resizeListener=Event.listen(window,'resize',this.scrollHandler);this.domScrollListener=g.subscribe('dom-scroll',this.scrollHandler);this.scrollHandler.defer();}).bind(this).defer();},remove:function(){this.removed=true;if(this.scrollListener){this.scrollListener.remove();this.resizeListener.remove();this.domScrollListener.unsubscribe();this.scrollListener=this.resizeListener=this.domScrollListener=null;}},setBuffer:function(n){this.buffer=n;this.scrollHandler&&this.scrollHandler.defer();}});e.exports=m;});
__d("StringEscape",[],function(a,b,c,d,e,f){var g={escapeJSQuotes:function(h){if(typeof h=='undefined'||h==null||!h.valueOf())return '';return h.toString().replace(/\\/g,'\\\\').replace(/\n/g,'\\n').replace(/\r/g,'\\r').replace(/"/g,'\\x22').replace(/'/g,'\\\'').replace(/</g,'\\x3c').replace(/>/g,'\\x3e').replace(/&/g,'\\x26');},htmlSpecialChars:function(h){if(typeof h=='undefined'||h===null||!h.toString)return '';if(h===false){return '0';}else if(h===true)return '1';return h.toString().replace(/&/g,'&amp;').replace(/"/g,'&quot;').replace(/'/g,'&#039;').replace(/</g,'&lt;').replace(/>/g,'&gt;');},htmlize:function(h){return g.htmlSpecialChars(h).replace(/\r\n|[\r\n]/g,'<br />');}};e.exports=g;});
__d("areObjectsEqual",[],function(a,b,c,d,e,f){function g(h,i){return JSON.stringify(h)==JSON.stringify(i);}e.exports=g;});
__d("computeRelativeURI",["URI","isEmpty"],function(a,b,c,d,e,f){var g=b('URI'),h=b('isEmpty');function i(k,l){if(!l)return k;if(l.charAt(0)=='/')return l;var m=k.split('/').slice(0,-1);m[0]!=='';l.split('/').forEach(function(n){if(!(n=='.'))if(n=='..'){if(m.length>1)m=m.slice(0,-1);}else m.push(n);});return m.join('/');}function j(k,l){var m=new g(),n=l;k=new g(k);l=new g(l);if(l.getDomain()&&!l.isFacebookURI())return n;var o=k,p=['Protocol','Domain','Port','Path','QueryData','Fragment'];p.forEach(function(q){var r=q=='Path'&&o===k;if(r)m.setPath(i(k.getPath(),l.getPath()));if(!h(l['get'+q]()))o=l;if(!r)m['set'+q](o['get'+q]());});return m;}e.exports=j;});
__d("PageTransitions",["event-extensions","Arbiter","Dialog","DOM","DOMScroll","Env","Form","HistoryManager","JSLogger","LinkController","OnloadHooks","StringEscape","URI","UserAgent","Vector","areObjectsEqual","computeRelativeURI","copyProperties","ge","goOrReplace","startsWith","tx","userAction"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('Dialog'),i=b('DOM'),j=b('DOMScroll'),k=b('Env'),l=b('Form'),m=b('HistoryManager'),n=b('JSLogger'),o=b('LinkController'),p=b('OnloadHooks'),q=b('StringEscape'),r=b('URI'),s=b('UserAgent'),t=b('Vector'),u=b('areObjectsEqual'),v=b('computeRelativeURI'),w=b('copyProperties'),x=b('ge'),y=b('goOrReplace'),z=b('startsWith'),aa=b('tx'),ba=b('userAction'),ca={_transition_handlers:[],_scroll_positions:{},_scroll_locked:false,isInitialized:function(){return !!ca._initialized;},_init:function(){if(!k.ALLOW_TRANSITION_IN_IFRAME&&window!=window.top)return;if(ca._initialized)return ca;ca._initialized=true;var ea=r.getRequestURI(false),fa=ea.getUnqualifiedURI(),ga=r(fa).setFragment(null),ha=fa.getFragment();if(ha.charAt(0)==='!'&&ga.toString()===ha.substr(1))fa=ga;w(ca,{_current_uri:fa,_most_recent_uri:fa,_next_uri:fa});var ia;if(z(ea.getFragment(),'/')){ia=ea.getFragment();}else ia=fa;m.init().setCanonicalLocation('#'+ia).registerURIHandler(ca._historyManagerHandler);o.registerFallbackHandler(ca._rewriteHref);o.registerFallbackHandler(ca._onlinkclick);Event.listen(document.documentElement,'submit',ca._onformsubmit);Event.listen(window,'scroll',function(){if(!ca._scroll_locked)ca._scroll_positions[ca._current_uri]=t.getScrollPosition();});return ca;},registerHandler:function(ea,fa){ca._init();fa=fa||5;if(!ca._transition_handlers[fa])ca._transition_handlers[fa]=[];ca._transition_handlers[fa].push(ea);},getCurrentURI:function(ea){if(!ca._current_uri&&!ea)return new r(ca._most_recent_uri);return new r(ca._current_uri);},getMostRecentURI:function(){return new r(ca._most_recent_uri);},getNextURI:function(){return new r(ca._next_uri);},_rewriteHref:function(ea){var fa=ea.getAttribute('href'),ga=v(ca._most_recent_uri.getQualifiedURI(),fa).toString();if(fa!=ga)ea.setAttribute('href',ga);},_onlinkclick:function(ea){da.lookBusy(ea);ca.go(ea.getAttribute('href'));return false;},_onformsubmit:function(event){var ea=event.getTarget();if(l.getAttribute(ea,'rel')||l.getAttribute(ea,'target'))return;var fa=ba('form',ea,event).set_namespace('page_transition'),ga=a.ArbiterMonitor;if(ga)ga.initUA(fa,[ea]);var ha=new r(l.getAttribute(ea,'action')||''),ia=v(ca._most_recent_uri,ha);ea.setAttribute('action',ia.toString());if((l.getAttribute(ea,'method')||'GET').toUpperCase()==='GET'){ca.go(ia.addQueryData(l.serialize(ea)));event.kill();}},go:function(ea,fa){var ga=new r(ea).removeQueryData('quickling').getQualifiedURI(),ha=ga.getUnqualifiedURI();delete ca._scroll_positions[ha];!fa&&ba('uri',{href:ga.toString()},null,'INDIRECT');da.lookBusy();ca._loadPage(ga,function(ia){if(ia){m.go(ga.toString(),false,fa);}else y(window.location,ga,fa);});},_historyManagerHandler:function(ea){if(ea.charAt(0)!='/')return false;ba('h',{href:ea},null);ca._loadPage(new r(ea),function(fa){if(!fa)y(window.location,ea,true);});return true;},_loadPage:function(ea,fa){if(r(ea).getFragment()&&u(r(ea).setFragment(null).getQualifiedURI(),r(ca._current_uri).setFragment(null).getQualifiedURI())){ca._current_uri=ca._most_recent_uri=ea;ca.restoreScrollPosition();da.stopLookingBusy();return;}var ga=ca._scroll_positions[ca._current_uri];ca._current_uri=null;ca._next_uri=ea;if(ga)j.scrollTo(ga,false);var ha=function(){ca._scroll_locked=true;var ja=ca._handleTransition(ea);fa&&fa(ja);},ia=p.runHooks('onbeforeleavehooks');if(ia){da.stopLookingBusy();ca._warnBeforeLeaving(ia,ha);}else ha();},_handleTransition:function(ea){window.onbeforeleavehooks=undefined;da.lookBusy();if(!ea.isSameOrigin())return false;var fa=window.AsyncRequest&&window.AsyncRequest.getLastID();g.inform("pre_page_transition",{from:ca.getMostRecentURI(),to:ea});for(var ga=ca._transition_handlers.length-1;ga>=0;--ga){var ha=ca._transition_handlers[ga];if(!ha)continue;for(var ia=ha.length-1;ia>=0;--ia)if(ha[ia](ea)===true){var ja={sender:this,uri:ea,id:fa};try{g.inform("page_transition",ja);}catch(ka){}return true;}else ha.splice(ia,1);}return false;},unifyURI:function(){ca._current_uri=ca._most_recent_uri=ca._next_uri;},transitionComplete:function(ea){ca._executeCompletionCallback();da.stopLookingBusy();ca.unifyURI();if(!ea)ca.restoreScrollPosition();try{if(document.activeElement&&document.activeElement.nodeName==='A')document.activeElement.blur();}catch(fa){}},_executeCompletionCallback:function(){if(ca._completionCallback)ca._completionCallback();ca._completionCallback=null;},setCompletionCallback:function(ea){ca._completionCallback=ea;},rewriteCurrentURI:function(ea,fa){ca.registerHandler(function(){if(ea==ca.getMostRecentURI().getUnqualifiedURI().toString()){ca.transitionComplete();return true;}});ca.go(fa,true);},_warnBeforeLeaving:function(ea,fa){new h().setTitle("Are you sure you want to leave this page?").setBody(q.htmlize(ea)).setButtons([{name:'leave_page',label:"Leave this Page",handler:fa},{name:'continue_editing',label:"Stay on this Page",className:'inputaux'}]).setModal(true).show();},restoreScrollPosition:function(){ca._scroll_locked=false;var ea=ca._current_uri,fa=ca._scroll_positions[ea];if(fa){j.scrollTo(fa,false);return;}function ga(ja){if(!ja)return null;var ka="a[name='"+q.escapeJSQuotes(ja)+"']";return i.scry(document.body,ka)[0]||x(ja);}var ha=ga(r(ea).getFragment());if(ha){var ia=t.getElementPosition(ha);ia.x=0;j.scrollTo(ia);}}},da=window._BusyUIManager||{_looking_busy:false,_original_cursors:[],lookBusy:function(ea){if(ea)da._giveProgressCursor(ea);if(da._looking_busy)return;da._looking_busy=true;da._giveProgressCursor(document.documentElement);},stopLookingBusy:function(){if(!da._looking_busy)return;da._looking_busy=false;while(da._original_cursors.length){var ea=da._original_cursors.pop(),fa=ea[0],ga=ea[1];if(fa.style)fa.style.cursor=ga||'';}},_giveProgressCursor:function(ea){if(!s.safari()){da._original_cursors.push([ea,ea.style.cursor]);ea.style.cursor='progress';}}};e.exports=ca;});
__d("ScrollAwareDOM",["ArbiterMixin","CSS","DOM","DOMPosition","DOMQuery","HTML","Vector","ViewportBounds","copyProperties"],function(a,b,c,d,e,f){var g=b('ArbiterMixin'),h=b('CSS'),i=b('DOM'),j=b('DOMPosition'),k=b('DOMQuery'),l=b('HTML'),m=b('Vector'),n=b('ViewportBounds'),o=b('copyProperties');function p(t,u){return function(){s.monitor(arguments[t],u.curry.apply(u,arguments));};}function q(t){if(!(t instanceof Array))t=[t];for(var u=0;u<t.length;u++){var v=l.replaceJSONWrapper(t[u]);if(v instanceof l){return v.getRootNode();}else if(i.isNode(v))return v;}return null;}function r(t){return j.getElementPosition(t).y>=n.getTop();}var s=o({monitor:function(t,u){var v=q(t);if(v){var w=!!v.offsetParent;if(w&&r(v))return u();var x=m.getDocumentDimensions(),y=u();if(w||(v.offsetParent&&!r(v))){var z=m.getDocumentDimensions().sub(x);if(s.inform('scroll',{delta:z})!==false)z.scrollElementBy(k.getDocumentScrollElement());}return y;}else return u();},replace:function(t,u){var v=q(u);if(!v||h.hasClass(v,'hidden_elem'))v=t;return s.monitor(v,function(){i.replace(t,u);});},prependContent:p(1,i.prependContent),insertAfter:p(1,i.insertAfter),insertBefore:p(1,i.insertBefore),setContent:p(0,i.setContent),appendContent:p(1,i.appendContent),remove:p(0,i.remove),empty:p(0,i.empty)},g);e.exports=s;});
__d("InputSelection",["DOM","Input"],function(a,b,c,d,e,f){var g=b('DOM'),h=b('Input'),i={get:function(j){if(!document.selection)return {start:j.selectionStart,end:j.selectionEnd};var k=document.selection.createRange();if(k.parentElement()!==j)return {start:0,end:0};var l=j.value.length;if(g.isNodeOfType(j,'input')){return {start:-k.moveStart('character',-l),end:-k.moveEnd('character',-l)};}else{var m=k.duplicate();m.moveToElementText(j);m.setEndPoint('StartToEnd',k);var n=l-m.text.length;m.setEndPoint('StartToStart',k);return {start:l-m.text.length,end:n};}},set:function(j,k,l){if(typeof l=='undefined')l=k;if(document.selection){if(j.tagName=='TEXTAREA'){var m=(j.value.slice(0,k).match(/\r/g)||[]).length,n=(j.value.slice(k,l).match(/\r/g)||[]).length;k-=m;l-=m+n;}var o=j.createTextRange();o.collapse(true);o.moveStart('character',k);o.moveEnd('character',l-k);o.select();}else{j.selectionStart=k;j.selectionEnd=Math.min(l,j.value.length);h.focus(j);}}};e.exports=i;});
__d("cx",[],function(a,b,c,d,e,f){function g(h){throw new Error('cx(...): Unexpected class transformation.');}e.exports=g;});
__d("enforceMaxLength",["event-extensions","function-extensions","DOM","Input","InputSelection"],function(a,b,c,d,e,f){b('event-extensions');b('function-extensions');var g=b('DOM'),h=b('Input'),i=b('InputSelection'),j=function(l,m){var n=h.getValue(l),o=n.length,p=o-m;if(p>0){var q,r;try{q=i.get(l);r=q.end;}catch(s){q=null;r=0;}if(r>=p)o=r;var t=o-p;if(t&&(n.charCodeAt(t-1)&64512)===55296)t--;r=Math.min(r,t);h.setValue(l,n.slice(0,t)+n.slice(o));if(q)i.set(l,Math.min(q.start,r),r);}},k=function(event){var l=event.getTarget(),m=l.getAttribute&&parseInt(l.getAttribute('maxlength'),10);if(m>0&&g.isNodeOfType(l,['input','textarea']))j.bind(null,l,m).defer();};Event.listen(document.documentElement,{keydown:k,paste:k});e.exports=j;});
__d("submitForm",["DOM"],function(a,b,c,d,e,f){var g=b('DOM'),h=function(i){var j=g.scry(i,'input[type="submit"]')[0];if(j){j.click();}else{j=g.create('input',{type:'submit',className:'hidden_elem'});g.appendContent(i,j);j.click();g.remove(j);}};e.exports=h;});
__d("PhotosConst",[],function(a,b,c,d,e,f){var g={VIEWER_PERMALINK:0,VIEWER_SNOWLIFT:6,VIEWER_VAULTBOX:8,BULK_EDITOR:3,FLASH_UPLOADER:4,SIZE_NORMAL:'n'};e.exports=g;});
__d("PhotosUtils",["copyProperties","Rect","Vector"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=b('Rect'),i=b('Vector');function j(){}g(j,{getNearestBox:function(k,l){var m=Infinity,n=null;for(var o in k){var p=k[o];if(p.contains(l)){var q=l.distanceTo(p.getCenter());if(q<m){m=q;n=o;}}}return n;},absoluteToNormalizedPosition:function(k,l){var m=i.getElementPosition(k),n=i.getElementDimensions(k),o=l.sub(m).mul(100/n.x,100/n.y);o.domain='pure';return o;},normalizedToAbsolutePosition:function(k,l){var m=i.getElementPosition(k),n=i.getElementDimensions(k),o=l.mul(n.x/100,n.y/100).add(m);o.domain='document';return o;}});e.exports=j;});
__d("TinyViewport",["event-extensions","CSS","DOM","debounce"],function(a,b,c,d,e,f){b('event-extensions');var g=b('CSS'),h=b('DOM'),i=b('debounce'),j=i(function(){var k=document.documentElement,l=h.getDocumentScrollElement(),m=k.clientHeight<400||l.clientWidth<l.scrollWidth;g.conditionClass(k,'tinyViewport',m);g.conditionClass(k,'canHaveFixedElements',!m);});j();Event.listen(window,'resize',j);});
__d("FormDisableOnSubmit",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties');function h(i){this._form=i;}g(h.prototype,{_subscription:null,_disabled:false,enable:function(){this._subscription=this._form.subscribe(['submit','reset'],this._handle.bind(this));},disable:function(){this._form.unsubscribe(this._subscription);this._subscription=null;},_handle:function(i,j){if(i=='submit'){if(this._disabled)return false;this._disabled=true;return true;}this._disabled=false;}});e.exports=h;});
__d("FormSubmitOnChange",["event-extensions","copyProperties","submitForm"],function(a,b,c,d,e,f){b('event-extensions');var g=b('copyProperties'),h=b('submitForm');function i(j){this._form=j;}g(i.prototype,{_listener:null,enable:function(){this._listener=Event.listen(this._form.getRoot(),'change',this._submit.bind(this));},disable:function(){this._listener.remove();this._listener=null;},_submit:function(){h(this._form.getRoot());}});e.exports=i;});
__d("UIForm",["event-extensions","ArbiterMixin","BehaviorsMixin","Class","DOM","Form","FormDisableOnSubmit","FormSubmitOnChange","Run","areObjectsEqual","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('ArbiterMixin'),h=b('BehaviorsMixin'),i=b('Class'),j=b('DOM'),k=b('Form'),l=b('FormDisableOnSubmit'),m=b('FormSubmitOnChange'),n=b('Run'),o=b('areObjectsEqual'),p=b('copyProperties');function q(r,s,t,u){this._root=r;this.controller=r;this._message=s;n.onAfterLoad(function(){this._originalState=k.serialize(this._root);}.bind(this));this._forceDirty=t;this._submitted=false;Event.listen(this._root,'submit',this._handleSubmit.bind(this));if(u&&u.length)this.enableBehaviors(u);var v=true;n.onBeforeUnload(this.checkUnsaved.bind(this),v);}p(q.prototype,g,h,{getRoot:function(){return this._root;},_handleSubmit:function(){if(this.inform('submit')===false)return false;this._submitted=true;return true;},reset:function(){this.inform('reset');this._submitted=false;},isDirty:function(){if(this._submitted||!j.contains(document.body,this._root))return false;if(this._forceDirty)return true;var r=k.serialize(this._root);return !o(r,this._originalState);},checkUnsaved:function(){if(this.isDirty())return this._message;return null;}});e.exports=a.UIForm||q;});
__d("legacy:menu-legacy",["Menu"],function(a,b,c,d){a.Menu=b('Menu');},3);
__d("SubMenu",["event-extensions","Arbiter","copyProperties","CSS"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS');function j(){}h(j.prototype,{_subMenu:null,_mainMenu:null,_forward:null,_backward:null,init:function(k,l,m,n){this._subMenu=k;this._mainMenu=l;this._forward=m;this._backward=n;g.subscribe('SubMenu/Reset',this._goToMainMenu.bind(this));Event.listen(m,'click',this._goToSubMenu.bind(this));Event.listen(n,'click',this._goToMainMenu.bind(this));},initAsyncChildMenu:function(k){Event.listen(this._forward,'click',function(){this._goToSubMenu();k.load();}.bind(this));},_goToMainMenu:function(){i.hide(this._subMenu);i.show(this._mainMenu);},_goToSubMenu:function(){i.hide(this._mainMenu);i.show(this._subMenu);}});e.exports=j;});
__d("legacy:ui-submenu",["SubMenu"],function(a,b,c,d){a.SubMenu=b('SubMenu');},3);
__d("AsyncMenu",["AsyncRequest","copyProperties"],function(a,b,c,d,e,f){var g=b('AsyncRequest'),h=b('copyProperties');function i(){}h(i.prototype,{_uri:null,_elem:null,init:function(j,k){this._uri=j;this._elem=k;},load:function(){this.load=bagofholding;g.bootstrap(this._uri,this._elem);}});e.exports=i;});
__d("legacy:ui-asyncmenu",["AsyncMenu"],function(a,b,c,d){a.AsyncMenu=b('AsyncMenu');},3);
__d("legacy:ARIA",["ARIA"],function(a,b,c,d){a.ARIA=b('ARIA');},3);
__d("CustomPrivacyOption",["event-extensions","AsyncRequest","Dialog","DOM","Form","Parent","Selector","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('AsyncRequest'),h=b('Dialog'),i=b('DOM'),j=b('Form'),k=b('Parent'),l=b('Selector'),m=b('copyProperties');function n(){}m(n,{_instances:{},update:function(o,p,q,r){var s=n._instances[o];s._update(p,q)._updateOption(q,r);Arbiter.inform('Form/change',{node:s._container});},getData:function(o){return n._instances[o]._privacyData;}});m(n.prototype,{init:function(o,p,q,r,s){(function(){var t=this.initCustomState(o,p);if(!t)return;Event.listen(t,'click',function(event){this.openCustomDialog(event,o,q,s);}.bind(this));this._initSelector(t,r);}).bind(this).defer();},_initSelector:function(o,p){this._selector=k.byClass(o,'uiSelector');l.listen(this._selector,'select',function(q){if(q.option._id!=this._id)this.clearCustomState();}.bind(this));if(p)l.setButtonTooltip(this._selector,p);},_updateOption:function(o,p){var q=l.getOption(this._selector,o)||l.getOption(this._selector,PrivacyBaseValue.CUSTOM+'');Arbiter.inform('CustomPrivacyOption/update',{selector:this._selector,option:q,tooltip:p});return this;},_update:function(o,p){var q=p==PrivacyBaseValue.CUSTOM||!l.getOption(this._selector,p),r=this._selector.getAttribute('data-name');this.updateCustomState(o,q,r);return this;},initCustomState:function(o,p){var q=ge(o);if(!q)return q;n._instances[o]=this;this._container=i.find(q,'.customPrivacyInputs');this._id=p;this._privacyData={};var r=j.serialize(this._container);if(r.audience)this._privacyData=r.audience[p];return q;},openCustomDialog:function(event,o,p,q){var r=new g('/ajax/privacy/custom_dialog/').setData({option_id:o,id:this._id,privacy_data:this._privacyData,explain_tags:p,autosave:q});new h().setAsync(r).setModal(true).setCausalElement(event.getTarget()).show();},updateCustomState:function(o,p,q){this.clearCustomState();this._privacyData=m({},o);if(p)if(q){q=q.slice(0,-'[value]'.length);var r={};r[q]=o;j.createHiddenInputs(r,this._container,null,true);}},clearCustomState:function(){this._privacyData={};i.empty(this._container);}});e.exports=n;});
__d("ComposerAudienceSelector",["DynamicIconSelector","CustomPrivacyOption","PrivacyConst","Selector"],function(a,b,c,d,e,f){b('DynamicIconSelector');var g=b('CustomPrivacyOption'),h=b('PrivacyConst'),i=b('Selector'),j={},k={},l={syncSelector:function(m){j[m]&&i.setSelected(m,j[m]);if(j[m]==h.BaseValue.CUSTOM&&k[m]){var n=i.getOption(m,h.BaseValue.CUSTOM+''),o=k[m];(function(){g.update(n.id,o.data,o.audience,o.tooltip);}).defer();}}};e.exports=l;});
__d("legacy:ComposerAudienceSelector",["ComposerAudienceSelector"],function(a,b,c,d){a.ComposerAudienceSelector=b('ComposerAudienceSelector');},3);
__d("legacy:CustomPrivacyOption",["CustomPrivacyOption"],function(a,b,c,d){a.CustomPrivacyOption=b('CustomPrivacyOption');},3);
var FriendListPrivacyOptions=(function(){var a=false,b=false,c=null,d={},e=function(f){if(is_empty(d))PageTransitions.registerHandler(function(){d={};a=false;b=false;});var g=f.getAttribute('data-name');d[g]=f;Selector.listen(f,'select',function(h){var i=h.option,j=DOM.find(i,'a.itemAnchor'),k=j.getAttribute('data-flid');if(!k)return;var l=j.getAttribute('data-dynamic');if(l&&a){FriendListPrivacyOptions.showSmartListNux(i,k);}else if(!l&&b)FriendListPrivacyOptions.showDumbListNux([k]);});};return {listen:function(f,g,h){var i=ge(f);if(!i)return;var j=Parent.byClass(i,'audienceSelector');if(j){e(j);a=g;b=h;}},showSmartListNux:function(f,g){new AsyncRequest('/ajax/friends/lists/smart_list_publish_nux.php').setData({option_id:f.id,flid:g}).send();a=false;},setContextualDialog:function(f,g){var h=Parent.byClass(g,'audienceSelector');if(h){f.setContext(h);f.show();var i=Arbiter.subscribe('composer/publish',function(){f.hide();});f.subscribe('hide',function(){i.unsubscribe();});}},showDumbListNux:function(f){new AsyncRequest('/ajax/friends/lists/dumb_list_publish_nux.php').setData({flids:f}).send();b=false;},showBothListsNux:function(f,g){c=f;FriendListPrivacyOptions.showDumbListNux(g);},setDialog:function(){if(!c)return;var f=Dialog.getCurrent();if(f)f.setCloseHandler(function(){FriendListPrivacyOptions.showSmartListNux(c);c=null;});}};})();
function OnlyMePrivacyOption(){}copy_properties(OnlyMePrivacyOption.prototype,{init:function(a){this._selector=Parent.byClass(a,'composerAudienceSelector');this._plusLabel=DOM.find(a,'.plusLabel');if(!this._selector)return;this._elem=a;this._taggedIDs=[];this._tags=[];this._eventTag=null;this._recalculateTooltipAndLabel();this._updateSelector();Arbiter.subscribe('Composer/changedtags',function(b,c){var d=this._eventTag;this._eventTag=c.eventTag;this._tags=c.withTags.map(function(f){return f.getText();});this._taggedIDs=c.withTags.map(function(f){return f.getValue();});for(var e in c.mention)if(c.mention[e].type=='user'&&c.mention[e].uid!=Env.user){this._tags.push(c.mention[e].text);this._taggedIDs.push(c.mention[e].uid);}if(d!=this._eventTag&&Selector.isOptionSelected(this._elem))Arbiter.inform('EventTagged/changed',this._getChangedData());if(this._recalculateTooltipAndLabel()&&Selector.isOptionSelected(this._elem)){this._updateSelector();Arbiter.inform('SelectedPrivacyOption/changed',this._getChangedData());}}.bind(this));Selector.listen(this._selector,'change',this._updateSelector.bind(this));},_getChangedData:function(){return {eventTag:this._eventTag,tags:this._taggedIDs,privacy:PrivacyFriendsValue.SELF};},_recalculateTooltipAndLabel:function(){var a=this._tooltip,b=this._label;if(this._taggedIDs.length){this._tooltip="Anyone tagged";this._label="Only Me"+' (+)';}else{this._tooltip="Only you";this._label="Only Me";}CSS.conditionShow(this._plusLabel,this._taggedIDs.length);return (a!=this._tooltip)||(b!=this._label);},_updateSelector:function(){if(Selector.isOptionSelected(this._elem)){Selector.setButtonLabel(this._selector,this._label);Selector.setButtonTooltip(this._selector,this._tooltip);return false;}return true;}});
function FriendsPrivacyOption(){this.parent.construct(this);}Class.extend(FriendsPrivacyOption,'OnlyMePrivacyOption');FriendsPrivacyOption.prototype.init=function(a,b){this._hasRestricted=b;this.parent.init(a);};FriendsPrivacyOption.prototype._getChangedData=function(){return {eventTag:this._eventTag,tags:this._taggedIDs,privacy:PrivacyFriendsValue.ALL_FRIENDS};};FriendsPrivacyOption.prototype._recalculateTooltipAndLabel=function(){var a=this._eventTag,b=this._tags.length,c=this._tooltip,d=this._label;if(b>2){if(a){this._tooltip=this._hasRestricted?"Your friends, friends of anyone tagged and anyone invited to this event; Except: Restricted":"Your friends, friends of anyone tagged and anyone invited to this event";}else this._tooltip=this._hasRestricted?"Your friends and friends of anyone tagged; Except: Restricted":"Your friends and friends of anyone tagged";}else if(b==2){if(a){if(this._hasRestricted){this._tooltip="Your friends, friends of anyone tagged and anyone invited to this event; Except: Restricted";}else this._tooltip="Your friends, friends of anyone tagged and anyone invited to this event";}else if(this._hasRestricted){this._tooltip=tx._("Your friends, {user}'s friends and {user2}'s friends; Except: Restricted ",{user:this._tags[0],user2:this._tags[1]});}else this._tooltip=tx._("Your friends, {user}'s friends and {user2}'s friends",{user:this._tags[0],user2:this._tags[1]});}else if(b==1){if(a){if(this._hasRestricted){this._tooltip=tx._("Your friends, {user}'s friends and anyone invited to this event; Except: Restricted",{user:this._tags[0]});}else this._tooltip=tx._("Your friends, {user}'s friends and anyone invited to this event",{user:this._tags[0]});}else if(this._hasRestricted){this._tooltip=tx._("Your friends and {user}'s friends; Except: Restricted",{user:this._tags[0]});}else this._tooltip=tx._("Your friends and {user}'s friends",{user:this._tags[0]});}else if(a){this._tooltip=this._hasRestricted?"Your friends and anyone invited to this event; Except: Restricted":"Your friends and anyone invited to this event";}else this._tooltip=this._hasRestricted?"Your friends; Except: Restricted":"Your friends";CSS.conditionShow(this._plusLabel,this._tags.length);this._label=this._elem.getAttribute('data-label');if(this._tags.length||this._eventTag)this._label+=' (+)';return (c!=this._tooltip)||(d!=this._label);};
__d("legacy:LayerDestroyOnHide",["LayerDestroyOnHide"],function(a,b,c,d){a.LayerDestroyOnHide=b('LayerDestroyOnHide');},3);
function MetaComposerEdDialog(){}copy_properties(MetaComposerEdDialog.prototype,{init:function(a,b,c,d,e,f,g){MetaComposerEdDialog.timesTagEduShown=c;MetaComposerEdDialog.timesEventTagEduShown=e;MetaComposerEdDialog.timesStickyEduShown=g;if(MetaComposerEdDialog.singleton){a.destroy();return;}MetaComposerEdDialog.singleton=this;this._dialog=a;if(f)Arbiter.subscribe('composer/mutate',function(h,i){this._sendEducationRequest({sticky_num:MetaComposerEdDialog.timesStickyEduShown},'/ajax/composer/audience/sticky_education');}.bind(this));if(d)if(e===0){Arbiter.subscribe('EventTagged/changed',function(h,i){this._sendEducationRequest({id:"composerTourAudience",event_tag_num:MetaComposerEdDialog.timesEventTagEduShown},'ajax/events/tagging/user_education',null);}.bind(this));}else Arbiter.subscribe('EventTagged/changed',function(h,i){this._sendEducationRequest({ids:i.tags,from:'AtTagger',eventID:i.eventTag,type:i.privacy,tag_num:MetaComposerEdDialog.timesTagEduShown,event_tag_num:MetaComposerEdDialog.timesEventTagEduShown},'ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));if(b)Arbiter.subscribe('SelectedPrivacyOption/changed',function(h,i){this._sendEducationRequest({ids:i.tags,from:'WithTagger',eventID:i.eventTag,type:i.privacy,tag_num:MetaComposerEdDialog.timesTagEduShown,event_tag_num:MetaComposerEdDialog.timesEventTagEduShown},'/ajax/composer/audience/tag_education',this._handler.bind(this));}.bind(this));Selector.subscribe('open',this._killAnim.bind(this));},_sendEducationRequest:function(a,b,c){if(!this._updateDialogContext())return;this._async&&this._async.abort();this._async=new AsyncRequest(b);this._async.setData(a).setHandler(c).send();},_updateDialogContext:function(){var a=DOM.scry(document.body,'div.composerAudienceWrapper')[0],b=Vector2.getElementPosition(a);if(a&&b.x>0&&b.y>0){this._dialog.setContext(a);return true;}return false;},_handler:function(a){var b=a.payload;if(!b||!this._updateDialogContext())return;var c=this._dialog.getContent();DOM.setContent(c,b);ARIA.announce(DOM.getText(c));this._dialog.disableBehavior(LayerDestroyOnHide).show();var d=Parent.byClass(c,'metaComposerUserEd');if(this._anim){this._anim.stop();this._anim=animation(d);}else this._anim=animation(d).from('opacity',0);this._anim.by('opacity',1).checkpoint().duration(3500).checkpoint().to('opacity',0).checkpoint().ondone(this._killAnim.bind(this)).go();},_killAnim:function(a,b){if(this._anim){this._anim.stop();this._dialog.hide(false);this._anim=null;}}});
__d("TooltipLink",["Parent","Tooltip"],function(a,b,c,d,e,f){var g=b('Parent'),h=b('Tooltip'),i={setTooltipText:function(j,k){j=g.byTag(j,'a');j&&h.set(j,k);}};e.exports=i;});
__d("BanzaiODS",["BanzaiDesktop"],function(a,b,c,d,e,f){var g=b('BanzaiDesktop'),h={};function i(k,l,m,n){var o=h[k]||(h[k]={});o=o[l]||(o[l]={});o=o[m]||(o[m]=[]);for(var p=0;p<n.length;p++){var q=n[p]==null?1:Number(n[p]);if(isFinite(q))o[p]=(o[p]||0)+q;}}g.subscribe(g.SEND,function(){for(var k in h){g.post('ods',h);break;}h={};});var j={bumpEntityKey:function(k,l,m){i('bEK',k,l,[m]);},bumpFraction:function(k,l,m,n){i('bF',k,l,[m,n]);}};e.exports=j;});
__d("OptionStorage",["copyProperties"],function(a,b,c,d,e,f){var g=b('copyProperties'),h=window.localStorage||null;function i(j,k,l){this.name=j;this.reviver=k||this._reviver;this.replacer=l||this._replacer;this._read();}g(i.prototype,{_read:function(j,k){if(h&&h[this.name]){this.options=JSON.parse(h[this.name],this.reviver);}else this.options={};},_write:function(){if(h){var j=g({},this.options);h[this.name]=JSON.stringify(j,this.replacer);}},_reviver:function(j,k){if(k){var l=/^\[RegExp (.*)\]$/.test(k)&&RegExp.$1;if(l)k=new RegExp(l.replace(/^\/|\/$/g,''));return k;}},_replacer:function(j,k){if(k instanceof RegExp){k='[RegExp '+k+']';this[j]=k;}return k;},get:function(j,k){return j in this.options?this.options[j]:k;},set:function(j,k){if(k==null){delete this.options[j];}else this.options[j]=k;this._write();}});e.exports=i;});
__d("RenderManager",["function-extensions","copyProperties"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties');function h(i){this._isDirty=false;this._obj=i;}g(h.prototype,{dirty:function(){if(!this._isDirty){this._isDirty=true;this._doPaint.bind(this).defer();}},_doPaint:function(){this._isDirty=false;this._obj.paint();}});e.exports=h;});
__d("CounterDisplay",["Arbiter","CSS","DOM","RenderManager","Run","$","copyProperties"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('CSS'),i=b('DOM'),j=b('RenderManager'),k=b('Run'),l=b('$'),m=b('copyProperties');function n(o,p,q,r,s,t){m(this,{_name:o,_valueNode:l(p),_wrapperNode:l(q)||null,_statusClass:s,_rm:new j(this),_arbiterSubscription:null,_count:0});var u=this._valueNode.firstChild;if(u){var v=parseInt(u.nodeValue,10);if(!isNaN(v))this._count=v;}this._statusNode=r?l(r):null;this._subscribeAll();n.instances.push(this);if(!t)k.onLeave(this._destroy.bind(this),true);}m(n,{EVENT_TYPE_ADJUST:'CounterDisplay/adjust',EVENT_TYPE_UPDATE:'CounterDisplay/update',instances:[],adjustCount:function(o,p){g.inform(n.EVENT_TYPE_ADJUST+'/'+o,p);},setCount:function(o,p){g.inform(n.EVENT_TYPE_UPDATE+'/'+o,p);}});m(n.prototype,{_destroy:function(){delete this._valueNode;delete this._wrapperNode;if(this._arbiterSubscription){this._arbiterSubscription.unsubscribe();delete this._arbiterSubscription;}n.instances.remove(this);},adjustCount:function(o){this._count=Math.max(0,this._count+o);this._rm.dirty();return this;},setCount:function(o){this._count=Math.max(0,o);this._rm.dirty();return this;},paint:function(){i.setContent(this._valueNode,this._count);this._toggleNodes();},_toggleNodes:function(){if(this._wrapperNode)h.conditionClass(this._wrapperNode,'hidden_elem',this._count<=0);if(this._statusClass&&this._statusNode)h.conditionClass(this._statusNode,this._statusClass,this._count>0);},_subscribeAll:function(){var o=[n.EVENT_TYPE_ADJUST+'/'+this._name,n.EVENT_TYPE_UPDATE+'/'+this._name];this._arbiterSubscription=g.subscribe(o,this._onInform.bind(this),g.SUBSCRIBE_NEW);},_onInform:function(o,p){p=parseInt(p);if(isNaN(p))return;if(o.indexOf(n.EVENT_TYPE_ADJUST)!=-1){this.adjustCount(p);}else if(o.indexOf(n.EVENT_TYPE_UPDATE)!=-1){this.setCount(p);}else return;return;}});e.exports=n;});
__d("ContextualLayerUpdateOnScroll",["event-extensions","Class","copyProperties"],function(a,b,c,d,e,f){b('event-extensions');var g=b('Class'),h=b('copyProperties');function i(j){this._layer=j;}h(i.prototype,{_subscriptions:[],enable:function(){this._subscriptions=[this._layer.subscribe('show',this._attachScrollListener.bind(this)),this._layer.subscribe('hide',this._removeScrollListener.bind(this))];},disable:function(){while(this._subscriptions.length)this._subscriptions.pop().unsubscribe();this.detach();},_attachScrollListener:function(){if(this._listener)return;var j=this._layer.getContextScrollParent();this._listener=Event.listen(j,'scroll',this._layer.updatePosition.bind(this._layer));},_removeScrollListener:function(){this._listener&&this._listener.remove();this._listener=null;}});e.exports=i;});
__d("Quickling",["AjaxPipeRequest","Arbiter","Class","DocumentTitle","DOM","HTML","OnloadHooks","PageTransitions","Run","URI","UserAgent","copyProperties","goOrReplace","isEmpty","QuicklingConfig"],function(a,b,c,d,e,f){var g=b('AjaxPipeRequest'),h=b('Arbiter'),i=b('Class'),j=b('DocumentTitle'),k=b('DOM'),l=b('HTML'),m=b('OnloadHooks'),n=b('PageTransitions'),o=b('Run'),p=b('URI'),q=b('UserAgent'),r=b('copyProperties'),s=b('goOrReplace'),t=b('isEmpty'),u=c('QuicklingConfig'),v=u.version,w=u.sessionLength,x=new RegExp(u.inactivePageRegex),y=0,z,aa='',ba={isActive:function(){return true;},isPageActive:function(ia){if(ia=='#')return false;ia=new p(ia);if(ia.getDomain()&&ia.getDomain()!=p().getDomain())return false;if(ia.getPath()=='/l.php'){var ja=ia.getQueryData().u;if(ja){ja=p(unescape(ja)).getDomain();if(ja&&ja!=p().getDomain())return false;}}var ka=ia.getPath(),la=ia.getQueryData();if(!t(la))ka+='?'+p.implodeQuery(la);return !x.test(ka);}};function ca(ia){ia=ia||'Facebook';j.set(ia);if(q.ie()){aa=ia;if(!z)z=window.setInterval(function(){var ja=aa,ka=j.get();if(ja!=ka)j.set(ja);},5000,false);}}function da(ia){var ja=document.getElementsByTagName('link');for(var ka=0;ka<ja.length;++ka){if(ja[ka].rel!='alternate')continue;k.remove(ja[ka]);}if(ia.length){var la=k.find(document,'head');la&&k.appendContent(la,l(ia[0]));}}function ea(ia){var ja={version:v};this.parent.construct(this,ia,{quickling:ja});}i.extend(ea,g);r(ea.prototype,{_preBootloadFirstResponse:function(ia){return true;},_fireDomContentCallback:function(){this._request.cavalry&&this._request.cavalry.setTimeStamp('t_domcontent');n.transitionComplete();this._onPageDisplayed&&this._onPageDisplayed(this.pipe);this.parent._fireDomContentCallback();},_fireOnloadCallback:function(){if(this._request.cavalry){this._request.cavalry.setTimeStamp('t_hooks');this._request.cavalry.setTimeStamp('t_layout');this._request.cavalry.setTimeStamp('t_onload');}this.parent._fireOnloadCallback();},isPageActive:function(ia){return ba.isPageActive(ia);},_versionCheck:function(ia){if(ia.version==v)return true;var ja=['quickling','ajaxpipe','ajaxpipe_token'];s(window.location,p(ia.uri).removeQueryData(ja),true);return false;},_processFirstResponse:function(ia){var ja=ia.getPayload();ca(ja.title);da(ja.syndication||[]);window.scrollTo(0,0);var ka=ja.body_class||'';document.body.className=ka;},getSanitizedParameters:function(){return ['quickling'];}});function fa(){y++;return y>=w;}function ga(ia){g.setCurrentRequest(null);if(fa())return false;if(!ba.isPageActive(ia))return false;window.ExitTime=Date.now();o.__removeHook('onafterloadhooks');o.__removeHook('onloadhooks');m.runHooks('onleavehooks');h.inform('onload/exit',true);new ea(ia).setCanvasId('content').send();return true;}function ha(ia){window[ia+'_native']=(function(ja){return function ka(la,ma){return ja(la,ma);};})(window[ia]);window[ia]=function ja(ka,la,ma){var na=window[ia+'_native'](ka,la);if(la>0)if(ma!==false)o.onLeave(function(){clearInterval(na);});return na;};}ha('setInterval');ha('setTimeout');n.registerHandler(ga,1);e.exports=a.Quickling=ba;});
__d("throttleAcrossTransitions",["debounce"],function(a,b,c,d,e,f){var g=b('debounce');function h(i,j,k){return g(i,j,k,true,true);}e.exports=h;});
__d("UserActionHistory",["Arbiter","ClickRefUtils","throttleAcrossTransitions"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('ClickRefUtils'),i=b('throttleAcrossTransitions'),j={click:1,submit:1},k=false,l={log:[],len:0},m=i(function(){try{k._ua_log=JSON.stringify(l);}catch(p){k=false;}},1000);function n(){try{if(a.sessionStorage){k=a.sessionStorage;k._ua_log&&(l=JSON.parse(k._ua_log));}}catch(p){k=false;}l.log[l.len%10]={ts:Date.now(),path:'-',index:l.len,type:'init',iref:'-'};l.len++;g.subscribe("UserAction/new",function(q,r){var s=r.ua,t=r.node,event=r.event;if(!event||!(event.type in j))return;var u={path:window._script_path,type:event.type,ts:s._ue_ts,iref:h.get_intern_ref(t)||'-',index:l.len};l.log[l.len++%10]=u;k&&m();});}function o(){return l.log.sort(function(p,q){return (q.ts!=p.ts)?(q.ts-p.ts):(q.index-p.index);});}n();e.exports={getHistory:o};});
__d("ClearableTypeahead",["event-extensions"],function(a,b,c,d,e,f){b('event-extensions');var g={resetOnCloseButtonClick:function(h,i){Event.listen(i,'click',function(){var j=h.getCore();j.reset();j.getElement().focus();});}};e.exports=g;});
__d("TypeaheadShowLoadingIndicator",["CSS","copyProperties"],function(a,b,c,d,e,f){var g=b('CSS'),h=b('copyProperties');function i(j){this._typeahead=j;}h(i.prototype,{_subscription:null,enable:function(){this._subscription=this._typeahead.subscribe('loading',function(j,k){g.conditionClass(this._typeahead.getElement(),'typeaheadLoading',k.loading);g.conditionClass(this._typeahead.getView().getElement(),'typeaheadViewLoading',k.loading);}.bind(this));},disable:function(){this._typeahead.unsubscribe(this._subscription);this._subscription=null;}});e.exports=i;});
__d("legacy:ShowLoadingIndicatorTypeaheadBehavior",["TypeaheadShowLoadingIndicator"],function(a,b,c,d){var e=b('TypeaheadShowLoadingIndicator');if(!a.TypeaheadBehaviors)a.TypeaheadBehaviors={};a.TypeaheadBehaviors.showLoadingIndicator=function(f){f.enableBehavior(e);};},3);
__d("curry",["bind"],function(a,b,c,d,e,f){var g=b('bind'),h=g(null,g,null);e.exports=h;});
__d("highlight",["Animation","Style"],function(a,b,c,d,e,f){var g=b('Animation'),h=b('Style');function i(j,k,l){new g(j).from('background','#fff9d7').to('background',l||'#fff').ease(g.ease.both).duration(2000).ondone(function(){h.set(j,'background','');k&&k();}).go();}e.exports=i;});
__d("ScrollHighlight",["DOMScroll","highlight","CSS"],function(a,b,c,d,e,f){var g=b('DOMScroll'),h=b('highlight'),i=b('CSS'),j={actOn:function(k){g.scrollTo(k);h(k,null,'#EDEFF4');i.removeClass(k,'highlightComment');}};e.exports=j;});
__d("ScrollingPager",["Arbiter","copyProperties","CSS","OnVisible","UIPagelet","$","ge"],function(a,b,c,d,e,f){var g=b('Arbiter'),h=b('copyProperties'),i=b('CSS'),j=b('OnVisible'),k=b('UIPagelet'),l=b('$'),m=b('ge'),n={};function o(p,q,r,s){this.scroll_loader_id=p;this.pagelet_src=q;this.data=r;this.options=s||{};if(this.options.target_id){this.target_id=this.options.target_id;this.options.append=true;}else this.target_id=p;this.handler=null;}h(o,{getInstance:function(p){return n[p];}});h(o.prototype,{setBuffer:function(p){this.options.buffer=p;this.onvisible&&this.onvisible.setBuffer(p);},getBuffer:function(){return this.options.buffer;},register:function(){this.onvisible=new j(l(this.scroll_loader_id),this.getHandler(),false,this.options.buffer,this.options);n[this.scroll_loader_id]=this;},getInstance:function(p){return n[p];},getHandler:function(){if(this.handler)return this.handler;function p(q){var r=m(this.scroll_loader_id);if(!r){this.onvisible.remove();return;}i.addClass(r.firstChild,'async_saving');var s=this.options.handler;this.options.handler=function(){g.inform('ScrollingPager/loadingComplete');s&&s.apply(null,arguments);};if(q)this.data.pager_fired_on_init=true;k.loadFromEndpoint(this.pagelet_src,this.target_id,this.data,this.options);}return p.bind(this);},setHandler:function(p){this.handler=p;},removeOnVisible:function(){this.onvisible.remove();}});e.exports=o;});
__d("ButtonGroup",["function-extensions","copyProperties","createArrayFrom","CSS","DataStore","Parent"],function(a,b,c,d,e,f){b('function-extensions');var g=b('copyProperties'),h=b('createArrayFrom'),i=b('CSS'),j=b('DataStore'),k=b('Parent'),l='firstItem',m='lastItem';function n(s,t){var u=k.byClass(s,t);if(!u)throw new Error('invalid use case');return u;}function o(s){return i.shown(s)&&h(s.childNodes).some(i.shown);}function p(s){var t,u,v;h(s.childNodes).forEach(function(w){v=o(w);i.removeClass(w,l);i.removeClass(w,m);i.conditionShow(w,v);if(v){t=t||w;u=w;}});t&&i.addClass(t,l);u&&i.addClass(u,m);i.conditionShow(s,t);}function q(s,t){var u=n(t,'uiButtonGroupItem');s(u);p(u.parentNode);}function r(s){this._root=n(s,'uiButtonGroup');j.set(this._root,'ButtonGroup',this);p(this._root);}r.getInstance=function(s){var t=n(s,'uiButtonGroup'),u=j.get(t,'ButtonGroup');return u||new r(t);};g(r.prototype,{hideItem:q.curry(i.hide),showItem:q.curry(i.show),toggleItem:q.curry(i.toggle)});e.exports=r;});
__d("legacy:ui-scrolling-pager-js",["ScrollingPager"],function(a,b,c,d){a.ScrollingPager=b('ScrollingPager');},3);
var StreamShareVideo={_endpoints:[],_thumbs:[],registerThumb:function(a,b,c,d){StreamShareVideo._endpoints[a+' '+c]=d;StreamShareVideo._thumbs[a+' '+c]=b;},clickTitle:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;var c=ge(StreamShareVideo._thumbs[a+' '+b]);if(c){CSS.addClass(c,"uiVideoThumbLoading");AsyncRequest.bootstrap(StreamShareVideo._endpoints[a+' '+b],c);return false;}return true;},clickTimeline:function(a,b,event){if(StreamShareVideo._shouldFollowHref(event))return true;CSS.addClass(a,'externalShareLoading');CSS.removeClass(a,'externalShareUnitVideo');AsyncRequest.bootstrap(b,a);return false;},_shouldFollowHref:function(event){event=$E(event);if(!event)return false;if(event.getModifiers().any||event.isMiddleClick())return true;return false;}};